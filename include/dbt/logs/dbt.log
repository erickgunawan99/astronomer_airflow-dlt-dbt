[0m12:33:20.357059 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70526447eb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x705264cd0bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x705264e86f30>]}


============================== 12:33:20.365356 | 7c09d7f9-6899-4149-9117-8d1e01641700 ==============================
[0m12:33:20.365356 [info ] [MainThread]: Running with dbt=1.10.6
[0m12:33:20.366355 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'debug': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt debug', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:33:20.398820 [info ] [MainThread]: dbt version: 1.10.6
[0m12:33:20.399558 [info ] [MainThread]: python version: 3.12.3
[0m12:33:20.400296 [info ] [MainThread]: python path: /home/adminxx/astro-dlt-dbt/venv/bin/python3
[0m12:33:20.400952 [info ] [MainThread]: os info: Linux-6.6.87.2-microsoft-standard-WSL2-x86_64-with-glibc2.39
[0m12:33:20.523275 [info ] [MainThread]: Using profiles dir at /home/adminxx/astro-dlt-dbt/include/dbt
[0m12:33:20.524045 [info ] [MainThread]: Using profiles.yml file at /home/adminxx/astro-dlt-dbt/include/dbt/profiles.yml
[0m12:33:20.524781 [info ] [MainThread]: Using dbt_project.yml file at /home/adminxx/astro-dlt-dbt/include/dbt/dbt_project.yml
[0m12:33:20.526282 [info ] [MainThread]: adapter type: postgres
[0m12:33:20.526857 [info ] [MainThread]: adapter version: 1.9.0
[0m12:33:20.763885 [info ] [MainThread]: Configuration:
[0m12:33:20.764727 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m12:33:20.765327 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m12:33:20.765900 [info ] [MainThread]: Required dependencies:
[0m12:33:20.766469 [debug] [MainThread]: Executing "git --help"
[0m12:33:20.805082 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--config-env=<name>=<envvar>] <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m12:33:20.805910 [debug] [MainThread]: STDERR: "b''"
[0m12:33:20.806434 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m12:33:20.807220 [info ] [MainThread]: Connection:
[0m12:33:20.808034 [info ] [MainThread]:   host: 127.0.0.1
[0m12:33:20.808917 [info ] [MainThread]:   port: 5433
[0m12:33:20.809698 [info ] [MainThread]:   user: admin
[0m12:33:20.810449 [info ] [MainThread]:   database: test_db
[0m12:33:20.811205 [info ] [MainThread]:   schema: dbt_model
[0m12:33:20.811964 [info ] [MainThread]:   connect_timeout: 10
[0m12:33:20.812844 [info ] [MainThread]:   role: None
[0m12:33:20.813959 [info ] [MainThread]:   search_path: None
[0m12:33:20.815267 [info ] [MainThread]:   keepalives_idle: 0
[0m12:33:20.816575 [info ] [MainThread]:   sslmode: None
[0m12:33:20.817920 [info ] [MainThread]:   sslcert: None
[0m12:33:20.819205 [info ] [MainThread]:   sslkey: None
[0m12:33:20.820943 [info ] [MainThread]:   sslrootcert: None
[0m12:33:20.822036 [info ] [MainThread]:   application_name: dbt
[0m12:33:20.823002 [info ] [MainThread]:   retries: 1
[0m12:33:20.824062 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m12:33:21.002936 [debug] [MainThread]: Acquiring new postgres connection 'debug'
[0m12:33:21.060797 [debug] [MainThread]: Using postgres connection "debug"
[0m12:33:21.061480 [debug] [MainThread]: On debug: select 1 as id
[0m12:33:21.062004 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:33:21.122536 [debug] [MainThread]: SQL status: SELECT 1 in 0.060 seconds
[0m12:33:21.123994 [debug] [MainThread]: On debug: Close
[0m12:33:21.124861 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m12:33:21.125534 [info ] [MainThread]: [32mAll checks passed![0m
[0m12:33:21.127922 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 0.8959144, "process_in_blocks": "67112", "process_kernel_time": 0.756418, "process_mem_max_rss": "116732", "process_out_blocks": "24", "process_user_time": 2.674871}
[0m12:33:21.128659 [debug] [MainThread]: Command `dbt debug` succeeded at 12:33:21.128503 after 0.90 seconds
[0m12:33:21.129155 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m12:33:21.129768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7052643692e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7052653d0f80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x705265960ec0>]}
[0m12:33:21.130355 [debug] [MainThread]: Flushing usage events
[0m12:33:22.084011 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:34:03.862732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77bfb7c65e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77bfb85f8dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77bfb85f90d0>]}


============================== 12:34:03.869307 | dd2880ac-8e7d-4cee-b129-53f5f380af42 ==============================
[0m12:34:03.869307 [info ] [MainThread]: Running with dbt=1.10.6
[0m12:34:03.870224 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt debug', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:34:03.885539 [info ] [MainThread]: dbt version: 1.10.6
[0m12:34:03.886247 [info ] [MainThread]: python version: 3.12.3
[0m12:34:03.887165 [info ] [MainThread]: python path: /home/adminxx/astro-dlt-dbt/venv/bin/python3
[0m12:34:03.887833 [info ] [MainThread]: os info: Linux-6.6.87.2-microsoft-standard-WSL2-x86_64-with-glibc2.39
[0m12:33:56.719695 [info ] [MainThread]: Using profiles dir at /home/adminxx/astro-dlt-dbt/include/dbt
[0m12:33:56.720666 [info ] [MainThread]: Using profiles.yml file at /home/adminxx/astro-dlt-dbt/include/dbt/profiles.yml
[0m12:33:56.721415 [info ] [MainThread]: Using dbt_project.yml file at /home/adminxx/astro-dlt-dbt/include/dbt/dbt_project.yml
[0m12:33:56.722442 [info ] [MainThread]: adapter type: postgres
[0m12:33:56.723382 [info ] [MainThread]: adapter version: 1.9.0
[0m12:33:56.992714 [info ] [MainThread]: Configuration:
[0m12:33:56.993991 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m12:33:56.994539 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m12:33:56.995379 [info ] [MainThread]: Required dependencies:
[0m12:33:56.996053 [debug] [MainThread]: Executing "git --help"
[0m12:33:57.000959 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--config-env=<name>=<envvar>] <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m12:33:57.001794 [debug] [MainThread]: STDERR: "b''"
[0m12:33:57.002754 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m12:33:57.003689 [info ] [MainThread]: Connection:
[0m12:33:57.004536 [info ] [MainThread]:   host: localhost
[0m12:33:57.005306 [info ] [MainThread]:   port: 5433
[0m12:33:57.005858 [info ] [MainThread]:   user: admin
[0m12:33:57.006429 [info ] [MainThread]:   database: test_db
[0m12:33:57.007016 [info ] [MainThread]:   schema: dbt_model
[0m12:33:57.007676 [info ] [MainThread]:   connect_timeout: 10
[0m12:33:57.008230 [info ] [MainThread]:   role: None
[0m12:33:57.008770 [info ] [MainThread]:   search_path: None
[0m12:33:57.009361 [info ] [MainThread]:   keepalives_idle: 0
[0m12:33:57.009927 [info ] [MainThread]:   sslmode: None
[0m12:33:57.010561 [info ] [MainThread]:   sslcert: None
[0m12:33:57.011233 [info ] [MainThread]:   sslkey: None
[0m12:33:57.012121 [info ] [MainThread]:   sslrootcert: None
[0m12:33:57.012941 [info ] [MainThread]:   application_name: dbt
[0m12:33:57.013615 [info ] [MainThread]:   retries: 1
[0m12:33:57.014409 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m12:33:57.146816 [debug] [MainThread]: Acquiring new postgres connection 'debug'
[0m12:33:57.195426 [debug] [MainThread]: Using postgres connection "debug"
[0m12:33:57.196074 [debug] [MainThread]: On debug: select 1 as id
[0m12:33:57.196573 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:33:57.214415 [debug] [MainThread]: SQL status: SELECT 1 in 0.018 seconds
[0m12:33:57.216066 [debug] [MainThread]: On debug: Close
[0m12:33:57.216776 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m12:33:57.217457 [info ] [MainThread]: [32mAll checks passed![0m
[0m12:33:57.219376 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 0.81221473, "process_in_blocks": "0", "process_kernel_time": 0.749453, "process_mem_max_rss": "117296", "process_out_blocks": "24", "process_user_time": 2.723623}
[0m12:33:57.220102 [debug] [MainThread]: Command `dbt debug` succeeded at 12:33:57.219949 after 0.81 seconds
[0m12:33:57.220626 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m12:33:57.221149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77bfb87f1760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77bfb7b341a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77bfb7a5e900>]}
[0m12:33:57.221726 [debug] [MainThread]: Flushing usage events
[0m12:33:58.556993 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:55:03.750833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee652fb9df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee65325edb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee655880fe0>]}


============================== 23:55:03.763020 | 28a2ad96-2980-4f0d-bcbf-e32c3b67dcee ==============================
[0m23:55:03.763020 [info ] [MainThread]: Running with dbt=1.10.6
[0m23:55:03.763968 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt debug', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:55:03.794985 [info ] [MainThread]: dbt version: 1.10.6
[0m23:55:03.795840 [info ] [MainThread]: python version: 3.12.3
[0m23:55:03.796489 [info ] [MainThread]: python path: /home/adminxx/astro-dlt-dbt/venv/bin/python3
[0m23:55:03.797275 [info ] [MainThread]: os info: Linux-6.6.87.2-microsoft-standard-WSL2-x86_64-with-glibc2.39
[0m23:55:03.938586 [info ] [MainThread]: Using profiles dir at /home/adminxx/astro-dlt-dbt/include/dbt
[0m23:55:03.939296 [info ] [MainThread]: Using profiles.yml file at /home/adminxx/astro-dlt-dbt/include/dbt/profiles.yml
[0m23:55:03.939822 [info ] [MainThread]: Using dbt_project.yml file at /home/adminxx/astro-dlt-dbt/include/dbt/dbt_project.yml
[0m23:55:03.941106 [info ] [MainThread]: adapter type: postgres
[0m23:55:03.941963 [info ] [MainThread]: adapter version: 1.9.0
[0m23:55:04.142303 [info ] [MainThread]: Configuration:
[0m23:55:04.143046 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m23:55:04.143615 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m23:55:04.144183 [info ] [MainThread]: Required dependencies:
[0m23:55:04.144760 [debug] [MainThread]: Executing "git --help"
[0m23:55:04.153331 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--config-env=<name>=<envvar>] <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m23:55:04.154358 [debug] [MainThread]: STDERR: "b''"
[0m23:55:04.154892 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m23:55:04.155467 [info ] [MainThread]: Connection:
[0m23:55:04.156047 [info ] [MainThread]:   host: localhost
[0m23:55:04.156608 [info ] [MainThread]:   port: 5433
[0m23:55:04.157189 [info ] [MainThread]:   user: admin
[0m23:55:04.157703 [info ] [MainThread]:   database: test_db
[0m23:55:04.158232 [info ] [MainThread]:   schema: dbt_model
[0m23:55:04.158761 [info ] [MainThread]:   connect_timeout: 10
[0m23:55:04.159264 [info ] [MainThread]:   role: None
[0m23:55:04.159742 [info ] [MainThread]:   search_path: None
[0m23:55:04.160229 [info ] [MainThread]:   keepalives_idle: 0
[0m23:55:04.160813 [info ] [MainThread]:   sslmode: None
[0m23:55:04.161306 [info ] [MainThread]:   sslcert: None
[0m23:55:04.161789 [info ] [MainThread]:   sslkey: None
[0m23:55:04.162333 [info ] [MainThread]:   sslrootcert: None
[0m23:55:04.162908 [info ] [MainThread]:   application_name: dbt
[0m23:55:04.163469 [info ] [MainThread]:   retries: 1
[0m23:55:04.164386 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:55:04.285697 [debug] [MainThread]: Acquiring new postgres connection 'debug'
[0m23:55:04.333866 [debug] [MainThread]: Using postgres connection "debug"
[0m23:55:04.334683 [debug] [MainThread]: On debug: select 1 as id
[0m23:55:04.335193 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:55:04.359455 [debug] [MainThread]: SQL status: SELECT 1 in 0.024 seconds
[0m23:55:04.361114 [debug] [MainThread]: On debug: Close
[0m23:55:04.361922 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m23:55:04.362649 [info ] [MainThread]: [32mAll checks passed![0m
[0m23:55:04.364367 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 0.72543234, "process_in_blocks": "67080", "process_kernel_time": 0.727785, "process_mem_max_rss": "117192", "process_out_blocks": "24", "process_user_time": 2.659216}
[0m23:55:04.365332 [debug] [MainThread]: Command `dbt debug` succeeded at 23:55:04.365148 after 0.73 seconds
[0m23:55:04.365960 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m23:55:04.366629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee6531e0620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee652ae5400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee652aa88f0>]}
[0m23:55:04.367439 [debug] [MainThread]: Flushing usage events
[0m23:55:05.842260 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:55:26.173950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda077e9a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda077e96a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda077e9910>]}


============================== 23:55:26.179682 | 4ba30549-ad6a-4b3e-beeb-0019779c2417 ==============================
[0m23:55:26.179682 [info ] [MainThread]: Running with dbt=1.10.6
[0m23:55:26.180548 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:55:26.489361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4ba30549-ad6a-4b3e-beeb-0019779c2417', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda0718e870>]}
[0m23:55:26.626807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4ba30549-ad6a-4b3e-beeb-0019779c2417', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda07f8e390>]}
[0m23:55:26.627926 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:55:34.370339 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m23:55:34.371234 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m23:55:34.371844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '4ba30549-ad6a-4b3e-beeb-0019779c2417', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda06d996d0>]}
[0m23:55:28.215674 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.staging
[0m23:55:28.230739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4ba30549-ad6a-4b3e-beeb-0019779c2417', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda06dcfb30>]}
[0m23:55:28.339003 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:55:28.346186 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:55:28.368214 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4ba30549-ad6a-4b3e-beeb-0019779c2417', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda0617b740>]}
[0m23:55:28.369037 [info ] [MainThread]: Found 1 model, 4 sources, 434 macros
[0m23:55:28.369604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4ba30549-ad6a-4b3e-beeb-0019779c2417', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda071aff20>]}
[0m23:55:28.372125 [info ] [MainThread]: 
[0m23:55:28.372892 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:55:28.373644 [info ] [MainThread]: 
[0m23:55:28.374616 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:55:28.376281 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:55:28.438942 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:55:28.440067 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:55:28.440833 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:55:28.458146 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.017 seconds
[0m23:55:28.460002 [debug] [ThreadPool]: On list_test_db: Close
[0m23:55:28.461288 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now create_test_db_dbt_model)
[0m23:55:28.462175 [debug] [ThreadPool]: Creating schema "database: "test_db"
schema: "dbt_model"
"
[0m23:55:28.470052 [debug] [ThreadPool]: Using postgres connection "create_test_db_dbt_model"
[0m23:55:28.470780 [debug] [ThreadPool]: On create_test_db_dbt_model: BEGIN
[0m23:55:28.471610 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:55:28.484399 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m23:55:28.485002 [debug] [ThreadPool]: Using postgres connection "create_test_db_dbt_model"
[0m23:55:28.485502 [debug] [ThreadPool]: On create_test_db_dbt_model: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "create_test_db_dbt_model"} */
create schema if not exists "dbt_model"
[0m23:55:28.493653 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.008 seconds
[0m23:55:28.495161 [debug] [ThreadPool]: On create_test_db_dbt_model: COMMIT
[0m23:55:28.495813 [debug] [ThreadPool]: Using postgres connection "create_test_db_dbt_model"
[0m23:55:28.496269 [debug] [ThreadPool]: On create_test_db_dbt_model: COMMIT
[0m23:55:28.498652 [debug] [ThreadPool]: SQL status: COMMIT in 0.002 seconds
[0m23:55:28.499249 [debug] [ThreadPool]: On create_test_db_dbt_model: Close
[0m23:55:28.501377 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_test_db_dbt_model, now list_test_db_dbt_model)
[0m23:55:28.511326 [debug] [ThreadPool]: Using postgres connection "list_test_db_dbt_model"
[0m23:55:28.512182 [debug] [ThreadPool]: On list_test_db_dbt_model: BEGIN
[0m23:55:28.512787 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:55:28.528142 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m23:55:28.528737 [debug] [ThreadPool]: Using postgres connection "list_test_db_dbt_model"
[0m23:55:28.529264 [debug] [ThreadPool]: On list_test_db_dbt_model: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_dbt_model"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_model'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_model'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'dbt_model'
  
[0m23:55:28.537977 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.008 seconds
[0m23:55:28.540895 [debug] [ThreadPool]: On list_test_db_dbt_model: ROLLBACK
[0m23:55:28.541806 [debug] [ThreadPool]: On list_test_db_dbt_model: Close
[0m23:55:28.547545 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:28.548069 [debug] [MainThread]: On master: BEGIN
[0m23:55:28.548615 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:55:28.563078 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m23:55:28.563924 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:28.564601 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:55:28.576839 [debug] [MainThread]: SQL status: SELECT 0 in 0.011 seconds
[0m23:55:28.578462 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4ba30549-ad6a-4b3e-beeb-0019779c2417', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda06dcd130>]}
[0m23:55:28.579090 [debug] [MainThread]: On master: ROLLBACK
[0m23:55:28.580040 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:28.580537 [debug] [MainThread]: On master: BEGIN
[0m23:55:28.581516 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:55:28.581973 [debug] [MainThread]: On master: COMMIT
[0m23:55:28.582414 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:28.582833 [debug] [MainThread]: On master: COMMIT
[0m23:55:28.583599 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:55:28.584054 [debug] [MainThread]: On master: Close
[0m23:55:28.591167 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m23:55:28.592109 [info ] [Thread-1 (]: 1 of 1 START sql table model dbt_model.stg_comments ............................ [RUN]
[0m23:55:28.592955 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_dbt_model, now model.mongo_movies.stg_comments)
[0m23:55:28.593491 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m23:55:28.609226 [debug] [Thread-1 (]: Compilation Error in model stg_comments (models/staging/stg_comments.sql)
  Model 'model.mongo_movies.stg_comments' (models/staging/stg_comments.sql) depends on a node named 'mongo_data.comments' which was not found
[0m23:55:28.612513 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ba30549-ad6a-4b3e-beeb-0019779c2417', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda05943fb0>]}
[0m23:55:28.613557 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model dbt_model.stg_comments ................... [[31mERROR[0m in 0.02s]
[0m23:55:28.614642 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m23:55:28.615902 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.stg_comments' to be skipped because of status 'error'.  Reason: Compilation Error in model stg_comments (models/staging/stg_comments.sql)
  Model 'model.mongo_movies.stg_comments' (models/staging/stg_comments.sql) depends on a node named 'mongo_data.comments' which was not found.
[0m23:55:28.619930 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:28.620428 [debug] [MainThread]: On master: BEGIN
[0m23:55:28.620913 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:55:28.637014 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m23:55:28.637683 [debug] [MainThread]: On master: COMMIT
[0m23:55:28.638232 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:28.638790 [debug] [MainThread]: On master: COMMIT
[0m23:55:28.639678 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:55:28.640656 [debug] [MainThread]: On master: Close
[0m23:55:28.641772 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:55:28.642465 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m23:55:28.643185 [info ] [MainThread]: 
[0m23:55:28.644235 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.27 seconds (0.27s).
[0m23:55:28.647717 [debug] [MainThread]: Command end result
[0m23:55:28.679414 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:55:28.681605 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:55:28.689012 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m23:55:28.689703 [info ] [MainThread]: 
[0m23:55:28.690772 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:55:28.691435 [info ] [MainThread]: 
[0m23:55:28.692259 [error] [MainThread]: [31mFailure in model stg_comments (models/staging/stg_comments.sql)[0m
[0m23:55:28.692921 [error] [MainThread]:   Compilation Error in model stg_comments (models/staging/stg_comments.sql)
  Model 'model.mongo_movies.stg_comments' (models/staging/stg_comments.sql) depends on a node named 'mongo_data.comments' which was not found
[0m23:55:28.693441 [info ] [MainThread]: 
[0m23:55:28.694205 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m23:55:28.695618 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.656874, "process_in_blocks": "744", "process_kernel_time": 0.663013, "process_mem_max_rss": "128748", "process_out_blocks": "2520", "process_user_time": 4.473345}
[0m23:55:28.696285 [debug] [MainThread]: Command `dbt run` failed at 23:55:28.696142 after 2.66 seconds
[0m23:55:28.696799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda07d19670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda0bbb33b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda086f4500>]}
[0m23:55:28.697311 [debug] [MainThread]: Flushing usage events
[0m23:55:29.816600 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:57:27.686482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd86421790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd85e74530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd85feb260>]}


============================== 23:57:27.691050 | f79d0c83-4cae-46d7-8d21-b7266571d065 ==============================
[0m23:57:27.691050 [info ] [MainThread]: Running with dbt=1.10.6
[0m23:57:27.691844 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:57:27.985463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f79d0c83-4cae-46d7-8d21-b7266571d065', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd86022060>]}
[0m23:57:28.105239 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f79d0c83-4cae-46d7-8d21-b7266571d065', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd856cf9b0>]}
[0m23:57:28.106331 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:57:28.260142 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m23:57:28.407199 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m23:57:28.408065 [debug] [MainThread]: Partial parsing: added file: mongo_movies://models/sources/sources.yml
[0m23:57:28.730269 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.staging
[0m23:57:28.742953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f79d0c83-4cae-46d7-8d21-b7266571d065', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd8392ed50>]}
[0m23:57:28.827342 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:57:28.829685 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:57:28.845911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f79d0c83-4cae-46d7-8d21-b7266571d065', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd841df0e0>]}
[0m23:57:28.846569 [info ] [MainThread]: Found 1 model, 4 sources, 434 macros
[0m23:57:28.847122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f79d0c83-4cae-46d7-8d21-b7266571d065', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd839cf6e0>]}
[0m23:57:28.849155 [info ] [MainThread]: 
[0m23:57:28.849734 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:57:28.850254 [info ] [MainThread]: 
[0m23:57:28.851062 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:57:28.852443 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:57:28.913545 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:57:28.914130 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:57:28.914702 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:57:28.931860 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.017 seconds
[0m23:57:28.933712 [debug] [ThreadPool]: On list_test_db: Close
[0m23:57:28.935786 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_dbt_model)
[0m23:57:28.944707 [debug] [ThreadPool]: Using postgres connection "list_test_db_dbt_model"
[0m23:57:28.945299 [debug] [ThreadPool]: On list_test_db_dbt_model: BEGIN
[0m23:57:28.945911 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:57:28.959135 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m23:57:28.959622 [debug] [ThreadPool]: Using postgres connection "list_test_db_dbt_model"
[0m23:57:28.960319 [debug] [ThreadPool]: On list_test_db_dbt_model: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_dbt_model"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_model'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_model'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'dbt_model'
  
[0m23:57:28.965053 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m23:57:28.966770 [debug] [ThreadPool]: On list_test_db_dbt_model: ROLLBACK
[0m23:57:28.967519 [debug] [ThreadPool]: On list_test_db_dbt_model: Close
[0m23:57:28.973636 [debug] [MainThread]: Using postgres connection "master"
[0m23:57:28.974143 [debug] [MainThread]: On master: BEGIN
[0m23:57:28.974669 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:57:28.988091 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m23:57:28.988942 [debug] [MainThread]: Using postgres connection "master"
[0m23:57:28.989740 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:57:28.997720 [debug] [MainThread]: SQL status: SELECT 0 in 0.007 seconds
[0m23:57:28.999713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f79d0c83-4cae-46d7-8d21-b7266571d065', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd8276e000>]}
[0m23:57:29.000444 [debug] [MainThread]: On master: ROLLBACK
[0m23:57:29.001311 [debug] [MainThread]: Using postgres connection "master"
[0m23:57:29.001760 [debug] [MainThread]: On master: BEGIN
[0m23:57:29.002854 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:57:29.003475 [debug] [MainThread]: On master: COMMIT
[0m23:57:29.003989 [debug] [MainThread]: Using postgres connection "master"
[0m23:57:29.004619 [debug] [MainThread]: On master: COMMIT
[0m23:57:29.005464 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:57:29.005937 [debug] [MainThread]: On master: Close
[0m23:57:29.011716 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m23:57:29.012621 [info ] [Thread-1 (]: 1 of 1 START sql table model dbt_model.stg_comments ............................ [RUN]
[0m23:57:29.013365 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_dbt_model, now model.mongo_movies.stg_comments)
[0m23:57:29.013942 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m23:57:29.033736 [debug] [Thread-1 (]: Compilation Error in model stg_comments (models/staging/stg_comments.sql)
  Model 'model.mongo_movies.stg_comments' (models/staging/stg_comments.sql) depends on a node named 'mongo_data.comments' which was not found
[0m23:57:29.036994 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f79d0c83-4cae-46d7-8d21-b7266571d065', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd8670eb70>]}
[0m23:57:29.038106 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model dbt_model.stg_comments ................... [[31mERROR[0m in 0.02s]
[0m23:57:29.039068 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m23:57:29.039953 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.stg_comments' to be skipped because of status 'error'.  Reason: Compilation Error in model stg_comments (models/staging/stg_comments.sql)
  Model 'model.mongo_movies.stg_comments' (models/staging/stg_comments.sql) depends on a node named 'mongo_data.comments' which was not found.
[0m23:57:29.044492 [debug] [MainThread]: Using postgres connection "master"
[0m23:57:29.045050 [debug] [MainThread]: On master: BEGIN
[0m23:57:29.045497 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:57:29.058978 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m23:57:29.059682 [debug] [MainThread]: On master: COMMIT
[0m23:57:29.060368 [debug] [MainThread]: Using postgres connection "master"
[0m23:57:29.060851 [debug] [MainThread]: On master: COMMIT
[0m23:57:29.061622 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:57:29.062086 [debug] [MainThread]: On master: Close
[0m23:57:29.062847 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:57:29.063282 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m23:57:29.063793 [info ] [MainThread]: 
[0m23:57:29.064624 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.21 seconds (0.21s).
[0m23:57:29.065900 [debug] [MainThread]: Command end result
[0m23:57:29.092724 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:57:29.095320 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:57:29.102519 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m23:57:29.103011 [info ] [MainThread]: 
[0m23:57:29.103645 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:57:29.104315 [info ] [MainThread]: 
[0m23:57:29.104941 [error] [MainThread]: [31mFailure in model stg_comments (models/staging/stg_comments.sql)[0m
[0m23:57:29.105596 [error] [MainThread]:   Compilation Error in model stg_comments (models/staging/stg_comments.sql)
  Model 'model.mongo_movies.stg_comments' (models/staging/stg_comments.sql) depends on a node named 'mongo_data.comments' which was not found
[0m23:57:29.106138 [info ] [MainThread]: 
[0m23:57:29.106679 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m23:57:29.107879 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.5254292, "process_in_blocks": "0", "process_kernel_time": 0.737032, "process_mem_max_rss": "126984", "process_out_blocks": "2512", "process_user_time": 3.354494}
[0m23:57:29.108562 [debug] [MainThread]: Command `dbt run` failed at 23:57:29.108425 after 1.53 seconds
[0m23:57:29.109083 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd89bb33b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd85feb410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd85fe9070>]}
[0m23:57:29.109751 [debug] [MainThread]: Flushing usage events
[0m23:57:30.477377 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:00:18.741303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779034ade420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7790342941a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7790351cc290>]}


============================== 00:00:18.746239 | e55c3a5f-6ac4-4a42-8452-10fa5ec998b4 ==============================
[0m00:00:18.746239 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:00:18.747205 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m00:00:19.064978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e55c3a5f-6ac4-4a42-8452-10fa5ec998b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77903690d0d0>]}
[0m00:00:19.215282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e55c3a5f-6ac4-4a42-8452-10fa5ec998b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779034bfade0>]}
[0m00:00:19.216384 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:00:19.367318 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:00:19.505115 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:00:19.506057 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/staging/stg_comments.sql
[0m00:00:19.928735 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_comments (models/staging/stg_comments.sql)
  source() takes exactly two arguments (1 given)
[0m00:00:19.931030 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.2962924, "process_in_blocks": "0", "process_kernel_time": 0.702624, "process_mem_max_rss": "118228", "process_out_blocks": "16", "process_user_time": 3.321499}
[0m00:00:19.932087 [debug] [MainThread]: Command `dbt run` failed at 00:00:19.931827 after 1.30 seconds
[0m00:00:19.932896 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7790349c9670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779033bed940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779033befb60>]}
[0m00:00:19.933480 [debug] [MainThread]: Flushing usage events
[0m00:00:21.189165 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:00:45.897300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f181a2c1e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f181bf46540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1819c1e630>]}


============================== 00:00:45.902761 | e41c7cb3-aa58-46a4-9ef2-49e7731ca4ba ==============================
[0m00:00:45.902761 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:00:45.903977 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:00:46.259198 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e41c7cb3-aa58-46a4-9ef2-49e7731ca4ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1818ef8a10>]}
[0m00:00:46.390219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e41c7cb3-aa58-46a4-9ef2-49e7731ca4ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1819b5c8c0>]}
[0m00:00:46.391926 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:00:46.549197 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:00:46.702060 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:00:46.703472 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/staging/stg_comments.sql
[0m00:00:47.162455 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_comments (models/staging/stg_comments.sql)
  source() takes exactly two arguments (1 given)
[0m00:00:47.164356 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.4020687, "process_in_blocks": "0", "process_kernel_time": 0.613527, "process_mem_max_rss": "118024", "process_out_blocks": "16", "process_user_time": 3.295842}
[0m00:00:47.165327 [debug] [MainThread]: Command `dbt run` failed at 00:00:47.165121 after 1.40 seconds
[0m00:00:47.165961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f181a2c1e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1818705760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1817b8bc50>]}
[0m00:00:47.166561 [debug] [MainThread]: Flushing usage events
[0m00:00:48.129841 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:01:18.964199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72359e7e14c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72359e3ad190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72359e8697f0>]}


============================== 00:01:18.969693 | e7398bf7-c5bd-4b00-ae67-3f477554edb4 ==============================
[0m00:01:18.969693 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:01:18.970633 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m00:01:19.316861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e7398bf7-c5bd-4b00-ae67-3f477554edb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7235a091b860>]}
[0m00:01:19.449547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e7398bf7-c5bd-4b00-ae67-3f477554edb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72359e77cd70>]}
[0m00:01:19.450928 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:01:19.619045 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:01:19.774738 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:01:19.775829 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/staging/stg_comments.sql
[0m00:01:20.279006 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.staging
[0m00:01:20.298820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e7398bf7-c5bd-4b00-ae67-3f477554edb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72359c1e4ec0>]}
[0m00:01:20.408330 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:01:20.410737 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:01:20.428200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e7398bf7-c5bd-4b00-ae67-3f477554edb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72359e7e2e10>]}
[0m00:01:20.428915 [info ] [MainThread]: Found 1 model, 4 sources, 434 macros
[0m00:01:20.429548 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e7398bf7-c5bd-4b00-ae67-3f477554edb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72359c1783e0>]}
[0m00:01:20.432155 [info ] [MainThread]: 
[0m00:01:20.432982 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:01:20.433628 [info ] [MainThread]: 
[0m00:01:20.434525 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:01:20.436134 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:01:20.498174 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:01:20.499062 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:01:20.499762 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:01:20.519412 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.020 seconds
[0m00:01:20.521810 [debug] [ThreadPool]: On list_test_db: Close
[0m00:01:20.524299 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_dbt_model)
[0m00:01:20.531946 [debug] [ThreadPool]: Using postgres connection "list_test_db_dbt_model"
[0m00:01:20.532489 [debug] [ThreadPool]: On list_test_db_dbt_model: BEGIN
[0m00:01:20.532973 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:01:20.549436 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m00:01:20.550095 [debug] [ThreadPool]: Using postgres connection "list_test_db_dbt_model"
[0m00:01:20.550632 [debug] [ThreadPool]: On list_test_db_dbt_model: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_dbt_model"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_model'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_model'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'dbt_model'
  
[0m00:01:20.556719 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m00:01:20.559544 [debug] [ThreadPool]: On list_test_db_dbt_model: ROLLBACK
[0m00:01:20.560552 [debug] [ThreadPool]: On list_test_db_dbt_model: Close
[0m00:01:20.567012 [debug] [MainThread]: Using postgres connection "master"
[0m00:01:20.567698 [debug] [MainThread]: On master: BEGIN
[0m00:01:20.568226 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:01:20.582428 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m00:01:20.583445 [debug] [MainThread]: Using postgres connection "master"
[0m00:01:20.584103 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:01:20.592266 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m00:01:20.594108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e7398bf7-c5bd-4b00-ae67-3f477554edb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72359cd702c0>]}
[0m00:01:20.594891 [debug] [MainThread]: On master: ROLLBACK
[0m00:01:20.596204 [debug] [MainThread]: Using postgres connection "master"
[0m00:01:20.596761 [debug] [MainThread]: On master: BEGIN
[0m00:01:20.597922 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:01:20.598445 [debug] [MainThread]: On master: COMMIT
[0m00:01:20.598975 [debug] [MainThread]: Using postgres connection "master"
[0m00:01:20.599441 [debug] [MainThread]: On master: COMMIT
[0m00:01:20.600266 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:01:20.600779 [debug] [MainThread]: On master: Close
[0m00:01:20.606129 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:01:20.607072 [info ] [Thread-1 (]: 1 of 1 START sql table model dbt_model.stg_comments ............................ [RUN]
[0m00:01:20.607914 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_dbt_model, now model.mongo_movies.stg_comments)
[0m00:01:20.608483 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:01:20.623005 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:01:20.628022 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:01:20.690018 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m00:01:20.694385 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:01:20.695013 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m00:01:20.695556 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:01:20.710698 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m00:01:20.711480 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:01:20.712064 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  
    

  create  table "test_db"."dbt_model"."stg_comments__dbt_tmp"
  
  
    as
  
  (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
  
[0m00:01:21.029187 [debug] [Thread-1 (]: SQL status: SELECT 41081 in 0.316 seconds
[0m00:01:21.043179 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:01:21.043880 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."dbt_model"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m00:01:21.045239 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:01:21.071177 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:01:21.071971 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:01:21.072554 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:01:21.096705 [debug] [Thread-1 (]: SQL status: COMMIT in 0.023 seconds
[0m00:01:21.108688 [debug] [Thread-1 (]: Applying DROP to: "test_db"."dbt_model"."stg_comments__dbt_backup"
[0m00:01:21.117806 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:01:21.118573 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop table if exists "test_db"."dbt_model"."stg_comments__dbt_backup" cascade
[0m00:01:21.120973 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.002 seconds
[0m00:01:21.124593 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m00:01:21.127189 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7398bf7-c5bd-4b00-ae67-3f477554edb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72359d13b680>]}
[0m00:01:21.128129 [info ] [Thread-1 (]: 1 of 1 OK created sql table model dbt_model.stg_comments ....................... [[32mSELECT 41081[0m in 0.52s]
[0m00:01:21.129331 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:01:21.132701 [debug] [MainThread]: Using postgres connection "master"
[0m00:01:21.133353 [debug] [MainThread]: On master: BEGIN
[0m00:01:21.133939 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:01:21.151123 [debug] [MainThread]: SQL status: BEGIN in 0.017 seconds
[0m00:01:21.151798 [debug] [MainThread]: On master: COMMIT
[0m00:01:21.152319 [debug] [MainThread]: Using postgres connection "master"
[0m00:01:21.152819 [debug] [MainThread]: On master: COMMIT
[0m00:01:21.153628 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:01:21.154173 [debug] [MainThread]: On master: Close
[0m00:01:21.155327 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:01:21.156226 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:01:21.156819 [info ] [MainThread]: 
[0m00:01:21.157538 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.72 seconds (0.72s).
[0m00:01:21.158799 [debug] [MainThread]: Command end result
[0m00:01:21.292906 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:01:21.295868 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:01:21.307042 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:01:21.307686 [info ] [MainThread]: 
[0m00:01:21.308357 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:01:21.309016 [info ] [MainThread]: 
[0m00:01:21.309659 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m00:01:21.311050 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.4606233, "process_in_blocks": "0", "process_kernel_time": 0.714882, "process_mem_max_rss": "128864", "process_out_blocks": "2536", "process_user_time": 3.774431}
[0m00:01:21.311837 [debug] [MainThread]: Command `dbt run` succeeded at 00:01:21.311686 after 2.46 seconds
[0m00:01:21.312388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7235a0d1b8f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7235a0bf2c00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7235a0bf1d00>]}
[0m00:01:21.312939 [debug] [MainThread]: Flushing usage events
[0m00:01:22.758631 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:09:40.443179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce560cbd670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce5614edac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce56112dfa0>]}


============================== 00:09:40.457288 | 2d2734cc-700c-41f6-a051-04ada6081529 ==============================
[0m00:09:40.457288 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:09:40.458188 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt clean', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m00:09:40.778766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2d2734cc-700c-41f6-a051-04ada6081529', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce561989a90>]}
[0m00:09:40.824241 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.51067907, "process_in_blocks": "3224", "process_kernel_time": 0.595581, "process_mem_max_rss": "104832", "process_out_blocks": "24", "process_user_time": 2.496294}
[0m00:09:40.825143 [debug] [MainThread]: Command `dbt clean` succeeded at 00:09:40.824962 after 0.51 seconds
[0m00:09:40.825887 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce564fb33b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce560b501a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce560cbd670>]}
[0m00:09:40.826595 [debug] [MainThread]: Flushing usage events
[0m00:09:42.315797 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:09:48.166519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f63c5e249e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f63c61eb680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f63c5e27b00>]}


============================== 00:09:48.171567 | 29ce1604-dba4-43de-b26a-3d989d9e174d ==============================
[0m00:09:48.171567 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:09:48.172474 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt compile', 'send_anonymous_usage_stats': 'True'}
[0m00:09:55.688707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '29ce1604-dba4-43de-b26a-3d989d9e174d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f63c68e7410>]}
[0m00:09:55.823813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '29ce1604-dba4-43de-b26a-3d989d9e174d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f63c5c82db0>]}
[0m00:09:55.828949 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:09:48.373675 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:09:48.374760 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m00:09:48.375406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '29ce1604-dba4-43de-b26a-3d989d9e174d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f63c4ffa390>]}
[0m00:09:50.241592 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.staging
[0m00:09:50.257427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '29ce1604-dba4-43de-b26a-3d989d9e174d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f63c439bb60>]}
[0m00:09:50.379255 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:09:50.386439 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:09:50.405903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '29ce1604-dba4-43de-b26a-3d989d9e174d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f63c3bc96d0>]}
[0m00:09:50.406688 [info ] [MainThread]: Found 1 model, 4 sources, 434 macros
[0m00:09:50.407295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '29ce1604-dba4-43de-b26a-3d989d9e174d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f63c3bfce60>]}
[0m00:09:50.410854 [info ] [MainThread]: 
[0m00:09:50.411478 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:09:50.412134 [info ] [MainThread]: 
[0m00:09:50.413083 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:09:50.414647 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_dbt_model'
[0m00:09:50.501724 [debug] [ThreadPool]: Using postgres connection "list_test_db_dbt_model"
[0m00:09:50.502454 [debug] [ThreadPool]: On list_test_db_dbt_model: BEGIN
[0m00:09:50.503138 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:09:50.545258 [debug] [ThreadPool]: SQL status: BEGIN in 0.042 seconds
[0m00:09:50.546005 [debug] [ThreadPool]: Using postgres connection "list_test_db_dbt_model"
[0m00:09:50.546532 [debug] [ThreadPool]: On list_test_db_dbt_model: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_dbt_model"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_model'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_model'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'dbt_model'
  
[0m00:09:50.553726 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.007 seconds
[0m00:09:50.555758 [debug] [ThreadPool]: On list_test_db_dbt_model: ROLLBACK
[0m00:09:50.556680 [debug] [ThreadPool]: On list_test_db_dbt_model: Close
[0m00:09:50.565510 [debug] [MainThread]: Using postgres connection "master"
[0m00:09:50.566317 [debug] [MainThread]: On master: BEGIN
[0m00:09:50.566886 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:09:50.581750 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:09:50.582812 [debug] [MainThread]: Using postgres connection "master"
[0m00:09:50.583402 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:09:50.593088 [debug] [MainThread]: SQL status: SELECT 0 in 0.009 seconds
[0m00:09:50.595045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '29ce1604-dba4-43de-b26a-3d989d9e174d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f63c439bb30>]}
[0m00:09:50.595710 [debug] [MainThread]: On master: ROLLBACK
[0m00:09:50.596949 [debug] [MainThread]: On master: Close
[0m00:09:50.608307 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:09:50.609154 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_dbt_model, now model.mongo_movies.stg_comments)
[0m00:09:50.609801 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:09:50.622297 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:09:50.626958 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:09:50.628371 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:09:50.631532 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:09:50.632028 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:09:50.633177 [debug] [MainThread]: Command end result
[0m00:09:50.670286 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:09:50.673789 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:09:50.686566 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:09:50.689063 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 3.14074, "process_in_blocks": "18856", "process_kernel_time": 0.745247, "process_mem_max_rss": "127948", "process_out_blocks": "2568", "process_user_time": 4.53022}
[0m00:09:50.689966 [debug] [MainThread]: Command `dbt compile` succeeded at 00:09:50.689662 after 3.14 seconds
[0m00:09:50.690772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f63c5a55610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f63c5eda1b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f63c3b57a70>]}
[0m00:09:50.691383 [debug] [MainThread]: Flushing usage events
[0m00:09:52.033261 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:11:09.602991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71539d8ac140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71539db871a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71539dbf2000>]}


============================== 00:11:09.611341 | fd9fa3b3-aa6e-4d5d-869a-e675a98b7f03 ==============================
[0m00:11:09.611341 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:11:09.612372 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt compile', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m00:11:10.024311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fd9fa3b3-aa6e-4d5d-869a-e675a98b7f03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71539d8059d0>]}
[0m00:11:10.174542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fd9fa3b3-aa6e-4d5d-869a-e675a98b7f03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71539e332030>]}
[0m00:11:10.177363 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:11:10.342787 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:11:10.542420 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m00:11:10.543276 [debug] [MainThread]: Partial parsing: added file: mongo_movies://models/mongo_movies/staging/stg_comments.sql
[0m00:11:10.543778 [debug] [MainThread]: Partial parsing: deleted file: mongo_movies://models/staging/stg_comments.sql
[0m00:11:11.048995 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.staging
[0m00:11:11.069361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fd9fa3b3-aa6e-4d5d-869a-e675a98b7f03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71539bdf8ec0>]}
[0m00:11:11.168134 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:11:11.171129 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:11:11.201868 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fd9fa3b3-aa6e-4d5d-869a-e675a98b7f03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71539c9a5a00>]}
[0m00:11:11.202664 [info ] [MainThread]: Found 1 model, 4 sources, 434 macros
[0m00:11:11.203267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fd9fa3b3-aa6e-4d5d-869a-e675a98b7f03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71539e76ba70>]}
[0m00:11:11.206555 [info ] [MainThread]: 
[0m00:11:11.207276 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:11:11.207964 [info ] [MainThread]: 
[0m00:11:11.209264 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:11:11.211410 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_dbt_model'
[0m00:11:11.280360 [debug] [ThreadPool]: Using postgres connection "list_test_db_dbt_model"
[0m00:11:11.281056 [debug] [ThreadPool]: On list_test_db_dbt_model: BEGIN
[0m00:11:11.281614 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:11:11.312708 [debug] [ThreadPool]: SQL status: BEGIN in 0.031 seconds
[0m00:11:11.313385 [debug] [ThreadPool]: Using postgres connection "list_test_db_dbt_model"
[0m00:11:11.313979 [debug] [ThreadPool]: On list_test_db_dbt_model: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_dbt_model"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_model'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_model'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'dbt_model'
  
[0m00:11:11.319914 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.005 seconds
[0m00:11:11.321921 [debug] [ThreadPool]: On list_test_db_dbt_model: ROLLBACK
[0m00:11:11.322843 [debug] [ThreadPool]: On list_test_db_dbt_model: Close
[0m00:11:11.330858 [debug] [MainThread]: Using postgres connection "master"
[0m00:11:11.331411 [debug] [MainThread]: On master: BEGIN
[0m00:11:11.331894 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:11:11.347172 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:11:11.348044 [debug] [MainThread]: Using postgres connection "master"
[0m00:11:11.348810 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:11:11.358303 [debug] [MainThread]: SQL status: SELECT 0 in 0.009 seconds
[0m00:11:11.360348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fd9fa3b3-aa6e-4d5d-869a-e675a98b7f03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71539e0ee990>]}
[0m00:11:11.361042 [debug] [MainThread]: On master: ROLLBACK
[0m00:11:11.361908 [debug] [MainThread]: On master: Close
[0m00:11:11.373204 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:11:11.374117 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_dbt_model, now model.mongo_movies.stg_comments)
[0m00:11:11.374720 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:11:11.385610 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:11:11.388812 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:11:11.390022 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:11:11.392684 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:11:11.393192 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:11:11.394214 [debug] [MainThread]: Command end result
[0m00:11:11.422553 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:11:11.424674 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:11:11.434147 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:11:11.436404 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 1.9503819, "process_in_blocks": "90000", "process_kernel_time": 0.821217, "process_mem_max_rss": "127800", "process_out_blocks": "2560", "process_user_time": 3.528608}
[0m00:11:11.437116 [debug] [MainThread]: Command `dbt compile` succeeded at 00:11:11.436950 after 1.95 seconds
[0m00:11:11.437773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7153a0471610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71539d95ce90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71539e0ed130>]}
[0m00:11:11.438485 [debug] [MainThread]: Flushing usage events
[0m00:11:12.832006 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:12:05.373505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79e761d61cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79e7610957c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79e761095640>]}


============================== 00:12:05.382367 | b0c77dcd-bc77-4d44-ae18-3fba65baaac5 ==============================
[0m00:12:05.382367 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:12:05.383940 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt clean', 'send_anonymous_usage_stats': 'True'}
[0m00:12:05.686920 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b0c77dcd-bc77-4d44-ae18-3fba65baaac5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79e760fffce0>]}
[0m00:12:05.731291 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.47891632, "process_in_blocks": "70904", "process_kernel_time": 0.742489, "process_mem_max_rss": "104632", "process_out_blocks": "16", "process_user_time": 2.354236}
[0m00:12:05.732190 [debug] [MainThread]: Command `dbt clean` succeeded at 00:12:05.732025 after 0.48 seconds
[0m00:12:05.732724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79e761095640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79e761804ce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79e76105bef0>]}
[0m00:12:05.733245 [debug] [MainThread]: Flushing usage events
[0m00:12:07.087102 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:13:35.550426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7980f6343f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7980f5f1c620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7980f6341e20>]}


============================== 00:13:35.559265 | a05de7ac-cd1d-4c75-a970-4ab37a1535dc ==============================
[0m00:13:35.559265 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:13:35.560486 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt clean', 'send_anonymous_usage_stats': 'True'}
[0m00:13:35.861077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a05de7ac-cd1d-4c75-a970-4ab37a1535dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7980f8243710>]}
[0m00:13:35.895133 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.4749296, "process_in_blocks": "70568", "process_kernel_time": 0.709773, "process_mem_max_rss": "104800", "process_out_blocks": "8", "process_user_time": 2.403716}
[0m00:13:35.895927 [debug] [MainThread]: Command `dbt clean` succeeded at 00:13:35.895759 after 0.48 seconds
[0m00:13:35.896577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7980f69051f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7980f5b4c4a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7980f67baf30>]}
[0m00:13:35.897265 [debug] [MainThread]: Flushing usage events
[0m00:13:37.221706 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:13:41.827092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d3345da1b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d33273f500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d332a81dc0>]}


============================== 00:13:41.832287 | 47dfac5b-ade5-43f5-bb93-9862a1e15de6 ==============================
[0m00:13:41.832287 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:13:41.833320 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt compile', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m00:13:42.179995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '47dfac5b-ade5-43f5-bb93-9862a1e15de6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d331ac37d0>]}
[0m00:13:42.314988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '47dfac5b-ade5-43f5-bb93-9862a1e15de6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d3325832c0>]}
[0m00:13:42.320329 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:13:42.503882 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:13:42.504877 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m00:13:42.505597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '47dfac5b-ade5-43f5-bb93-9862a1e15de6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d3311b84a0>]}
[0m00:13:43.926751 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.staging
[0m00:13:43.941277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '47dfac5b-ade5-43f5-bb93-9862a1e15de6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d330544a40>]}
[0m00:13:44.038796 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:13:44.045735 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:13:44.066684 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '47dfac5b-ade5-43f5-bb93-9862a1e15de6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d330596570>]}
[0m00:13:44.067442 [info ] [MainThread]: Found 1 model, 4 sources, 434 macros
[0m00:13:44.068075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '47dfac5b-ade5-43f5-bb93-9862a1e15de6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d330526d80>]}
[0m00:13:44.071382 [info ] [MainThread]: 
[0m00:13:44.072010 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:13:44.072605 [info ] [MainThread]: 
[0m00:13:44.073605 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:13:44.075178 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_dbt_model'
[0m00:13:44.146160 [debug] [ThreadPool]: Using postgres connection "list_test_db_dbt_model"
[0m00:13:44.146851 [debug] [ThreadPool]: On list_test_db_dbt_model: BEGIN
[0m00:13:44.147356 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:13:44.185251 [debug] [ThreadPool]: SQL status: BEGIN in 0.038 seconds
[0m00:13:44.186093 [debug] [ThreadPool]: Using postgres connection "list_test_db_dbt_model"
[0m00:13:44.186711 [debug] [ThreadPool]: On list_test_db_dbt_model: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_dbt_model"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_model'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_model'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'dbt_model'
  
[0m00:13:44.194607 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.007 seconds
[0m00:13:44.196835 [debug] [ThreadPool]: On list_test_db_dbt_model: ROLLBACK
[0m00:13:44.197897 [debug] [ThreadPool]: On list_test_db_dbt_model: Close
[0m00:13:44.204955 [debug] [MainThread]: Using postgres connection "master"
[0m00:13:44.205485 [debug] [MainThread]: On master: BEGIN
[0m00:13:44.206089 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:13:44.221340 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:13:44.222146 [debug] [MainThread]: Using postgres connection "master"
[0m00:13:44.222871 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:13:44.232424 [debug] [MainThread]: SQL status: SELECT 0 in 0.009 seconds
[0m00:13:44.234704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '47dfac5b-ade5-43f5-bb93-9862a1e15de6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d33058f320>]}
[0m00:13:44.235374 [debug] [MainThread]: On master: ROLLBACK
[0m00:13:44.236489 [debug] [MainThread]: On master: Close
[0m00:13:44.248317 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:13:44.249154 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_dbt_model, now model.mongo_movies.stg_comments)
[0m00:13:44.249978 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:13:44.261132 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:13:44.266048 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:13:44.267085 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:13:44.270578 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:13:44.271062 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:13:44.272016 [debug] [MainThread]: Command end result
[0m00:13:44.303947 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:13:44.306510 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:13:44.315717 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:13:44.317158 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 3.1022093, "process_in_blocks": "19128", "process_kernel_time": 0.666826, "process_mem_max_rss": "127732", "process_out_blocks": "2568", "process_user_time": 4.474659}
[0m00:13:44.317897 [debug] [MainThread]: Command `dbt compile` succeeded at 00:13:44.317708 after 3.10 seconds
[0m00:13:44.318502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d335fb33b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d331cd3e00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d32fd18320>]}
[0m00:13:44.319204 [debug] [MainThread]: Flushing usage events
[0m00:13:45.665017 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:14:31.164532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735269377e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7352695f1280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735267431040>]}


============================== 00:14:31.169458 | 16292618-6fde-406a-afcd-823215c85e12 ==============================
[0m00:14:31.169458 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:14:31.170322 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt ls --resource-type model', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:14:23.773446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '16292618-6fde-406a-afcd-823215c85e12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7352663b2150>]}
[0m00:14:23.933795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '16292618-6fde-406a-afcd-823215c85e12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73526695ce60>]}
[0m00:14:23.935043 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:14:24.101011 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:14:24.259322 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:14:24.259951 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:14:24.268827 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.staging
[0m00:14:24.314949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '16292618-6fde-406a-afcd-823215c85e12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735265b22f60>]}
[0m00:14:24.424132 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:14:24.426846 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:14:24.444939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '16292618-6fde-406a-afcd-823215c85e12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7352657795e0>]}
[0m00:14:24.446040 [info ] [MainThread]: Found 1 model, 4 sources, 434 macros
[0m00:14:24.447072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '16292618-6fde-406a-afcd-823215c85e12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735265393fb0>]}
[0m00:14:24.448437 [info ] [MainThread]: mongo_movies.staging.stg_comments
[0m00:14:24.450121 [debug] [MainThread]: Resource report: {"command_name": "list", "command_success": true, "command_wall_clock_time": 1.106241, "process_in_blocks": "288", "process_kernel_time": 0.544999, "process_mem_max_rss": "114720", "process_out_blocks": "864", "process_user_time": 2.903028}
[0m00:14:24.451030 [debug] [MainThread]: Command `dbt ls` succeeded at 00:14:24.450844 after 1.11 seconds
[0m00:14:24.451787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7352671c7530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7352671c7230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735265393fb0>]}
[0m00:14:24.452544 [debug] [MainThread]: Flushing usage events
[0m00:14:25.809656 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:19:12.383248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7459d62b2300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7459d46e46b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7459d39c8fb0>]}


============================== 00:19:12.388166 | a8df4b19-52b8-45fd-8e47-0c5c06a57f39 ==============================
[0m00:19:12.388166 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:19:12.389269 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt clean', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m00:19:12.627141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a8df4b19-52b8-45fd-8e47-0c5c06a57f39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7459d36b38c0>]}
[0m00:19:12.645748 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.37440792, "process_in_blocks": "0", "process_kernel_time": 0.541127, "process_mem_max_rss": "104984", "process_out_blocks": "16", "process_user_time": 2.302516}
[0m00:19:12.646503 [debug] [MainThread]: Command `dbt clean` succeeded at 00:19:12.646351 after 0.38 seconds
[0m00:19:12.646985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7459d3fef770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7459d46b6120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7459d4666870>]}
[0m00:19:12.647587 [debug] [MainThread]: Flushing usage events
[0m00:19:13.938838 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:19:19.509539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71744a195760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x717449667b30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7174496657c0>]}


============================== 00:19:19.515924 | c8fe7748-758a-47fb-b6a6-c505b2951489 ==============================
[0m00:19:19.515924 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:19:19.517228 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt compile', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:19:19.822519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c8fe7748-758a-47fb-b6a6-c505b2951489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x717449102570>]}
[0m00:19:19.971449 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c8fe7748-758a-47fb-b6a6-c505b2951489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7174498f9730>]}
[0m00:19:19.972680 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:19:20.134245 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:19:20.136028 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m00:19:20.137317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'c8fe7748-758a-47fb-b6a6-c505b2951489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x717448920f50>]}
[0m00:19:21.963027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c8fe7748-758a-47fb-b6a6-c505b2951489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71744813fb00>]}
[0m00:19:22.061735 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:19:22.064670 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:19:22.081138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c8fe7748-758a-47fb-b6a6-c505b2951489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71744798f7d0>]}
[0m00:19:22.081870 [info ] [MainThread]: Found 1 model, 4 sources, 434 macros
[0m00:19:22.082571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c8fe7748-758a-47fb-b6a6-c505b2951489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71744817e8d0>]}
[0m00:19:22.086231 [info ] [MainThread]: 
[0m00:19:22.086929 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:19:22.087644 [info ] [MainThread]: 
[0m00:19:22.088797 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:19:22.090479 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_dbt_model'
[0m00:19:22.157256 [debug] [ThreadPool]: Using postgres connection "list_test_db_dbt_model"
[0m00:19:22.157952 [debug] [ThreadPool]: On list_test_db_dbt_model: BEGIN
[0m00:19:22.158459 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:19:22.176727 [debug] [ThreadPool]: SQL status: BEGIN in 0.018 seconds
[0m00:19:22.177330 [debug] [ThreadPool]: Using postgres connection "list_test_db_dbt_model"
[0m00:19:22.177889 [debug] [ThreadPool]: On list_test_db_dbt_model: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_dbt_model"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_model'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_model'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'dbt_model'
  
[0m00:19:22.184496 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.006 seconds
[0m00:19:22.186982 [debug] [ThreadPool]: On list_test_db_dbt_model: ROLLBACK
[0m00:19:22.187785 [debug] [ThreadPool]: On list_test_db_dbt_model: Close
[0m00:19:22.194545 [debug] [MainThread]: Using postgres connection "master"
[0m00:19:22.195074 [debug] [MainThread]: On master: BEGIN
[0m00:19:22.195634 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:19:22.210678 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:19:22.211213 [debug] [MainThread]: Using postgres connection "master"
[0m00:19:22.211853 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:19:22.220160 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m00:19:22.222483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c8fe7748-758a-47fb-b6a6-c505b2951489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7174479a1dc0>]}
[0m00:19:22.223151 [debug] [MainThread]: On master: ROLLBACK
[0m00:19:22.224318 [debug] [MainThread]: On master: Close
[0m00:19:22.231944 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:19:22.233252 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_dbt_model, now model.mongo_movies.stg_comments)
[0m00:19:22.234243 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:19:22.256811 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:19:22.261343 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:19:22.262482 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:19:22.265448 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:19:22.265946 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:19:22.267141 [debug] [MainThread]: Command end result
[0m00:19:22.302312 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:19:22.304657 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:19:22.314007 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:19:22.315497 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 2.931536, "process_in_blocks": "0", "process_kernel_time": 0.725076, "process_mem_max_rss": "127620", "process_out_blocks": "2568", "process_user_time": 4.485271}
[0m00:19:22.316239 [debug] [MainThread]: Command `dbt compile` succeeded at 00:19:22.316080 after 2.93 seconds
[0m00:19:22.316854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71744dbb33b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71744a195760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x717449665670>]}
[0m00:19:22.317430 [debug] [MainThread]: Flushing usage events
[0m00:19:23.779366 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:20:02.169105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77276687bda0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77276699c1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772766b0c4a0>]}


============================== 00:20:02.174168 | 82a217c6-e128-42a1-8805-23e00a89bd41 ==============================
[0m00:20:02.174168 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:20:02.175283 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m00:20:02.517471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '82a217c6-e128-42a1-8805-23e00a89bd41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772765f16030>]}
[0m00:20:02.650319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '82a217c6-e128-42a1-8805-23e00a89bd41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772766d5a060>]}
[0m00:20:02.651592 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:20:02.813594 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:20:02.963916 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:20:02.964524 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:20:03.012196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '82a217c6-e128-42a1-8805-23e00a89bd41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772765b39ac0>]}
[0m00:20:03.116258 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:20:03.118834 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:20:03.137474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '82a217c6-e128-42a1-8805-23e00a89bd41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772765ff1040>]}
[0m00:20:03.138159 [info ] [MainThread]: Found 1 model, 4 sources, 434 macros
[0m00:20:03.138879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '82a217c6-e128-42a1-8805-23e00a89bd41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772765b38920>]}
[0m00:20:03.141385 [info ] [MainThread]: 
[0m00:20:03.142114 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:20:03.142760 [info ] [MainThread]: 
[0m00:20:03.143959 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:20:03.147413 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:20:03.215554 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:20:03.216246 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:20:03.216857 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:20:03.233876 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.017 seconds
[0m00:20:03.235931 [debug] [ThreadPool]: On list_test_db: Close
[0m00:20:03.238084 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_dbt_model)
[0m00:20:03.246487 [debug] [ThreadPool]: Using postgres connection "list_test_db_dbt_model"
[0m00:20:03.247014 [debug] [ThreadPool]: On list_test_db_dbt_model: BEGIN
[0m00:20:03.247694 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:20:03.261249 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m00:20:03.261765 [debug] [ThreadPool]: Using postgres connection "list_test_db_dbt_model"
[0m00:20:03.262338 [debug] [ThreadPool]: On list_test_db_dbt_model: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_dbt_model"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_model'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_model'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'dbt_model'
  
[0m00:20:03.267200 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.004 seconds
[0m00:20:03.269410 [debug] [ThreadPool]: On list_test_db_dbt_model: ROLLBACK
[0m00:20:03.270218 [debug] [ThreadPool]: On list_test_db_dbt_model: Close
[0m00:20:03.277963 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:03.278528 [debug] [MainThread]: On master: BEGIN
[0m00:20:03.279050 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:20:03.293882 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:20:03.294551 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:03.295463 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:20:03.309663 [debug] [MainThread]: SQL status: SELECT 0 in 0.013 seconds
[0m00:20:03.311791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '82a217c6-e128-42a1-8805-23e00a89bd41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772765f4bf50>]}
[0m00:20:03.312821 [debug] [MainThread]: On master: ROLLBACK
[0m00:20:03.313891 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:03.314406 [debug] [MainThread]: On master: BEGIN
[0m00:20:03.315634 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:20:03.316141 [debug] [MainThread]: On master: COMMIT
[0m00:20:03.316703 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:03.317251 [debug] [MainThread]: On master: COMMIT
[0m00:20:03.318118 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:20:03.318645 [debug] [MainThread]: On master: Close
[0m00:20:03.324973 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:20:03.326071 [info ] [Thread-1 (]: 1 of 1 START sql view model dbt_model.stg_comments ............................. [RUN]
[0m00:20:03.327094 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_dbt_model, now model.mongo_movies.stg_comments)
[0m00:20:03.328011 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:20:03.343041 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:20:03.344366 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:20:03.405676 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m00:20:03.411002 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:20:03.411930 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m00:20:03.412647 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:20:03.429785 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m00:20:03.430706 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:20:03.431547 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."dbt_model"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m00:20:03.456435 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.024 seconds
[0m00:20:03.467074 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:20:03.468577 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."dbt_model"."stg_comments" rename to "stg_comments__dbt_backup"
[0m00:20:03.470109 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:20:03.475631 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:20:03.477685 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."dbt_model"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m00:20:03.479410 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:20:03.524385 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:20:03.525504 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:20:03.526237 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:20:03.532733 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m00:20:03.541863 [debug] [Thread-1 (]: Applying DROP to: "test_db"."dbt_model"."stg_comments__dbt_backup"
[0m00:20:03.551642 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:20:03.552457 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop table if exists "test_db"."dbt_model"."stg_comments__dbt_backup" cascade
[0m00:20:03.566880 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.014 seconds
[0m00:20:03.570599 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m00:20:03.574049 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '82a217c6-e128-42a1-8805-23e00a89bd41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7727692d67b0>]}
[0m00:20:03.575451 [info ] [Thread-1 (]: 1 of 1 OK created sql view model dbt_model.stg_comments ........................ [[32mCREATE VIEW[0m in 0.24s]
[0m00:20:03.576808 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:20:03.579975 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:03.580497 [debug] [MainThread]: On master: BEGIN
[0m00:20:03.580980 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:20:03.595147 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m00:20:03.596422 [debug] [MainThread]: On master: COMMIT
[0m00:20:03.597195 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:03.597780 [debug] [MainThread]: On master: COMMIT
[0m00:20:03.598713 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:20:03.599289 [debug] [MainThread]: On master: Close
[0m00:20:03.600152 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:20:03.600638 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:20:03.601125 [info ] [MainThread]: 
[0m00:20:03.601801 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.46 seconds (0.46s).
[0m00:20:03.602984 [debug] [MainThread]: Command end result
[0m00:20:03.640037 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:20:03.643194 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:20:03.653228 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:20:03.653753 [info ] [MainThread]: 
[0m00:20:03.654451 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:20:03.655042 [info ] [MainThread]: 
[0m00:20:03.655695 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m00:20:03.657205 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.6068835, "process_in_blocks": "112", "process_kernel_time": 0.70724, "process_mem_max_rss": "124244", "process_out_blocks": "1752", "process_user_time": 3.28702}
[0m00:20:03.658151 [debug] [MainThread]: Command `dbt run` succeeded at 00:20:03.657950 after 1.61 seconds
[0m00:20:03.658826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77276adb33b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77276699c1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7727663cc5c0>]}
[0m00:20:03.659441 [debug] [MainThread]: Flushing usage events
[0m00:20:04.488572 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:21:50.620999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ddbb7e33800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ddbb8081f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ddbb8083ef0>]}


============================== 00:21:50.626537 | 161336b7-f7e2-48cd-9ec7-7f16c0863554 ==============================
[0m00:21:50.626537 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:21:50.627838 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt compile', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m00:21:50.952894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '161336b7-f7e2-48cd-9ec7-7f16c0863554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ddbb7982ab0>]}
[0m00:21:51.127494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '161336b7-f7e2-48cd-9ec7-7f16c0863554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ddbb7e7b6b0>]}
[0m00:21:51.128877 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:21:51.296975 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:21:51.417089 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m00:21:51.418098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '161336b7-f7e2-48cd-9ec7-7f16c0863554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ddbb691e3f0>]}
[0m00:21:53.282249 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '161336b7-f7e2-48cd-9ec7-7f16c0863554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ddbb69e3b60>]}
[0m00:21:53.376938 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:21:53.379716 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:21:53.396269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '161336b7-f7e2-48cd-9ec7-7f16c0863554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ddbb6187020>]}
[0m00:21:53.397158 [info ] [MainThread]: Found 1 model, 4 sources, 434 macros
[0m00:21:53.397796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '161336b7-f7e2-48cd-9ec7-7f16c0863554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ddbb61b87a0>]}
[0m00:21:53.400246 [info ] [MainThread]: 
[0m00:21:53.400928 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:21:53.401577 [info ] [MainThread]: 
[0m00:21:53.402409 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:21:53.403963 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_dbt_model'
[0m00:21:53.462844 [debug] [ThreadPool]: Using postgres connection "list_test_db_dbt_model"
[0m00:21:53.463525 [debug] [ThreadPool]: On list_test_db_dbt_model: BEGIN
[0m00:21:53.464412 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:21:53.483818 [debug] [ThreadPool]: SQL status: BEGIN in 0.019 seconds
[0m00:21:53.484577 [debug] [ThreadPool]: Using postgres connection "list_test_db_dbt_model"
[0m00:21:53.485110 [debug] [ThreadPool]: On list_test_db_dbt_model: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_dbt_model"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_model'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_model'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'dbt_model'
  
[0m00:21:53.491018 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.005 seconds
[0m00:21:53.493687 [debug] [ThreadPool]: On list_test_db_dbt_model: ROLLBACK
[0m00:21:53.494709 [debug] [ThreadPool]: On list_test_db_dbt_model: Close
[0m00:21:53.501484 [debug] [MainThread]: Using postgres connection "master"
[0m00:21:53.502022 [debug] [MainThread]: On master: BEGIN
[0m00:21:53.502504 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:21:53.517944 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:21:53.518527 [debug] [MainThread]: Using postgres connection "master"
[0m00:21:53.519162 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:21:53.528096 [debug] [MainThread]: SQL status: SELECT 2 in 0.008 seconds
[0m00:21:53.530552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '161336b7-f7e2-48cd-9ec7-7f16c0863554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ddbb61f5a00>]}
[0m00:21:53.531199 [debug] [MainThread]: On master: ROLLBACK
[0m00:21:53.532312 [debug] [MainThread]: On master: Close
[0m00:21:53.538460 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:21:53.539721 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_dbt_model, now model.mongo_movies.stg_comments)
[0m00:21:53.541056 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:21:53.565979 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:21:53.567309 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:21:53.568846 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:21:53.572405 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:21:53.573034 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:21:53.574290 [debug] [MainThread]: Command end result
[0m00:21:53.611620 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:21:53.614080 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:21:53.625449 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:21:53.627685 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 3.133235, "process_in_blocks": "0", "process_kernel_time": 0.700604, "process_mem_max_rss": "128016", "process_out_blocks": "2568", "process_user_time": 4.710836}
[0m00:21:53.628595 [debug] [MainThread]: Command `dbt compile` succeeded at 00:21:53.628398 after 3.13 seconds
[0m00:21:53.629351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ddbb87749b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ddbb78e8f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ddbbc3b33b0>]}
[0m00:21:53.630072 [debug] [MainThread]: Flushing usage events
[0m00:21:54.575160 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:22:29.997843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b1ef7ddaa80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b1ef640bc50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b1ef546bbc0>]}


============================== 00:22:30.003574 | d0032676-85a8-4c45-b37c-d2b1b5ede79f ==============================
[0m00:22:30.003574 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:22:30.004908 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'debug': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt compile', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:22:30.362826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd0032676-85a8-4c45-b37c-d2b1b5ede79f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b1ef62c5970>]}
[0m00:22:30.505146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd0032676-85a8-4c45-b37c-d2b1b5ede79f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b1ef5e6c320>]}
[0m00:22:30.506607 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:22:30.662380 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:22:30.796220 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m00:22:30.797406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'd0032676-85a8-4c45-b37c-d2b1b5ede79f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b1ef4159f70>]}
[0m00:22:32.616083 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.mongo_movies.mongo_movies
[0m00:22:32.632127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd0032676-85a8-4c45-b37c-d2b1b5ede79f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b1ef39f0fb0>]}
[0m00:22:32.739594 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:22:32.742276 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:22:32.760370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd0032676-85a8-4c45-b37c-d2b1b5ede79f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b1ef39e5640>]}
[0m00:22:32.761255 [info ] [MainThread]: Found 1 model, 4 sources, 434 macros
[0m00:22:32.762096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd0032676-85a8-4c45-b37c-d2b1b5ede79f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b1ef397af00>]}
[0m00:22:32.764790 [info ] [MainThread]: 
[0m00:22:32.765463 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:22:32.766032 [info ] [MainThread]: 
[0m00:22:32.766990 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:22:32.768608 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_dbt_model'
[0m00:22:32.833995 [debug] [ThreadPool]: Using postgres connection "list_test_db_dbt_model"
[0m00:22:32.834660 [debug] [ThreadPool]: On list_test_db_dbt_model: BEGIN
[0m00:22:32.835167 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:22:32.851532 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m00:22:32.852462 [debug] [ThreadPool]: Using postgres connection "list_test_db_dbt_model"
[0m00:22:32.853320 [debug] [ThreadPool]: On list_test_db_dbt_model: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_dbt_model"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_model'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_model'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'dbt_model'
  
[0m00:22:32.858680 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.005 seconds
[0m00:22:32.860801 [debug] [ThreadPool]: On list_test_db_dbt_model: ROLLBACK
[0m00:22:32.861830 [debug] [ThreadPool]: On list_test_db_dbt_model: Close
[0m00:22:32.869479 [debug] [MainThread]: Using postgres connection "master"
[0m00:22:32.870147 [debug] [MainThread]: On master: BEGIN
[0m00:22:32.870690 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:22:32.884472 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m00:22:32.885170 [debug] [MainThread]: Using postgres connection "master"
[0m00:22:32.886073 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:22:32.895131 [debug] [MainThread]: SQL status: SELECT 2 in 0.008 seconds
[0m00:22:32.897634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd0032676-85a8-4c45-b37c-d2b1b5ede79f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b1ef3514b90>]}
[0m00:22:32.898492 [debug] [MainThread]: On master: ROLLBACK
[0m00:22:32.899498 [debug] [MainThread]: On master: Close
[0m00:22:32.906926 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:22:32.908574 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_dbt_model, now model.mongo_movies.stg_comments)
[0m00:22:32.909526 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:22:32.927455 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:22:32.928916 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:22:32.930364 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:22:32.933342 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:22:32.933866 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:22:32.934946 [debug] [MainThread]: Command end result
[0m00:22:32.965870 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:22:32.968762 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:22:32.978602 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:22:32.980221 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 3.1009357, "process_in_blocks": "0", "process_kernel_time": 0.68581, "process_mem_max_rss": "127856", "process_out_blocks": "2576", "process_user_time": 4.797047}
[0m00:22:32.980991 [debug] [MainThread]: Command `dbt compile` succeeded at 00:22:32.980822 after 3.10 seconds
[0m00:22:32.981563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b1ef9adf3b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b1ef5cea7b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b1ef3500410>]}
[0m00:22:32.982149 [debug] [MainThread]: Flushing usage events
[0m00:22:34.278426 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:25:39.330034 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764fef2b3a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764fef57e030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764fef37a060>]}


============================== 00:25:39.335101 | 05fcbffb-302f-4b6b-9e55-76fd298331a8 ==============================
[0m00:25:39.335101 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:25:39.336167 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'invocation_command': 'dbt clean', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m00:25:39.619236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '05fcbffb-302f-4b6b-9e55-76fd298331a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764feed99490>]}
[0m00:25:39.638044 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.4713457, "process_in_blocks": "0", "process_kernel_time": 0.509106, "process_mem_max_rss": "105080", "process_out_blocks": "16", "process_user_time": 2.512802}
[0m00:25:39.638753 [debug] [MainThread]: Command `dbt clean` succeeded at 00:25:39.638609 after 0.47 seconds
[0m00:25:39.639240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764ff33b33b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764fefa950a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764feedf36b0>]}
[0m00:25:39.639741 [debug] [MainThread]: Flushing usage events
[0m00:25:40.648246 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:28:52.113654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d315867b7a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d3158d74290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d315867ba40>]}


============================== 00:28:52.118628 | 49009524-8f83-44f5-93b2-320043aef5a1 ==============================
[0m00:28:52.118628 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:28:52.119557 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'debug': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt compile', 'send_anonymous_usage_stats': 'True'}
[0m00:28:52.207452 [error] [MainThread]: Encountered an error:
Runtime Error
  Credentials in profile "default", target "dev" invalid: 'schema' is a required property
[0m00:28:52.209242 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": false, "command_wall_clock_time": 0.21925384, "process_in_blocks": "0", "process_kernel_time": 0.539747, "process_mem_max_rss": "105644", "process_out_blocks": "8", "process_user_time": 2.220572}
[0m00:28:52.210091 [debug] [MainThread]: Command `dbt compile` failed at 00:28:52.209816 after 0.22 seconds
[0m00:28:52.210737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d3158c888f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d315875acc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d31586f48c0>]}
[0m00:28:52.211377 [debug] [MainThread]: Flushing usage events
[0m00:28:53.593123 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:30:27.216299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e77511e0fb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e7750e1c770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e77511e3050>]}


============================== 00:30:27.221059 | 7bb8ba01-3277-4ce8-92a7-e61f9605548b ==============================
[0m00:30:27.221059 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:30:27.222133 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt compile', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m00:30:27.537007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7bb8ba01-3277-4ce8-92a7-e61f9605548b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e77503aac30>]}
[0m00:30:27.667333 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7bb8ba01-3277-4ce8-92a7-e61f9605548b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e7750b5ea80>]}
[0m00:30:27.668523 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:30:27.820290 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:30:27.821319 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m00:30:27.821965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '7bb8ba01-3277-4ce8-92a7-e61f9605548b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e77508a3e60>]}
[0m00:30:29.645215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7bb8ba01-3277-4ce8-92a7-e61f9605548b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e774ffc17f0>]}
[0m00:30:29.748017 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:30:29.750493 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:30:29.768469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7bb8ba01-3277-4ce8-92a7-e61f9605548b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e774ffea270>]}
[0m00:30:29.769177 [info ] [MainThread]: Found 2 models, 4 sources, 434 macros
[0m00:30:29.769893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7bb8ba01-3277-4ce8-92a7-e61f9605548b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e774f31ccb0>]}
[0m00:30:29.772422 [info ] [MainThread]: 
[0m00:30:29.773048 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:30:29.773614 [info ] [MainThread]: 
[0m00:30:29.774483 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:30:29.775937 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_staging'
[0m00:30:29.782552 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_marts'
[0m00:30:29.852554 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:30:29.853403 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:30:29.854214 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m00:30:29.854823 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m00:30:29.855500 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:30:29.856257 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:30:29.873135 [debug] [ThreadPool]: SQL status: BEGIN in 0.017 seconds
[0m00:30:29.874230 [debug] [ThreadPool]: SQL status: BEGIN in 0.019 seconds
[0m00:30:29.874905 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:30:29.875546 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:30:29.876184 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m00:30:29.877078 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m00:30:29.883292 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.006 seconds
[0m00:30:29.884062 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.006 seconds
[0m00:30:29.885959 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m00:30:29.887670 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m00:30:29.888742 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m00:30:29.889309 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m00:30:29.897051 [debug] [MainThread]: Using postgres connection "master"
[0m00:30:29.897676 [debug] [MainThread]: On master: BEGIN
[0m00:30:29.898458 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:30:29.913727 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:30:29.914772 [debug] [MainThread]: Using postgres connection "master"
[0m00:30:29.915350 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:30:29.924364 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m00:30:29.926472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7bb8ba01-3277-4ce8-92a7-e61f9605548b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e774f7e52e0>]}
[0m00:30:29.927228 [debug] [MainThread]: On master: ROLLBACK
[0m00:30:29.928111 [debug] [MainThread]: On master: Close
[0m00:30:29.933519 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:30:29.934503 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m00:30:29.935162 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:30:29.946460 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:30:29.951184 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:30:29.952270 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:30:29.954223 [debug] [Thread-3 (]: Began running node model.mongo_movies.comments_by_user
[0m00:30:29.955589 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user'
[0m00:30:29.956196 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.comments_by_user
[0m00:30:29.959686 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user"
[0m00:30:29.961265 [debug] [Thread-3 (]: Began executing node model.mongo_movies.comments_by_user
[0m00:30:29.962376 [debug] [Thread-3 (]: Finished running node model.mongo_movies.comments_by_user
[0m00:30:29.965235 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:30:29.965847 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:30:29.966362 [debug] [MainThread]: Connection 'list_test_db_public_marts' was properly closed.
[0m00:30:29.966817 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user' was properly closed.
[0m00:30:29.968026 [debug] [MainThread]: Command end result
[0m00:30:29.997541 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:30:29.999895 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:30:30.009055 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:30:30.010689 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 2.9077501, "process_in_blocks": "0", "process_kernel_time": 0.66494, "process_mem_max_rss": "128332", "process_out_blocks": "2592", "process_user_time": 4.367533}
[0m00:30:30.011475 [debug] [MainThread]: Command `dbt compile` succeeded at 00:30:30.011291 after 2.91 seconds
[0m00:30:30.012061 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e774efc44a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e77511e3050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e77511e0fb0>]}
[0m00:30:30.012744 [debug] [MainThread]: Flushing usage events
[0m00:30:30.848558 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:30:37.186994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71e0280ae510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71e025c76030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71e0257d2060>]}


============================== 00:30:37.191708 | 06a7f65d-24a9-4af8-a364-aa532581ad2f ==============================
[0m00:30:37.191708 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:30:37.192694 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m00:30:37.534901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '06a7f65d-24a9-4af8-a364-aa532581ad2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71e025c76030>]}
[0m00:30:37.665232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '06a7f65d-24a9-4af8-a364-aa532581ad2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71e02680baa0>]}
[0m00:30:37.666611 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:30:37.822561 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:30:37.968384 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:30:37.969138 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:30:38.019904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '06a7f65d-24a9-4af8-a364-aa532581ad2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71e024b43e60>]}
[0m00:30:38.155467 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:30:38.158327 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:30:38.178206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '06a7f65d-24a9-4af8-a364-aa532581ad2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71e024b41100>]}
[0m00:30:38.179048 [info ] [MainThread]: Found 2 models, 4 sources, 434 macros
[0m00:30:38.179857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '06a7f65d-24a9-4af8-a364-aa532581ad2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71e025368620>]}
[0m00:30:38.182563 [info ] [MainThread]: 
[0m00:30:38.183229 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:30:38.183831 [info ] [MainThread]: 
[0m00:30:38.184839 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:30:38.191027 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:30:38.192734 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:30:38.274404 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:30:38.275409 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:30:38.276285 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:30:38.277101 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:30:38.277729 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:30:38.278377 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:30:38.296742 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.019 seconds
[0m00:30:38.297551 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.019 seconds
[0m00:30:38.299436 [debug] [ThreadPool]: On list_test_db: Close
[0m00:30:38.301205 [debug] [ThreadPool]: On list_test_db: Close
[0m00:30:38.303122 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now create_test_db_public_staging)
[0m00:30:38.303847 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now create_test_db_public_marts)
[0m00:30:38.304743 [debug] [ThreadPool]: Creating schema "database: "test_db"
schema: "public_staging"
"
[0m00:30:38.305664 [debug] [ThreadPool]: Creating schema "database: "test_db"
schema: "public_marts"
"
[0m00:30:38.314342 [debug] [ThreadPool]: Using postgres connection "create_test_db_public_staging"
[0m00:30:38.317174 [debug] [ThreadPool]: Using postgres connection "create_test_db_public_marts"
[0m00:30:38.317831 [debug] [ThreadPool]: On create_test_db_public_staging: BEGIN
[0m00:30:38.318588 [debug] [ThreadPool]: On create_test_db_public_marts: BEGIN
[0m00:30:38.319237 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:30:38.319907 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:30:38.334165 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m00:30:38.335034 [debug] [ThreadPool]: Using postgres connection "create_test_db_public_staging"
[0m00:30:38.335606 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m00:30:38.336293 [debug] [ThreadPool]: On create_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "create_test_db_public_staging"} */
create schema if not exists "public_staging"
[0m00:30:38.337296 [debug] [ThreadPool]: Using postgres connection "create_test_db_public_marts"
[0m00:30:38.338496 [debug] [ThreadPool]: On create_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "create_test_db_public_marts"} */
create schema if not exists "public_marts"
[0m00:30:38.340278 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.002 seconds
[0m00:30:38.341004 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.002 seconds
[0m00:30:38.342667 [debug] [ThreadPool]: On create_test_db_public_staging: COMMIT
[0m00:30:38.344489 [debug] [ThreadPool]: On create_test_db_public_marts: COMMIT
[0m00:30:38.345279 [debug] [ThreadPool]: Using postgres connection "create_test_db_public_staging"
[0m00:30:38.345969 [debug] [ThreadPool]: Using postgres connection "create_test_db_public_marts"
[0m00:30:38.346585 [debug] [ThreadPool]: On create_test_db_public_staging: COMMIT
[0m00:30:38.347213 [debug] [ThreadPool]: On create_test_db_public_marts: COMMIT
[0m00:30:38.353898 [debug] [ThreadPool]: SQL status: COMMIT in 0.006 seconds
[0m00:30:38.354644 [debug] [ThreadPool]: On create_test_db_public_staging: Close
[0m00:30:38.355309 [debug] [ThreadPool]: SQL status: COMMIT in 0.007 seconds
[0m00:30:38.356054 [debug] [ThreadPool]: On create_test_db_public_marts: Close
[0m00:30:38.359491 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_test_db_public_marts, now list_test_db_public_staging)
[0m00:30:38.360814 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_test_db_public_staging, now list_test_db_public_marts)
[0m00:30:38.370503 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:30:38.373167 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:30:38.373872 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m00:30:38.374488 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m00:30:38.375170 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:30:38.375944 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:30:38.390092 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m00:30:38.390871 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:30:38.391532 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m00:30:38.392126 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m00:30:38.392898 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:30:38.393810 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m00:30:38.398123 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m00:30:38.398765 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m00:30:38.400552 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m00:30:38.402229 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m00:30:38.403162 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m00:30:38.403869 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m00:30:38.411220 [debug] [MainThread]: Using postgres connection "master"
[0m00:30:38.411889 [debug] [MainThread]: On master: BEGIN
[0m00:30:38.412389 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:30:38.428076 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m00:30:38.428904 [debug] [MainThread]: Using postgres connection "master"
[0m00:30:38.429498 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:30:38.437882 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m00:30:38.439736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '06a7f65d-24a9-4af8-a364-aa532581ad2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71e023f82120>]}
[0m00:30:38.440406 [debug] [MainThread]: On master: ROLLBACK
[0m00:30:38.441827 [debug] [MainThread]: Using postgres connection "master"
[0m00:30:38.442504 [debug] [MainThread]: On master: BEGIN
[0m00:30:38.443712 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:30:38.444409 [debug] [MainThread]: On master: COMMIT
[0m00:30:38.445169 [debug] [MainThread]: Using postgres connection "master"
[0m00:30:38.445671 [debug] [MainThread]: On master: COMMIT
[0m00:30:38.446479 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:30:38.447007 [debug] [MainThread]: On master: Close
[0m00:30:38.452398 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:30:38.453391 [info ] [Thread-1 (]: 1 of 2 START sql view model public_staging.stg_comments ........................ [RUN]
[0m00:30:38.454235 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m00:30:38.454803 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:30:38.467535 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:30:38.468815 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:30:38.523285 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m00:30:38.527963 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:30:38.528649 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m00:30:38.529243 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:30:38.544698 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m00:30:38.545745 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:30:38.546430 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m00:30:38.555590 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.009 seconds
[0m00:30:38.564963 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:30:38.565582 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m00:30:38.566832 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:30:38.589254 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:30:38.590417 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:30:38.592561 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:30:38.606605 [debug] [Thread-1 (]: SQL status: COMMIT in 0.013 seconds
[0m00:30:38.620443 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m00:30:38.631029 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:30:38.632015 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m00:30:38.634063 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m00:30:38.637867 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m00:30:38.641683 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06a7f65d-24a9-4af8-a364-aa532581ad2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71e021f6be30>]}
[0m00:30:38.643051 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.19s]
[0m00:30:38.645039 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:30:38.646666 [debug] [Thread-3 (]: Began running node model.mongo_movies.comments_by_user
[0m00:30:38.648099 [info ] [Thread-3 (]: 2 of 2 START sql table model public_marts.comments_by_user ..................... [RUN]
[0m00:30:38.649288 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user'
[0m00:30:38.649876 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.comments_by_user
[0m00:30:38.654924 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user"
[0m00:30:38.656210 [debug] [Thread-3 (]: Began executing node model.mongo_movies.comments_by_user
[0m00:30:38.698476 [debug] [Thread-3 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user"
[0m00:30:38.701409 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m00:30:38.702429 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: BEGIN
[0m00:30:38.703173 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m00:30:38.720519 [debug] [Thread-3 (]: SQL status: BEGIN in 0.017 seconds
[0m00:30:38.721447 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m00:30:38.722494 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */

  
    

  create  table "test_db"."public_marts"."comments_by_user__dbt_tmp"
  
  
    as
  
  (
    select name, email, count(*) from "test_db"."public_staging"."stg_comments"
group by name, email
order by count(*) desc
  );
  
[0m00:30:38.787729 [debug] [Thread-3 (]: SQL status: SELECT 236 in 0.064 seconds
[0m00:30:38.798382 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m00:30:38.799238 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */
alter table "test_db"."public_marts"."comments_by_user__dbt_tmp" rename to "comments_by_user"
[0m00:30:38.800754 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:30:38.802922 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: COMMIT
[0m00:30:38.803523 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m00:30:38.804094 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: COMMIT
[0m00:30:38.814178 [debug] [Thread-3 (]: SQL status: COMMIT in 0.009 seconds
[0m00:30:38.817787 [debug] [Thread-3 (]: Applying DROP to: "test_db"."public_marts"."comments_by_user__dbt_backup"
[0m00:30:38.824406 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m00:30:38.825377 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */
drop table if exists "test_db"."public_marts"."comments_by_user__dbt_backup" cascade
[0m00:30:38.826531 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.001 seconds
[0m00:30:38.828637 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: Close
[0m00:30:38.829718 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06a7f65d-24a9-4af8-a364-aa532581ad2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71e023f818b0>]}
[0m00:30:38.830992 [info ] [Thread-3 (]: 2 of 2 OK created sql table model public_marts.comments_by_user ................ [[32mSELECT 236[0m in 0.18s]
[0m00:30:38.831956 [debug] [Thread-3 (]: Finished running node model.mongo_movies.comments_by_user
[0m00:30:38.835416 [debug] [MainThread]: Using postgres connection "master"
[0m00:30:38.836242 [debug] [MainThread]: On master: BEGIN
[0m00:30:38.837069 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:30:38.851746 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:30:38.852655 [debug] [MainThread]: On master: COMMIT
[0m00:30:38.853418 [debug] [MainThread]: Using postgres connection "master"
[0m00:30:38.854213 [debug] [MainThread]: On master: COMMIT
[0m00:30:38.855399 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:30:38.856274 [debug] [MainThread]: On master: Close
[0m00:30:38.857936 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:30:38.858565 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:30:38.859297 [debug] [MainThread]: Connection 'list_test_db_public_staging' was properly closed.
[0m00:30:38.859943 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user' was properly closed.
[0m00:30:38.860752 [info ] [MainThread]: 
[0m00:30:38.861769 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 0.68 seconds (0.68s).
[0m00:30:38.863396 [debug] [MainThread]: Command end result
[0m00:30:38.897780 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:30:38.900978 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:30:38.913920 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:30:38.914715 [info ] [MainThread]: 
[0m00:30:38.915702 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:30:38.916612 [info ] [MainThread]: 
[0m00:30:38.917385 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m00:30:38.919014 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.8453674, "process_in_blocks": "0", "process_kernel_time": 0.689202, "process_mem_max_rss": "126088", "process_out_blocks": "1800", "process_user_time": 3.387974}
[0m00:30:38.919729 [debug] [MainThread]: Command `dbt run` succeeded at 00:30:38.919561 after 1.85 seconds
[0m00:30:38.920356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71e029d233b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71e024fc1730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71e026630bc0>]}
[0m00:30:38.921079 [debug] [MainThread]: Flushing usage events
[0m00:30:40.171042 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:34:30.751714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6ff3e27440>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6ff2be3200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6ff29295b0>]}


============================== 00:34:30.757278 | 7a587fca-45b9-4242-b9ce-029c6fed96ec ==============================
[0m00:34:30.757278 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:34:30.758334 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt compile', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:34:31.106397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7a587fca-45b9-4242-b9ce-029c6fed96ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6ff1b5adb0>]}
[0m00:34:31.262367 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7a587fca-45b9-4242-b9ce-029c6fed96ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6ff1fe2a20>]}
[0m00:34:31.264001 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:34:31.435841 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:34:31.625769 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:34:31.627166 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user.sql
[0m00:34:32.205873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7a587fca-45b9-4242-b9ce-029c6fed96ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6ff03f1910>]}
[0m00:34:32.309388 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:34:32.312083 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:34:32.331376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7a587fca-45b9-4242-b9ce-029c6fed96ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6ff0708350>]}
[0m00:34:32.332162 [info ] [MainThread]: Found 2 models, 4 sources, 434 macros
[0m00:34:32.332878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7a587fca-45b9-4242-b9ce-029c6fed96ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6ff03f27e0>]}
[0m00:34:32.335618 [info ] [MainThread]: 
[0m00:34:32.336251 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:34:32.336909 [info ] [MainThread]: 
[0m00:34:32.337738 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:34:32.339370 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_marts'
[0m00:34:32.346891 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_staging'
[0m00:34:32.417707 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:34:32.418596 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:34:32.419244 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m00:34:32.419973 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m00:34:32.420697 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:34:32.421369 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:34:32.440345 [debug] [ThreadPool]: SQL status: BEGIN in 0.019 seconds
[0m00:34:32.441066 [debug] [ThreadPool]: SQL status: BEGIN in 0.020 seconds
[0m00:34:32.441595 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:34:32.442355 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:34:32.442990 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m00:34:32.443624 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m00:34:32.451194 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.007 seconds
[0m00:34:32.451751 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.007 seconds
[0m00:34:32.453585 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m00:34:32.455801 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m00:34:32.457258 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m00:34:32.457768 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m00:34:32.465803 [debug] [MainThread]: Using postgres connection "master"
[0m00:34:32.466544 [debug] [MainThread]: On master: BEGIN
[0m00:34:32.467064 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:34:32.482561 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:34:32.483374 [debug] [MainThread]: Using postgres connection "master"
[0m00:34:32.484368 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:34:32.497382 [debug] [MainThread]: SQL status: SELECT 2 in 0.012 seconds
[0m00:34:32.499550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7a587fca-45b9-4242-b9ce-029c6fed96ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6ff0395ac0>]}
[0m00:34:32.500414 [debug] [MainThread]: On master: ROLLBACK
[0m00:34:32.501505 [debug] [MainThread]: On master: Close
[0m00:34:32.507267 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:34:32.508121 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m00:34:32.508769 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:34:32.521273 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:34:32.522617 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:34:32.523990 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:34:32.526363 [debug] [Thread-3 (]: Began running node model.mongo_movies.comments_by_user
[0m00:34:32.527418 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user'
[0m00:34:32.528195 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.comments_by_user
[0m00:34:32.532648 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user"
[0m00:34:32.533796 [debug] [Thread-3 (]: Began executing node model.mongo_movies.comments_by_user
[0m00:34:32.535122 [debug] [Thread-3 (]: Finished running node model.mongo_movies.comments_by_user
[0m00:34:32.538227 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:34:32.538728 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:34:32.539174 [debug] [MainThread]: Connection 'list_test_db_public_staging' was properly closed.
[0m00:34:32.539609 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user' was properly closed.
[0m00:34:32.541070 [debug] [MainThread]: Command end result
[0m00:34:32.575949 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:34:32.578497 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:34:32.591978 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:34:32.593709 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 1.9917043, "process_in_blocks": "0", "process_kernel_time": 0.729254, "process_mem_max_rss": "128596", "process_out_blocks": "2600", "process_user_time": 3.967143}
[0m00:34:32.594660 [debug] [MainThread]: Command `dbt compile` succeeded at 00:34:32.594499 after 1.99 seconds
[0m00:34:32.595230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6ff0fb3d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6ff0b6ddf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6ff0f94f50>]}
[0m00:34:32.595781 [debug] [MainThread]: Flushing usage events
[0m00:34:33.905360 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:39:15.532855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7350e2d85640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7350e2e9f020>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7350e2d85d30>]}


============================== 00:39:15.537959 | 9923c7b0-af0e-48c7-b5e2-3647fdcd1559 ==============================
[0m00:39:15.537959 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:39:15.539444 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt clean', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m00:39:15.779207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9923c7b0-af0e-48c7-b5e2-3647fdcd1559', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7350e2beef30>]}
[0m00:39:15.798990 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.38581213, "process_in_blocks": "0", "process_kernel_time": 0.594255, "process_mem_max_rss": "104640", "process_out_blocks": "8", "process_user_time": 2.355279}
[0m00:39:15.799753 [debug] [MainThread]: Command `dbt clean` succeeded at 00:39:15.799593 after 0.39 seconds
[0m00:39:15.800388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7350e2e9f020>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7350e21a7a70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7350e273d2e0>]}
[0m00:39:15.801598 [debug] [MainThread]: Flushing usage events
[0m00:39:16.723393 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:39:22.607900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x717820101dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x717820a241a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71782050d070>]}


============================== 00:39:22.612999 | faff878e-3c44-46a9-9a59-d6dce60bff82 ==============================
[0m00:39:22.612999 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:39:22.613974 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'debug': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt compile', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m00:39:22.972804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'faff878e-3c44-46a9-9a59-d6dce60bff82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71781f7b6630>]}
[0m00:39:23.123405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'faff878e-3c44-46a9-9a59-d6dce60bff82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x717820488e30>]}
[0m00:39:23.124789 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:39:23.287451 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:39:23.288498 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m00:39:23.289140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'faff878e-3c44-46a9-9a59-d6dce60bff82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71781f7e8d10>]}
[0m00:39:25.173029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'faff878e-3c44-46a9-9a59-d6dce60bff82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71781e58a090>]}
[0m00:39:25.281491 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:39:25.284029 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:39:25.302025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'faff878e-3c44-46a9-9a59-d6dce60bff82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71781e59d190>]}
[0m00:39:25.302842 [info ] [MainThread]: Found 2 models, 4 sources, 434 macros
[0m00:39:25.303894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'faff878e-3c44-46a9-9a59-d6dce60bff82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71781e104fe0>]}
[0m00:39:25.306592 [info ] [MainThread]: 
[0m00:39:25.307380 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:39:25.308174 [info ] [MainThread]: 
[0m00:39:25.309306 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:39:25.310956 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_staging'
[0m00:39:25.385341 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:39:25.386032 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m00:39:25.386555 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:39:25.405276 [debug] [ThreadPool]: SQL status: BEGIN in 0.019 seconds
[0m00:39:25.405941 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:39:25.406476 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m00:39:25.417175 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.010 seconds
[0m00:39:25.419325 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m00:39:25.420306 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m00:39:25.427969 [debug] [MainThread]: Using postgres connection "master"
[0m00:39:25.428600 [debug] [MainThread]: On master: BEGIN
[0m00:39:25.429172 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:39:25.443533 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m00:39:25.444479 [debug] [MainThread]: Using postgres connection "master"
[0m00:39:25.445316 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:39:25.455705 [debug] [MainThread]: SQL status: SELECT 2 in 0.010 seconds
[0m00:39:25.457969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'faff878e-3c44-46a9-9a59-d6dce60bff82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71781dddbe90>]}
[0m00:39:25.458647 [debug] [MainThread]: On master: ROLLBACK
[0m00:39:25.459612 [debug] [MainThread]: On master: Close
[0m00:39:25.465228 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:39:25.466115 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m00:39:25.466696 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:39:25.478371 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:39:25.482629 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:39:25.483863 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:39:25.485331 [debug] [Thread-3 (]: Began running node model.mongo_movies.comments_by_user
[0m00:39:25.486764 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user'
[0m00:39:25.487438 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.comments_by_user
[0m00:39:25.494420 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user"
[0m00:39:25.496863 [debug] [Thread-3 (]: Finished running node model.mongo_movies.comments_by_user
[0m00:39:25.500170 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:39:25.500717 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:39:25.501257 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user' was properly closed.
[0m00:39:25.502334 [debug] [MainThread]: Command end result
[0m00:39:25.531378 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:39:25.533729 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:39:25.543889 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:39:25.545434 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 3.0789485, "process_in_blocks": "0", "process_kernel_time": 0.744967, "process_mem_max_rss": "128392", "process_out_blocks": "2600", "process_user_time": 4.720548}
[0m00:39:25.546157 [debug] [MainThread]: Command `dbt compile` succeeded at 00:39:25.545979 after 3.08 seconds
[0m00:39:25.546757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71781f890350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7178215beea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7178215bee70>]}
[0m00:39:25.547430 [debug] [MainThread]: Flushing usage events
[0m00:39:26.319411 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:47:20.433894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d540029fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d53f66e720>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d53f6f42f0>]}


============================== 00:47:20.439095 | 0086dd8a-1d3f-4203-9e0d-819919d48aea ==============================
[0m00:47:20.439095 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:47:20.440411 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt compile', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m00:47:20.772510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0086dd8a-1d3f-4203-9e0d-819919d48aea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d53efbbbf0>]}
[0m00:47:20.914972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0086dd8a-1d3f-4203-9e0d-819919d48aea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d53ed83b00>]}
[0m00:47:20.916425 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:47:21.086229 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:47:21.250801 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:47:21.251833 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user.sql
[0m00:47:21.801565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0086dd8a-1d3f-4203-9e0d-819919d48aea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d53d5ec230>]}
[0m00:47:21.919389 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:47:21.922013 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:47:21.944082 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0086dd8a-1d3f-4203-9e0d-819919d48aea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d53e149190>]}
[0m00:47:21.944927 [info ] [MainThread]: Found 2 models, 4 sources, 434 macros
[0m00:47:21.945639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0086dd8a-1d3f-4203-9e0d-819919d48aea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d53d57c620>]}
[0m00:47:21.948158 [info ] [MainThread]: 
[0m00:47:21.948944 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:47:29.171909 [info ] [MainThread]: 
[0m00:47:29.173736 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:47:29.175369 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_staging'
[0m00:47:29.181860 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_marts'
[0m00:47:29.256741 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:47:29.257510 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:47:29.258054 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m00:47:29.258709 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m00:47:29.259370 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:47:29.260154 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:47:29.276832 [debug] [ThreadPool]: SQL status: BEGIN in 0.017 seconds
[0m00:47:29.277468 [debug] [ThreadPool]: SQL status: BEGIN in 0.017 seconds
[0m00:47:29.278151 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:47:29.278894 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:47:29.279651 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m00:47:29.280373 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m00:47:29.287029 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.006 seconds
[0m00:47:29.287863 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.007 seconds
[0m00:47:29.289902 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m00:47:29.293090 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m00:47:29.294412 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m00:47:29.295448 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m00:47:29.305511 [debug] [MainThread]: Using postgres connection "master"
[0m00:47:29.306281 [debug] [MainThread]: On master: BEGIN
[0m00:47:29.306849 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:47:29.321440 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m00:47:29.322291 [debug] [MainThread]: Using postgres connection "master"
[0m00:47:29.323028 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:47:29.332463 [debug] [MainThread]: SQL status: SELECT 2 in 0.009 seconds
[0m00:47:29.335246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0086dd8a-1d3f-4203-9e0d-819919d48aea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d53d58d310>]}
[0m00:47:29.335926 [debug] [MainThread]: On master: ROLLBACK
[0m00:47:29.336944 [debug] [MainThread]: On master: Close
[0m00:47:29.342586 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:47:29.343340 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m00:47:29.343905 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:47:29.354744 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:47:29.355795 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:47:29.356926 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:47:29.358553 [debug] [Thread-3 (]: Began running node model.mongo_movies.comments_by_user
[0m00:47:29.359385 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user'
[0m00:47:29.359937 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.comments_by_user
[0m00:47:29.367758 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user"
[0m00:47:29.368783 [debug] [Thread-3 (]: Began executing node model.mongo_movies.comments_by_user
[0m00:47:29.369868 [debug] [Thread-3 (]: Finished running node model.mongo_movies.comments_by_user
[0m00:47:29.373053 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:47:29.373541 [debug] [MainThread]: Connection 'list_test_db_public_staging' was properly closed.
[0m00:47:29.373987 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:47:29.374422 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user' was properly closed.
[0m00:47:29.375541 [debug] [MainThread]: Command end result
[0m00:47:21.773947 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:47:21.776484 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:47:21.792489 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:47:21.794866 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 1.9806101, "process_in_blocks": "0", "process_kernel_time": 0.655432, "process_mem_max_rss": "128216", "process_out_blocks": "2608", "process_user_time": 3.692267}
[0m00:47:21.795796 [debug] [MainThread]: Command `dbt compile` succeeded at 00:47:21.795601 after 1.98 seconds
[0m00:47:21.797194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d54176d7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d541c7a840>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d53c131c70>]}
[0m00:47:21.798075 [debug] [MainThread]: Flushing usage events
[0m00:47:23.127598 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:47:36.238284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bf92490ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bf91a5e630>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bf942c92b0>]}


============================== 00:47:36.243823 | 4a3429d6-23e3-4612-95d7-45349dfd15c9 ==============================
[0m00:47:36.243823 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:47:36.244756 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m00:47:36.585471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4a3429d6-23e3-4612-95d7-45349dfd15c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bf9206d0a0>]}
[0m00:47:36.745284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4a3429d6-23e3-4612-95d7-45349dfd15c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bf91e30440>]}
[0m00:47:36.747063 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:47:36.915977 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:47:44.299075 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:47:44.300083 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:47:44.360192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4a3429d6-23e3-4612-95d7-45349dfd15c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bf90ff2960>]}
[0m00:47:36.831951 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:47:36.834960 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:47:36.873634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4a3429d6-23e3-4612-95d7-45349dfd15c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bf90ff2d50>]}
[0m00:47:36.874911 [info ] [MainThread]: Found 2 models, 4 sources, 434 macros
[0m00:47:36.876696 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4a3429d6-23e3-4612-95d7-45349dfd15c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bf903d36e0>]}
[0m00:47:36.881031 [info ] [MainThread]: 
[0m00:47:36.882110 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:47:36.882858 [info ] [MainThread]: 
[0m00:47:36.883965 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:47:36.900693 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:47:36.902153 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:47:36.976340 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:47:36.977061 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:47:36.977829 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:47:36.978495 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:47:36.979165 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:47:36.979773 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:47:36.998939 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.020 seconds
[0m00:47:36.999608 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.020 seconds
[0m00:47:37.001842 [debug] [ThreadPool]: On list_test_db: Close
[0m00:47:37.003982 [debug] [ThreadPool]: On list_test_db: Close
[0m00:47:37.007838 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m00:47:37.009277 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m00:47:37.018470 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:47:37.021826 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:47:37.022661 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m00:47:37.023341 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m00:47:37.024136 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:47:37.024789 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:47:37.039321 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m00:47:37.040013 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m00:47:37.040850 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:47:37.041593 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:47:37.042527 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m00:47:37.043467 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m00:47:37.050073 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.005 seconds
[0m00:47:37.050847 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.007 seconds
[0m00:47:37.052703 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m00:47:37.054690 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m00:47:37.056121 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m00:47:37.057137 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m00:47:37.065018 [debug] [MainThread]: Using postgres connection "master"
[0m00:47:37.066172 [debug] [MainThread]: On master: BEGIN
[0m00:47:37.066757 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:47:37.082984 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m00:47:37.083656 [debug] [MainThread]: Using postgres connection "master"
[0m00:47:37.084232 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:47:37.093600 [debug] [MainThread]: SQL status: SELECT 2 in 0.008 seconds
[0m00:47:37.095909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4a3429d6-23e3-4612-95d7-45349dfd15c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bf91380e90>]}
[0m00:47:37.096777 [debug] [MainThread]: On master: ROLLBACK
[0m00:47:37.098198 [debug] [MainThread]: Using postgres connection "master"
[0m00:47:37.098762 [debug] [MainThread]: On master: BEGIN
[0m00:47:37.100229 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:47:37.100889 [debug] [MainThread]: On master: COMMIT
[0m00:47:37.101388 [debug] [MainThread]: Using postgres connection "master"
[0m00:47:37.101865 [debug] [MainThread]: On master: COMMIT
[0m00:47:37.102791 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:47:37.103328 [debug] [MainThread]: On master: Close
[0m00:47:37.110258 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:47:37.111191 [info ] [Thread-1 (]: 1 of 2 START sql view model public_staging.stg_comments ........................ [RUN]
[0m00:47:37.112050 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m00:47:37.112744 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:47:37.124690 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:47:37.125776 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:47:37.181045 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m00:47:37.185426 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:47:37.186092 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m00:47:37.186665 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:47:37.202107 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m00:47:37.202870 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:47:37.203549 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m00:47:37.210218 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m00:47:37.219049 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:47:37.219743 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m00:47:37.221325 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:47:37.225151 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:47:37.225887 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m00:47:37.227718 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:47:37.251693 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:47:37.252415 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:47:37.253033 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:47:37.256318 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:47:37.273304 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m00:47:37.284444 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:47:37.285221 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m00:47:37.289822 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m00:47:37.293650 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m00:47:37.296136 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4a3429d6-23e3-4612-95d7-45349dfd15c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bf925f2b40>]}
[0m00:47:37.297191 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.18s]
[0m00:47:37.298280 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:47:37.300531 [debug] [Thread-3 (]: Began running node model.mongo_movies.comments_by_user
[0m00:47:37.301835 [info ] [Thread-3 (]: 2 of 2 START sql incremental model public_marts.comments_by_user ............... [RUN]
[0m00:47:37.302760 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user'
[0m00:47:37.303332 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.comments_by_user
[0m00:47:37.316436 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user"
[0m00:47:37.318296 [debug] [Thread-3 (]: Began executing node model.mongo_movies.comments_by_user
[0m00:47:37.382500 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m00:47:37.383383 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */

    
  
    

  create temporary table "comments_by_user__dbt_tmp004737360828"
  
  
    as
  
  (
    

select 
  name,
  email,
  count(*) as comment_count,
  array_agg(movie_id) as movie_ids
from "test_db"."public_staging"."stg_comments"
where 1=1

  and load_date > (select max(load_date) from "test_db"."public_marts"."comments_by_user")

group by name, email
  );
  
  
[0m00:47:37.384014 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m00:47:37.405260 [debug] [Thread-3 (]: Postgres adapter: Postgres error: aggregate functions are not allowed in WHERE
LINE 23:   and load_date > (select max(load_date) from "test_db"."pub...
                                   ^

[0m00:47:37.406280 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: Close
[0m00:47:37.415165 [debug] [Thread-3 (]: Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  aggregate functions are not allowed in WHERE
  LINE 23:   and load_date > (select max(load_date) from "test_db"."pub...
                                     ^
[0m00:47:37.416023 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4a3429d6-23e3-4612-95d7-45349dfd15c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bf8f373f20>]}
[0m00:47:37.417199 [error] [Thread-3 (]: 2 of 2 ERROR creating sql incremental model public_marts.comments_by_user ...... [[31mERROR[0m in 0.11s]
[0m00:47:37.418286 [debug] [Thread-3 (]: Finished running node model.mongo_movies.comments_by_user
[0m00:47:37.419199 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.comments_by_user' to be skipped because of status 'error'.  Reason: Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  aggregate functions are not allowed in WHERE
  LINE 23:   and load_date > (select max(load_date) from "test_db"."pub...
                                     ^.
[0m00:47:37.423452 [debug] [MainThread]: Using postgres connection "master"
[0m00:47:37.423969 [debug] [MainThread]: On master: BEGIN
[0m00:47:37.424566 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:47:37.439579 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:47:37.440392 [debug] [MainThread]: On master: COMMIT
[0m00:47:37.440926 [debug] [MainThread]: Using postgres connection "master"
[0m00:47:37.441461 [debug] [MainThread]: On master: COMMIT
[0m00:47:37.442262 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:47:37.442862 [debug] [MainThread]: On master: Close
[0m00:47:37.443879 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:47:37.444522 [debug] [MainThread]: Connection 'list_test_db_public_marts' was properly closed.
[0m00:47:37.445028 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:47:37.445469 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user' was properly closed.
[0m00:47:37.446111 [info ] [MainThread]: 
[0m00:47:37.447005 [info ] [MainThread]: Finished running 1 incremental model, 1 view model in 0 hours 0 minutes and 0.56 seconds (0.56s).
[0m00:47:37.448580 [debug] [MainThread]: Command end result
[0m00:47:37.478454 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:47:37.481047 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:47:37.490175 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:47:37.490858 [info ] [MainThread]: 
[0m00:47:37.491574 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m00:47:37.492209 [info ] [MainThread]: 
[0m00:47:37.493082 [error] [MainThread]: [31mFailure in model comments_by_user (models/mongo_movies/comments_by_user.sql)[0m
[0m00:47:37.493884 [error] [MainThread]:   Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  aggregate functions are not allowed in WHERE
  LINE 23:   and load_date > (select max(load_date) from "test_db"."pub...
                                     ^
[0m00:47:37.494457 [info ] [MainThread]: 
[0m00:47:37.495146 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/mongo_movies/comments_by_user.sql
[0m00:47:37.495752 [info ] [MainThread]: 
[0m00:47:37.496492 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m00:47:37.498126 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.8918077, "process_in_blocks": "320", "process_kernel_time": 0.630108, "process_mem_max_rss": "126964", "process_out_blocks": "1784", "process_user_time": 3.623124}
[0m00:47:37.498845 [debug] [MainThread]: Command `dbt run` failed at 00:47:37.498676 after 1.89 seconds
[0m00:47:37.499502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bf923e9af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bf9261c4a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bf8df17170>]}
[0m00:47:37.500320 [debug] [MainThread]: Flushing usage events
[0m00:47:38.794142 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:51:07.030678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8c84535d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8c853af170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8c84d6d640>]}


============================== 00:51:07.039134 | 6965d395-9d42-49ce-a27b-3ae37a2a9faf ==============================
[0m00:51:07.039134 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:51:07.040025 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m00:51:14.761682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6965d395-9d42-49ce-a27b-3ae37a2a9faf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8c84321340>]}
[0m00:51:07.192692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6965d395-9d42-49ce-a27b-3ae37a2a9faf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8c8551b2f0>]}
[0m00:51:07.194200 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:51:07.366602 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:51:07.586379 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:51:07.587557 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user.sql
[0m00:51:08.132499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6965d395-9d42-49ce-a27b-3ae37a2a9faf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8c82be0770>]}
[0m00:51:08.237299 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:51:08.240185 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:51:08.276804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6965d395-9d42-49ce-a27b-3ae37a2a9faf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8c83725580>]}
[0m00:51:08.277560 [info ] [MainThread]: Found 2 models, 4 sources, 434 macros
[0m00:51:08.278156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6965d395-9d42-49ce-a27b-3ae37a2a9faf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8c837d6db0>]}
[0m00:51:08.280534 [info ] [MainThread]: 
[0m00:51:08.281214 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:51:08.281900 [info ] [MainThread]: 
[0m00:51:08.282782 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:51:08.292047 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:51:08.294085 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:51:08.373251 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:51:08.373978 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:51:08.374714 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:51:08.375618 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:51:08.376703 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:51:08.377380 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:51:08.423351 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.046 seconds
[0m00:51:08.424150 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.047 seconds
[0m00:51:08.426095 [debug] [ThreadPool]: On list_test_db: Close
[0m00:51:08.427988 [debug] [ThreadPool]: On list_test_db: Close
[0m00:51:08.431245 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m00:51:08.437980 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m00:51:08.442262 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:51:08.445062 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:51:08.445809 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m00:51:08.446534 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m00:51:08.447325 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:51:08.448133 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:51:08.472430 [debug] [ThreadPool]: SQL status: BEGIN in 0.024 seconds
[0m00:51:08.473302 [debug] [ThreadPool]: SQL status: BEGIN in 0.026 seconds
[0m00:51:08.473940 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:51:08.474622 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:51:08.475387 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m00:51:08.476165 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m00:51:08.486162 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.009 seconds
[0m00:51:08.486919 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.010 seconds
[0m00:51:08.489378 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m00:51:08.491068 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m00:51:08.492166 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m00:51:08.492677 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m00:51:08.500052 [debug] [MainThread]: Using postgres connection "master"
[0m00:51:08.500635 [debug] [MainThread]: On master: BEGIN
[0m00:51:08.501107 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:51:08.515855 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:51:08.516493 [debug] [MainThread]: Using postgres connection "master"
[0m00:51:08.517066 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:51:08.528937 [debug] [MainThread]: SQL status: SELECT 2 in 0.011 seconds
[0m00:51:08.531231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6965d395-9d42-49ce-a27b-3ae37a2a9faf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8c82b40e90>]}
[0m00:51:08.532191 [debug] [MainThread]: On master: ROLLBACK
[0m00:51:08.533177 [debug] [MainThread]: Using postgres connection "master"
[0m00:51:08.533676 [debug] [MainThread]: On master: BEGIN
[0m00:51:08.534736 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:51:08.535308 [debug] [MainThread]: On master: COMMIT
[0m00:51:08.535973 [debug] [MainThread]: Using postgres connection "master"
[0m00:51:08.536628 [debug] [MainThread]: On master: COMMIT
[0m00:51:08.537354 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:51:08.537962 [debug] [MainThread]: On master: Close
[0m00:51:08.545651 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:51:08.546571 [info ] [Thread-1 (]: 1 of 2 START sql view model public_staging.stg_comments ........................ [RUN]
[0m00:51:08.547753 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m00:51:08.548399 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:51:08.562653 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:51:08.563958 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:51:08.622474 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m00:51:08.623648 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:51:08.624274 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m00:51:08.624826 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:51:08.640061 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m00:51:08.640870 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:51:08.641471 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m00:51:08.651173 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.009 seconds
[0m00:51:08.660710 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:51:08.661608 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m00:51:08.662984 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:51:08.668320 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:51:08.669741 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m00:51:08.671491 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:51:08.795932 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:51:08.796739 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:51:08.797590 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:51:08.805001 [debug] [Thread-1 (]: SQL status: COMMIT in 0.007 seconds
[0m00:51:08.814611 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m00:51:08.824320 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:51:08.825231 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m00:51:08.833058 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.007 seconds
[0m00:51:08.836666 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m00:51:08.839908 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6965d395-9d42-49ce-a27b-3ae37a2a9faf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8c855b3320>]}
[0m00:51:08.841411 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.29s]
[0m00:51:08.842423 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:51:08.844561 [debug] [Thread-3 (]: Began running node model.mongo_movies.comments_by_user
[0m00:51:08.845378 [info ] [Thread-3 (]: 2 of 2 START sql incremental model public_marts.comments_by_user ............... [RUN]
[0m00:51:08.846303 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user'
[0m00:51:08.846903 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.comments_by_user
[0m00:51:08.856368 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user"
[0m00:51:08.857519 [debug] [Thread-3 (]: Began executing node model.mongo_movies.comments_by_user
[0m00:51:08.915299 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m00:51:08.916068 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */

    
  
    

  create temporary table "comments_by_user__dbt_tmp005108894413"
  
  
    as
  
  (
    

with latest_load as (
    select max(load_date) as max_load_date from "test_db"."public_marts"."comments_by_user"
)

select 
    c.name, 
    c.email, 
    count(*) as comment_count, 
    array_agg(c.movie_id) as movie_ids
    load_date
from "test_db"."public_staging"."stg_comments" c

join latest_load l on true

where 1=1

  and c.load_date > l.max_load_date

group by c.name, c.email
  );
  
  
[0m00:51:08.916674 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m00:51:08.938794 [debug] [Thread-3 (]: Postgres adapter: Postgres error: syntax error at or near "load_date"
LINE 24:     load_date
             ^

[0m00:51:08.939830 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: Close
[0m00:51:08.950813 [debug] [Thread-3 (]: Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  syntax error at or near "load_date"
  LINE 24:     load_date
               ^
[0m00:51:08.951835 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6965d395-9d42-49ce-a27b-3ae37a2a9faf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8c833ce0f0>]}
[0m00:51:08.952817 [error] [Thread-3 (]: 2 of 2 ERROR creating sql incremental model public_marts.comments_by_user ...... [[31mERROR[0m in 0.11s]
[0m00:51:08.953897 [debug] [Thread-3 (]: Finished running node model.mongo_movies.comments_by_user
[0m00:51:08.954879 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.comments_by_user' to be skipped because of status 'error'.  Reason: Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  syntax error at or near "load_date"
  LINE 24:     load_date
               ^.
[0m00:51:08.959374 [debug] [MainThread]: Using postgres connection "master"
[0m00:51:08.959917 [debug] [MainThread]: On master: BEGIN
[0m00:51:08.960380 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:51:08.975542 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:51:08.976343 [debug] [MainThread]: On master: COMMIT
[0m00:51:08.977035 [debug] [MainThread]: Using postgres connection "master"
[0m00:51:08.977604 [debug] [MainThread]: On master: COMMIT
[0m00:51:08.978393 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:51:08.979047 [debug] [MainThread]: On master: Close
[0m00:51:08.980256 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:51:08.980798 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:51:08.981413 [debug] [MainThread]: Connection 'list_test_db_public_staging' was properly closed.
[0m00:51:08.982010 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user' was properly closed.
[0m00:51:08.982560 [info ] [MainThread]: 
[0m00:51:08.983184 [info ] [MainThread]: Finished running 1 incremental model, 1 view model in 0 hours 0 minutes and 0.70 seconds (0.70s).
[0m00:51:08.984780 [debug] [MainThread]: Command end result
[0m00:51:09.028072 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:51:09.030663 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:51:09.039618 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:51:09.040223 [info ] [MainThread]: 
[0m00:51:09.040892 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m00:51:09.041522 [info ] [MainThread]: 
[0m00:51:09.042199 [error] [MainThread]: [31mFailure in model comments_by_user (models/mongo_movies/comments_by_user.sql)[0m
[0m00:51:09.042869 [error] [MainThread]:   Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  syntax error at or near "load_date"
  LINE 24:     load_date
               ^
[0m00:51:09.043531 [info ] [MainThread]: 
[0m00:51:09.044233 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/mongo_movies/comments_by_user.sql
[0m00:51:09.044796 [info ] [MainThread]: 
[0m00:51:09.045397 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m00:51:09.048056 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.6015842, "process_in_blocks": "90352", "process_kernel_time": 0.934791, "process_mem_max_rss": "129992", "process_out_blocks": "2640", "process_user_time": 3.912822}
[0m00:51:09.048820 [debug] [MainThread]: Command `dbt run` failed at 00:51:09.048623 after 2.60 seconds
[0m00:51:09.049424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8c85391af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8c88ceb3b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8c83b13cb0>]}
[0m00:51:09.050000 [debug] [MainThread]: Flushing usage events
[0m00:51:10.489384 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:51:22.925543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bb4cc25b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bb4cc253d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bb4cc25af0>]}


============================== 00:51:22.931074 | aec5745e-aaa6-4600-bf10-99502698e6eb ==============================
[0m00:51:22.931074 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:51:22.932123 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:51:23.280157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aec5745e-aaa6-4600-bf10-99502698e6eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bb4d78f1a0>]}
[0m00:51:23.420447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'aec5745e-aaa6-4600-bf10-99502698e6eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bb4ca9c560>]}
[0m00:51:23.422246 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:51:23.596751 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:51:23.752957 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:51:23.754212 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user.sql
[0m00:51:24.363950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aec5745e-aaa6-4600-bf10-99502698e6eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bb4ade8590>]}
[0m00:51:24.466935 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:51:24.469493 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:51:24.488708 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aec5745e-aaa6-4600-bf10-99502698e6eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bb4adb7440>]}
[0m00:51:24.489546 [info ] [MainThread]: Found 2 models, 4 sources, 434 macros
[0m00:51:24.490293 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aec5745e-aaa6-4600-bf10-99502698e6eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bb4b187530>]}
[0m00:51:24.492962 [info ] [MainThread]: 
[0m00:51:24.493672 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:51:24.494295 [info ] [MainThread]: 
[0m00:51:24.495174 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:51:24.501019 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:51:24.508438 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:51:24.575247 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:51:24.576248 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:51:24.576902 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:51:24.577533 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:51:24.578230 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:51:24.578946 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:51:24.597477 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.018 seconds
[0m00:51:24.598528 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.020 seconds
[0m00:51:24.600403 [debug] [ThreadPool]: On list_test_db: Close
[0m00:51:24.602275 [debug] [ThreadPool]: On list_test_db: Close
[0m00:51:24.605658 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m00:51:24.612171 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m00:51:24.616160 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:51:24.619537 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:51:24.620301 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m00:51:24.620984 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m00:51:24.621615 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:51:24.622268 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:51:24.636383 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m00:51:24.637086 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:51:24.637638 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m00:51:24.638250 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m00:51:24.638950 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:51:24.640029 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m00:51:24.646874 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.007 seconds
[0m00:51:24.647758 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.007 seconds
[0m00:51:24.649987 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m00:51:24.651905 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m00:51:24.653057 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m00:51:24.653570 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m00:51:24.661651 [debug] [MainThread]: Using postgres connection "master"
[0m00:51:24.662250 [debug] [MainThread]: On master: BEGIN
[0m00:51:24.662780 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:51:24.677958 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:51:24.678676 [debug] [MainThread]: Using postgres connection "master"
[0m00:51:24.679260 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:51:24.689912 [debug] [MainThread]: SQL status: SELECT 2 in 0.010 seconds
[0m00:51:24.692076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aec5745e-aaa6-4600-bf10-99502698e6eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bb4ad48950>]}
[0m00:51:24.692807 [debug] [MainThread]: On master: ROLLBACK
[0m00:51:24.693716 [debug] [MainThread]: Using postgres connection "master"
[0m00:51:24.694229 [debug] [MainThread]: On master: BEGIN
[0m00:51:24.695519 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:51:24.696089 [debug] [MainThread]: On master: COMMIT
[0m00:51:24.696590 [debug] [MainThread]: Using postgres connection "master"
[0m00:51:24.697128 [debug] [MainThread]: On master: COMMIT
[0m00:51:24.698019 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:51:24.698581 [debug] [MainThread]: On master: Close
[0m00:51:24.704498 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:51:24.705652 [info ] [Thread-1 (]: 1 of 2 START sql view model public_staging.stg_comments ........................ [RUN]
[0m00:51:24.706805 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m00:51:24.707517 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:51:24.719015 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:51:24.720066 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:51:24.776421 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m00:51:24.778005 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:51:24.778719 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m00:51:24.779590 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:51:24.793898 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m00:51:24.794642 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:51:24.795425 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m00:51:24.802373 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m00:51:24.811511 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:51:24.812275 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m00:51:24.813836 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:51:24.819605 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:51:24.820290 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m00:51:24.821952 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:51:24.939869 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:51:24.940617 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:51:24.941253 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:51:24.951908 [debug] [Thread-1 (]: SQL status: COMMIT in 0.010 seconds
[0m00:51:24.962436 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m00:51:24.972213 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:51:24.972907 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m00:51:24.977211 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m00:51:24.981132 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m00:51:24.983858 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aec5745e-aaa6-4600-bf10-99502698e6eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bb4dad6780>]}
[0m00:51:24.984793 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.28s]
[0m00:51:24.985800 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:51:24.987257 [debug] [Thread-3 (]: Began running node model.mongo_movies.comments_by_user
[0m00:51:24.988639 [info ] [Thread-3 (]: 2 of 2 START sql incremental model public_marts.comments_by_user ............... [RUN]
[0m00:51:24.989505 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user'
[0m00:51:24.990074 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.comments_by_user
[0m00:51:24.999515 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user"
[0m00:51:25.000959 [debug] [Thread-3 (]: Began executing node model.mongo_movies.comments_by_user
[0m00:51:25.061030 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m00:51:25.061762 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */

    
  
    

  create temporary table "comments_by_user__dbt_tmp005125040094"
  
  
    as
  
  (
    

with latest_load as (
    select max(load_date) as max_load_date from "test_db"."public_marts"."comments_by_user"
)

select 
    c.name, 
    c.email, 
    count(*) as comment_count, 
    array_agg(c.movie_id) as movie_ids,
    load_date
from "test_db"."public_staging"."stg_comments" c

join latest_load l on true

where 1=1

  and c.load_date > l.max_load_date

group by c.name, c.email
  );
  
  
[0m00:51:25.062402 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m00:51:25.084156 [debug] [Thread-3 (]: Postgres adapter: Postgres error: column "load_date" does not exist
LINE 16:     select max(load_date) as max_load_date from "test_db"."p...
                        ^

[0m00:51:25.085538 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: Close
[0m00:51:25.092006 [debug] [Thread-3 (]: Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  column "load_date" does not exist
  LINE 16:     select max(load_date) as max_load_date from "test_db"."p...
                          ^
[0m00:51:25.092858 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aec5745e-aaa6-4600-bf10-99502698e6eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bb4c1f5550>]}
[0m00:51:25.093845 [error] [Thread-3 (]: 2 of 2 ERROR creating sql incremental model public_marts.comments_by_user ...... [[31mERROR[0m in 0.10s]
[0m00:51:25.094826 [debug] [Thread-3 (]: Finished running node model.mongo_movies.comments_by_user
[0m00:51:25.095737 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.comments_by_user' to be skipped because of status 'error'.  Reason: Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  column "load_date" does not exist
  LINE 16:     select max(load_date) as max_load_date from "test_db"."p...
                          ^.
[0m00:51:25.100044 [debug] [MainThread]: Using postgres connection "master"
[0m00:51:25.100570 [debug] [MainThread]: On master: BEGIN
[0m00:51:25.101051 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:51:25.116933 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m00:51:25.117835 [debug] [MainThread]: On master: COMMIT
[0m00:51:25.118571 [debug] [MainThread]: Using postgres connection "master"
[0m00:51:25.119119 [debug] [MainThread]: On master: COMMIT
[0m00:51:25.120039 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:51:25.120538 [debug] [MainThread]: On master: Close
[0m00:51:25.121366 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:51:25.121851 [debug] [MainThread]: Connection 'list_test_db_public_marts' was properly closed.
[0m00:51:25.122287 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:51:25.122713 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user' was properly closed.
[0m00:51:25.123306 [info ] [MainThread]: 
[0m00:51:25.124197 [info ] [MainThread]: Finished running 1 incremental model, 1 view model in 0 hours 0 minutes and 0.63 seconds (0.63s).
[0m00:51:25.126826 [debug] [MainThread]: Command end result
[0m00:51:25.165730 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:51:25.168384 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:51:25.176688 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:51:25.177229 [info ] [MainThread]: 
[0m00:51:25.177909 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m00:51:25.178631 [info ] [MainThread]: 
[0m00:51:25.179465 [error] [MainThread]: [31mFailure in model comments_by_user (models/mongo_movies/comments_by_user.sql)[0m
[0m00:51:25.180167 [error] [MainThread]:   Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  column "load_date" does not exist
  LINE 16:     select max(load_date) as max_load_date from "test_db"."p...
                          ^
[0m00:51:25.180817 [info ] [MainThread]: 
[0m00:51:25.181725 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/mongo_movies/comments_by_user.sql
[0m00:51:25.182395 [info ] [MainThread]: 
[0m00:51:25.183103 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m00:51:25.184715 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.3791409, "process_in_blocks": "0", "process_kernel_time": 0.821915, "process_mem_max_rss": "130572", "process_out_blocks": "2624", "process_user_time": 3.862273}
[0m00:51:25.185533 [debug] [MainThread]: Command `dbt run` failed at 00:51:25.185352 after 2.38 seconds
[0m00:51:25.186331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bb4c544110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bb4c5447a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bb4dd88e00>]}
[0m00:51:25.187177 [debug] [MainThread]: Flushing usage events
[0m00:51:26.544456 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:52:41.856091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1839466300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1838a296a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1838a28440>]}


============================== 00:52:41.861404 | 53a9b458-0cc5-4be6-8119-1b6fbdd95eb7 ==============================
[0m00:52:41.861404 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:52:41.862470 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'version_check': 'True', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m00:52:42.184387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '53a9b458-0cc5-4be6-8119-1b6fbdd95eb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1837d3cd10>]}
[0m00:52:42.318014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '53a9b458-0cc5-4be6-8119-1b6fbdd95eb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e183a91c4d0>]}
[0m00:52:42.319382 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:52:42.477836 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:52:49.866897 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:52:49.867895 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user.sql
[0m00:52:42.743717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '53a9b458-0cc5-4be6-8119-1b6fbdd95eb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e18369dc860>]}
[0m00:52:42.860595 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:52:42.863395 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:52:42.882477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '53a9b458-0cc5-4be6-8119-1b6fbdd95eb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1837541880>]}
[0m00:52:42.883604 [info ] [MainThread]: Found 2 models, 4 sources, 434 macros
[0m00:52:42.884311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '53a9b458-0cc5-4be6-8119-1b6fbdd95eb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e18369d0c50>]}
[0m00:52:42.887203 [info ] [MainThread]: 
[0m00:52:42.888067 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:52:42.888660 [info ] [MainThread]: 
[0m00:52:42.889931 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:52:42.897081 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:52:42.904309 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:52:42.974773 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:52:42.975573 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:52:42.976196 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:52:42.976865 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:52:42.977583 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:52:42.978300 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:52:42.997554 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.020 seconds
[0m00:52:42.998283 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.020 seconds
[0m00:52:43.000329 [debug] [ThreadPool]: On list_test_db: Close
[0m00:52:43.002232 [debug] [ThreadPool]: On list_test_db: Close
[0m00:52:43.005358 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m00:52:43.006709 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m00:52:43.017661 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:52:43.020611 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:52:43.021370 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m00:52:43.022083 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m00:52:43.022749 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:52:43.023391 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:52:43.039590 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m00:52:43.040348 [debug] [ThreadPool]: SQL status: BEGIN in 0.018 seconds
[0m00:52:43.041091 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:52:43.041975 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:52:43.042649 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m00:52:43.043389 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m00:52:43.050088 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.006 seconds
[0m00:52:43.050788 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.006 seconds
[0m00:52:43.053348 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m00:52:43.055608 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m00:52:43.056696 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m00:52:43.057379 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m00:52:43.067688 [debug] [MainThread]: Using postgres connection "master"
[0m00:52:43.068397 [debug] [MainThread]: On master: BEGIN
[0m00:52:43.068907 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:52:43.083783 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:52:43.084540 [debug] [MainThread]: Using postgres connection "master"
[0m00:52:43.085167 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:52:43.094315 [debug] [MainThread]: SQL status: SELECT 2 in 0.008 seconds
[0m00:52:43.096304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '53a9b458-0cc5-4be6-8119-1b6fbdd95eb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e183ac48b30>]}
[0m00:52:43.097053 [debug] [MainThread]: On master: ROLLBACK
[0m00:52:43.098085 [debug] [MainThread]: Using postgres connection "master"
[0m00:52:43.098579 [debug] [MainThread]: On master: BEGIN
[0m00:52:43.099818 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:52:43.100369 [debug] [MainThread]: On master: COMMIT
[0m00:52:43.100889 [debug] [MainThread]: Using postgres connection "master"
[0m00:52:43.101642 [debug] [MainThread]: On master: COMMIT
[0m00:52:43.102476 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:52:43.103036 [debug] [MainThread]: On master: Close
[0m00:52:43.109030 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:52:43.110029 [info ] [Thread-1 (]: 1 of 2 START sql view model public_staging.stg_comments ........................ [RUN]
[0m00:52:43.110855 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m00:52:43.111452 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:52:43.123603 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:52:43.124902 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:52:43.189357 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m00:52:43.190705 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:52:43.191482 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m00:52:43.192048 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:52:43.207596 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m00:52:43.208499 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:52:43.209104 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m00:52:43.219920 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m00:52:43.234495 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:52:43.235502 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m00:52:43.237318 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:52:43.244044 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:52:43.244819 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m00:52:43.246392 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:52:43.364436 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:52:43.365217 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:52:43.365880 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:52:43.372862 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m00:52:43.382296 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m00:52:43.391756 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:52:43.392552 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m00:52:43.396079 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m00:52:43.399870 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m00:52:43.402735 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '53a9b458-0cc5-4be6-8119-1b6fbdd95eb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e18393e2b70>]}
[0m00:52:43.403740 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.29s]
[0m00:52:43.404759 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:52:43.406653 [debug] [Thread-3 (]: Began running node model.mongo_movies.comments_by_user
[0m00:52:43.407847 [info ] [Thread-3 (]: 2 of 2 START sql incremental model public_marts.comments_by_user ............... [RUN]
[0m00:52:43.408889 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user'
[0m00:52:43.409534 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.comments_by_user
[0m00:52:43.420296 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user"
[0m00:52:43.421417 [debug] [Thread-3 (]: Began executing node model.mongo_movies.comments_by_user
[0m00:52:43.480197 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m00:52:43.480943 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */

    
  
    

  create temporary table "comments_by_user__dbt_tmp005243458418"
  
  
    as
  
  (
    

with max_existing_date as (
  
    select max(load_date) as max_load_date from "test_db"."public_marts"."comments_by_user"
  
)

select 
    c.name, 
    c.email, 
    count(*) as comment_count, 
    array_agg(c.movie_id) as movie_ids,
    load_date
from "test_db"."public_staging"."stg_comments" c

join max_existing_date l on true

where 1=1

  and c.load_date > l.max_load_date

group by c.name, c.email
  );
  
  
[0m00:52:43.481523 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m00:52:43.497436 [debug] [Thread-3 (]: Postgres adapter: Postgres error: column "load_date" does not exist
LINE 17:     select max(load_date) as max_load_date from "test_db"."p...
                        ^

[0m00:52:43.498397 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: Close
[0m00:52:43.503984 [debug] [Thread-3 (]: Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  column "load_date" does not exist
  LINE 17:     select max(load_date) as max_load_date from "test_db"."p...
                          ^
[0m00:52:43.504779 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '53a9b458-0cc5-4be6-8119-1b6fbdd95eb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e183650b7d0>]}
[0m00:52:43.505973 [error] [Thread-3 (]: 2 of 2 ERROR creating sql incremental model public_marts.comments_by_user ...... [[31mERROR[0m in 0.10s]
[0m00:52:43.507036 [debug] [Thread-3 (]: Finished running node model.mongo_movies.comments_by_user
[0m00:52:43.507985 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.comments_by_user' to be skipped because of status 'error'.  Reason: Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  column "load_date" does not exist
  LINE 17:     select max(load_date) as max_load_date from "test_db"."p...
                          ^.
[0m00:52:43.513129 [debug] [MainThread]: Using postgres connection "master"
[0m00:52:43.513730 [debug] [MainThread]: On master: BEGIN
[0m00:52:43.514245 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:52:43.529493 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:52:43.530421 [debug] [MainThread]: On master: COMMIT
[0m00:52:43.531045 [debug] [MainThread]: Using postgres connection "master"
[0m00:52:43.531563 [debug] [MainThread]: On master: COMMIT
[0m00:52:43.532422 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:52:43.532960 [debug] [MainThread]: On master: Close
[0m00:52:43.533936 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:52:43.534460 [debug] [MainThread]: Connection 'list_test_db_public_staging' was properly closed.
[0m00:52:43.534906 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:52:43.535339 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user' was properly closed.
[0m00:52:43.535851 [info ] [MainThread]: 
[0m00:52:43.536581 [info ] [MainThread]: Finished running 1 incremental model, 1 view model in 0 hours 0 minutes and 0.65 seconds (0.65s).
[0m00:52:43.538277 [debug] [MainThread]: Command end result
[0m00:52:43.573017 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:52:43.575681 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:52:43.584549 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:52:43.585151 [info ] [MainThread]: 
[0m00:52:43.586019 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m00:52:43.586747 [info ] [MainThread]: 
[0m00:52:43.587457 [error] [MainThread]: [31mFailure in model comments_by_user (models/mongo_movies/comments_by_user.sql)[0m
[0m00:52:43.588131 [error] [MainThread]:   Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  column "load_date" does not exist
  LINE 17:     select max(load_date) as max_load_date from "test_db"."p...
                          ^
[0m00:52:43.588740 [info ] [MainThread]: 
[0m00:52:43.589491 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/mongo_movies/comments_by_user.sql
[0m00:52:43.590047 [info ] [MainThread]: 
[0m00:52:43.590640 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m00:52:43.592220 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.3611467, "process_in_blocks": "0", "process_kernel_time": 0.652045, "process_mem_max_rss": "130424", "process_out_blocks": "2640", "process_user_time": 3.970554}
[0m00:52:43.593064 [debug] [MainThread]: Command `dbt run` failed at 00:52:43.592865 after 2.36 seconds
[0m00:52:43.594024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e183b049af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e18384502c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1838450410>]}
[0m00:52:43.594782 [debug] [MainThread]: Flushing usage events
[0m00:52:45.069236 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:56:00.266577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def6f972120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def6d511760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def6d0a0350>]}


============================== 00:56:00.271472 | 18d9eac5-3004-493a-9c8f-2e307a70b437 ==============================
[0m00:56:00.271472 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:56:00.272374 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'version_check': 'True', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:56:00.599697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '18d9eac5-3004-493a-9c8f-2e307a70b437', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def713b33b0>]}
[0m00:56:00.740496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '18d9eac5-3004-493a-9c8f-2e307a70b437', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def6cef7e00>]}
[0m00:56:00.741981 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:56:00.915408 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:56:01.080252 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:56:01.081365 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user.sql
[0m00:56:01.673757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '18d9eac5-3004-493a-9c8f-2e307a70b437', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def6b1e0530>]}
[0m00:56:01.784719 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:56:01.787335 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:56:01.806662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '18d9eac5-3004-493a-9c8f-2e307a70b437', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def6bd22990>]}
[0m00:56:01.807550 [info ] [MainThread]: Found 2 models, 4 sources, 434 macros
[0m00:56:01.808293 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '18d9eac5-3004-493a-9c8f-2e307a70b437', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def6b1adbb0>]}
[0m00:56:01.811711 [info ] [MainThread]: 
[0m00:56:01.812493 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:56:01.813145 [info ] [MainThread]: 
[0m00:56:01.814109 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:56:01.821610 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:56:01.823509 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:56:01.908989 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:56:01.909783 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:56:01.910512 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:56:01.911243 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:56:01.911899 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:56:01.912546 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:56:01.931150 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.019 seconds
[0m00:56:01.931834 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.019 seconds
[0m00:56:01.934710 [debug] [ThreadPool]: On list_test_db: Close
[0m00:56:01.936476 [debug] [ThreadPool]: On list_test_db: Close
[0m00:56:01.940031 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m00:56:01.941341 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m00:56:01.950334 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:56:01.952562 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:56:01.953728 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m00:56:01.954533 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m00:56:01.955197 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:56:01.955894 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:56:01.971043 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m00:56:01.971914 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:56:01.972699 [debug] [ThreadPool]: SQL status: BEGIN in 0.017 seconds
[0m00:56:01.973631 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m00:56:01.974630 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:56:01.975615 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m00:56:01.980627 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.005 seconds
[0m00:56:01.983221 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m00:56:01.983766 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.008 seconds
[0m00:56:01.986454 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m00:56:01.986961 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m00:56:01.988151 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m00:56:01.996156 [debug] [MainThread]: Using postgres connection "master"
[0m00:56:01.996801 [debug] [MainThread]: On master: BEGIN
[0m00:56:01.997434 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:56:02.014533 [debug] [MainThread]: SQL status: BEGIN in 0.017 seconds
[0m00:56:02.015156 [debug] [MainThread]: Using postgres connection "master"
[0m00:56:02.015751 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:56:02.024973 [debug] [MainThread]: SQL status: SELECT 2 in 0.009 seconds
[0m00:56:02.027420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '18d9eac5-3004-493a-9c8f-2e307a70b437', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def6c598260>]}
[0m00:56:02.028121 [debug] [MainThread]: On master: ROLLBACK
[0m00:56:02.029235 [debug] [MainThread]: Using postgres connection "master"
[0m00:56:02.029789 [debug] [MainThread]: On master: BEGIN
[0m00:56:02.031315 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:56:02.031930 [debug] [MainThread]: On master: COMMIT
[0m00:56:02.032438 [debug] [MainThread]: Using postgres connection "master"
[0m00:56:02.033094 [debug] [MainThread]: On master: COMMIT
[0m00:56:02.033946 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:56:02.034475 [debug] [MainThread]: On master: Close
[0m00:56:02.040671 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:56:02.041680 [info ] [Thread-1 (]: 1 of 2 START sql view model public_staging.stg_comments ........................ [RUN]
[0m00:56:02.042487 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m00:56:02.043051 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:56:02.054919 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:56:02.055996 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:56:02.112616 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m00:56:02.113977 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:56:02.114608 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m00:56:02.115224 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:56:02.130910 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m00:56:02.131632 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:56:02.132241 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m00:56:02.137512 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m00:56:02.146947 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:56:02.147658 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m00:56:02.149694 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:56:02.155029 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:56:02.155681 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m00:56:02.156941 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:56:02.277282 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:56:02.278015 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:56:02.278628 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:56:02.287218 [debug] [Thread-1 (]: SQL status: COMMIT in 0.008 seconds
[0m00:56:02.297478 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m00:56:02.311956 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:56:02.312711 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m00:56:02.316121 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m00:56:02.319638 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m00:56:02.322273 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '18d9eac5-3004-493a-9c8f-2e307a70b437', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def6dec6cc0>]}
[0m00:56:02.323380 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.28s]
[0m00:56:02.325256 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:56:02.327047 [debug] [Thread-3 (]: Began running node model.mongo_movies.comments_by_user
[0m00:56:02.327956 [info ] [Thread-3 (]: 2 of 2 START sql incremental model public_marts.comments_by_user ............... [RUN]
[0m00:56:02.328998 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user'
[0m00:56:02.329783 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.comments_by_user
[0m00:56:02.336468 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user"
[0m00:56:02.337722 [debug] [Thread-3 (]: Began executing node model.mongo_movies.comments_by_user
[0m00:56:02.405144 [debug] [Thread-3 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user"
[0m00:56:02.411928 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m00:56:02.412570 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: BEGIN
[0m00:56:02.413276 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m00:56:02.427499 [debug] [Thread-3 (]: SQL status: BEGIN in 0.014 seconds
[0m00:56:02.428277 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m00:56:02.429288 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */

      
  
    

  create  table "test_db"."public_marts"."comments_by_user"
  
  
    as
  
  (
    

with latest_load as (
    select max(load_date) as max_load_date from "test_db"."public_marts"."comments_by_user"
)

select 
    c.name, 
    c.email, 
    count(*) as comment_count, 
    array_agg(c.movie_id) as movie_ids,
    load_date
from "test_db"."public_staging"."stg_comments" c

where 1=1

group by c.name, c.email
  );
  
  
[0m00:56:02.430733 [debug] [Thread-3 (]: Postgres adapter: Postgres error: relation "public_marts.comments_by_user" does not exist
LINE 16:     select max(load_date) as max_load_date from "test_db"."p...
                                                         ^

[0m00:56:02.431436 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: ROLLBACK
[0m00:56:02.432444 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: Close
[0m00:56:02.439120 [debug] [Thread-3 (]: Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  relation "public_marts.comments_by_user" does not exist
  LINE 16:     select max(load_date) as max_load_date from "test_db"."p...
                                                           ^
  compiled code at target/run/mongo_movies/models/mongo_movies/comments_by_user.sql
[0m00:56:02.440048 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '18d9eac5-3004-493a-9c8f-2e307a70b437', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def6b9ab230>]}
[0m00:56:02.441112 [error] [Thread-3 (]: 2 of 2 ERROR creating sql incremental model public_marts.comments_by_user ...... [[31mERROR[0m in 0.11s]
[0m00:56:02.442276 [debug] [Thread-3 (]: Finished running node model.mongo_movies.comments_by_user
[0m00:56:02.443328 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.comments_by_user' to be skipped because of status 'error'.  Reason: Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  relation "public_marts.comments_by_user" does not exist
  LINE 16:     select max(load_date) as max_load_date from "test_db"."p...
                                                           ^
  compiled code at target/run/mongo_movies/models/mongo_movies/comments_by_user.sql.
[0m00:56:02.447787 [debug] [MainThread]: Using postgres connection "master"
[0m00:56:02.448325 [debug] [MainThread]: On master: BEGIN
[0m00:56:02.448931 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:56:02.464878 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m00:56:02.465612 [debug] [MainThread]: On master: COMMIT
[0m00:56:02.466122 [debug] [MainThread]: Using postgres connection "master"
[0m00:56:02.466648 [debug] [MainThread]: On master: COMMIT
[0m00:56:02.467467 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:56:02.468050 [debug] [MainThread]: On master: Close
[0m00:56:02.469046 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:56:02.469567 [debug] [MainThread]: Connection 'list_test_db_public_staging' was properly closed.
[0m00:56:02.470179 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:56:02.470826 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user' was properly closed.
[0m00:56:02.471598 [info ] [MainThread]: 
[0m00:56:02.472326 [info ] [MainThread]: Finished running 1 incremental model, 1 view model in 0 hours 0 minutes and 0.66 seconds (0.66s).
[0m00:56:02.474711 [debug] [MainThread]: Command end result
[0m00:56:02.513146 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:56:02.515720 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:56:02.524154 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:56:02.524699 [info ] [MainThread]: 
[0m00:56:02.526329 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m00:56:02.527190 [info ] [MainThread]: 
[0m00:56:02.528216 [error] [MainThread]: [31mFailure in model comments_by_user (models/mongo_movies/comments_by_user.sql)[0m
[0m00:56:02.529342 [error] [MainThread]:   Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  relation "public_marts.comments_by_user" does not exist
  LINE 16:     select max(load_date) as max_load_date from "test_db"."p...
                                                           ^
  compiled code at target/run/mongo_movies/models/mongo_movies/comments_by_user.sql
[0m00:56:02.530059 [info ] [MainThread]: 
[0m00:56:02.530879 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/mongo_movies/comments_by_user.sql
[0m00:56:02.531639 [info ] [MainThread]: 
[0m00:56:02.532430 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m00:56:02.534354 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.397566, "process_in_blocks": "8", "process_kernel_time": 0.760498, "process_mem_max_rss": "130636", "process_out_blocks": "2656", "process_user_time": 3.965457}
[0m00:56:02.535143 [debug] [MainThread]: Command `dbt run` failed at 00:56:02.534962 after 2.40 seconds
[0m00:56:02.535796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def6deed5e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def6d37bef0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def6c111400>]}
[0m00:56:02.536397 [debug] [MainThread]: Flushing usage events
[0m00:56:03.346572 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:57:20.932010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5e65d3f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5e69a2480>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5e69a19a0>]}


============================== 00:57:20.938259 | 79eb2ed1-3c19-4745-b956-d2c45f143ddb ==============================
[0m00:57:20.938259 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:57:20.939298 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt compile', 'send_anonymous_usage_stats': 'True'}
[0m00:57:21.254049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '79eb2ed1-3c19-4745-b956-d2c45f143ddb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5ea5b33b0>]}
[0m00:57:21.388567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '79eb2ed1-3c19-4745-b956-d2c45f143ddb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5e6147d10>]}
[0m00:57:21.389804 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:57:21.555405 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:57:21.708499 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:57:21.709456 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user.sql
[0m00:57:22.324460 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '79eb2ed1-3c19-4745-b956-d2c45f143ddb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5e43dc680>]}
[0m00:57:22.428902 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:57:22.431336 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:57:22.447874 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '79eb2ed1-3c19-4745-b956-d2c45f143ddb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5e43b5280>]}
[0m00:57:22.448660 [info ] [MainThread]: Found 2 models, 4 sources, 434 macros
[0m00:57:22.449264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '79eb2ed1-3c19-4745-b956-d2c45f143ddb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5e43df7d0>]}
[0m00:57:22.451865 [info ] [MainThread]: 
[0m00:57:22.452527 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:57:22.453062 [info ] [MainThread]: 
[0m00:57:22.453878 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:57:22.455555 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_marts'
[0m00:57:22.462602 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_staging'
[0m00:57:22.539278 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:57:22.540341 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:57:22.541327 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m00:57:22.542002 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m00:57:22.542660 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:57:22.543321 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:57:22.560730 [debug] [ThreadPool]: SQL status: BEGIN in 0.018 seconds
[0m00:57:22.561699 [debug] [ThreadPool]: SQL status: BEGIN in 0.018 seconds
[0m00:57:22.562373 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:57:22.563104 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:57:22.563820 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m00:57:22.564484 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m00:57:22.571230 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.006 seconds
[0m00:57:22.571897 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.007 seconds
[0m00:57:22.573861 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m00:57:22.576260 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m00:57:22.577694 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m00:57:22.578521 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m00:57:22.587531 [debug] [MainThread]: Using postgres connection "master"
[0m00:57:22.588250 [debug] [MainThread]: On master: BEGIN
[0m00:57:22.588843 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:57:22.603663 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:57:22.604630 [debug] [MainThread]: Using postgres connection "master"
[0m00:57:22.605537 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:57:22.614124 [debug] [MainThread]: SQL status: SELECT 2 in 0.008 seconds
[0m00:57:22.616135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '79eb2ed1-3c19-4745-b956-d2c45f143ddb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5e4f3bb60>]}
[0m00:57:22.616985 [debug] [MainThread]: On master: ROLLBACK
[0m00:57:22.617823 [debug] [MainThread]: On master: Close
[0m00:57:22.624664 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:57:22.625453 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m00:57:22.626065 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:57:22.638552 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:57:22.639686 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:57:22.641411 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:57:22.643339 [debug] [Thread-3 (]: Began running node model.mongo_movies.comments_by_user
[0m00:57:22.644259 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user'
[0m00:57:22.644912 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.comments_by_user
[0m00:57:22.658052 [debug] [Thread-3 (]: Compilation Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  'dbt_utils' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m00:57:22.659424 [debug] [Thread-3 (]: Finished running node model.mongo_movies.comments_by_user
[0m00:57:22.660727 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.comments_by_user' to be skipped because of status 'error'.  Reason: Compilation Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  'dbt_utils' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps"..
[0m00:57:22.662564 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:57:22.664025 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:57:22.664623 [debug] [MainThread]: Connection 'list_test_db_public_staging' was properly closed.
[0m00:57:22.665052 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user' was properly closed.
[0m00:57:22.665746 [error] [MainThread]: Encountered an error:
Runtime Error
  Compilation Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
    'dbt_utils' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m00:57:22.667148 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": false, "command_wall_clock_time": 1.8535424, "process_in_blocks": "232", "process_kernel_time": 0.677275, "process_mem_max_rss": "128364", "process_out_blocks": "1752", "process_user_time": 3.647144}
[0m00:57:22.667907 [debug] [MainThread]: Command `dbt compile` failed at 00:57:22.667719 after 1.85 seconds
[0m00:57:22.668512 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5e62bcd40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5e43cbda0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5e43b4440>]}
[0m00:57:22.669075 [debug] [MainThread]: Flushing usage events
[0m00:57:23.567833 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:57:36.726734 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e067533f20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e067787fb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e0675339e0>]}


============================== 00:57:36.732894 | 762de09d-0183-409a-abe1-9a40773e6430 ==============================
[0m00:57:36.732894 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:57:36.734548 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt compile', 'send_anonymous_usage_stats': 'True'}
[0m00:57:37.108826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '762de09d-0183-409a-abe1-9a40773e6430', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e069d733e0>]}
[0m00:57:37.246704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '762de09d-0183-409a-abe1-9a40773e6430', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e0675b2930>]}
[0m00:57:37.247971 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:57:37.422914 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:57:37.581214 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:57:37.582157 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user.sql
[0m00:57:45.348532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '762de09d-0183-409a-abe1-9a40773e6430', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e0657dc260>]}
[0m00:57:45.453775 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:57:45.456381 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:57:45.473579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '762de09d-0183-409a-abe1-9a40773e6430', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e066366630>]}
[0m00:57:45.474400 [info ] [MainThread]: Found 2 models, 4 sources, 434 macros
[0m00:57:45.475361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '762de09d-0183-409a-abe1-9a40773e6430', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e066381910>]}
[0m00:57:45.478064 [info ] [MainThread]: 
[0m00:57:45.478832 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:57:45.479665 [info ] [MainThread]: 
[0m00:57:45.480865 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:57:45.482862 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_marts'
[0m00:57:45.484481 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_staging'
[0m00:57:37.834767 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:57:37.835476 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:57:37.847158 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m00:57:37.847880 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m00:57:37.848511 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:57:37.849149 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:57:37.866495 [debug] [ThreadPool]: SQL status: BEGIN in 0.018 seconds
[0m00:57:37.867195 [debug] [ThreadPool]: SQL status: BEGIN in 0.018 seconds
[0m00:57:37.867914 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:57:37.868586 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:57:37.869283 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m00:57:37.870096 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m00:57:37.877237 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.006 seconds
[0m00:57:37.878315 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.007 seconds
[0m00:57:37.880206 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m00:57:37.882822 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m00:57:37.883839 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m00:57:37.884508 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m00:57:37.893371 [debug] [MainThread]: Using postgres connection "master"
[0m00:57:37.894123 [debug] [MainThread]: On master: BEGIN
[0m00:57:37.894714 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:57:37.910518 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m00:57:37.911188 [debug] [MainThread]: Using postgres connection "master"
[0m00:57:37.911757 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:57:37.920772 [debug] [MainThread]: SQL status: SELECT 2 in 0.008 seconds
[0m00:57:37.923344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '762de09d-0183-409a-abe1-9a40773e6430', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e067e79250>]}
[0m00:57:37.924002 [debug] [MainThread]: On master: ROLLBACK
[0m00:57:37.924976 [debug] [MainThread]: On master: Close
[0m00:57:37.930573 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:57:37.931446 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m00:57:37.932029 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:57:37.943319 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:57:37.944271 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:57:37.945574 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:57:37.947587 [debug] [Thread-3 (]: Began running node model.mongo_movies.comments_by_user
[0m00:57:37.948413 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user'
[0m00:57:37.948961 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.comments_by_user
[0m00:57:37.954267 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user"
[0m00:57:37.955119 [debug] [Thread-3 (]: Began executing node model.mongo_movies.comments_by_user
[0m00:57:37.956185 [debug] [Thread-3 (]: Finished running node model.mongo_movies.comments_by_user
[0m00:57:37.958999 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:57:37.959480 [debug] [MainThread]: Connection 'list_test_db_public_marts' was properly closed.
[0m00:57:37.959934 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:57:37.960400 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user' was properly closed.
[0m00:57:37.961772 [debug] [MainThread]: Command end result
[0m00:57:38.086444 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:57:38.089143 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:57:38.099785 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:57:38.102334 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 1.9895108, "process_in_blocks": "112", "process_kernel_time": 0.676904, "process_mem_max_rss": "128392", "process_out_blocks": "2608", "process_user_time": 3.663248}
[0m00:57:38.103325 [debug] [MainThread]: Command `dbt compile` succeeded at 00:57:38.103113 after 1.99 seconds
[0m00:57:38.104195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e06b815670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e0676170e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e068448710>]}
[0m00:57:38.105082 [debug] [MainThread]: Flushing usage events
[0m00:57:39.416932 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:57:55.301929 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72877311a330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72877286eb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72877286fb30>]}


============================== 00:57:55.307474 | 5491d70f-9cd9-42aa-8d64-ff0bf9bae868 ==============================
[0m00:57:55.307474 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:57:55.308543 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m00:57:47.899114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5491d70f-9cd9-42aa-8d64-ff0bf9bae868', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7287721708c0>]}
[0m00:57:48.042945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5491d70f-9cd9-42aa-8d64-ff0bf9bae868', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7287735c1b80>]}
[0m00:57:48.044227 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:57:48.202007 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:57:48.361837 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:57:48.362476 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:57:48.420500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5491d70f-9cd9-42aa-8d64-ff0bf9bae868', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728771d6d5e0>]}
[0m00:57:48.536922 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:57:48.539497 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:57:48.560008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5491d70f-9cd9-42aa-8d64-ff0bf9bae868', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728771579fa0>]}
[0m00:57:48.561169 [info ] [MainThread]: Found 2 models, 4 sources, 434 macros
[0m00:57:48.562177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5491d70f-9cd9-42aa-8d64-ff0bf9bae868', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728771d6d910>]}
[0m00:57:48.567540 [info ] [MainThread]: 
[0m00:57:48.568485 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:57:48.569905 [info ] [MainThread]: 
[0m00:57:48.571764 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:57:48.580497 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:57:48.590486 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:57:48.678087 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:57:48.678738 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:57:48.679575 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:57:48.680307 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:57:48.681153 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:57:48.681956 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:57:48.702113 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.021 seconds
[0m00:57:48.704309 [debug] [ThreadPool]: On list_test_db: Close
[0m00:57:48.705035 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.023 seconds
[0m00:57:48.706691 [debug] [ThreadPool]: On list_test_db: Close
[0m00:57:48.708106 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:57:48.708589 [debug] [MainThread]: Connection 'list_test_db' was properly closed.
[0m00:57:48.709294 [debug] [MainThread]: Connection 'list_test_db' was properly closed.
[0m00:57:48.709882 [info ] [MainThread]: 
[0m00:57:48.710557 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.14 seconds (0.14s).
[0m00:57:48.711690 [error] [MainThread]: Encountered an error:

[0m00:57:48.723182 [error] [MainThread]: Traceback (most recent call last):
  File "/home/adminxx/astro-dlt-dbt/venv/lib/python3.12/site-packages/dbt/cli/requires.py", line 178, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/home/adminxx/astro-dlt-dbt/venv/lib/python3.12/site-packages/dbt/cli/requires.py", line 128, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/adminxx/astro-dlt-dbt/venv/lib/python3.12/site-packages/dbt/cli/requires.py", line 272, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/adminxx/astro-dlt-dbt/venv/lib/python3.12/site-packages/dbt/cli/requires.py", line 303, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/adminxx/astro-dlt-dbt/venv/lib/python3.12/site-packages/dbt/cli/requires.py", line 373, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/adminxx/astro-dlt-dbt/venv/lib/python3.12/site-packages/dbt/cli/requires.py", line 350, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/adminxx/astro-dlt-dbt/venv/lib/python3.12/site-packages/dbt/cli/requires.py", line 390, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/adminxx/astro-dlt-dbt/venv/lib/python3.12/site-packages/dbt/cli/main.py", line 586, in run
    results = task.run()
              ^^^^^^^^^^
  File "/home/adminxx/astro-dlt-dbt/venv/lib/python3.12/site-packages/dbt/task/runnable.py", line 599, in run
    result = self.execute_with_hooks(selected_uids)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/adminxx/astro-dlt-dbt/venv/lib/python3.12/site-packages/dbt/task/runnable.py", line 532, in execute_with_hooks
    before_run_status = self.before_run(adapter, selected_uids)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/adminxx/astro-dlt-dbt/venv/lib/python3.12/site-packages/dbt/task/run.py", line 1074, in before_run
    self.create_schemas(adapter, required_schemas)
  File "/home/adminxx/astro-dlt-dbt/venv/lib/python3.12/site-packages/dbt/task/runnable.py", line 706, in create_schemas
    for ls_future in as_completed(list_futures):
  File "/usr/lib/python3.12/concurrent/futures/_base.py", line 243, in as_completed
    waiter.event.wait(wait_timeout)
  File "/usr/lib/python3.12/threading.py", line 655, in wait
    signaled = self._cond.wait(timeout)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/threading.py", line 355, in wait
    waiter.acquire()
KeyboardInterrupt

[0m00:57:48.725363 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.3467232, "process_in_blocks": "488", "process_kernel_time": 0.759976, "process_mem_max_rss": "123020", "process_out_blocks": "880", "process_user_time": 3.137616}
[0m00:57:48.726228 [debug] [MainThread]: Command `dbt run` failed at 00:57:48.725987 after 1.35 seconds
[0m00:57:48.726971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728772cb9c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7287711a9c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728771123b60>]}
[0m00:57:48.727930 [debug] [MainThread]: Flushing usage events
[0m00:57:50.098606 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:58:34.139810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f4f7594c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f4ef34230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f4f0a3800>]}


============================== 00:58:34.145676 | 581e619e-d6ed-4f38-8e69-60e1b1a04ea2 ==============================
[0m00:58:34.145676 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:58:34.146535 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:58:34.539542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '581e619e-d6ed-4f38-8e69-60e1b1a04ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f4fb8f980>]}
[0m00:58:34.693384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '581e619e-d6ed-4f38-8e69-60e1b1a04ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f50ad3d70>]}
[0m00:58:34.694900 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:58:34.848397 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:58:35.007858 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:58:35.008947 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user.sql
[0m00:58:35.572477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '581e619e-d6ed-4f38-8e69-60e1b1a04ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f4d1eff20>]}
[0m00:58:35.690085 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:58:35.692770 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:58:35.712987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '581e619e-d6ed-4f38-8e69-60e1b1a04ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f4f759070>]}
[0m00:58:35.713893 [info ] [MainThread]: Found 2 models, 4 sources, 434 macros
[0m00:58:35.714664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '581e619e-d6ed-4f38-8e69-60e1b1a04ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f4d151d30>]}
[0m00:58:35.717941 [info ] [MainThread]: 
[0m00:58:35.718639 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:58:35.719458 [info ] [MainThread]: 
[0m00:58:35.720476 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:58:35.729771 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:58:35.737020 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:58:35.821730 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:58:35.822680 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:58:35.823555 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:58:35.824432 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:58:35.825622 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:58:35.826612 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:58:35.849709 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.024 seconds
[0m00:58:35.850982 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.024 seconds
[0m00:58:35.853555 [debug] [ThreadPool]: On list_test_db: Close
[0m00:58:35.855868 [debug] [ThreadPool]: On list_test_db: Close
[0m00:58:35.859301 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m00:58:35.860478 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m00:58:35.870659 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:58:35.874409 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:58:35.875544 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m00:58:35.876403 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m00:58:35.877282 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:58:35.877953 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:58:35.894100 [debug] [ThreadPool]: SQL status: BEGIN in 0.017 seconds
[0m00:58:35.894902 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:58:35.895501 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m00:58:35.896156 [debug] [ThreadPool]: SQL status: BEGIN in 0.018 seconds
[0m00:58:35.896977 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:58:35.897600 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m00:58:35.903321 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.006 seconds
[0m00:58:35.905794 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m00:58:35.906376 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.008 seconds
[0m00:58:35.908732 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m00:58:35.909620 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m00:58:35.910908 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m00:58:35.918673 [debug] [MainThread]: Using postgres connection "master"
[0m00:58:35.919309 [debug] [MainThread]: On master: BEGIN
[0m00:58:35.919812 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:58:35.934632 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:58:35.935345 [debug] [MainThread]: Using postgres connection "master"
[0m00:58:35.935941 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:58:35.946852 [debug] [MainThread]: SQL status: SELECT 2 in 0.010 seconds
[0m00:58:35.948805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '581e619e-d6ed-4f38-8e69-60e1b1a04ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f4766bb30>]}
[0m00:58:35.949583 [debug] [MainThread]: On master: ROLLBACK
[0m00:58:35.950446 [debug] [MainThread]: Using postgres connection "master"
[0m00:58:35.951006 [debug] [MainThread]: On master: BEGIN
[0m00:58:35.952134 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:58:35.952644 [debug] [MainThread]: On master: COMMIT
[0m00:58:35.953241 [debug] [MainThread]: Using postgres connection "master"
[0m00:58:35.953750 [debug] [MainThread]: On master: COMMIT
[0m00:58:35.954596 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:58:35.955127 [debug] [MainThread]: On master: Close
[0m00:58:35.961793 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:58:35.963026 [info ] [Thread-1 (]: 1 of 2 START sql view model public_staging.stg_comments ........................ [RUN]
[0m00:58:35.963955 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m00:58:35.964615 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:58:35.976372 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:58:35.977565 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:58:36.039630 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m00:58:36.040850 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:58:36.041498 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m00:58:36.042069 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:58:36.056602 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m00:58:36.057401 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:58:36.057981 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m00:58:36.064619 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m00:58:36.074220 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:58:36.074883 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m00:58:36.077767 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:58:36.083272 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:58:36.084099 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m00:58:36.085924 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:58:36.212601 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:58:36.213653 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:58:36.214557 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:58:36.221590 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m00:58:36.249205 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m00:58:36.286076 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:58:36.287142 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m00:58:36.296986 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.009 seconds
[0m00:58:36.302805 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m00:58:36.306456 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '581e619e-d6ed-4f38-8e69-60e1b1a04ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f4feba7b0>]}
[0m00:58:36.307745 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.34s]
[0m00:58:36.309537 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:58:36.311885 [debug] [Thread-3 (]: Began running node model.mongo_movies.comments_by_user
[0m00:58:36.313334 [info ] [Thread-3 (]: 2 of 2 START sql incremental model public_marts.comments_by_user ............... [RUN]
[0m00:58:36.314768 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user'
[0m00:58:36.315768 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.comments_by_user
[0m00:58:36.328892 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user"
[0m00:58:36.330652 [debug] [Thread-3 (]: Began executing node model.mongo_movies.comments_by_user
[0m00:58:36.394076 [debug] [Thread-3 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user"
[0m00:58:36.395371 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m00:58:36.396069 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: BEGIN
[0m00:58:36.396963 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m00:58:36.411121 [debug] [Thread-3 (]: SQL status: BEGIN in 0.014 seconds
[0m00:58:36.411840 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m00:58:36.412417 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */

      
  
    

  create  table "test_db"."public_marts"."comments_by_user"
  
  
    as
  
  (
    

select 
    name, 
    email, 
    count(*) as comment_count, 
    array_agg(movie_id) as movie_ids,
    load_date
from "test_db"."public_staging"."stg_comments" 
where 1=1

group by name, email
  );
  
  
[0m00:58:36.416135 [debug] [Thread-3 (]: Postgres adapter: Postgres error: column "stg_comments.load_date" must appear in the GROUP BY clause or be used in an aggregate function
LINE 20:     load_date
             ^

[0m00:58:36.416958 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: ROLLBACK
[0m00:58:36.418123 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: Close
[0m00:58:36.425574 [debug] [Thread-3 (]: Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  column "stg_comments.load_date" must appear in the GROUP BY clause or be used in an aggregate function
  LINE 20:     load_date
               ^
  compiled code at target/run/mongo_movies/models/mongo_movies/comments_by_user.sql
[0m00:58:36.426452 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '581e619e-d6ed-4f38-8e69-60e1b1a04ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f4e5c3b00>]}
[0m00:58:36.427454 [error] [Thread-3 (]: 2 of 2 ERROR creating sql incremental model public_marts.comments_by_user ...... [[31mERROR[0m in 0.11s]
[0m00:58:36.428515 [debug] [Thread-3 (]: Finished running node model.mongo_movies.comments_by_user
[0m00:58:36.429462 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.comments_by_user' to be skipped because of status 'error'.  Reason: Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  column "stg_comments.load_date" must appear in the GROUP BY clause or be used in an aggregate function
  LINE 20:     load_date
               ^
  compiled code at target/run/mongo_movies/models/mongo_movies/comments_by_user.sql.
[0m00:58:36.433655 [debug] [MainThread]: Using postgres connection "master"
[0m00:58:36.434370 [debug] [MainThread]: On master: BEGIN
[0m00:58:36.434930 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:58:36.451736 [debug] [MainThread]: SQL status: BEGIN in 0.017 seconds
[0m00:58:36.452501 [debug] [MainThread]: On master: COMMIT
[0m00:58:36.453019 [debug] [MainThread]: Using postgres connection "master"
[0m00:58:36.453656 [debug] [MainThread]: On master: COMMIT
[0m00:58:36.454537 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:58:36.455076 [debug] [MainThread]: On master: Close
[0m00:58:36.456224 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:58:36.457004 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:58:36.457756 [debug] [MainThread]: Connection 'list_test_db_public_staging' was properly closed.
[0m00:58:36.458390 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user' was properly closed.
[0m00:58:36.459117 [info ] [MainThread]: 
[0m00:58:36.459974 [info ] [MainThread]: Finished running 1 incremental model, 1 view model in 0 hours 0 minutes and 0.74 seconds (0.74s).
[0m00:58:36.461754 [debug] [MainThread]: Command end result
[0m00:58:36.500926 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:58:36.503716 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:58:36.513690 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:58:36.514428 [info ] [MainThread]: 
[0m00:58:36.515178 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m00:58:36.515793 [info ] [MainThread]: 
[0m00:58:36.516598 [error] [MainThread]: [31mFailure in model comments_by_user (models/mongo_movies/comments_by_user.sql)[0m
[0m00:58:36.517444 [error] [MainThread]:   Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  column "stg_comments.load_date" must appear in the GROUP BY clause or be used in an aggregate function
  LINE 20:     load_date
               ^
  compiled code at target/run/mongo_movies/models/mongo_movies/comments_by_user.sql
[0m00:58:36.518016 [info ] [MainThread]: 
[0m00:58:36.518687 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/mongo_movies/comments_by_user.sql
[0m00:58:36.519241 [info ] [MainThread]: 
[0m00:58:36.519868 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m00:58:36.521400 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.499701, "process_in_blocks": "0", "process_kernel_time": 0.788758, "process_mem_max_rss": "130412", "process_out_blocks": "2648", "process_user_time": 4.053341}
[0m00:58:36.522100 [debug] [MainThread]: Command `dbt run` failed at 00:58:36.521946 after 2.50 seconds
[0m00:58:36.522685 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f4e983170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f4e983380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f4e9f53d0>]}
[0m00:58:36.523495 [debug] [MainThread]: Flushing usage events
[0m00:58:37.984141 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:59:47.135358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e02d46436e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e02d3780350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e02d47178f0>]}


============================== 00:59:47.140297 | 50d55a50-e2c0-4dff-af5f-83870c6ecc57 ==============================
[0m00:59:47.140297 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:59:47.141200 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:59:47.479702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '50d55a50-e2c0-4dff-af5f-83870c6ecc57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e02d2d04bc0>]}
[0m00:59:47.617160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '50d55a50-e2c0-4dff-af5f-83870c6ecc57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e02d314cb00>]}
[0m00:59:47.618670 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:59:47.780453 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:59:47.939995 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:59:47.940955 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user.sql
[0m00:59:48.009186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '50d55a50-e2c0-4dff-af5f-83870c6ecc57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e02d19f0350>]}
[0m00:59:48.142401 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:59:48.146178 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:59:48.167841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '50d55a50-e2c0-4dff-af5f-83870c6ecc57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e02d5357110>]}
[0m00:59:48.168846 [info ] [MainThread]: Found 2 models, 4 sources, 434 macros
[0m00:59:48.169542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '50d55a50-e2c0-4dff-af5f-83870c6ecc57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e02d21113d0>]}
[0m00:59:48.172176 [info ] [MainThread]: 
[0m00:59:48.172908 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:59:48.173460 [info ] [MainThread]: 
[0m00:59:48.174293 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:59:48.181219 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:59:48.187927 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:59:48.262723 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:59:48.263518 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:59:48.264141 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:59:48.264963 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:59:48.265804 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:59:48.266532 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:59:48.284992 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.018 seconds
[0m00:59:48.285683 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.020 seconds
[0m00:59:48.288097 [debug] [ThreadPool]: On list_test_db: Close
[0m00:59:48.289757 [debug] [ThreadPool]: On list_test_db: Close
[0m00:59:48.293408 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m00:59:48.294521 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m00:59:48.304101 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:59:48.307092 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:59:48.307803 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m00:59:48.308684 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m00:59:48.309480 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:59:48.310153 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:59:48.325030 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m00:59:48.325815 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m00:59:48.326544 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:59:48.327316 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:59:48.328093 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m00:59:48.328858 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m00:59:48.335129 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m00:59:48.335880 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.006 seconds
[0m00:59:48.337579 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m00:59:48.339791 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m00:59:48.340926 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m00:59:48.341451 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m00:59:48.350085 [debug] [MainThread]: Using postgres connection "master"
[0m00:59:48.350802 [debug] [MainThread]: On master: BEGIN
[0m00:59:48.351465 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:59:48.366010 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m00:59:48.366652 [debug] [MainThread]: Using postgres connection "master"
[0m00:59:48.367332 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:59:48.377165 [debug] [MainThread]: SQL status: SELECT 2 in 0.009 seconds
[0m00:59:48.379503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '50d55a50-e2c0-4dff-af5f-83870c6ecc57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e02d3124ec0>]}
[0m00:59:48.380230 [debug] [MainThread]: On master: ROLLBACK
[0m00:59:48.381086 [debug] [MainThread]: Using postgres connection "master"
[0m00:59:48.381620 [debug] [MainThread]: On master: BEGIN
[0m00:59:48.382837 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:59:48.383366 [debug] [MainThread]: On master: COMMIT
[0m00:59:48.383903 [debug] [MainThread]: Using postgres connection "master"
[0m00:59:48.384437 [debug] [MainThread]: On master: COMMIT
[0m00:59:48.385310 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:59:48.385813 [debug] [MainThread]: On master: Close
[0m00:59:48.392264 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:59:48.393545 [info ] [Thread-1 (]: 1 of 2 START sql view model public_staging.stg_comments ........................ [RUN]
[0m00:59:48.394382 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m00:59:48.394956 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:59:48.407867 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:59:48.409237 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:59:48.467565 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m00:59:48.468712 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:59:48.469320 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m00:59:48.469917 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:59:48.484621 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m00:59:48.485528 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:59:48.486192 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m00:59:48.491783 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m00:59:48.502035 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:59:48.502815 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m00:59:48.504532 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:59:48.510298 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:59:48.510924 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m00:59:48.512562 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:59:48.643621 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:59:48.644364 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:59:48.644925 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:59:48.651226 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m00:59:48.660816 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m00:59:48.669744 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:59:48.670385 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m00:59:48.674710 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m00:59:48.678160 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m00:59:48.680609 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '50d55a50-e2c0-4dff-af5f-83870c6ecc57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e02d1570260>]}
[0m00:59:48.681580 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.28s]
[0m00:59:48.682791 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:59:48.684664 [debug] [Thread-3 (]: Began running node model.mongo_movies.comments_by_user
[0m00:59:48.685860 [info ] [Thread-3 (]: 2 of 2 START sql incremental model public_marts.comments_by_user ............... [RUN]
[0m00:59:48.686768 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user'
[0m00:59:48.687479 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.comments_by_user
[0m00:59:48.692935 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user"
[0m00:59:48.693990 [debug] [Thread-3 (]: Began executing node model.mongo_movies.comments_by_user
[0m00:59:48.754496 [debug] [Thread-3 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user"
[0m00:59:48.755983 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m00:59:48.756713 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: BEGIN
[0m00:59:48.757399 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m00:59:48.772649 [debug] [Thread-3 (]: SQL status: BEGIN in 0.015 seconds
[0m00:59:48.773327 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m00:59:48.774036 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */

      
  
    

  create  table "test_db"."public_marts"."comments_by_user"
  
  
    as
  
  (
    

select 
    name, 
    email, 
    count(*) as comment_count, 
    array_agg(movie_id) as movie_ids,
    load_date
from "test_db"."public_staging"."stg_comments" 
where 1=1

group by name, email, load_date
order by comment_count desc
  );
  
  
[0m00:59:48.934908 [debug] [Thread-3 (]: SQL status: SELECT 236 in 0.160 seconds
[0m00:59:48.943861 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: COMMIT
[0m00:59:48.944582 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m00:59:48.945153 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: COMMIT
[0m00:59:48.951860 [debug] [Thread-3 (]: SQL status: COMMIT in 0.006 seconds
[0m00:59:48.953090 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: Close
[0m00:59:48.954111 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '50d55a50-e2c0-4dff-af5f-83870c6ecc57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e02d62137a0>]}
[0m00:59:48.955155 [info ] [Thread-3 (]: 2 of 2 OK created sql incremental model public_marts.comments_by_user .......... [[32mSELECT 236[0m in 0.27s]
[0m00:59:48.956301 [debug] [Thread-3 (]: Finished running node model.mongo_movies.comments_by_user
[0m00:59:48.960659 [debug] [MainThread]: Using postgres connection "master"
[0m00:59:48.961440 [debug] [MainThread]: On master: BEGIN
[0m00:59:48.962031 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:59:48.977027 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:59:48.978030 [debug] [MainThread]: On master: COMMIT
[0m00:59:48.978702 [debug] [MainThread]: Using postgres connection "master"
[0m00:59:48.979531 [debug] [MainThread]: On master: COMMIT
[0m00:59:48.980642 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:59:48.981380 [debug] [MainThread]: On master: Close
[0m00:59:48.982525 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:59:48.983232 [debug] [MainThread]: Connection 'list_test_db_public_staging' was properly closed.
[0m00:59:48.983876 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:59:48.984623 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user' was properly closed.
[0m00:59:48.985343 [info ] [MainThread]: 
[0m00:59:48.986176 [info ] [MainThread]: Finished running 1 incremental model, 1 view model in 0 hours 0 minutes and 0.81 seconds (0.81s).
[0m00:59:48.988363 [debug] [MainThread]: Command end result
[0m00:59:49.031660 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:59:49.035284 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:59:49.044197 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:59:49.044750 [info ] [MainThread]: 
[0m00:59:49.045489 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:59:49.046077 [info ] [MainThread]: 
[0m00:59:49.046679 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m00:59:49.048302 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.5283499, "process_in_blocks": "0", "process_kernel_time": 0.696056, "process_mem_max_rss": "130560", "process_out_blocks": "2640", "process_user_time": 4.019636}
[0m00:59:49.049012 [debug] [MainThread]: Command `dbt run` succeeded at 00:59:49.048837 after 2.53 seconds
[0m00:59:49.049663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e02d2d07fb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e02d2d07c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e02d2d053a0>]}
[0m00:59:49.050369 [debug] [MainThread]: Flushing usage events
[0m00:59:50.557629 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:02:45.193585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7091e45f7f20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7091e45ce390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7091e363cda0>]}


============================== 01:02:45.198686 | 92640432-1b0e-41ae-a788-99fdb8c20a2d ==============================
[0m01:02:45.198686 [info ] [MainThread]: Running with dbt=1.10.6
[0m01:02:45.199771 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt compile', 'send_anonymous_usage_stats': 'True'}
[0m01:02:45.566908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '92640432-1b0e-41ae-a788-99fdb8c20a2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7091e3598d70>]}
[0m01:02:45.716004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '92640432-1b0e-41ae-a788-99fdb8c20a2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7091e5a25670>]}
[0m01:02:45.717196 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m01:02:45.865703 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m01:02:46.018364 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:02:46.019645 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user.sql
[0m01:02:46.539330 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '92640432-1b0e-41ae-a788-99fdb8c20a2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7091e17e87a0>]}
[0m01:02:46.638904 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:02:46.641769 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:02:46.659854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '92640432-1b0e-41ae-a788-99fdb8c20a2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7091e23721e0>]}
[0m01:02:46.660910 [info ] [MainThread]: Found 2 models, 4 sources, 434 macros
[0m01:02:46.661723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '92640432-1b0e-41ae-a788-99fdb8c20a2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7091e2b80e00>]}
[0m01:02:46.664768 [info ] [MainThread]: 
[0m01:02:46.665435 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:02:46.665985 [info ] [MainThread]: 
[0m01:02:46.666882 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:02:46.668547 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_staging'
[0m01:02:46.669850 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_marts'
[0m01:02:46.756737 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:02:46.757705 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:02:46.758406 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m01:02:46.759258 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m01:02:46.760035 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:02:46.760726 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:02:46.779186 [debug] [ThreadPool]: SQL status: BEGIN in 0.018 seconds
[0m01:02:46.780264 [debug] [ThreadPool]: SQL status: BEGIN in 0.020 seconds
[0m01:02:46.781007 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:02:46.781640 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:02:46.782434 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m01:02:46.783298 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m01:02:46.791571 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.007 seconds
[0m01:02:46.792453 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.008 seconds
[0m01:02:46.795000 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m01:02:46.797182 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m01:02:46.798246 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m01:02:46.798939 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m01:02:46.808649 [debug] [MainThread]: Using postgres connection "master"
[0m01:02:46.809284 [debug] [MainThread]: On master: BEGIN
[0m01:02:46.809772 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:02:46.825173 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m01:02:46.826069 [debug] [MainThread]: Using postgres connection "master"
[0m01:02:46.826944 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:02:46.837080 [debug] [MainThread]: SQL status: SELECT 2 in 0.009 seconds
[0m01:02:46.839165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '92640432-1b0e-41ae-a788-99fdb8c20a2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7091e3e61370>]}
[0m01:02:46.839864 [debug] [MainThread]: On master: ROLLBACK
[0m01:02:46.840762 [debug] [MainThread]: On master: Close
[0m01:02:46.847010 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m01:02:46.847983 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m01:02:46.848725 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m01:02:46.859763 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m01:02:46.860758 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m01:02:46.862032 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m01:02:46.864086 [debug] [Thread-3 (]: Began running node model.mongo_movies.comments_by_user
[0m01:02:46.864982 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user'
[0m01:02:46.865554 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.comments_by_user
[0m01:02:46.874440 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user"
[0m01:02:46.875562 [debug] [Thread-3 (]: Began executing node model.mongo_movies.comments_by_user
[0m01:02:46.876775 [debug] [Thread-3 (]: Finished running node model.mongo_movies.comments_by_user
[0m01:02:46.881240 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:02:46.882039 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m01:02:46.882560 [debug] [MainThread]: Connection 'list_test_db_public_marts' was properly closed.
[0m01:02:46.883121 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user' was properly closed.
[0m01:02:46.884361 [debug] [MainThread]: Command end result
[0m01:02:47.009537 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:02:47.012191 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:02:47.021664 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m01:02:47.023281 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 1.9493985, "process_in_blocks": "0", "process_kernel_time": 0.731798, "process_mem_max_rss": "128364", "process_out_blocks": "2616", "process_user_time": 3.54977}
[0m01:02:47.024073 [debug] [MainThread]: Command `dbt compile` succeeded at 01:02:47.023859 after 1.95 seconds
[0m01:02:47.024741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7091e37434d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7091e17bede0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7091e17e92b0>]}
[0m01:02:47.025526 [debug] [MainThread]: Flushing usage events
[0m01:02:48.446584 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:03:16.570896 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f871f6bb230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f871f037380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f871f037b00>]}


============================== 01:03:16.576148 | 5d5203ee-0420-4d6f-b3b3-daa0a0f64cfe ==============================
[0m01:03:16.576148 [info ] [MainThread]: Running with dbt=1.10.6
[0m01:03:16.577044 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:03:16.936251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5d5203ee-0420-4d6f-b3b3-daa0a0f64cfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f87215493a0>]}
[0m01:03:17.069793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5d5203ee-0420-4d6f-b3b3-daa0a0f64cfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f871f2f5970>]}
[0m01:03:17.071061 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m01:03:17.225321 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m01:03:17.385006 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:03:17.385699 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:03:17.439312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5d5203ee-0420-4d6f-b3b3-daa0a0f64cfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f871e314fe0>]}
[0m01:03:17.548307 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:03:17.550819 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:03:17.568485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5d5203ee-0420-4d6f-b3b3-daa0a0f64cfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f871e316b40>]}
[0m01:03:17.569314 [info ] [MainThread]: Found 2 models, 4 sources, 434 macros
[0m01:03:17.569950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d5203ee-0420-4d6f-b3b3-daa0a0f64cfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8721dc9010>]}
[0m01:03:17.572352 [info ] [MainThread]: 
[0m01:03:17.573003 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:03:17.573566 [info ] [MainThread]: 
[0m01:03:17.574447 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:03:17.581348 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:03:17.590541 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:03:17.650179 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:03:17.651113 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:03:17.651704 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:03:17.652440 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:03:17.653281 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:03:17.654130 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:03:17.674509 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.020 seconds
[0m01:03:17.675271 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.022 seconds
[0m01:03:17.677225 [debug] [ThreadPool]: On list_test_db: Close
[0m01:03:17.678973 [debug] [ThreadPool]: On list_test_db: Close
[0m01:03:17.681929 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m01:03:17.688309 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m01:03:17.698673 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:03:17.699349 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:03:17.700268 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m01:03:17.701181 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m01:03:17.701835 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:03:17.702490 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:03:17.716684 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m01:03:17.717496 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:03:17.718103 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m01:03:17.718640 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m01:03:17.719248 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:03:17.720147 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m01:03:17.726052 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.006 seconds
[0m01:03:17.729104 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m01:03:17.729733 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.009 seconds
[0m01:03:17.731537 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m01:03:17.732121 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m01:03:17.733004 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m01:03:17.741844 [debug] [MainThread]: Using postgres connection "master"
[0m01:03:17.742469 [debug] [MainThread]: On master: BEGIN
[0m01:03:17.743137 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:03:17.757612 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m01:03:17.758269 [debug] [MainThread]: Using postgres connection "master"
[0m01:03:17.758838 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:03:17.769382 [debug] [MainThread]: SQL status: SELECT 2 in 0.010 seconds
[0m01:03:17.771444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d5203ee-0420-4d6f-b3b3-daa0a0f64cfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f871d756690>]}
[0m01:03:17.772303 [debug] [MainThread]: On master: ROLLBACK
[0m01:03:17.773227 [debug] [MainThread]: Using postgres connection "master"
[0m01:03:17.773729 [debug] [MainThread]: On master: BEGIN
[0m01:03:17.774865 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m01:03:17.775452 [debug] [MainThread]: On master: COMMIT
[0m01:03:17.776133 [debug] [MainThread]: Using postgres connection "master"
[0m01:03:17.776668 [debug] [MainThread]: On master: COMMIT
[0m01:03:17.777402 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:03:17.777887 [debug] [MainThread]: On master: Close
[0m01:03:17.784186 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m01:03:17.785178 [info ] [Thread-1 (]: 1 of 2 START sql view model public_staging.stg_comments ........................ [RUN]
[0m01:03:17.785993 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m01:03:17.786691 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m01:03:17.798551 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m01:03:17.800129 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m01:03:17.856909 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m01:03:17.858307 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:03:17.858908 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m01:03:17.859541 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:03:17.874821 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m01:03:17.875564 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:03:17.876208 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m01:03:17.880637 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m01:03:17.889219 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:03:17.889824 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m01:03:17.891947 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m01:03:17.897763 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:03:17.898393 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m01:03:17.899849 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:03:17.925980 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:03:17.926718 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:03:17.927349 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:03:17.934336 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m01:03:17.945870 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m01:03:17.956193 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:03:17.956926 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m01:03:17.962787 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m01:03:17.966951 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m01:03:17.969412 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d5203ee-0420-4d6f-b3b3-daa0a0f64cfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8718f41550>]}
[0m01:03:17.970448 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.18s]
[0m01:03:17.971506 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m01:03:17.973325 [debug] [Thread-3 (]: Began running node model.mongo_movies.comments_by_user
[0m01:03:17.974176 [info ] [Thread-3 (]: 2 of 2 START sql incremental model public_marts.comments_by_user ............... [RUN]
[0m01:03:17.975068 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user'
[0m01:03:17.975662 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.comments_by_user
[0m01:03:17.990124 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user"
[0m01:03:17.991302 [debug] [Thread-3 (]: Began executing node model.mongo_movies.comments_by_user
[0m01:03:18.049883 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m01:03:18.050619 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */

    
  
    

  create temporary table "comments_by_user__dbt_tmp010318028335"
  
  
    as
  
  (
    

with latest_load as (
    select max(load_date) as max_load_date from "test_db"."public_marts"."comments_by_user"
)

select 
    c.name, 
    c.email, 
    count(*) as comment_count, 
    array_agg(c.movie_id) as movie_ids
    c.load_date
from "test_db"."public_staging"."stg_comments" c

join latest_load l on true

where 1=1

  and c.load_date > l.max_load_date

group by c.name, c.email
order by comment_count desc
  );
  
  
[0m01:03:18.051218 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:03:18.068694 [debug] [Thread-3 (]: Postgres adapter: Postgres error: syntax error at or near "c"
LINE 24:     c.load_date
             ^

[0m01:03:18.069919 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: Close
[0m01:03:18.076623 [debug] [Thread-3 (]: Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  syntax error at or near "c"
  LINE 24:     c.load_date
               ^
[0m01:03:18.077446 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d5203ee-0420-4d6f-b3b3-daa0a0f64cfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8718f03bc0>]}
[0m01:03:18.078365 [error] [Thread-3 (]: 2 of 2 ERROR creating sql incremental model public_marts.comments_by_user ...... [[31mERROR[0m in 0.10s]
[0m01:03:18.079491 [debug] [Thread-3 (]: Finished running node model.mongo_movies.comments_by_user
[0m01:03:18.080492 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.comments_by_user' to be skipped because of status 'error'.  Reason: Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  syntax error at or near "c"
  LINE 24:     c.load_date
               ^.
[0m01:03:18.084753 [debug] [MainThread]: Using postgres connection "master"
[0m01:03:18.085308 [debug] [MainThread]: On master: BEGIN
[0m01:03:18.085779 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:03:18.099596 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m01:03:18.100662 [debug] [MainThread]: On master: COMMIT
[0m01:03:18.101540 [debug] [MainThread]: Using postgres connection "master"
[0m01:03:18.102103 [debug] [MainThread]: On master: COMMIT
[0m01:03:18.102915 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:03:18.103455 [debug] [MainThread]: On master: Close
[0m01:03:18.104564 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:03:18.105110 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m01:03:18.105617 [debug] [MainThread]: Connection 'list_test_db_public_staging' was properly closed.
[0m01:03:18.106112 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user' was properly closed.
[0m01:03:18.106733 [info ] [MainThread]: 
[0m01:03:18.107387 [info ] [MainThread]: Finished running 1 incremental model, 1 view model in 0 hours 0 minutes and 0.53 seconds (0.53s).
[0m01:03:18.108746 [debug] [MainThread]: Command end result
[0m01:03:18.144811 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:03:18.147472 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:03:18.157113 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m01:03:18.157716 [info ] [MainThread]: 
[0m01:03:18.158396 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m01:03:18.159085 [info ] [MainThread]: 
[0m01:03:18.159767 [error] [MainThread]: [31mFailure in model comments_by_user (models/mongo_movies/comments_by_user.sql)[0m
[0m01:03:18.160519 [error] [MainThread]:   Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  syntax error at or near "c"
  LINE 24:     c.load_date
               ^
[0m01:03:18.161075 [info ] [MainThread]: 
[0m01:03:18.161686 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/mongo_movies/comments_by_user.sql
[0m01:03:18.162220 [info ] [MainThread]: 
[0m01:03:18.162850 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m01:03:18.164376 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.7202549, "process_in_blocks": "0", "process_kernel_time": 0.738969, "process_mem_max_rss": "126824", "process_out_blocks": "1784", "process_user_time": 3.374506}
[0m01:03:18.165087 [debug] [MainThread]: Command `dbt run` failed at 01:03:18.164901 after 1.72 seconds
[0m01:03:18.165803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f871ee740e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f871ec2ecc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f87235633b0>]}
[0m01:03:18.166527 [debug] [MainThread]: Flushing usage events
[0m01:03:18.931459 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:03:28.935486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76b074f0d820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76b074ba8380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76b074ba84d0>]}


============================== 01:03:28.940113 | 84e4191c-4754-4191-8861-fffc9466663d ==============================
[0m01:03:28.940113 [info ] [MainThread]: Running with dbt=1.10.6
[0m01:03:28.940994 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:03:29.262538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '84e4191c-4754-4191-8861-fffc9466663d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76b074110d40>]}
[0m01:03:29.395859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '84e4191c-4754-4191-8861-fffc9466663d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76b075384e30>]}
[0m01:03:29.397059 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m01:03:29.548242 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m01:03:29.700193 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:03:29.701166 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user.sql
[0m01:03:30.225929 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '84e4191c-4754-4191-8861-fffc9466663d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76b072df8410>]}
[0m01:03:30.329051 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:03:30.331678 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:03:30.350297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '84e4191c-4754-4191-8861-fffc9466663d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76b074aa8cb0>]}
[0m01:03:30.351114 [info ] [MainThread]: Found 2 models, 4 sources, 434 macros
[0m01:03:30.351895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '84e4191c-4754-4191-8861-fffc9466663d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76b072df7dd0>]}
[0m01:03:30.354374 [info ] [MainThread]: 
[0m01:03:30.355198 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:03:30.356090 [info ] [MainThread]: 
[0m01:03:30.357211 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:03:30.367302 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:03:30.380569 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:03:30.448601 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:03:30.449313 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:03:30.449976 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:03:30.450740 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:03:30.451493 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:03:30.452311 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:03:30.469374 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.018 seconds
[0m01:03:30.470267 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.018 seconds
[0m01:03:30.473069 [debug] [ThreadPool]: On list_test_db: Close
[0m01:03:30.475486 [debug] [ThreadPool]: On list_test_db: Close
[0m01:03:30.479197 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m01:03:30.480509 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m01:03:30.492689 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:03:30.495016 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:03:30.496164 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m01:03:30.496920 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m01:03:30.497606 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:03:30.498276 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:03:30.514236 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m01:03:30.514991 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:03:30.515769 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m01:03:30.516513 [debug] [ThreadPool]: SQL status: BEGIN in 0.018 seconds
[0m01:03:30.517258 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:03:30.518011 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m01:03:30.525549 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.008 seconds
[0m01:03:30.526553 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.008 seconds
[0m01:03:30.529647 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m01:03:30.531996 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m01:03:30.533161 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m01:03:30.533832 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m01:03:30.542454 [debug] [MainThread]: Using postgres connection "master"
[0m01:03:30.543210 [debug] [MainThread]: On master: BEGIN
[0m01:03:30.543907 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:03:30.559409 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m01:03:30.560259 [debug] [MainThread]: Using postgres connection "master"
[0m01:03:30.561435 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:03:30.572554 [debug] [MainThread]: SQL status: SELECT 2 in 0.010 seconds
[0m01:03:30.574636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '84e4191c-4754-4191-8861-fffc9466663d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76b0713bffb0>]}
[0m01:03:30.575347 [debug] [MainThread]: On master: ROLLBACK
[0m01:03:30.576521 [debug] [MainThread]: Using postgres connection "master"
[0m01:03:30.577038 [debug] [MainThread]: On master: BEGIN
[0m01:03:30.578379 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m01:03:30.579157 [debug] [MainThread]: On master: COMMIT
[0m01:03:30.580602 [debug] [MainThread]: Using postgres connection "master"
[0m01:03:30.581257 [debug] [MainThread]: On master: COMMIT
[0m01:03:30.582108 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:03:30.582609 [debug] [MainThread]: On master: Close
[0m01:03:30.588708 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m01:03:30.589652 [info ] [Thread-1 (]: 1 of 2 START sql view model public_staging.stg_comments ........................ [RUN]
[0m01:03:30.590475 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m01:03:30.591036 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m01:03:30.605621 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m01:03:30.607239 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m01:03:30.664248 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m01:03:30.665561 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:03:30.666307 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m01:03:30.667111 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:03:30.681866 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m01:03:30.682622 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:03:30.683195 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m01:03:30.687721 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m01:03:30.699940 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:03:30.701010 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m01:03:30.702917 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:03:30.710438 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:03:30.711221 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m01:03:30.712912 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:03:30.831450 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:03:30.832307 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:03:30.832889 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:03:30.859613 [debug] [Thread-1 (]: SQL status: COMMIT in 0.026 seconds
[0m01:03:30.869004 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m01:03:30.878731 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:03:30.879425 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m01:03:30.882932 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m01:03:30.886357 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m01:03:30.888959 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84e4191c-4754-4191-8861-fffc9466663d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76b077496b40>]}
[0m01:03:30.890030 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.30s]
[0m01:03:30.891117 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m01:03:30.893332 [debug] [Thread-3 (]: Began running node model.mongo_movies.comments_by_user
[0m01:03:30.894239 [info ] [Thread-3 (]: 2 of 2 START sql incremental model public_marts.comments_by_user ............... [RUN]
[0m01:03:30.895176 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user'
[0m01:03:30.895773 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.comments_by_user
[0m01:03:30.904755 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user"
[0m01:03:30.905774 [debug] [Thread-3 (]: Began executing node model.mongo_movies.comments_by_user
[0m01:03:30.972928 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m01:03:30.973740 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */

    
  
    

  create temporary table "comments_by_user__dbt_tmp010330950085"
  
  
    as
  
  (
    

with latest_load as (
    select max(load_date) as max_load_date from "test_db"."public_marts"."comments_by_user"
)

select 
    c.name, 
    c.email, 
    count(*) as comment_count, 
    array_agg(c.movie_id) as movie_ids,
    c.load_date
from "test_db"."public_staging"."stg_comments" c

join latest_load l on true

where 1=1

  and c.load_date > l.max_load_date

group by c.name, c.email
order by comment_count desc
  );
  
  
[0m01:03:30.974343 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:03:30.991012 [debug] [Thread-3 (]: Postgres adapter: Postgres error: column "c.load_date" must appear in the GROUP BY clause or be used in an aggregate function
LINE 24:     c.load_date
             ^

[0m01:03:30.992260 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: Close
[0m01:03:30.998256 [debug] [Thread-3 (]: Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  column "c.load_date" must appear in the GROUP BY clause or be used in an aggregate function
  LINE 24:     c.load_date
               ^
[0m01:03:30.999030 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84e4191c-4754-4191-8861-fffc9466663d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76b0731b4050>]}
[0m01:03:31.000336 [error] [Thread-3 (]: 2 of 2 ERROR creating sql incremental model public_marts.comments_by_user ...... [[31mERROR[0m in 0.10s]
[0m01:03:31.001321 [debug] [Thread-3 (]: Finished running node model.mongo_movies.comments_by_user
[0m01:03:31.002366 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.comments_by_user' to be skipped because of status 'error'.  Reason: Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  column "c.load_date" must appear in the GROUP BY clause or be used in an aggregate function
  LINE 24:     c.load_date
               ^.
[0m01:03:31.006798 [debug] [MainThread]: Using postgres connection "master"
[0m01:03:31.007478 [debug] [MainThread]: On master: BEGIN
[0m01:03:31.008095 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:03:31.023465 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m01:03:31.024382 [debug] [MainThread]: On master: COMMIT
[0m01:03:31.025053 [debug] [MainThread]: Using postgres connection "master"
[0m01:03:31.025553 [debug] [MainThread]: On master: COMMIT
[0m01:03:31.026410 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:03:31.026941 [debug] [MainThread]: On master: Close
[0m01:03:31.028041 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:03:31.028773 [debug] [MainThread]: Connection 'list_test_db_public_marts' was properly closed.
[0m01:03:31.029388 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m01:03:31.030107 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user' was properly closed.
[0m01:03:31.030870 [info ] [MainThread]: 
[0m01:03:31.032297 [info ] [MainThread]: Finished running 1 incremental model, 1 view model in 0 hours 0 minutes and 0.67 seconds (0.67s).
[0m01:03:31.034198 [debug] [MainThread]: Command end result
[0m01:03:31.071628 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:03:31.074458 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:03:31.083765 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m01:03:31.084571 [info ] [MainThread]: 
[0m01:03:31.085396 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m01:03:31.086037 [info ] [MainThread]: 
[0m01:03:31.086736 [error] [MainThread]: [31mFailure in model comments_by_user (models/mongo_movies/comments_by_user.sql)[0m
[0m01:03:31.087536 [error] [MainThread]:   Database Error in model comments_by_user (models/mongo_movies/comments_by_user.sql)
  column "c.load_date" must appear in the GROUP BY clause or be used in an aggregate function
  LINE 24:     c.load_date
               ^
[0m01:03:31.088114 [info ] [MainThread]: 
[0m01:03:31.088768 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/mongo_movies/comments_by_user.sql
[0m01:03:31.089383 [info ] [MainThread]: 
[0m01:03:31.090012 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m01:03:31.091743 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.270938, "process_in_blocks": "0", "process_kernel_time": 0.702554, "process_mem_max_rss": "130496", "process_out_blocks": "2640", "process_user_time": 3.907508}
[0m01:03:31.092513 [debug] [MainThread]: Command `dbt run` failed at 01:03:31.092347 after 2.27 seconds
[0m01:03:31.093211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76b074521d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76b074eb2120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76b0741d1250>]}
[0m01:03:31.094024 [debug] [MainThread]: Flushing usage events
[0m01:03:32.496783 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:03:50.447882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b0a6afffaa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b0a6bacd8e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b0a6b28e870>]}


============================== 01:03:50.454951 | 34d49f12-458d-4ca2-b377-3a958d3e8fb3 ==============================
[0m01:03:50.454951 [info ] [MainThread]: Running with dbt=1.10.6
[0m01:03:50.456289 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:03:50.835517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '34d49f12-458d-4ca2-b377-3a958d3e8fb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b0a6b545430>]}
[0m01:03:50.967616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '34d49f12-458d-4ca2-b377-3a958d3e8fb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b0a6bbcf350>]}
[0m01:03:50.969036 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m01:03:51.130045 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m01:03:51.291628 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:03:51.292771 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user.sql
[0m01:03:51.824906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '34d49f12-458d-4ca2-b377-3a958d3e8fb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b0a691fc530>]}
[0m01:03:51.931560 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:03:51.934118 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:03:51.952534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '34d49f12-458d-4ca2-b377-3a958d3e8fb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b0a6b4c9520>]}
[0m01:03:51.953338 [info ] [MainThread]: Found 2 models, 4 sources, 434 macros
[0m01:03:51.953940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '34d49f12-458d-4ca2-b377-3a958d3e8fb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b0a6990d580>]}
[0m01:03:51.956754 [info ] [MainThread]: 
[0m01:03:51.957625 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:03:51.958257 [info ] [MainThread]: 
[0m01:03:51.959177 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:03:51.968150 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:03:51.969983 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:03:52.047605 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:03:52.048751 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:03:52.049450 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:03:52.050211 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:03:52.050902 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:03:52.051589 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:03:52.070857 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.019 seconds
[0m01:03:52.071460 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.021 seconds
[0m01:03:52.073457 [debug] [ThreadPool]: On list_test_db: Close
[0m01:03:52.075449 [debug] [ThreadPool]: On list_test_db: Close
[0m01:03:52.078644 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m01:03:52.079914 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m01:03:52.089282 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:03:52.092554 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:03:52.093554 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m01:03:52.094274 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m01:03:52.094930 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:03:52.095584 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:03:52.111431 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m01:03:52.112219 [debug] [ThreadPool]: SQL status: BEGIN in 0.017 seconds
[0m01:03:52.113012 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:03:52.113830 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:03:52.114625 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m01:03:52.115330 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m01:03:52.122936 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.007 seconds
[0m01:03:52.123673 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.007 seconds
[0m01:03:52.125782 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m01:03:52.127522 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m01:03:52.128647 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m01:03:52.129144 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m01:03:52.137754 [debug] [MainThread]: Using postgres connection "master"
[0m01:03:52.138465 [debug] [MainThread]: On master: BEGIN
[0m01:03:52.138956 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:03:52.154249 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m01:03:52.154886 [debug] [MainThread]: Using postgres connection "master"
[0m01:03:52.155443 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:03:52.165583 [debug] [MainThread]: SQL status: SELECT 2 in 0.009 seconds
[0m01:03:52.167832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '34d49f12-458d-4ca2-b377-3a958d3e8fb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b0a68db5010>]}
[0m01:03:52.168569 [debug] [MainThread]: On master: ROLLBACK
[0m01:03:52.169654 [debug] [MainThread]: Using postgres connection "master"
[0m01:03:52.170192 [debug] [MainThread]: On master: BEGIN
[0m01:03:52.171353 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m01:03:52.171908 [debug] [MainThread]: On master: COMMIT
[0m01:03:52.172462 [debug] [MainThread]: Using postgres connection "master"
[0m01:03:52.172959 [debug] [MainThread]: On master: COMMIT
[0m01:03:52.173809 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:03:52.174293 [debug] [MainThread]: On master: Close
[0m01:03:52.180422 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m01:03:52.181341 [info ] [Thread-1 (]: 1 of 2 START sql view model public_staging.stg_comments ........................ [RUN]
[0m01:03:52.182146 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m01:03:52.182710 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m01:03:52.194229 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m01:03:52.195540 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m01:03:52.248517 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m01:03:52.249904 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:03:52.250855 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m01:03:52.251716 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:03:52.265840 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m01:03:52.266545 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:03:52.267106 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m01:03:52.272899 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m01:03:52.282619 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:03:52.283245 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m01:03:52.284745 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:03:52.291491 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:03:52.292414 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m01:03:52.293877 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:03:52.413563 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:03:52.414301 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:03:52.414970 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:03:52.423314 [debug] [Thread-1 (]: SQL status: COMMIT in 0.007 seconds
[0m01:03:52.434813 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m01:03:52.444540 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:03:52.445313 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m01:03:52.452757 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.006 seconds
[0m01:03:52.457386 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m01:03:52.459801 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34d49f12-458d-4ca2-b377-3a958d3e8fb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b0a6735e630>]}
[0m01:03:52.460787 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.28s]
[0m01:03:52.461899 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m01:03:52.463722 [debug] [Thread-3 (]: Began running node model.mongo_movies.comments_by_user
[0m01:03:52.464729 [info ] [Thread-3 (]: 2 of 2 START sql incremental model public_marts.comments_by_user ............... [RUN]
[0m01:03:52.465648 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user'
[0m01:03:52.466206 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.comments_by_user
[0m01:03:52.476473 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user"
[0m01:03:52.477573 [debug] [Thread-3 (]: Began executing node model.mongo_movies.comments_by_user
[0m01:03:52.540471 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m01:03:52.541209 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */

    
  
    

  create temporary table "comments_by_user__dbt_tmp010352518797"
  
  
    as
  
  (
    

with latest_load as (
    select max(load_date) as max_load_date from "test_db"."public_marts"."comments_by_user"
)

select 
    c.name, 
    c.email, 
    count(*) as comment_count, 
    array_agg(c.movie_id) as movie_ids,
    c.load_date
from "test_db"."public_staging"."stg_comments" c

join latest_load l on true

where 1=1

  and c.load_date > l.max_load_date

group by c.name, c.email, c.load_date
order by comment_count desc
  );
  
  
[0m01:03:52.541777 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:03:52.570244 [debug] [Thread-3 (]: SQL status: SELECT 0 in 0.028 seconds
[0m01:03:52.590127 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m01:03:52.590826 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: BEGIN
[0m01:03:52.592512 [debug] [Thread-3 (]: SQL status: BEGIN in 0.001 seconds
[0m01:03:52.593125 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m01:03:52.593711 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user__dbt_tmp010352518797'
        
      order by ordinal_position

  
[0m01:03:52.616538 [debug] [Thread-3 (]: SQL status: SELECT 5 in 0.022 seconds
[0m01:03:52.626479 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m01:03:52.627238 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m01:03:52.634152 [debug] [Thread-3 (]: SQL status: SELECT 5 in 0.006 seconds
[0m01:03:52.644997 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m01:03:52.645656 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m01:03:52.651707 [debug] [Thread-3 (]: SQL status: SELECT 5 in 0.005 seconds
[0m01:03:52.683267 [debug] [Thread-3 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user"
[0m01:03:52.684925 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m01:03:52.685844 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */

      
        delete from "test_db"."public_marts"."comments_by_user" as DBT_INTERNAL_DEST
        where (name, email) in (
            select distinct name, email
            from "comments_by_user__dbt_tmp010352518797" as DBT_INTERNAL_SOURCE
        );

    

    insert into "test_db"."public_marts"."comments_by_user" ("name", "email", "comment_count", "movie_ids", "load_date")
    (
        select "name", "email", "comment_count", "movie_ids", "load_date"
        from "comments_by_user__dbt_tmp010352518797"
    )
  
[0m01:03:52.692498 [debug] [Thread-3 (]: SQL status: INSERT 0 0 in 0.006 seconds
[0m01:03:52.694731 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: COMMIT
[0m01:03:52.695309 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m01:03:52.695896 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: COMMIT
[0m01:03:52.698770 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m01:03:52.699897 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: Close
[0m01:03:52.700998 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34d49f12-458d-4ca2-b377-3a958d3e8fb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b0a6758a8a0>]}
[0m01:03:52.701902 [info ] [Thread-3 (]: 2 of 2 OK created sql incremental model public_marts.comments_by_user .......... [[32mINSERT 0 0[0m in 0.24s]
[0m01:03:52.703115 [debug] [Thread-3 (]: Finished running node model.mongo_movies.comments_by_user
[0m01:03:52.706528 [debug] [MainThread]: Using postgres connection "master"
[0m01:03:52.707046 [debug] [MainThread]: On master: BEGIN
[0m01:03:52.707603 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:03:52.722887 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m01:03:52.723559 [debug] [MainThread]: On master: COMMIT
[0m01:03:52.724174 [debug] [MainThread]: Using postgres connection "master"
[0m01:03:52.724745 [debug] [MainThread]: On master: COMMIT
[0m01:03:52.725551 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:03:52.726044 [debug] [MainThread]: On master: Close
[0m01:03:52.727087 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:03:52.728064 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m01:03:52.728672 [debug] [MainThread]: Connection 'list_test_db_public_staging' was properly closed.
[0m01:03:52.729207 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user' was properly closed.
[0m01:03:52.729882 [info ] [MainThread]: 
[0m01:03:52.730529 [info ] [MainThread]: Finished running 1 incremental model, 1 view model in 0 hours 0 minutes and 0.77 seconds (0.77s).
[0m01:03:52.732346 [debug] [MainThread]: Command end result
[0m01:03:52.770213 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:03:52.773210 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:03:52.782184 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m01:03:52.782861 [info ] [MainThread]: 
[0m01:03:52.783706 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:03:52.784632 [info ] [MainThread]: 
[0m01:03:52.785346 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m01:03:52.787053 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.496797, "process_in_blocks": "8", "process_kernel_time": 0.702524, "process_mem_max_rss": "130516", "process_out_blocks": "2648", "process_user_time": 4.098668}
[0m01:03:52.787740 [debug] [MainThread]: Command `dbt run` succeeded at 01:03:52.787588 after 2.50 seconds
[0m01:03:52.788366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b0a6c86aed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b0a6aa8c6b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b0a6aa8c950>]}
[0m01:03:52.789000 [debug] [MainThread]: Flushing usage events
[0m01:03:53.621423 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:13:38.529322 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a68604a2330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a685df14530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a685de6bf20>]}


============================== 01:13:38.538015 | ad29a1d7-f777-4ce5-9cad-7bd8153f3fbf ==============================
[0m01:13:38.538015 [info ] [MainThread]: Running with dbt=1.10.6
[0m01:13:38.539234 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:13:39.003468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ad29a1d7-f777-4ce5-9cad-7bd8153f3fbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a685d9bacf0>]}
[0m01:13:39.137611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ad29a1d7-f777-4ce5-9cad-7bd8153f3fbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a685dc06f30>]}
[0m01:13:39.142869 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m01:13:39.322369 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m01:13:46.846599 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:13:46.847733 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user.sql
[0m01:13:39.589448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ad29a1d7-f777-4ce5-9cad-7bd8153f3fbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a685bfe3e00>]}
[0m01:13:39.690508 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:13:39.696024 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:13:39.729028 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ad29a1d7-f777-4ce5-9cad-7bd8153f3fbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a685d3ff860>]}
[0m01:13:39.729815 [info ] [MainThread]: Found 2 models, 4 sources, 434 macros
[0m01:13:39.730441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ad29a1d7-f777-4ce5-9cad-7bd8153f3fbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a685bfac830>]}
[0m01:13:39.732807 [info ] [MainThread]: 
[0m01:13:39.733465 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:13:39.734076 [info ] [MainThread]: 
[0m01:13:39.734922 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:13:39.740910 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:13:39.742630 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:13:39.818295 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:13:39.819117 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:13:39.819835 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:13:39.820461 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:13:39.821078 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:13:39.821749 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:13:39.858303 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.036 seconds
[0m01:13:39.859651 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.038 seconds
[0m01:13:39.861882 [debug] [ThreadPool]: On list_test_db: Close
[0m01:13:39.863673 [debug] [ThreadPool]: On list_test_db: Close
[0m01:13:39.866841 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m01:13:39.867990 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m01:13:39.877773 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:13:39.880647 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:13:39.881681 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m01:13:39.882377 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m01:13:39.883066 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:13:39.883732 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:13:39.906921 [debug] [ThreadPool]: SQL status: BEGIN in 0.024 seconds
[0m01:13:39.907674 [debug] [ThreadPool]: SQL status: BEGIN in 0.024 seconds
[0m01:13:39.908315 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:13:39.908923 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:13:39.909560 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m01:13:39.910224 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m01:13:39.916775 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.006 seconds
[0m01:13:39.918491 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m01:13:39.919068 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.008 seconds
[0m01:13:39.920889 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m01:13:39.921393 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m01:13:39.922385 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m01:13:39.930257 [debug] [MainThread]: Using postgres connection "master"
[0m01:13:39.930880 [debug] [MainThread]: On master: BEGIN
[0m01:13:39.931530 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:13:39.946766 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m01:13:39.947562 [debug] [MainThread]: Using postgres connection "master"
[0m01:13:39.948184 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:13:39.957939 [debug] [MainThread]: SQL status: SELECT 2 in 0.009 seconds
[0m01:13:39.960812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ad29a1d7-f777-4ce5-9cad-7bd8153f3fbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a685bfc1d60>]}
[0m01:13:39.961825 [debug] [MainThread]: On master: ROLLBACK
[0m01:13:39.962837 [debug] [MainThread]: Using postgres connection "master"
[0m01:13:39.963437 [debug] [MainThread]: On master: BEGIN
[0m01:13:39.964574 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m01:13:39.965084 [debug] [MainThread]: On master: COMMIT
[0m01:13:39.965613 [debug] [MainThread]: Using postgres connection "master"
[0m01:13:39.966106 [debug] [MainThread]: On master: COMMIT
[0m01:13:39.967030 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:13:39.967569 [debug] [MainThread]: On master: Close
[0m01:13:39.980122 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m01:13:39.981137 [info ] [Thread-1 (]: 1 of 2 START sql view model public_staging.stg_comments ........................ [RUN]
[0m01:13:39.981973 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m01:13:39.982564 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m01:13:39.994269 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m01:13:39.995320 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m01:13:40.048583 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m01:13:40.049749 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:13:40.050447 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m01:13:40.051053 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:13:40.068486 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m01:13:40.069665 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:13:40.070307 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m01:13:40.079060 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.008 seconds
[0m01:13:40.088013 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:13:40.088667 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m01:13:40.090325 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:13:40.095623 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:13:40.096206 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m01:13:40.097769 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:13:40.209553 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:13:40.210455 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:13:40.211125 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:13:40.220637 [debug] [Thread-1 (]: SQL status: COMMIT in 0.009 seconds
[0m01:13:40.229450 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m01:13:40.242678 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:13:40.243601 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m01:13:40.248736 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m01:13:40.252895 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m01:13:40.256870 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad29a1d7-f777-4ce5-9cad-7bd8153f3fbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a685e9fe6c0>]}
[0m01:13:40.258236 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.27s]
[0m01:13:40.259569 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m01:13:40.261449 [debug] [Thread-3 (]: Began running node model.mongo_movies.comments_by_user
[0m01:13:40.262256 [info ] [Thread-3 (]: 2 of 2 START sql incremental model public_marts.comments_by_user ............... [RUN]
[0m01:13:40.263316 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user'
[0m01:13:40.263893 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.comments_by_user
[0m01:13:40.270120 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user"
[0m01:13:40.271254 [debug] [Thread-3 (]: Began executing node model.mongo_movies.comments_by_user
[0m01:13:40.338346 [debug] [Thread-3 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user"
[0m01:13:40.339675 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m01:13:40.340456 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: BEGIN
[0m01:13:40.341107 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:13:40.356443 [debug] [Thread-3 (]: SQL status: BEGIN in 0.015 seconds
[0m01:13:40.357423 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m01:13:40.358136 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */

      
  
    

  create  table "test_db"."public_marts"."comments_by_user"
  
  
    as
  
  (
    

with max_existing as (
    
        select null::timestamp as max_load_date
    
)

select 
    c.name, 
    c.email, 
    count(*) as comment_count, 
    array_agg(c.movie_id) as movie_ids,
    max(c.load_date) as load_date  -- ✅ allowed because it's inside an aggregate
from "test_db"."public_staging"."stg_comments" c
join max_existing m on true
where 1=1

group by c.name, c.email
order by comment_count desc
  );
  
  
[0m01:13:40.477880 [debug] [Thread-3 (]: SQL status: SELECT 236 in 0.119 seconds
[0m01:13:40.485111 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: COMMIT
[0m01:13:40.485725 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m01:13:40.486348 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: COMMIT
[0m01:13:40.490588 [debug] [Thread-3 (]: SQL status: COMMIT in 0.004 seconds
[0m01:13:40.492429 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: Close
[0m01:13:40.494347 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad29a1d7-f777-4ce5-9cad-7bd8153f3fbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a685c7d3ce0>]}
[0m01:13:40.495783 [info ] [Thread-3 (]: 2 of 2 OK created sql incremental model public_marts.comments_by_user .......... [[32mSELECT 236[0m in 0.23s]
[0m01:13:40.497474 [debug] [Thread-3 (]: Finished running node model.mongo_movies.comments_by_user
[0m01:13:40.501301 [debug] [MainThread]: Using postgres connection "master"
[0m01:13:40.501917 [debug] [MainThread]: On master: BEGIN
[0m01:13:40.502414 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:13:40.518454 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m01:13:40.519429 [debug] [MainThread]: On master: COMMIT
[0m01:13:40.520319 [debug] [MainThread]: Using postgres connection "master"
[0m01:13:40.521023 [debug] [MainThread]: On master: COMMIT
[0m01:13:40.521996 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:13:40.522562 [debug] [MainThread]: On master: Close
[0m01:13:40.523658 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:13:40.524232 [debug] [MainThread]: Connection 'list_test_db_public_staging' was properly closed.
[0m01:13:40.524700 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m01:13:40.525156 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user' was properly closed.
[0m01:13:40.525819 [info ] [MainThread]: 
[0m01:13:40.526650 [info ] [MainThread]: Finished running 1 incremental model, 1 view model in 0 hours 0 minutes and 0.79 seconds (0.79s).
[0m01:13:40.528516 [debug] [MainThread]: Command end result
[0m01:13:40.568468 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:13:40.571543 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:13:40.580531 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m01:13:40.581123 [info ] [MainThread]: 
[0m01:13:40.582024 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:13:40.582711 [info ] [MainThread]: 
[0m01:13:40.583625 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m01:13:40.586392 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.6928706, "process_in_blocks": "90096", "process_kernel_time": 0.844265, "process_mem_max_rss": "129860", "process_out_blocks": "2640", "process_user_time": 4.005693}
[0m01:13:40.587408 [debug] [MainThread]: Command `dbt run` succeeded at 01:13:40.587233 after 2.69 seconds
[0m01:13:40.588154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a685bfe3b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a685cf175c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a685cf14c80>]}
[0m01:13:40.588795 [debug] [MainThread]: Flushing usage events
[0m01:13:42.241640 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:23:00.791908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6b9ab7fa10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6b9b1d7470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6b9ab7f5f0>]}


============================== 01:23:00.800196 | 9ac3c0f0-028a-4122-9d9c-a8e536402eb1 ==============================
[0m01:23:00.800196 [info ] [MainThread]: Running with dbt=1.10.6
[0m01:23:00.801056 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:23:01.245138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9ac3c0f0-028a-4122-9d9c-a8e536402eb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6b9a54a660>]}
[0m01:23:01.378702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9ac3c0f0-028a-4122-9d9c-a8e536402eb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6b9bb633b0>]}
[0m01:23:01.384095 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m01:23:01.561466 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m01:23:01.781087 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:23:01.782044 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user.sql
[0m01:23:02.337025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9ac3c0f0-028a-4122-9d9c-a8e536402eb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6b991f7f50>]}
[0m01:23:02.437030 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:23:02.442233 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:23:02.472780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9ac3c0f0-028a-4122-9d9c-a8e536402eb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6b99d55610>]}
[0m01:23:02.473569 [info ] [MainThread]: Found 2 models, 4 sources, 434 macros
[0m01:23:02.474192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9ac3c0f0-028a-4122-9d9c-a8e536402eb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6b99930500>]}
[0m01:23:02.476519 [info ] [MainThread]: 
[0m01:23:02.477146 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:23:02.477756 [info ] [MainThread]: 
[0m01:23:02.478686 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:23:02.485065 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:23:02.492451 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:23:02.572575 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:23:02.573635 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:23:02.574987 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:23:02.576057 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:23:02.576944 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:23:02.577878 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:23:02.613214 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.036 seconds
[0m01:23:02.613839 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.036 seconds
[0m01:23:02.615832 [debug] [ThreadPool]: On list_test_db: Close
[0m01:23:02.617767 [debug] [ThreadPool]: On list_test_db: Close
[0m01:23:02.620767 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m01:23:02.621998 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m01:23:02.632138 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:23:02.634639 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:23:02.635517 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m01:23:02.636272 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m01:23:02.636969 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:23:02.637592 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:23:02.660102 [debug] [ThreadPool]: SQL status: BEGIN in 0.023 seconds
[0m01:23:02.660750 [debug] [ThreadPool]: SQL status: BEGIN in 0.023 seconds
[0m01:23:02.661399 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:23:02.662081 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:23:02.662800 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m01:23:02.663718 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m01:23:02.670280 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.006 seconds
[0m01:23:02.670889 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.006 seconds
[0m01:23:02.672797 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m01:23:02.674782 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m01:23:02.676067 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m01:23:02.676924 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m01:23:02.683924 [debug] [MainThread]: Using postgres connection "master"
[0m01:23:02.684521 [debug] [MainThread]: On master: BEGIN
[0m01:23:02.685016 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:23:02.699212 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m01:23:02.700257 [debug] [MainThread]: Using postgres connection "master"
[0m01:23:02.700872 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:23:02.710414 [debug] [MainThread]: SQL status: SELECT 2 in 0.009 seconds
[0m01:23:02.712967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9ac3c0f0-028a-4122-9d9c-a8e536402eb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6b991e10a0>]}
[0m01:23:02.713660 [debug] [MainThread]: On master: ROLLBACK
[0m01:23:02.714644 [debug] [MainThread]: Using postgres connection "master"
[0m01:23:02.715278 [debug] [MainThread]: On master: BEGIN
[0m01:23:02.716592 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m01:23:02.717093 [debug] [MainThread]: On master: COMMIT
[0m01:23:02.717653 [debug] [MainThread]: Using postgres connection "master"
[0m01:23:02.718193 [debug] [MainThread]: On master: COMMIT
[0m01:23:02.719055 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:23:02.719691 [debug] [MainThread]: On master: Close
[0m01:23:02.730662 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m01:23:02.731651 [info ] [Thread-1 (]: 1 of 2 START sql view model public_staging.stg_comments ........................ [RUN]
[0m01:23:02.732417 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m01:23:02.733035 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m01:23:02.744548 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m01:23:02.745585 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m01:23:02.798783 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m01:23:02.800340 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:23:02.801082 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m01:23:02.801623 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:23:02.816641 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m01:23:02.817337 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:23:02.817954 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m01:23:02.824783 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m01:23:02.834311 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:23:02.834971 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m01:23:02.836652 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:23:02.841807 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:23:02.842373 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m01:23:02.844136 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:23:02.967368 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:23:02.968224 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:23:02.968926 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:23:02.976388 [debug] [Thread-1 (]: SQL status: COMMIT in 0.007 seconds
[0m01:23:02.988190 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m01:23:02.997116 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:23:02.997936 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m01:23:03.004074 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m01:23:03.008513 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m01:23:03.011969 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9ac3c0f0-028a-4122-9d9c-a8e536402eb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6b9bc0a6c0>]}
[0m01:23:03.013124 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.28s]
[0m01:23:03.014098 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m01:23:03.015829 [debug] [Thread-3 (]: Began running node model.mongo_movies.comments_by_user
[0m01:23:03.017406 [info ] [Thread-3 (]: 2 of 2 START sql incremental model public_marts.comments_by_user ............... [RUN]
[0m01:23:03.018249 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user'
[0m01:23:03.018805 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.comments_by_user
[0m01:23:03.025159 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user"
[0m01:23:03.026117 [debug] [Thread-3 (]: Began executing node model.mongo_movies.comments_by_user
[0m01:23:03.085748 [debug] [Thread-3 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user"
[0m01:23:03.086870 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m01:23:03.087934 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: BEGIN
[0m01:23:03.088583 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:23:03.104820 [debug] [Thread-3 (]: SQL status: BEGIN in 0.016 seconds
[0m01:23:03.105515 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m01:23:03.106205 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */

      
  
    

  create  table "test_db"."public_marts"."comments_by_user"
  
  
    as
  
  (
    

with max_existing as (
  
      select null::timestamp as max_load_date
  
),

-- Only new rows since last load
filtered_new as (
  select *
  from "test_db"."public_staging"."stg_comments" c
  join max_existing m on true
  where c.load_date > coalesce(m.max_load_date, '1900-01-01')
),

-- Aggregate new rows
new_agg as (
  select
    name,
    email,
    count(*) as comment_count,
    array_agg(movie_id) as movie_ids,
    max(load_date) as load_date
  from filtered_new
  group by name, email
),

-- For incremental runs, include existing data
final as (
  
    select * from new_agg
  
)

-- Combine old + new
select
  name,
  email,
  sum(comment_count) as comment_count,
  array_agg(distinct movie_ids) as movie_ids,
  max(load_date) as load_date
from final
group by name, email
order by comment_count desc
  );
  
  
[0m01:23:03.218570 [debug] [Thread-3 (]: SQL status: SELECT 236 in 0.112 seconds
[0m01:23:03.226190 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: COMMIT
[0m01:23:03.227034 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m01:23:03.227699 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: COMMIT
[0m01:23:03.234744 [debug] [Thread-3 (]: SQL status: COMMIT in 0.006 seconds
[0m01:23:03.236785 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: Close
[0m01:23:03.237922 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9ac3c0f0-028a-4122-9d9c-a8e536402eb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6b999d06b0>]}
[0m01:23:03.238901 [info ] [Thread-3 (]: 2 of 2 OK created sql incremental model public_marts.comments_by_user .......... [[32mSELECT 236[0m in 0.22s]
[0m01:23:03.240199 [debug] [Thread-3 (]: Finished running node model.mongo_movies.comments_by_user
[0m01:23:03.243796 [debug] [MainThread]: Using postgres connection "master"
[0m01:23:03.244328 [debug] [MainThread]: On master: BEGIN
[0m01:23:03.244913 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:23:03.259499 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m01:23:03.260161 [debug] [MainThread]: On master: COMMIT
[0m01:23:03.260742 [debug] [MainThread]: Using postgres connection "master"
[0m01:23:03.261362 [debug] [MainThread]: On master: COMMIT
[0m01:23:03.262238 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:23:03.262769 [debug] [MainThread]: On master: Close
[0m01:23:03.264048 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:23:03.264539 [debug] [MainThread]: Connection 'list_test_db_public_marts' was properly closed.
[0m01:23:03.264975 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m01:23:03.265456 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user' was properly closed.
[0m01:23:03.266136 [info ] [MainThread]: 
[0m01:23:03.266954 [info ] [MainThread]: Finished running 1 incremental model, 1 view model in 0 hours 0 minutes and 0.79 seconds (0.79s).
[0m01:23:03.269018 [debug] [MainThread]: Command end result
[0m01:23:03.303313 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:23:03.305894 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:23:03.315757 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m01:23:03.316391 [info ] [MainThread]: 
[0m01:23:03.317139 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:23:03.317760 [info ] [MainThread]: 
[0m01:23:03.318402 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m01:23:03.320742 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.651772, "process_in_blocks": "89888", "process_kernel_time": 0.818858, "process_mem_max_rss": "130320", "process_out_blocks": "2664", "process_user_time": 3.928305}
[0m01:23:03.321470 [debug] [MainThread]: Command `dbt run` succeeded at 01:23:03.321293 after 2.65 seconds
[0m01:23:03.322025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6b9a11f920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6b9a11f290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6b9a11e270>]}
[0m01:23:03.322651 [debug] [MainThread]: Flushing usage events
[0m01:23:04.944834 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:33:35.967928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4a1edbe120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4a1f4e65d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4a1f710080>]}


============================== 23:33:35.976032 | 6ade9295-da76-493b-9df9-cda7fade1cf8 ==============================
[0m23:33:35.976032 [info ] [MainThread]: Running with dbt=1.10.6
[0m23:33:35.977193 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt compile', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:33:36.398974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6ade9295-da76-493b-9df9-cda7fade1cf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4a1dfb6cc0>]}
[0m23:33:36.526066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6ade9295-da76-493b-9df9-cda7fade1cf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4a1e90dac0>]}
[0m23:33:36.527622 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:33:36.685609 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m23:33:36.876351 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 3 files added, 0 files changed.
[0m23:33:36.877303 [debug] [MainThread]: Partial parsing: added file: mongo_movies://models/mongo_movies/comments_by_user_incremental.sql
[0m23:33:36.877807 [debug] [MainThread]: Partial parsing: added file: mongo_movies://models/staging/stg_movies_directors.sql
[0m23:33:36.878290 [debug] [MainThread]: Partial parsing: added file: mongo_movies://models/staging/stg_movies_genres.sql
[0m23:33:36.878769 [debug] [MainThread]: Partial parsing: deleted file: mongo_movies://models/mongo_movies/comments_by_user.sql
[0m23:33:37.382451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6ade9295-da76-493b-9df9-cda7fade1cf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4a1c7785c0>]}
[0m23:33:37.479976 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:33:37.485010 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:33:37.516982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6ade9295-da76-493b-9df9-cda7fade1cf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4a1d35a8a0>]}
[0m23:33:37.518242 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m23:33:37.519181 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6ade9295-da76-493b-9df9-cda7fade1cf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4a1cf38080>]}
[0m23:33:37.522284 [info ] [MainThread]: 
[0m23:33:37.522984 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:33:37.523636 [info ] [MainThread]: 
[0m23:33:37.524743 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:33:37.533293 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_marts'
[0m23:33:37.534636 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_staging'
[0m23:33:37.613252 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:33:37.613997 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:33:37.614817 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m23:33:37.615487 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m23:33:37.616143 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:33:37.616788 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:33:37.651556 [debug] [ThreadPool]: SQL status: BEGIN in 0.035 seconds
[0m23:33:37.652490 [debug] [ThreadPool]: SQL status: BEGIN in 0.036 seconds
[0m23:33:37.653062 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:33:37.653645 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:33:37.654265 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m23:33:37.654870 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m23:33:37.675473 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.020 seconds
[0m23:33:37.676075 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.021 seconds
[0m23:33:37.677957 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m23:33:37.679607 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m23:33:37.680531 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m23:33:37.681097 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m23:33:37.690260 [debug] [MainThread]: Using postgres connection "master"
[0m23:33:37.690848 [debug] [MainThread]: On master: BEGIN
[0m23:33:37.691272 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:33:37.704544 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m23:33:37.705090 [debug] [MainThread]: Using postgres connection "master"
[0m23:33:37.705623 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:33:37.718396 [debug] [MainThread]: SQL status: SELECT 2 in 0.012 seconds
[0m23:33:37.720388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6ade9295-da76-493b-9df9-cda7fade1cf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4a20d9d100>]}
[0m23:33:37.721016 [debug] [MainThread]: On master: ROLLBACK
[0m23:33:37.721821 [debug] [MainThread]: On master: Close
[0m23:33:37.728985 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m23:33:37.729711 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m23:33:37.730371 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m23:33:37.731161 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_movies_directors)
[0m23:33:37.731995 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m23:33:37.732687 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m23:33:37.744153 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m23:33:37.746437 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m23:33:37.748364 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m23:33:37.749659 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m23:33:37.750551 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m23:33:37.752459 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m23:33:37.753224 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m23:33:37.754297 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m23:33:37.754824 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m23:33:37.761049 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m23:33:37.762386 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m23:33:37.763193 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m23:33:37.765762 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:33:37.766216 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m23:33:37.766627 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m23:33:37.767032 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m23:33:37.768463 [debug] [MainThread]: Command end result
[0m23:33:37.883724 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:33:37.886405 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:33:37.896237 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m23:33:37.898722 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 2.0439944, "process_in_blocks": "103584", "process_kernel_time": 0.985666, "process_mem_max_rss": "128140", "process_out_blocks": "2664", "process_user_time": 3.666198}
[0m23:33:37.899587 [debug] [MainThread]: Command `dbt compile` succeeded at 23:33:37.899374 after 2.05 seconds
[0m23:33:37.900302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4a1e5a8380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4a1f0f5ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4a1ee14ce0>]}
[0m23:33:37.901121 [debug] [MainThread]: Flushing usage events
[0m23:33:39.252280 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:33:55.759767 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d7eccd2990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d7eca92720>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d7eccd3890>]}


============================== 23:33:55.765369 | 3807ae7b-48e7-45ce-a2d6-2f71e93727ef ==============================
[0m23:33:55.765369 [info ] [MainThread]: Running with dbt=1.10.6
[0m23:33:55.766347 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:33:56.064568 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3807ae7b-48e7-45ce-a2d6-2f71e93727ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d7ebf1c110>]}
[0m23:33:56.194040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3807ae7b-48e7-45ce-a2d6-2f71e93727ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d7ed218f80>]}
[0m23:33:56.195511 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:33:56.354490 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m23:33:56.517029 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:33:56.517817 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:33:56.567355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3807ae7b-48e7-45ce-a2d6-2f71e93727ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d7eb709580>]}
[0m23:33:56.662335 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:33:56.664875 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:33:56.682246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3807ae7b-48e7-45ce-a2d6-2f71e93727ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d7eab39fd0>]}
[0m23:33:56.683214 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m23:33:56.684111 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3807ae7b-48e7-45ce-a2d6-2f71e93727ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d7ebbdd910>]}
[0m23:33:56.686348 [info ] [MainThread]: 
[0m23:33:56.686970 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:33:56.687538 [info ] [MainThread]: 
[0m23:33:56.688330 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:33:56.694554 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:33:56.696230 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:33:56.828476 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:33:56.829264 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:33:56.829884 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:33:56.830522 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:33:56.831136 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:33:56.831715 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:33:56.848564 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.017 seconds
[0m23:33:56.849163 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.017 seconds
[0m23:33:56.851552 [debug] [ThreadPool]: On list_test_db: Close
[0m23:33:56.853571 [debug] [ThreadPool]: On list_test_db: Close
[0m23:33:56.856703 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m23:33:56.857851 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m23:33:56.866297 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:33:56.869183 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:33:56.869877 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m23:33:56.870474 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m23:33:56.871159 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:33:56.871730 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:33:56.885636 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m23:33:56.886448 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:33:56.887090 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m23:33:56.887611 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m23:33:56.888209 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:33:56.888964 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m23:33:56.892969 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.004 seconds
[0m23:33:56.893931 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.004 seconds
[0m23:33:56.895970 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m23:33:56.898145 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m23:33:56.899419 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m23:33:56.900183 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m23:33:56.908587 [debug] [MainThread]: Using postgres connection "master"
[0m23:33:56.909189 [debug] [MainThread]: On master: BEGIN
[0m23:33:56.909634 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:33:56.923696 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m23:33:56.924538 [debug] [MainThread]: Using postgres connection "master"
[0m23:33:56.925126 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:33:56.933516 [debug] [MainThread]: SQL status: SELECT 2 in 0.008 seconds
[0m23:33:56.935848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3807ae7b-48e7-45ce-a2d6-2f71e93727ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d7ec3e2d80>]}
[0m23:33:56.936491 [debug] [MainThread]: On master: ROLLBACK
[0m23:33:56.937316 [debug] [MainThread]: Using postgres connection "master"
[0m23:33:56.937972 [debug] [MainThread]: On master: BEGIN
[0m23:33:56.940002 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:33:56.940993 [debug] [MainThread]: On master: COMMIT
[0m23:33:56.941556 [debug] [MainThread]: Using postgres connection "master"
[0m23:33:56.942082 [debug] [MainThread]: On master: COMMIT
[0m23:33:56.943114 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m23:33:56.943596 [debug] [MainThread]: On master: Close
[0m23:33:56.949628 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m23:33:56.950399 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m23:33:56.951287 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m23:33:56.952346 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m23:33:56.953254 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m23:33:56.953966 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_movies_directors)
[0m23:33:56.954653 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m23:33:56.955432 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m23:33:56.966446 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m23:33:56.969417 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m23:33:56.970838 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m23:33:56.971609 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m23:33:57.066231 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m23:33:57.067582 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m23:33:57.069466 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:33:57.070055 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m23:33:57.070567 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:33:57.073618 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:33:57.074470 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m23:33:57.075070 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:33:57.085824 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m23:33:57.086865 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:33:57.087724 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m23:33:57.088517 [debug] [Thread-2 (]: SQL status: BEGIN in 0.013 seconds
[0m23:33:57.089216 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:33:57.089873 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m23:33:57.111406 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.021 seconds
[0m23:33:57.112079 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.023 seconds
[0m23:33:57.120775 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:33:57.124648 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:33:57.125641 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m23:33:57.126602 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m23:33:57.128726 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:33:57.129388 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:33:57.132868 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:33:57.154511 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:33:57.155309 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m23:33:57.156197 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:33:57.157346 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:33:57.158532 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:33:57.164203 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:33:57.164726 [debug] [Thread-2 (]: SQL status: COMMIT in 0.005 seconds
[0m23:33:57.165376 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:33:57.174290 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m23:33:57.175666 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:33:57.185728 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:33:57.186813 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m23:33:57.188440 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m23:33:57.189078 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:33:57.192417 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m23:33:57.195487 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m23:33:57.199822 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:33:57.200873 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3807ae7b-48e7-45ce-a2d6-2f71e93727ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d7eec4e630>]}
[0m23:33:57.201576 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m23:33:57.202612 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.24s]
[0m23:33:57.203976 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m23:33:57.209425 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.006 seconds
[0m23:33:57.211776 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m23:33:57.212828 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3807ae7b-48e7-45ce-a2d6-2f71e93727ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d7eabb33b0>]}
[0m23:33:57.213756 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.26s]
[0m23:33:57.214805 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m23:33:57.216479 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m23:33:57.217572 [info ] [Thread-4 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m23:33:57.218456 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m23:33:57.219171 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m23:33:57.231215 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m23:33:57.232203 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m23:33:57.289812 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user_incremental"
[0m23:33:57.294794 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:33:57.295391 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: BEGIN
[0m23:33:57.295927 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m23:33:57.309289 [debug] [Thread-4 (]: SQL status: BEGIN in 0.013 seconds
[0m23:33:57.310179 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:33:57.310885 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      
  
    

  create  table "test_db"."public_marts"."comments_by_user_incremental"
  
  
    as
  
  (
    

WITH max_existing AS (
  
      SELECT null::timestamp AS max_load_date
  
),

-- Only new rows since last load
filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE c.load_date > coalesce(m.max_load_date, '1900-01-01')
),

-- Aggregate new rows
new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

-- Include old data for incremental runs
final AS (
  
    SELECT * FROM new_agg
  
),

-- Flatten arrays
flat AS (
  SELECT
    name,
    email,
    comment_count,
    unnest(movie_ids) AS movie_id,
    load_date
  FROM final
)

-- Final aggregation (switch source based on run type)
SELECT
  name,
  email,
  SUM(comment_count) AS comment_count,
  ARRAY_AGG(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
  MAX(load_date) AS load_date
FROM
  
    final
  
GROUP BY name, email
ORDER BY comment_count DESC;
  );
  
  
[0m23:33:57.312105 [debug] [Thread-4 (]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 71: ORDER BY comment_count DESC;
                                    ^

[0m23:33:57.312633 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: ROLLBACK
[0m23:33:57.313586 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m23:33:57.330812 [debug] [Thread-4 (]: Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  syntax error at or near ";"
  LINE 71: ORDER BY comment_count DESC;
                                      ^
  compiled code at target/run/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql
[0m23:33:57.331623 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3807ae7b-48e7-45ce-a2d6-2f71e93727ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d7e8ede390>]}
[0m23:33:57.332482 [error] [Thread-4 (]: 3 of 3 ERROR creating sql incremental model public_marts.comments_by_user_incremental  [[31mERROR[0m in 0.11s]
[0m23:33:57.333603 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m23:33:57.334496 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.comments_by_user_incremental' to be skipped because of status 'error'.  Reason: Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  syntax error at or near ";"
  LINE 71: ORDER BY comment_count DESC;
                                      ^
  compiled code at target/run/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql.
[0m23:33:57.338260 [debug] [MainThread]: Using postgres connection "master"
[0m23:33:57.338879 [debug] [MainThread]: On master: BEGIN
[0m23:33:57.339340 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:33:57.352162 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m23:33:57.352795 [debug] [MainThread]: On master: COMMIT
[0m23:33:57.353344 [debug] [MainThread]: Using postgres connection "master"
[0m23:33:57.353818 [debug] [MainThread]: On master: COMMIT
[0m23:33:57.354658 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:33:57.355278 [debug] [MainThread]: On master: Close
[0m23:33:57.356099 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:33:57.356576 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m23:33:57.356992 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m23:33:57.357395 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m23:33:57.357945 [info ] [MainThread]: 
[0m23:33:57.358623 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 0.67 seconds (0.67s).
[0m23:33:57.360842 [debug] [MainThread]: Command end result
[0m23:33:57.392821 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:33:57.395379 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:33:57.404365 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m23:33:57.404974 [info ] [MainThread]: 
[0m23:33:57.405585 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:33:57.406140 [info ] [MainThread]: 
[0m23:33:57.406828 [error] [MainThread]: [31mFailure in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)[0m
[0m23:33:57.407438 [error] [MainThread]:   Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  syntax error at or near ";"
  LINE 71: ORDER BY comment_count DESC;
                                      ^
  compiled code at target/run/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql
[0m23:33:57.407953 [info ] [MainThread]: 
[0m23:33:57.408521 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql
[0m23:33:57.409070 [info ] [MainThread]: 
[0m23:33:57.409642 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=3
[0m23:33:57.411138 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.7590584, "process_in_blocks": "864", "process_kernel_time": 0.714729, "process_mem_max_rss": "127908", "process_out_blocks": "1840", "process_user_time": 3.521448}
[0m23:33:57.411776 [debug] [MainThread]: Command `dbt run` failed at 23:33:57.411638 after 1.76 seconds
[0m23:33:57.412341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d7f095b410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d7ebb40a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d7ecc19a00>]}
[0m23:33:57.413106 [debug] [MainThread]: Flushing usage events
[0m23:33:58.583162 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:34:09.579602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e63ec82360>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e63f3c1040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e63f38b530>]}


============================== 23:34:09.583904 | e03e2e88-b9b1-4b71-a761-56e068ed2658 ==============================
[0m23:34:09.583904 [info ] [MainThread]: Running with dbt=1.10.6
[0m23:34:09.584676 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:34:09.879278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e03e2e88-b9b1-4b71-a761-56e068ed2658', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e63dd1f0e0>]}
[0m23:34:10.004246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e03e2e88-b9b1-4b71-a761-56e068ed2658', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e63e5378f0>]}
[0m23:34:10.005401 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:34:10.182969 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m23:34:10.325376 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:34:10.326287 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user_incremental.sql
[0m23:34:10.799673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e03e2e88-b9b1-4b71-a761-56e068ed2658', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e63c9e4ef0>]}
[0m23:34:10.895098 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:34:10.897609 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:34:10.914505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e03e2e88-b9b1-4b71-a761-56e068ed2658', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e63cd04da0>]}
[0m23:34:10.915226 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m23:34:10.915778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e03e2e88-b9b1-4b71-a761-56e068ed2658', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e63cdcdd00>]}
[0m23:34:10.918147 [info ] [MainThread]: 
[0m23:34:10.918710 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:34:10.919295 [info ] [MainThread]: 
[0m23:34:10.920242 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:34:10.926312 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:34:10.928177 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:34:10.993786 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:34:10.994568 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:34:10.995170 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:34:10.995752 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:34:10.996341 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:34:10.996896 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:34:11.013087 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.017 seconds
[0m23:34:11.013727 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.017 seconds
[0m23:34:11.015423 [debug] [ThreadPool]: On list_test_db: Close
[0m23:34:11.016993 [debug] [ThreadPool]: On list_test_db: Close
[0m23:34:11.020687 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m23:34:11.027652 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m23:34:11.031521 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:34:11.034232 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:34:11.035092 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m23:34:11.035806 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m23:34:11.036411 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:34:11.037112 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:34:11.050147 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m23:34:11.050966 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:34:11.051417 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m23:34:11.051970 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m23:34:11.052579 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:34:11.053417 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m23:34:11.057861 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.005 seconds
[0m23:34:11.058743 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.005 seconds
[0m23:34:11.060502 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m23:34:11.062464 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m23:34:11.063419 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m23:34:11.063906 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m23:34:11.070756 [debug] [MainThread]: Using postgres connection "master"
[0m23:34:11.071348 [debug] [MainThread]: On master: BEGIN
[0m23:34:11.071834 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:34:11.086458 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m23:34:11.087312 [debug] [MainThread]: Using postgres connection "master"
[0m23:34:11.087974 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:34:11.096844 [debug] [MainThread]: SQL status: SELECT 3 in 0.008 seconds
[0m23:34:11.098564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e03e2e88-b9b1-4b71-a761-56e068ed2658', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e640c3d370>]}
[0m23:34:11.099173 [debug] [MainThread]: On master: ROLLBACK
[0m23:34:11.099977 [debug] [MainThread]: Using postgres connection "master"
[0m23:34:11.100673 [debug] [MainThread]: On master: BEGIN
[0m23:34:11.102312 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:34:11.102774 [debug] [MainThread]: On master: COMMIT
[0m23:34:11.103251 [debug] [MainThread]: Using postgres connection "master"
[0m23:34:11.103685 [debug] [MainThread]: On master: COMMIT
[0m23:34:11.104443 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:34:11.104891 [debug] [MainThread]: On master: Close
[0m23:34:11.110792 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m23:34:11.111620 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m23:34:11.112577 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m23:34:11.113608 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m23:34:11.114456 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m23:34:11.115207 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_movies_directors)
[0m23:34:11.115900 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m23:34:11.116512 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m23:34:11.129948 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m23:34:11.130514 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m23:34:11.131826 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m23:34:11.132506 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m23:34:11.300111 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m23:34:11.302435 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m23:34:11.303525 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:34:11.304218 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:34:11.304855 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m23:34:11.305612 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m23:34:11.306279 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:34:11.306958 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:34:11.321700 [debug] [Thread-2 (]: SQL status: BEGIN in 0.015 seconds
[0m23:34:11.322348 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m23:34:11.323033 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:34:11.323747 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:34:11.324424 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m23:34:11.325180 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m23:34:11.328171 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m23:34:11.336127 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m23:34:11.338157 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:34:11.341999 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:34:11.342735 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m23:34:11.343516 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m23:34:11.344970 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:34:11.345811 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:34:11.349184 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:34:11.353367 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:34:11.354493 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m23:34:11.355177 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m23:34:11.356520 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:34:11.357164 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:34:11.397548 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:34:11.400672 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:34:11.401428 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:34:11.402363 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:34:11.403100 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:34:11.403766 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:34:11.406204 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m23:34:11.413035 [debug] [Thread-1 (]: SQL status: COMMIT in 0.009 seconds
[0m23:34:11.415956 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m23:34:11.419587 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m23:34:11.429518 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:34:11.430675 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:34:11.431461 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m23:34:11.432122 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m23:34:11.438154 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.005 seconds
[0m23:34:11.442126 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m23:34:11.442998 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.010 seconds
[0m23:34:11.445213 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m23:34:11.448069 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e03e2e88-b9b1-4b71-a761-56e068ed2658', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e640aa7e00>]}
[0m23:34:11.450169 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e03e2e88-b9b1-4b71-a761-56e068ed2658', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e63f3eb770>]}
[0m23:34:11.449401 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.33s]
[0m23:34:11.451575 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.34s]
[0m23:34:11.452784 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m23:34:11.453892 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m23:34:11.455830 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m23:34:11.456643 [info ] [Thread-4 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m23:34:11.457871 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m23:34:11.458737 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m23:34:11.470158 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m23:34:11.471537 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m23:34:11.538524 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user_incremental"
[0m23:34:11.539920 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:34:11.540702 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: BEGIN
[0m23:34:11.541458 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m23:34:11.557558 [debug] [Thread-4 (]: SQL status: BEGIN in 0.016 seconds
[0m23:34:11.558405 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:34:11.559205 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      
  
    

  create  table "test_db"."public_marts"."comments_by_user_incremental"
  
  
    as
  
  (
    

WITH max_existing AS (
  
      SELECT null::timestamp AS max_load_date
  
),

-- Only new rows since last load
filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE c.load_date > coalesce(m.max_load_date, '1900-01-01')
),

-- Aggregate new rows
new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

-- Include old data for incremental runs
final AS (
  
    SELECT * FROM new_agg
  
),

-- Flatten arrays
flat AS (
  SELECT
    name,
    email,
    comment_count,
    unnest(movie_ids) AS movie_id,
    load_date
  FROM final
)

-- Final aggregation (switch source based on run type)
SELECT
  name,
  email,
  SUM(comment_count) AS comment_count,
  ARRAY_AGG(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
  MAX(load_date) AS load_date
FROM
  
    final
  
GROUP BY name, email
ORDER BY comment_count DESC
  );
  
  
[0m23:34:11.564567 [debug] [Thread-4 (]: Postgres adapter: Postgres error: column "movie_id" does not exist
LINE 64:   ARRAY_AGG(DISTINCT movie_id ORDER BY movie_id) AS movie_id...
                              ^
HINT:  Perhaps you meant to reference the column "final.movie_ids".

[0m23:34:11.565571 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: ROLLBACK
[0m23:34:11.567013 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m23:34:11.573876 [debug] [Thread-4 (]: Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  column "movie_id" does not exist
  LINE 64:   ARRAY_AGG(DISTINCT movie_id ORDER BY movie_id) AS movie_id...
                                ^
  HINT:  Perhaps you meant to reference the column "final.movie_ids".
  compiled code at target/run/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql
[0m23:34:11.575067 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e03e2e88-b9b1-4b71-a761-56e068ed2658', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e638317170>]}
[0m23:34:11.576184 [error] [Thread-4 (]: 3 of 3 ERROR creating sql incremental model public_marts.comments_by_user_incremental  [[31mERROR[0m in 0.12s]
[0m23:34:11.577465 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m23:34:11.578458 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.comments_by_user_incremental' to be skipped because of status 'error'.  Reason: Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  column "movie_id" does not exist
  LINE 64:   ARRAY_AGG(DISTINCT movie_id ORDER BY movie_id) AS movie_id...
                                ^
  HINT:  Perhaps you meant to reference the column "final.movie_ids".
  compiled code at target/run/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql.
[0m23:34:11.583234 [debug] [MainThread]: Using postgres connection "master"
[0m23:34:11.583778 [debug] [MainThread]: On master: BEGIN
[0m23:34:11.584338 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:34:11.599565 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m23:34:11.600350 [debug] [MainThread]: On master: COMMIT
[0m23:34:11.600969 [debug] [MainThread]: Using postgres connection "master"
[0m23:34:11.601644 [debug] [MainThread]: On master: COMMIT
[0m23:34:11.603383 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m23:34:11.604064 [debug] [MainThread]: On master: Close
[0m23:34:11.605696 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:34:11.606473 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m23:34:11.607239 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m23:34:11.607828 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m23:34:11.608540 [info ] [MainThread]: 
[0m23:34:11.609189 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 0.69 seconds (0.69s).
[0m23:34:11.610845 [debug] [MainThread]: Command end result
[0m23:34:11.643714 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:34:11.646808 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:34:11.655135 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m23:34:11.655695 [info ] [MainThread]: 
[0m23:34:11.656422 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:34:11.657033 [info ] [MainThread]: 
[0m23:34:11.657845 [error] [MainThread]: [31mFailure in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)[0m
[0m23:34:11.658477 [error] [MainThread]:   Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  column "movie_id" does not exist
  LINE 64:   ARRAY_AGG(DISTINCT movie_id ORDER BY movie_id) AS movie_id...
                                ^
  HINT:  Perhaps you meant to reference the column "final.movie_ids".
  compiled code at target/run/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql
[0m23:34:11.658984 [info ] [MainThread]: 
[0m23:34:11.659730 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql
[0m23:34:11.660231 [info ] [MainThread]: 
[0m23:34:11.660779 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=3
[0m23:34:11.664217 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.2161794, "process_in_blocks": "0", "process_kernel_time": 0.72584, "process_mem_max_rss": "131084", "process_out_blocks": "2712", "process_user_time": 3.968195}
[0m23:34:11.665134 [debug] [MainThread]: Command `dbt run` failed at 23:34:11.664949 after 2.22 seconds
[0m23:34:11.666019 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e63e9ea1b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e63e9e8bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e63e1be5d0>]}
[0m23:34:11.666693 [debug] [MainThread]: Flushing usage events
[0m23:34:12.885770 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:34:56.893432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74fc17cdb230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74fc17cda120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74fc17cdb050>]}


============================== 23:34:56.898342 | d308dd7b-fa57-407d-b139-ad02b9b5bce7 ==============================
[0m23:34:56.898342 [info ] [MainThread]: Running with dbt=1.10.6
[0m23:34:56.899562 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'debug': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:34:57.198238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd308dd7b-fa57-407d-b139-ad02b9b5bce7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74fc173bae10>]}
[0m23:34:57.320559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd308dd7b-fa57-407d-b139-ad02b9b5bce7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74fc182aa090>]}
[0m23:34:57.321900 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:34:57.467854 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m23:34:57.603128 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:34:57.604318 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user_incremental.sql
[0m23:34:58.083301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd308dd7b-fa57-407d-b139-ad02b9b5bce7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74fc159f0e00>]}
[0m23:34:58.182517 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:34:58.185770 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:34:58.208158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd308dd7b-fa57-407d-b139-ad02b9b5bce7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74fc16d46810>]}
[0m23:34:58.208976 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m23:34:58.209616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd308dd7b-fa57-407d-b139-ad02b9b5bce7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74fc17e9c380>]}
[0m23:34:58.213799 [info ] [MainThread]: 
[0m23:34:58.215236 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:34:58.216063 [info ] [MainThread]: 
[0m23:34:58.217194 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:34:58.225447 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:34:58.226973 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:34:58.297913 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:34:58.298659 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:34:58.299281 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:34:58.299879 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:34:58.300465 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:34:58.301019 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:34:58.317252 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.017 seconds
[0m23:34:58.317924 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.017 seconds
[0m23:34:58.319644 [debug] [ThreadPool]: On list_test_db: Close
[0m23:34:58.321263 [debug] [ThreadPool]: On list_test_db: Close
[0m23:34:58.324277 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m23:34:58.325452 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m23:34:58.333840 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:34:58.336800 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:34:58.337421 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m23:34:58.338027 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m23:34:58.338611 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:34:58.339230 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:34:58.353120 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m23:34:58.353768 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m23:34:58.354258 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:34:58.354838 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:34:58.355442 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m23:34:58.356165 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m23:34:58.360950 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.004 seconds
[0m23:34:58.363442 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m23:34:58.364170 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.007 seconds
[0m23:34:58.366203 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m23:34:58.366761 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m23:34:58.367931 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m23:34:58.375575 [debug] [MainThread]: Using postgres connection "master"
[0m23:34:58.376224 [debug] [MainThread]: On master: BEGIN
[0m23:34:58.376666 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:34:58.389595 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m23:34:58.390187 [debug] [MainThread]: Using postgres connection "master"
[0m23:34:58.390746 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:34:58.398924 [debug] [MainThread]: SQL status: SELECT 3 in 0.007 seconds
[0m23:34:58.400961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd308dd7b-fa57-407d-b139-ad02b9b5bce7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74fc159567b0>]}
[0m23:34:58.401741 [debug] [MainThread]: On master: ROLLBACK
[0m23:34:58.402558 [debug] [MainThread]: Using postgres connection "master"
[0m23:34:58.403137 [debug] [MainThread]: On master: BEGIN
[0m23:34:58.404111 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m23:34:58.404565 [debug] [MainThread]: On master: COMMIT
[0m23:34:58.405020 [debug] [MainThread]: Using postgres connection "master"
[0m23:34:58.405437 [debug] [MainThread]: On master: COMMIT
[0m23:34:58.406183 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:34:58.406658 [debug] [MainThread]: On master: Close
[0m23:34:58.412175 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m23:34:58.412849 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m23:34:58.413764 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m23:34:58.414644 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m23:34:58.415572 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m23:34:58.416380 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_movies_directors)
[0m23:34:58.416984 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m23:34:58.417583 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m23:35:09.143945 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m23:35:09.146433 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m23:35:09.148048 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m23:35:09.148991 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m23:35:09.327752 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m23:35:09.328795 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m23:35:09.330124 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:35:09.330936 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:35:09.331697 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m23:35:09.332823 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m23:35:09.333767 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:35:09.334458 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:35:09.351920 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m23:35:09.352832 [debug] [Thread-2 (]: SQL status: BEGIN in 0.018 seconds
[0m23:35:09.353741 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:35:09.354619 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:35:09.355596 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m23:35:09.356495 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m23:35:09.360625 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m23:34:58.667519 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.013 seconds
[0m23:34:58.672754 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:34:58.678452 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:34:58.679399 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m23:34:58.680174 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m23:34:58.681894 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:34:58.682598 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:34:58.688667 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:34:58.693768 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:34:58.694694 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m23:34:58.695635 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m23:34:58.697424 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:34:58.698250 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:34:58.744651 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:34:58.745746 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:34:58.746405 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:34:58.747208 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:34:58.747976 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:34:58.748761 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:34:58.751732 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m23:34:58.758106 [debug] [Thread-2 (]: SQL status: COMMIT in 0.008 seconds
[0m23:34:58.766592 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m23:34:58.763641 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m23:34:58.780023 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:34:58.781944 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:34:58.783048 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m23:34:58.784008 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m23:34:58.788012 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.003 seconds
[0m23:34:58.791934 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m23:34:58.792577 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.008 seconds
[0m23:34:58.794839 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m23:34:58.797802 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd308dd7b-fa57-407d-b139-ad02b9b5bce7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74fc17d05730>]}
[0m23:34:58.798636 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd308dd7b-fa57-407d-b139-ad02b9b5bce7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74fc17168320>]}
[0m23:34:58.799619 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.38s]
[0m23:34:58.800802 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.38s]
[0m23:34:58.801897 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m23:34:58.802719 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m23:34:58.804861 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m23:34:58.805914 [info ] [Thread-4 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m23:34:58.807104 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m23:34:58.807887 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m23:34:58.815522 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m23:34:58.816772 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m23:34:58.887928 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user_incremental"
[0m23:34:58.889790 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:34:58.890417 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: BEGIN
[0m23:34:58.891006 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m23:34:58.903553 [debug] [Thread-4 (]: SQL status: BEGIN in 0.012 seconds
[0m23:34:58.904212 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:34:58.904904 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      
  
    

  create  table "test_db"."public_marts"."comments_by_user_incremental"
  
  
    as
  
  (
    

WITH max_existing AS (
  
      SELECT null::timestamp AS max_load_date
  
),

-- Only new rows since last load
filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE c.load_date > coalesce(m.max_load_date, '1900-01-01')
),

-- Aggregate new rows
new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

-- Include old data for incremental runs
final AS (
  
    SELECT * FROM new_agg
  
),

-- Flatten arrays
flat AS (
  SELECT
    name,
    email,
    comment_count,
    unnest(movie_ids) AS movie_ids,
    load_date
  FROM final
)

-- Final aggregation (switch source based on run type)
SELECT
  name,
  email,
  SUM(comment_count) AS comment_count,
  ARRAY_AGG(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
  MAX(load_date) AS load_date
FROM
  
    final
  
GROUP BY name, email
ORDER BY comment_count DESC
  );
  
  
[0m23:34:58.908052 [debug] [Thread-4 (]: Postgres adapter: Postgres error: column "movie_id" does not exist
LINE 64:   ARRAY_AGG(DISTINCT movie_id ORDER BY movie_id) AS movie_id...
                              ^
HINT:  Perhaps you meant to reference the column "final.movie_ids".

[0m23:34:58.908780 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: ROLLBACK
[0m23:34:58.909847 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m23:34:58.914495 [debug] [Thread-4 (]: Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  column "movie_id" does not exist
  LINE 64:   ARRAY_AGG(DISTINCT movie_id ORDER BY movie_id) AS movie_id...
                                ^
  HINT:  Perhaps you meant to reference the column "final.movie_ids".
  compiled code at target/run/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql
[0m23:34:58.915233 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd308dd7b-fa57-407d-b139-ad02b9b5bce7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74fc159591f0>]}
[0m23:34:58.916114 [error] [Thread-4 (]: 3 of 3 ERROR creating sql incremental model public_marts.comments_by_user_incremental  [[31mERROR[0m in 0.11s]
[0m23:34:58.917014 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m23:34:58.917953 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.comments_by_user_incremental' to be skipped because of status 'error'.  Reason: Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  column "movie_id" does not exist
  LINE 64:   ARRAY_AGG(DISTINCT movie_id ORDER BY movie_id) AS movie_id...
                                ^
  HINT:  Perhaps you meant to reference the column "final.movie_ids".
  compiled code at target/run/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql.
[0m23:34:58.922050 [debug] [MainThread]: Using postgres connection "master"
[0m23:34:58.922728 [debug] [MainThread]: On master: BEGIN
[0m23:34:58.923248 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:34:58.935438 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m23:34:58.936044 [debug] [MainThread]: On master: COMMIT
[0m23:34:58.936537 [debug] [MainThread]: Using postgres connection "master"
[0m23:34:58.937077 [debug] [MainThread]: On master: COMMIT
[0m23:34:58.937857 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:34:58.938624 [debug] [MainThread]: On master: Close
[0m23:34:58.939537 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:34:58.940032 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m23:34:58.940524 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m23:34:58.941094 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m23:34:58.942041 [info ] [MainThread]: 
[0m23:34:58.942798 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 0.72 seconds (0.72s).
[0m23:34:58.944554 [debug] [MainThread]: Command end result
[0m23:34:58.986707 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:34:58.990905 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:34:59.005503 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m23:34:59.006347 [info ] [MainThread]: 
[0m23:34:59.007257 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:34:59.008057 [info ] [MainThread]: 
[0m23:34:59.008995 [error] [MainThread]: [31mFailure in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)[0m
[0m23:34:59.009992 [error] [MainThread]:   Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  column "movie_id" does not exist
  LINE 64:   ARRAY_AGG(DISTINCT movie_id ORDER BY movie_id) AS movie_id...
                                ^
  HINT:  Perhaps you meant to reference the column "final.movie_ids".
  compiled code at target/run/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql
[0m23:34:59.010706 [info ] [MainThread]: 
[0m23:34:59.011446 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql
[0m23:34:59.012021 [info ] [MainThread]: 
[0m23:34:59.012668 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=3
[0m23:34:59.014466 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.226593, "process_in_blocks": "0", "process_kernel_time": 0.735256, "process_mem_max_rss": "130792", "process_out_blocks": "2712", "process_user_time": 4.067886}
[0m23:34:59.015326 [debug] [MainThread]: Command `dbt run` failed at 23:34:59.015164 after 2.23 seconds
[0m23:34:59.015944 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74fc17fe5970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74fc14489940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74fc14489ca0>]}
[0m23:34:59.016671 [debug] [MainThread]: Flushing usage events
[0m23:35:00.411365 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:35:16.452317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e1f99335c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e1f94f1b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e1f94f17c0>]}


============================== 23:35:16.456946 | 1b794f66-41f6-46c8-9dc8-bbd607e29e5b ==============================
[0m23:35:16.456946 [info ] [MainThread]: Running with dbt=1.10.6
[0m23:35:16.457884 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m23:35:16.744033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1b794f66-41f6-46c8-9dc8-bbd607e29e5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e1f8d77fb0>]}
[0m23:35:16.867464 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1b794f66-41f6-46c8-9dc8-bbd607e29e5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e1f8a4df40>]}
[0m23:35:16.868657 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:35:17.013956 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m23:35:17.155419 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:35:17.156355 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user_incremental.sql
[0m23:35:17.645238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1b794f66-41f6-46c8-9dc8-bbd607e29e5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e1f6b61910>]}
[0m23:35:17.742603 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:35:17.745604 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:35:17.762765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1b794f66-41f6-46c8-9dc8-bbd607e29e5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e1f6f341d0>]}
[0m23:35:17.763613 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m23:35:17.764267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1b794f66-41f6-46c8-9dc8-bbd607e29e5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e1f7f25130>]}
[0m23:35:17.767045 [info ] [MainThread]: 
[0m23:35:17.767730 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:35:17.768445 [info ] [MainThread]: 
[0m23:35:17.769334 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:35:17.778007 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:35:17.779440 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:35:17.853926 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:35:17.854741 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:35:17.855410 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:35:17.856164 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:35:17.856811 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:35:17.857421 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:35:17.874692 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.018 seconds
[0m23:35:17.875412 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.018 seconds
[0m23:35:17.877188 [debug] [ThreadPool]: On list_test_db: Close
[0m23:35:17.879136 [debug] [ThreadPool]: On list_test_db: Close
[0m23:35:17.883029 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m23:35:17.884165 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m23:35:17.892306 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:35:17.895214 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:35:17.897310 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m23:35:17.896195 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m23:35:17.898012 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:35:17.898727 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:35:17.912310 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m23:35:17.912879 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m23:35:17.913570 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:35:17.914306 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:35:17.914965 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m23:35:17.915578 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m23:35:17.920614 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.004 seconds
[0m23:35:17.921516 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.005 seconds
[0m23:35:17.923519 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m23:35:17.925175 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m23:35:17.926213 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m23:35:17.926868 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m23:35:17.934478 [debug] [MainThread]: Using postgres connection "master"
[0m23:35:17.935108 [debug] [MainThread]: On master: BEGIN
[0m23:35:17.935558 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:35:17.948534 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m23:35:17.949138 [debug] [MainThread]: Using postgres connection "master"
[0m23:35:17.949657 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:35:17.958503 [debug] [MainThread]: SQL status: SELECT 3 in 0.008 seconds
[0m23:35:17.961098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1b794f66-41f6-46c8-9dc8-bbd607e29e5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e1f83ff770>]}
[0m23:35:17.961707 [debug] [MainThread]: On master: ROLLBACK
[0m23:35:17.962667 [debug] [MainThread]: Using postgres connection "master"
[0m23:35:17.963121 [debug] [MainThread]: On master: BEGIN
[0m23:35:17.964334 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:35:17.964799 [debug] [MainThread]: On master: COMMIT
[0m23:35:17.965257 [debug] [MainThread]: Using postgres connection "master"
[0m23:35:17.965686 [debug] [MainThread]: On master: COMMIT
[0m23:35:17.966645 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:35:17.967249 [debug] [MainThread]: On master: Close
[0m23:35:17.973468 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m23:35:17.974283 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m23:35:17.975045 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m23:35:17.976040 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m23:35:17.976869 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m23:35:17.977493 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_movies_directors)
[0m23:35:17.978138 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m23:35:17.978807 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m23:35:17.990700 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m23:35:17.993477 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m23:35:17.994820 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m23:35:17.995733 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m23:35:18.166064 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m23:35:18.166821 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m23:35:18.168324 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:35:18.169035 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:35:18.169658 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m23:35:18.170315 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m23:35:18.171036 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:35:18.171948 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:35:18.187232 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m23:35:18.188124 [debug] [Thread-2 (]: SQL status: BEGIN in 0.017 seconds
[0m23:35:18.189022 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:35:18.189808 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:35:18.190459 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m23:35:18.191167 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m23:35:18.194597 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m23:35:18.195330 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m23:35:18.204021 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:35:18.208246 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:35:18.208955 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m23:35:18.209576 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m23:35:18.211053 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:35:18.211593 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:35:18.215088 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:35:18.219177 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:35:18.220332 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m23:35:18.221209 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m23:35:18.222878 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:35:18.223578 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:35:18.264302 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:35:18.261848 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:35:18.265348 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:35:18.266017 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:35:18.266684 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:35:18.267352 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:35:18.274010 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m23:35:18.280697 [debug] [Thread-2 (]: SQL status: COMMIT in 0.012 seconds
[0m23:35:18.285598 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m23:35:18.289608 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m23:35:18.298089 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:35:18.299723 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:35:18.300585 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m23:35:18.301290 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m23:35:18.314369 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.012 seconds
[0m23:35:18.317899 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m23:35:18.320175 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1b794f66-41f6-46c8-9dc8-bbd607e29e5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e1f98fad20>]}
[0m23:35:18.321156 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.34s]
[0m23:35:18.322232 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m23:35:18.325215 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.023 seconds
[0m23:35:18.327035 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m23:35:18.328014 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1b794f66-41f6-46c8-9dc8-bbd607e29e5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e1f50460c0>]}
[0m23:35:18.328894 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.35s]
[0m23:35:18.330006 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m23:35:18.332028 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m23:35:18.333088 [info ] [Thread-4 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m23:35:18.333913 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m23:35:18.334494 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m23:35:18.340840 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m23:35:18.341778 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m23:35:18.409938 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user_incremental"
[0m23:35:18.411403 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:35:18.412152 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: BEGIN
[0m23:35:18.412883 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m23:35:29.173204 [debug] [Thread-4 (]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
connection to server at "localhost" (127.0.0.1), port 5433 failed: timeout expired

[0m23:35:29.188561 [debug] [Thread-4 (]: SQL status: BEGIN in 0.027 seconds
[0m23:35:29.189312 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:35:29.189857 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      
  
    

  create  table "test_db"."public_marts"."comments_by_user_incremental"
  
  
    as
  
  (
    

WITH max_existing AS (
  
      SELECT null::timestamp AS max_load_date
  
),

-- Only new rows since last load
filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE c.load_date > coalesce(m.max_load_date, '1900-01-01')
),

-- Aggregate new rows
new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

-- Include old data for incremental runs
final AS (
  
    SELECT * FROM new_agg
  
),

-- Flatten arrays
flat AS (
  SELECT
    name,
    email,
    comment_count,
    unnest(movie_ids) AS movie_ids,
    load_date
  FROM final
)

-- Final aggregation (switch source based on run type)
SELECT
  name,
  email,
  SUM(comment_count) AS comment_count,
  ARRAY_AGG(DISTINCT movie_ids ORDER BY movie_ids) AS movie_ids,
  MAX(load_date) AS load_date
FROM
  
    final
  
GROUP BY name, email
ORDER BY comment_count DESC
  );
  
  
[0m23:35:29.387181 [debug] [Thread-4 (]: SQL status: SELECT 236 in 0.196 seconds
[0m23:35:18.666675 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m23:35:18.669891 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:35:18.670770 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m23:35:18.673636 [debug] [Thread-4 (]: SQL status: COMMIT in 0.002 seconds
[0m23:35:18.674782 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m23:35:18.675663 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1b794f66-41f6-46c8-9dc8-bbd607e29e5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e1f51b4ef0>]}
[0m23:35:18.677202 [info ] [Thread-4 (]: 3 of 3 OK created sql incremental model public_marts.comments_by_user_incremental  [[32mSELECT 236[0m in 0.34s]
[0m23:35:18.678078 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m23:35:18.681276 [debug] [MainThread]: Using postgres connection "master"
[0m23:35:18.681869 [debug] [MainThread]: On master: BEGIN
[0m23:35:18.682480 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:35:18.698232 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m23:35:18.699101 [debug] [MainThread]: On master: COMMIT
[0m23:35:18.699802 [debug] [MainThread]: Using postgres connection "master"
[0m23:35:18.700390 [debug] [MainThread]: On master: COMMIT
[0m23:35:18.701172 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:35:18.701632 [debug] [MainThread]: On master: Close
[0m23:35:18.702615 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:35:18.703271 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m23:35:18.704429 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m23:35:18.705256 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m23:35:18.706055 [info ] [MainThread]: 
[0m23:35:18.706834 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 0.94 seconds (0.94s).
[0m23:35:18.708226 [debug] [MainThread]: Command end result
[0m23:35:18.740403 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:35:18.743122 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:35:18.751577 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m23:35:18.752160 [info ] [MainThread]: 
[0m23:35:18.752898 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:35:18.753458 [info ] [MainThread]: 
[0m23:35:18.754173 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m23:35:18.755534 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.3906648, "process_in_blocks": "0", "process_kernel_time": 0.7354, "process_mem_max_rss": "130932", "process_out_blocks": "2704", "process_user_time": 4.000739}
[0m23:35:18.756345 [debug] [MainThread]: Command `dbt run` succeeded at 23:35:18.756123 after 2.39 seconds
[0m23:35:18.756918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e1fcdb3410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e1f93d7a70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e1f6b42f90>]}
[0m23:35:18.757484 [debug] [MainThread]: Flushing usage events
[0m23:35:19.966333 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:37:19.298542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7749259d3320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774925765a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7749259d1100>]}


============================== 23:37:19.303475 | eb183638-4f1a-4acb-9e9a-0bc1d2912c5f ==============================
[0m23:37:19.303475 [info ] [MainThread]: Running with dbt=1.10.6
[0m23:37:19.304465 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:37:19.605709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eb183638-4f1a-4acb-9e9a-0bc1d2912c5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774924737fe0>]}
[0m23:37:19.735805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'eb183638-4f1a-4acb-9e9a-0bc1d2912c5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77492554a000>]}
[0m23:37:19.737104 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:37:19.886949 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m23:37:20.034343 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:37:20.035237 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user_incremental.sql
[0m23:37:20.539185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eb183638-4f1a-4acb-9e9a-0bc1d2912c5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7749233ecec0>]}
[0m23:37:20.642202 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:37:20.644572 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:37:20.662680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eb183638-4f1a-4acb-9e9a-0bc1d2912c5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774923723800>]}
[0m23:37:20.663680 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m23:37:20.664471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eb183638-4f1a-4acb-9e9a-0bc1d2912c5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774923b392e0>]}
[0m23:37:20.667181 [info ] [MainThread]: 
[0m23:37:20.667898 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:37:20.668479 [info ] [MainThread]: 
[0m23:37:20.669516 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:37:20.676743 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:37:20.678234 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:37:20.742361 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:37:20.743073 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:37:20.743723 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:37:20.744429 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:37:20.745141 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:37:20.745834 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:37:20.763460 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.018 seconds
[0m23:37:20.765772 [debug] [ThreadPool]: On list_test_db: Close
[0m23:37:20.766319 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.020 seconds
[0m23:37:20.768022 [debug] [ThreadPool]: On list_test_db: Close
[0m23:37:20.770912 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m23:37:20.771940 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m23:37:20.780954 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:37:20.783406 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:37:20.784063 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m23:37:20.784726 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m23:37:20.785852 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:37:20.786453 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:37:20.802073 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m23:37:20.802717 [debug] [ThreadPool]: SQL status: BEGIN in 0.017 seconds
[0m23:37:20.803215 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:37:20.803825 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:37:20.804478 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m23:37:20.805191 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m23:37:20.810322 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.004 seconds
[0m23:37:20.811178 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.005 seconds
[0m23:37:20.813166 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m23:37:20.814837 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m23:37:20.815825 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m23:37:20.816456 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m23:37:20.824574 [debug] [MainThread]: Using postgres connection "master"
[0m23:37:20.825265 [debug] [MainThread]: On master: BEGIN
[0m23:37:20.825762 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:37:20.840191 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m23:37:20.840781 [debug] [MainThread]: Using postgres connection "master"
[0m23:37:20.841456 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:37:20.852079 [debug] [MainThread]: SQL status: SELECT 3 in 0.010 seconds
[0m23:37:20.854353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eb183638-4f1a-4acb-9e9a-0bc1d2912c5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7749258485c0>]}
[0m23:37:20.855011 [debug] [MainThread]: On master: ROLLBACK
[0m23:37:20.856028 [debug] [MainThread]: Using postgres connection "master"
[0m23:37:20.856505 [debug] [MainThread]: On master: BEGIN
[0m23:37:20.857649 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:37:20.858130 [debug] [MainThread]: On master: COMMIT
[0m23:37:20.858662 [debug] [MainThread]: Using postgres connection "master"
[0m23:37:20.859127 [debug] [MainThread]: On master: COMMIT
[0m23:37:20.859825 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:37:20.860309 [debug] [MainThread]: On master: Close
[0m23:37:20.866526 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m23:37:20.867197 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m23:37:20.868112 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m23:37:20.869145 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m23:37:20.870139 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m23:37:20.870831 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_movies_directors)
[0m23:37:20.871445 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m23:37:20.872248 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m23:37:20.886846 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m23:37:20.889709 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m23:37:20.891335 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m23:37:20.897615 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m23:37:21.081351 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m23:37:21.082395 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m23:37:21.083837 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:37:21.084455 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:37:21.085131 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m23:37:21.085763 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m23:37:21.086400 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:37:21.087077 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:37:21.100426 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m23:37:21.101374 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:37:21.102138 [debug] [Thread-2 (]: SQL status: BEGIN in 0.015 seconds
[0m23:37:21.102698 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m23:37:21.103326 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:37:21.104537 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m23:37:21.107345 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m23:37:21.108082 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m23:37:21.117827 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:37:21.122233 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:37:21.123073 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m23:37:21.123753 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m23:37:21.125350 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:37:21.125920 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:37:21.129318 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:37:21.134711 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:37:21.135731 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m23:37:21.136670 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m23:37:21.138076 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:37:21.143855 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.006 seconds
[0m23:37:21.180838 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:37:21.182073 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:37:21.182994 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:37:21.183652 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:37:21.184319 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:37:21.185076 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:37:21.191976 [debug] [Thread-2 (]: SQL status: COMMIT in 0.006 seconds
[0m23:37:21.199145 [debug] [Thread-1 (]: SQL status: COMMIT in 0.013 seconds
[0m23:37:21.202440 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m23:37:21.206210 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m23:37:21.216125 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:37:21.217312 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:37:21.218004 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m23:37:21.218694 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m23:37:21.222330 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.003 seconds
[0m23:37:21.225478 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m23:37:21.226071 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.006 seconds
[0m23:37:21.228579 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m23:37:21.232522 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb183638-4f1a-4acb-9e9a-0bc1d2912c5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774921944fe0>]}
[0m23:37:21.233293 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb183638-4f1a-4acb-9e9a-0bc1d2912c5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7749252976b0>]}
[0m23:37:21.234455 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.36s]
[0m23:37:21.235515 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.36s]
[0m23:37:21.236571 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m23:37:21.237479 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m23:37:21.239497 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m23:37:21.240303 [info ] [Thread-4 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m23:37:21.241355 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m23:37:21.241987 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m23:37:21.252022 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m23:37:21.253423 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m23:37:21.321452 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:37:21.322249 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

    
  
    

  create temporary table "comments_by_user_incremental__dbt_tmp233721298941"
  
  
    as
  
  (
    

WITH max_existing AS (
  
      SELECT max(load_date) AS max_load_date FROM "test_db"."public_marts"."comments_by_user_incremental"
  
),

-- Only new rows since last load
filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE c.load_date > coalesce(m.max_load_date, '1900-01-01')
),

-- Aggregate new rows
new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

-- Include old data for incremental runs
final AS (
  
    SELECT * FROM "test_db"."public_marts"."comments_by_user_incremental"
    UNION ALL
    SELECT * FROM new_agg
  
),

-- Flatten arrays
flat AS (
  SELECT
    name,
    email,
    comment_count,
    unnest(movie_ids) AS movie_ids,
    load_date
  FROM final
)

-- Final aggregation (switch source based on run type)
SELECT
  name,
  email,
  SUM(comment_count) AS comment_count,
  ARRAY_AGG(DISTINCT movie_ids ORDER BY movie_ids) AS movie_ids,
  MAX(load_date) AS load_date
FROM flat
GROUP BY name, email
ORDER BY comment_count DESC
  );
  
  
[0m23:37:21.322812 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m23:37:21.483476 [debug] [Thread-4 (]: SQL status: SELECT 236 in 0.161 seconds
[0m23:37:21.502602 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:37:21.503280 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: BEGIN
[0m23:37:21.504275 [debug] [Thread-4 (]: SQL status: BEGIN in 0.000 seconds
[0m23:37:21.504943 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:37:21.505492 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental__dbt_tmp233721298941'
        
      order by ordinal_position

  
[0m23:37:21.525941 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.020 seconds
[0m23:37:21.533800 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:37:21.534520 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m23:37:21.538751 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.004 seconds
[0m23:37:21.548493 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:37:21.549291 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m23:37:21.552982 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.003 seconds
[0m23:37:21.579317 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user_incremental"
[0m23:37:21.580727 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:37:21.582023 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      
        delete from "test_db"."public_marts"."comments_by_user_incremental" as DBT_INTERNAL_DEST
        where (name, email) in (
            select distinct name, email
            from "comments_by_user_incremental__dbt_tmp233721298941" as DBT_INTERNAL_SOURCE
        );

    

    insert into "test_db"."public_marts"."comments_by_user_incremental" ("name", "email", "comment_count", "movie_ids", "load_date")
    (
        select "name", "email", "comment_count", "movie_ids", "load_date"
        from "comments_by_user_incremental__dbt_tmp233721298941"
    )
  
[0m23:37:21.592437 [debug] [Thread-4 (]: SQL status: INSERT 0 236 in 0.010 seconds
[0m23:37:21.594988 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m23:37:21.595559 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:37:21.596112 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m23:37:21.601553 [debug] [Thread-4 (]: SQL status: COMMIT in 0.005 seconds
[0m23:37:21.603091 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m23:37:21.604046 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb183638-4f1a-4acb-9e9a-0bc1d2912c5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774927b40920>]}
[0m23:37:21.605066 [info ] [Thread-4 (]: 3 of 3 OK created sql incremental model public_marts.comments_by_user_incremental  [[32mINSERT 0 236[0m in 0.36s]
[0m23:37:21.606200 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m23:37:21.609463 [debug] [MainThread]: Using postgres connection "master"
[0m23:37:21.610044 [debug] [MainThread]: On master: BEGIN
[0m23:37:21.610747 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:37:21.624321 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m23:37:21.625128 [debug] [MainThread]: On master: COMMIT
[0m23:37:21.625647 [debug] [MainThread]: Using postgres connection "master"
[0m23:37:21.626175 [debug] [MainThread]: On master: COMMIT
[0m23:37:21.627066 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:37:21.627622 [debug] [MainThread]: On master: Close
[0m23:37:21.628479 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:37:21.629301 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m23:37:21.629896 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m23:37:21.630784 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m23:37:21.631692 [info ] [MainThread]: 
[0m23:37:21.633124 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 0.96 seconds (0.96s).
[0m23:37:21.635201 [debug] [MainThread]: Command end result
[0m23:37:21.671799 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:37:21.674144 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:37:21.681995 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m23:37:21.682627 [info ] [MainThread]: 
[0m23:37:21.683310 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:37:21.683960 [info ] [MainThread]: 
[0m23:37:21.684582 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m23:37:21.686018 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.4975035, "process_in_blocks": "8", "process_kernel_time": 0.690054, "process_mem_max_rss": "131032", "process_out_blocks": "2720", "process_user_time": 4.224543}
[0m23:37:21.686684 [debug] [MainThread]: Command `dbt run` succeeded at 23:37:21.686538 after 2.50 seconds
[0m23:37:21.687192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774924304e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774924305fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7749243051f0>]}
[0m23:37:21.687742 [debug] [MainThread]: Flushing usage events
[0m23:37:23.081994 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:42:11.319374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a5619ef530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a561967590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a563d71040>]}


============================== 23:42:11.324321 | 21a12e67-8292-4544-80c4-dcd05c7a85d8 ==============================
[0m23:42:11.324321 [info ] [MainThread]: Running with dbt=1.10.6
[0m23:42:11.325327 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'debug': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:42:11.619305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '21a12e67-8292-4544-80c4-dcd05c7a85d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a56201b0b0>]}
[0m23:42:11.740803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '21a12e67-8292-4544-80c4-dcd05c7a85d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a562233fe0>]}
[0m23:42:11.741968 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:42:11.892410 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m23:42:12.042467 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:42:12.043331 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user_incremental.sql
[0m23:42:12.547431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '21a12e67-8292-4544-80c4-dcd05c7a85d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a55f3f8e30>]}
[0m23:42:12.658148 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:42:12.660567 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:42:12.677264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '21a12e67-8292-4544-80c4-dcd05c7a85d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a55f735340>]}
[0m23:42:12.678112 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m23:42:12.678746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '21a12e67-8292-4544-80c4-dcd05c7a85d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a55f3e7f20>]}
[0m23:42:12.681652 [info ] [MainThread]: 
[0m23:42:12.682540 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:42:12.683257 [info ] [MainThread]: 
[0m23:42:12.684239 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:42:12.690510 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:42:12.691914 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:42:12.753113 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:42:12.753793 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:42:12.754412 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:42:12.755043 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:42:12.755675 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:42:12.756283 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:42:12.774952 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.019 seconds
[0m23:42:12.775642 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.020 seconds
[0m23:42:12.777354 [debug] [ThreadPool]: On list_test_db: Close
[0m23:42:12.779741 [debug] [ThreadPool]: On list_test_db: Close
[0m23:42:12.783523 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m23:42:12.784412 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m23:42:12.792687 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:42:12.795668 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:42:12.796731 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m23:42:12.797707 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m23:42:12.798502 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:42:12.799262 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:42:12.812048 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m23:42:12.812586 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m23:42:12.813199 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:42:12.813845 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:42:12.814477 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m23:42:12.815204 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m23:42:12.820392 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.004 seconds
[0m23:42:12.821018 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.005 seconds
[0m23:42:12.822885 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m23:42:12.825003 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m23:42:12.826087 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m23:42:12.827120 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m23:42:12.835390 [debug] [MainThread]: Using postgres connection "master"
[0m23:42:12.835992 [debug] [MainThread]: On master: BEGIN
[0m23:42:12.836457 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:42:12.850719 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m23:42:12.851258 [debug] [MainThread]: Using postgres connection "master"
[0m23:42:12.851771 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:42:12.860671 [debug] [MainThread]: SQL status: SELECT 3 in 0.008 seconds
[0m23:42:12.863018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '21a12e67-8292-4544-80c4-dcd05c7a85d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a560349880>]}
[0m23:42:12.863617 [debug] [MainThread]: On master: ROLLBACK
[0m23:42:12.864543 [debug] [MainThread]: Using postgres connection "master"
[0m23:42:12.865323 [debug] [MainThread]: On master: BEGIN
[0m23:42:12.866754 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:42:12.867219 [debug] [MainThread]: On master: COMMIT
[0m23:42:12.867723 [debug] [MainThread]: Using postgres connection "master"
[0m23:42:12.868160 [debug] [MainThread]: On master: COMMIT
[0m23:42:12.868945 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:42:12.869608 [debug] [MainThread]: On master: Close
[0m23:42:12.875203 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m23:42:12.875816 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m23:42:12.876662 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m23:42:12.877575 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m23:42:12.878461 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m23:42:12.879206 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_movies_directors)
[0m23:42:12.879927 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m23:42:12.880565 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m23:42:12.891873 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m23:42:12.894577 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m23:42:12.895888 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m23:42:12.896490 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m23:42:13.077853 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m23:42:13.082212 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m23:42:13.083639 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:42:13.084267 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:42:13.084824 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m23:42:13.085601 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m23:42:13.086215 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:42:13.086846 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:42:13.099600 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m23:42:13.100477 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:42:13.101003 [debug] [Thread-2 (]: SQL status: BEGIN in 0.014 seconds
[0m23:42:13.101608 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m23:42:13.102288 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:42:13.103099 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m23:42:13.107511 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m23:42:13.108334 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m23:42:13.117528 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:42:13.121541 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:42:13.122579 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m23:42:13.123261 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m23:42:13.125017 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:42:13.125683 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:42:13.129241 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:42:13.133660 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:42:13.134375 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m23:42:13.135080 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m23:42:13.136554 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:42:13.137117 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:42:13.166803 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:42:13.167598 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:42:13.168197 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:42:13.168887 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:42:13.169670 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:42:13.170378 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:42:13.177708 [debug] [Thread-2 (]: SQL status: COMMIT in 0.006 seconds
[0m23:42:13.184554 [debug] [Thread-1 (]: SQL status: COMMIT in 0.013 seconds
[0m23:42:13.187404 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m23:42:13.190742 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m23:42:13.198909 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:42:13.200859 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:42:13.201669 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m23:42:13.202800 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m23:42:13.208819 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.005 seconds
[0m23:42:13.212692 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m23:42:13.213665 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.009 seconds
[0m23:42:13.215530 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m23:42:13.218181 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '21a12e67-8292-4544-80c4-dcd05c7a85d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a563aca3f0>]}
[0m23:42:13.218980 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '21a12e67-8292-4544-80c4-dcd05c7a85d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a55f7012b0>]}
[0m23:42:13.220231 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.34s]
[0m23:42:13.221423 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.34s]
[0m23:42:13.222482 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m23:42:13.223309 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m23:42:13.225012 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m23:42:13.226335 [info ] [Thread-4 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m23:42:13.227136 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m23:42:13.227657 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m23:42:13.237064 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m23:42:13.238254 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m23:42:13.298622 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:42:13.299802 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

    
  
    

  create temporary table "comments_by_user_incremental__dbt_tmp234213275356"
  
  
    as
  
  (
    

WITH max_existing AS (
  
      SELECT max(load_date) AS max_load_date FROM "test_db"."public_marts"."comments_by_user_incremental"
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE c.load_date > coalesce(m.max_load_date, '1900-01-01')
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

final AS (
  
    SELECT * FROM "test_db"."public_marts"."comments_by_user_incremental"
    UNION ALL
    SELECT * FROM new_agg
  
),

flat AS (
  SELECT
    name,
    email,
    comment_count,
    unnest(movie_ids) AS movie_id,
    load_date
  FROM final
)


SELECT
  name,
  email,
  sum(comment_count) AS comment_count,
  array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
  max(load_date) AS load_date
FROM flat
GROUP BY name, email
ORDER BY comment_count DESC

  );
  
  
[0m23:42:13.300769 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m23:42:13.430108 [debug] [Thread-4 (]: SQL status: SELECT 236 in 0.129 seconds
[0m23:42:13.447663 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:42:13.448272 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: BEGIN
[0m23:42:13.449725 [debug] [Thread-4 (]: SQL status: BEGIN in 0.001 seconds
[0m23:42:13.450434 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:42:13.450958 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental__dbt_tmp234213275356'
        
      order by ordinal_position

  
[0m23:42:13.458081 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.006 seconds
[0m23:42:13.464702 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:42:13.465305 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m23:42:13.469492 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.003 seconds
[0m23:42:13.480531 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:42:13.481243 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m23:42:13.485630 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.004 seconds
[0m23:42:13.507742 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user_incremental"
[0m23:42:13.508702 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:42:13.509447 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      
        delete from "test_db"."public_marts"."comments_by_user_incremental" as DBT_INTERNAL_DEST
        where (name, email) in (
            select distinct name, email
            from "comments_by_user_incremental__dbt_tmp234213275356" as DBT_INTERNAL_SOURCE
        );

    

    insert into "test_db"."public_marts"."comments_by_user_incremental" ("name", "email", "comment_count", "movie_ids", "load_date")
    (
        select "name", "email", "comment_count", "movie_ids", "load_date"
        from "comments_by_user_incremental__dbt_tmp234213275356"
    )
  
[0m23:42:13.518190 [debug] [Thread-4 (]: SQL status: INSERT 0 236 in 0.008 seconds
[0m23:42:13.520290 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m23:42:13.520861 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:42:13.521453 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m23:42:13.526038 [debug] [Thread-4 (]: SQL status: COMMIT in 0.004 seconds
[0m23:42:13.527663 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m23:42:13.528540 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '21a12e67-8292-4544-80c4-dcd05c7a85d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a5607f4ec0>]}
[0m23:42:13.529479 [info ] [Thread-4 (]: 3 of 3 OK created sql incremental model public_marts.comments_by_user_incremental  [[32mINSERT 0 236[0m in 0.30s]
[0m23:42:13.530470 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m23:42:13.533780 [debug] [MainThread]: Using postgres connection "master"
[0m23:42:13.534426 [debug] [MainThread]: On master: BEGIN
[0m23:42:13.535035 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:42:13.548333 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m23:42:13.549277 [debug] [MainThread]: On master: COMMIT
[0m23:42:13.549881 [debug] [MainThread]: Using postgres connection "master"
[0m23:42:13.550455 [debug] [MainThread]: On master: COMMIT
[0m23:42:13.551297 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:42:13.551836 [debug] [MainThread]: On master: Close
[0m23:42:13.552973 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:42:13.553859 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m23:42:13.554443 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m23:42:13.555003 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m23:42:13.555750 [info ] [MainThread]: 
[0m23:42:13.556489 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 0.87 seconds (0.87s).
[0m23:42:13.558314 [debug] [MainThread]: Command end result
[0m23:42:13.588745 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:42:13.591510 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:42:13.599242 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m23:42:13.599919 [info ] [MainThread]: 
[0m23:42:13.600718 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:42:13.601565 [info ] [MainThread]: 
[0m23:42:13.602297 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m23:42:13.603644 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.396073, "process_in_blocks": "0", "process_kernel_time": 0.752804, "process_mem_max_rss": "131304", "process_out_blocks": "2720", "process_user_time": 4.065142}
[0m23:42:13.604344 [debug] [MainThread]: Command `dbt run` succeeded at 23:42:13.604184 after 2.40 seconds
[0m23:42:13.604847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a561965370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a561a8d5e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a560349bb0>]}
[0m23:42:13.605499 [debug] [MainThread]: Flushing usage events
[0m23:42:14.858717 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:53:28.696480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca683b196a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca68561a4b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca6833fa2d0>]}


============================== 23:53:28.704578 | 00faac4a-25cd-4bc3-be63-740bc0a28e92 ==============================
[0m23:53:28.704578 [info ] [MainThread]: Running with dbt=1.10.6
[0m23:53:28.705501 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:53:29.118208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '00faac4a-25cd-4bc3-be63-740bc0a28e92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca68259ea80>]}
[0m23:53:29.259226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '00faac4a-25cd-4bc3-be63-740bc0a28e92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca6833fa360>]}
[0m23:53:29.264204 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:53:29.426784 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m23:53:29.649180 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:53:29.649920 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:53:29.695297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '00faac4a-25cd-4bc3-be63-740bc0a28e92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca6821ee6c0>]}
[0m23:53:29.794494 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:53:29.799126 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:53:29.834474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '00faac4a-25cd-4bc3-be63-740bc0a28e92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca681105d00>]}
[0m23:53:29.835167 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m23:53:29.835824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '00faac4a-25cd-4bc3-be63-740bc0a28e92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca6821d6660>]}
[0m23:53:29.838086 [info ] [MainThread]: 
[0m23:53:29.838661 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:53:29.839156 [info ] [MainThread]: 
[0m23:53:29.840240 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:53:29.846182 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:53:29.847264 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:53:29.922168 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:53:29.922972 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:53:29.923933 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:53:29.924742 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:53:29.925342 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:53:29.925996 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:53:29.966506 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.041 seconds
[0m23:53:29.968053 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.042 seconds
[0m23:53:29.969703 [debug] [ThreadPool]: On list_test_db: Close
[0m23:53:29.972008 [debug] [ThreadPool]: On list_test_db: Close
[0m23:53:29.975413 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m23:53:29.981924 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m23:53:29.989883 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:53:29.990841 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:53:29.991944 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m23:53:29.992586 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m23:53:29.993251 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:53:29.993909 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:53:30.007957 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m23:53:30.008986 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:53:30.009691 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m23:53:30.010238 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m23:53:30.010803 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:53:30.011634 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m23:53:30.019563 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.008 seconds
[0m23:53:30.020190 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.008 seconds
[0m23:53:30.021962 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m23:53:30.023778 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m23:53:30.024690 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m23:53:30.025180 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m23:53:30.033171 [debug] [MainThread]: Using postgres connection "master"
[0m23:53:30.033815 [debug] [MainThread]: On master: BEGIN
[0m23:53:30.034437 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:53:30.046755 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m23:53:30.047314 [debug] [MainThread]: Using postgres connection "master"
[0m23:53:30.048034 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:53:30.056305 [debug] [MainThread]: SQL status: SELECT 3 in 0.008 seconds
[0m23:53:30.058029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '00faac4a-25cd-4bc3-be63-740bc0a28e92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca68252b350>]}
[0m23:53:30.058651 [debug] [MainThread]: On master: ROLLBACK
[0m23:53:30.059763 [debug] [MainThread]: Using postgres connection "master"
[0m23:53:30.060515 [debug] [MainThread]: On master: BEGIN
[0m23:53:30.061599 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:53:30.062062 [debug] [MainThread]: On master: COMMIT
[0m23:53:30.062528 [debug] [MainThread]: Using postgres connection "master"
[0m23:53:30.062958 [debug] [MainThread]: On master: COMMIT
[0m23:53:30.063837 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:53:30.064309 [debug] [MainThread]: On master: Close
[0m23:53:30.073676 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m23:53:30.074393 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m23:53:30.075123 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m23:53:30.076209 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m23:53:30.077109 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m23:53:30.077801 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_movies_directors)
[0m23:53:30.078441 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m23:53:30.079094 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m23:53:40.842550 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m23:53:40.845054 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m23:53:40.846298 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m23:53:40.846868 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m23:53:40.927428 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m23:53:40.930199 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m23:53:40.931725 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:53:40.932441 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:53:40.933070 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m23:53:40.933876 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m23:53:40.934745 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:53:40.935481 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:53:40.947892 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m23:53:40.948474 [debug] [Thread-2 (]: SQL status: BEGIN in 0.013 seconds
[0m23:53:40.949145 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:53:40.949934 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:53:40.950641 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m23:53:40.951475 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m23:53:40.956739 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m23:53:40.957317 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m23:53:40.965487 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:53:40.969897 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:53:40.970598 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m23:53:40.971291 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m23:53:40.973837 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:53:40.974382 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:53:40.977691 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:53:40.981986 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:53:40.983059 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m23:53:40.984293 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m23:53:40.985910 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:53:40.986486 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:53:41.030902 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:53:41.032917 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:53:41.033760 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:53:41.035225 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:53:41.035927 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:53:41.036629 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:53:41.043025 [debug] [Thread-2 (]: SQL status: COMMIT in 0.006 seconds
[0m23:53:41.049857 [debug] [Thread-1 (]: SQL status: COMMIT in 0.012 seconds
[0m23:53:30.297696 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m23:53:30.301761 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m23:53:30.316112 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:53:30.317724 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:53:30.318424 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m23:53:30.319173 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m23:53:30.324583 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m23:53:30.328823 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m23:53:30.329569 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.010 seconds
[0m23:53:30.333147 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m23:53:30.340602 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '00faac4a-25cd-4bc3-be63-740bc0a28e92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca68550a960>]}
[0m23:53:30.341993 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '00faac4a-25cd-4bc3-be63-740bc0a28e92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca67f5777a0>]}
[0m23:53:30.342980 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.26s]
[0m23:53:30.344100 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.26s]
[0m23:53:30.345717 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m23:53:30.346604 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m23:53:30.348174 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m23:53:30.348969 [info ] [Thread-4 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m23:53:30.349854 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m23:53:30.350370 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m23:53:30.363564 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m23:53:30.364683 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m23:53:30.426364 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user_incremental"
[0m23:53:30.427546 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:53:30.428249 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: BEGIN
[0m23:53:30.428918 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m23:53:30.442404 [debug] [Thread-4 (]: SQL status: BEGIN in 0.013 seconds
[0m23:53:30.443098 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:53:30.443897 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      
  
    

  create  table "test_db"."public_marts"."comments_by_user_incremental"
  
  
    as
  
  (
    

WITH max_existing AS (
  
      SELECT null::timestamp AS max_load_date
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE c.load_date > coalesce(m.max_load_date, '1900-01-01')
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

final AS (
  
    SELECT * FROM new_agg
  
),

flat AS (
  SELECT
    name,
    email,
    comment_count,
    unnest(movie_ids) AS movie_id,
    load_date
  FROM final
)


SELECT * FROM new_agg

  );
  
  
[0m23:53:30.640081 [debug] [Thread-4 (]: SQL status: SELECT 236 in 0.196 seconds
[0m23:53:30.648287 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m23:53:30.649088 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:53:30.649676 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m23:53:30.657996 [debug] [Thread-4 (]: SQL status: COMMIT in 0.008 seconds
[0m23:53:30.659030 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m23:53:30.660039 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '00faac4a-25cd-4bc3-be63-740bc0a28e92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca67f4d1b50>]}
[0m23:53:30.661165 [info ] [Thread-4 (]: 3 of 3 OK created sql incremental model public_marts.comments_by_user_incremental  [[32mSELECT 236[0m in 0.31s]
[0m23:53:30.662384 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m23:53:30.665745 [debug] [MainThread]: Using postgres connection "master"
[0m23:53:30.666510 [debug] [MainThread]: On master: BEGIN
[0m23:53:30.667145 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:53:30.680570 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m23:53:30.681298 [debug] [MainThread]: On master: COMMIT
[0m23:53:30.681876 [debug] [MainThread]: Using postgres connection "master"
[0m23:53:30.682449 [debug] [MainThread]: On master: COMMIT
[0m23:53:30.683290 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:53:30.683822 [debug] [MainThread]: On master: Close
[0m23:53:30.684681 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:53:30.685408 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m23:53:30.685938 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m23:53:30.686521 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m23:53:30.687287 [info ] [MainThread]: 
[0m23:53:30.687879 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 0.85 seconds (0.85s).
[0m23:53:30.689453 [debug] [MainThread]: Command end result
[0m23:53:30.716527 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:53:30.719207 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:53:30.727098 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m23:53:30.727752 [info ] [MainThread]: 
[0m23:53:30.728556 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:53:30.729296 [info ] [MainThread]: 
[0m23:53:30.729982 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m23:53:30.732025 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.1598907, "process_in_blocks": "89768", "process_kernel_time": 0.890447, "process_mem_max_rss": "127060", "process_out_blocks": "1856", "process_user_time": 3.639396}
[0m23:53:30.732713 [debug] [MainThread]: Command `dbt run` succeeded at 23:53:30.732557 after 2.16 seconds
[0m23:53:30.733377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca6833ce510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca683763f80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca6830099a0>]}
[0m23:53:30.733898 [debug] [MainThread]: Flushing usage events
[0m23:53:32.168092 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:54:36.021806 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe285a80dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe285a81130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe285a80c50>]}


============================== 23:54:36.029771 | 2175c1df-ba79-417b-a03d-a0d52a4fe655 ==============================
[0m23:54:36.029771 [info ] [MainThread]: Running with dbt=1.10.6
[0m23:54:36.030607 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:54:25.683228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2175c1df-ba79-417b-a03d-a0d52a4fe655', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe2855d4fb0>]}
[0m23:54:25.845066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2175c1df-ba79-417b-a03d-a0d52a4fe655', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe286ade3f0>]}
[0m23:54:25.850003 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:54:26.005641 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m23:54:26.202389 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:54:26.203014 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:54:26.248082 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2175c1df-ba79-417b-a03d-a0d52a4fe655', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe284d47380>]}
[0m23:54:26.359645 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:54:26.362604 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:54:26.397624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2175c1df-ba79-417b-a03d-a0d52a4fe655', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe2841220c0>]}
[0m23:54:26.398443 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m23:54:26.399042 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2175c1df-ba79-417b-a03d-a0d52a4fe655', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe2851f96d0>]}
[0m23:54:26.402118 [info ] [MainThread]: 
[0m23:54:26.402837 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:54:26.403358 [info ] [MainThread]: 
[0m23:54:26.404234 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:54:26.410994 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:54:26.421338 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:54:26.498255 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:54:26.498918 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:54:26.499836 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:54:26.500740 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:54:26.501415 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:54:26.502046 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:54:26.541644 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.040 seconds
[0m23:54:26.543649 [debug] [ThreadPool]: On list_test_db: Close
[0m23:54:26.544195 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.042 seconds
[0m23:54:26.546402 [debug] [ThreadPool]: On list_test_db: Close
[0m23:54:26.548975 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m23:54:26.550258 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m23:54:26.562299 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:54:26.565956 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:54:26.566824 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m23:54:26.567832 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m23:54:26.568627 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:54:26.569195 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:54:26.583831 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m23:54:26.584714 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m23:54:26.585371 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:54:26.585936 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:54:26.586545 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m23:54:26.587174 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m23:54:26.592935 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.005 seconds
[0m23:54:26.593548 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.006 seconds
[0m23:54:26.595256 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m23:54:26.597006 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m23:54:26.598111 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m23:54:26.598626 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m23:54:26.606746 [debug] [MainThread]: Using postgres connection "master"
[0m23:54:26.607405 [debug] [MainThread]: On master: BEGIN
[0m23:54:26.607877 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:54:26.621274 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m23:54:26.621988 [debug] [MainThread]: Using postgres connection "master"
[0m23:54:26.622789 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:54:26.632126 [debug] [MainThread]: SQL status: SELECT 3 in 0.008 seconds
[0m23:54:26.634617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2175c1df-ba79-417b-a03d-a0d52a4fe655', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe2841a79b0>]}
[0m23:54:26.635500 [debug] [MainThread]: On master: ROLLBACK
[0m23:54:26.636492 [debug] [MainThread]: Using postgres connection "master"
[0m23:54:26.636987 [debug] [MainThread]: On master: BEGIN
[0m23:54:26.638021 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:54:26.638473 [debug] [MainThread]: On master: COMMIT
[0m23:54:26.638934 [debug] [MainThread]: Using postgres connection "master"
[0m23:54:26.639393 [debug] [MainThread]: On master: COMMIT
[0m23:54:26.640264 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:54:26.640992 [debug] [MainThread]: On master: Close
[0m23:54:26.654818 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m23:54:26.655691 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m23:54:26.656658 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m23:54:26.658121 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m23:54:26.659257 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m23:54:26.660181 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_movies_directors)
[0m23:54:26.661378 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m23:54:26.662041 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m23:54:26.675914 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m23:54:26.680009 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m23:54:26.682498 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m23:54:26.688830 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m23:54:26.789015 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m23:54:26.789880 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m23:54:26.791308 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:54:26.791939 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:54:26.792589 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m23:54:26.793510 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m23:54:26.794444 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:54:26.795085 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:54:26.810049 [debug] [Thread-2 (]: SQL status: BEGIN in 0.015 seconds
[0m23:54:26.811355 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:54:26.812107 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m23:54:26.812739 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m23:54:26.813394 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:54:26.814293 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m23:54:26.819227 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m23:54:26.820069 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m23:54:26.829853 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:54:26.834808 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:54:26.835639 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m23:54:26.836325 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m23:54:26.838780 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:54:26.839888 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m23:54:26.846508 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:54:26.852399 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:54:26.853418 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m23:54:26.854156 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m23:54:26.855499 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:54:26.856058 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:54:26.884394 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:54:26.885190 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:54:26.885905 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:54:26.886567 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:54:26.887211 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:54:26.887875 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:54:26.896775 [debug] [Thread-1 (]: SQL status: COMMIT in 0.008 seconds
[0m23:54:26.897323 [debug] [Thread-2 (]: SQL status: COMMIT in 0.009 seconds
[0m23:54:26.906022 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m23:54:26.909530 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m23:54:26.918493 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:54:26.919840 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:54:26.920619 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m23:54:26.921332 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m23:54:26.924551 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.002 seconds
[0m23:54:26.927694 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m23:54:26.928662 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.006 seconds
[0m23:54:26.930821 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m23:54:26.933790 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2175c1df-ba79-417b-a03d-a0d52a4fe655', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe286b0e630>]}
[0m23:54:26.934492 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2175c1df-ba79-417b-a03d-a0d52a4fe655', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe28246fe30>]}
[0m23:54:26.935583 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.27s]
[0m23:54:26.936808 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.27s]
[0m23:54:26.937840 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m23:54:26.938761 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m23:54:26.941162 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m23:54:26.941958 [info ] [Thread-4 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m23:54:26.942977 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m23:54:26.943585 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m23:54:26.959100 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m23:54:26.960685 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m23:54:27.017082 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:54:27.018058 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

    
  
    

  create temporary table "comments_by_user_incremental__dbt_tmp235426997374"
  
  
    as
  
  (
    

WITH max_existing AS (
  
      SELECT max(load_date) AS max_load_date FROM "test_db"."public_marts"."comments_by_user_incremental"
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE c.load_date > coalesce(m.max_load_date, '1900-01-01')
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

final AS (
  
    SELECT * FROM "test_db"."public_marts"."comments_by_user_incremental"
    UNION ALL
    SELECT * FROM new_agg
  
),

flat AS (
  SELECT
    name,
    email,
    comment_count,
    unnest(movie_ids) AS movie_id,
    load_date
  FROM final
)


SELECT
  name,
  email,
  sum(comment_count) AS comment_count,
  array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
  max(load_date) AS load_date
FROM flat
GROUP BY name, email
ORDER BY comment_count DESC

  );
  
  
[0m23:54:27.018799 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m23:54:27.119709 [debug] [Thread-4 (]: SQL status: SELECT 236 in 0.101 seconds
[0m23:54:27.142005 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:54:27.142766 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: BEGIN
[0m23:54:27.143832 [debug] [Thread-4 (]: SQL status: BEGIN in 0.000 seconds
[0m23:54:27.144466 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:54:27.145015 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental__dbt_tmp235426997374'
        
      order by ordinal_position

  
[0m23:54:27.152233 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.007 seconds
[0m23:54:27.163615 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:54:27.164409 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m23:54:27.168450 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.003 seconds
[0m23:54:27.178831 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:54:27.179579 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m23:54:27.183482 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.003 seconds
[0m23:54:27.205732 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user_incremental"
[0m23:54:27.206785 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:54:27.207381 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      
        delete from "test_db"."public_marts"."comments_by_user_incremental" as DBT_INTERNAL_DEST
        where (name, email) in (
            select distinct name, email
            from "comments_by_user_incremental__dbt_tmp235426997374" as DBT_INTERNAL_SOURCE
        );

    

    insert into "test_db"."public_marts"."comments_by_user_incremental" ("name", "email", "comment_count", "movie_ids", "load_date")
    (
        select "name", "email", "comment_count", "movie_ids", "load_date"
        from "comments_by_user_incremental__dbt_tmp235426997374"
    )
  
[0m23:54:27.218681 [debug] [Thread-4 (]: SQL status: INSERT 0 236 in 0.011 seconds
[0m23:54:27.221384 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m23:54:27.221979 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:54:27.222565 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m23:54:27.228859 [debug] [Thread-4 (]: SQL status: COMMIT in 0.006 seconds
[0m23:54:27.230078 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m23:54:27.231040 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2175c1df-ba79-417b-a03d-a0d52a4fe655', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe282483590>]}
[0m23:54:27.232014 [info ] [Thread-4 (]: 3 of 3 OK created sql incremental model public_marts.comments_by_user_incremental  [[32mINSERT 0 236[0m in 0.29s]
[0m23:54:27.232999 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m23:54:27.236129 [debug] [MainThread]: Using postgres connection "master"
[0m23:54:27.236834 [debug] [MainThread]: On master: BEGIN
[0m23:54:27.237311 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:54:27.251830 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m23:54:27.252598 [debug] [MainThread]: On master: COMMIT
[0m23:54:27.253230 [debug] [MainThread]: Using postgres connection "master"
[0m23:54:27.253700 [debug] [MainThread]: On master: COMMIT
[0m23:54:27.254543 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:54:27.255028 [debug] [MainThread]: On master: Close
[0m23:54:27.255844 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:54:27.256367 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m23:54:27.256822 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m23:54:27.257259 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m23:54:27.257920 [info ] [MainThread]: 
[0m23:54:27.258604 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 0.85 seconds (0.85s).
[0m23:54:27.260044 [debug] [MainThread]: Command end result
[0m23:54:27.288778 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:54:27.291166 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:54:27.299126 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m23:54:27.299697 [info ] [MainThread]: 
[0m23:54:27.300665 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:54:27.301287 [info ] [MainThread]: 
[0m23:54:27.301950 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m23:54:27.303904 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.182114, "process_in_blocks": "90640", "process_kernel_time": 0.842155, "process_mem_max_rss": "127688", "process_out_blocks": "1872", "process_user_time": 3.67375}
[0m23:54:27.304619 [debug] [MainThread]: Command `dbt run` succeeded at 23:54:27.304463 after 2.18 seconds
[0m23:54:27.305194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe282581280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe285c50e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe285c50f50>]}
[0m23:54:27.305735 [debug] [MainThread]: Flushing usage events
[0m23:54:28.499088 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:07:18.390665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x716014b862a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7160148694c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71601443af60>]}


============================== 00:07:18.397634 | e88e64ab-cd85-4469-bdac-c9a9754c79f9 ==============================
[0m00:07:18.397634 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:07:18.398685 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'version_check': 'True', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:07:18.818967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e88e64ab-cd85-4469-bdac-c9a9754c79f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x716014e3dc40>]}
[0m00:07:18.963980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e88e64ab-cd85-4469-bdac-c9a9754c79f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7160167820f0>]}
[0m00:07:18.965752 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:07:19.138224 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:07:19.368703 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:07:19.369620 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user_incremental.sql
[0m00:07:19.917639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e88e64ab-cd85-4469-bdac-c9a9754c79f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71601399b590>]}
[0m00:07:20.013527 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:07:20.017106 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:07:20.052403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e88e64ab-cd85-4469-bdac-c9a9754c79f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7160129ae120>]}
[0m00:07:20.053174 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m00:07:20.053743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e88e64ab-cd85-4469-bdac-c9a9754c79f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x716015ed27e0>]}
[0m00:07:20.056187 [info ] [MainThread]: 
[0m00:07:20.056817 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:07:20.057354 [info ] [MainThread]: 
[0m00:07:20.058159 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:07:20.063782 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:07:20.065035 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:07:20.151290 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:07:20.152208 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:07:20.153118 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:07:20.153942 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:07:20.154712 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:07:20.155371 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:07:20.188168 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.033 seconds
[0m00:07:20.188834 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.033 seconds
[0m00:07:20.190457 [debug] [ThreadPool]: On list_test_db: Close
[0m00:07:20.192761 [debug] [ThreadPool]: On list_test_db: Close
[0m00:07:20.196579 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m00:07:20.197514 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m00:07:20.206277 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:07:20.209422 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:07:20.210295 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m00:07:20.211119 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m00:07:20.211757 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:07:20.212348 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:07:20.225786 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m00:07:20.226322 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m00:07:20.226937 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:07:20.227711 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:07:20.228362 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m00:07:20.228977 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m00:07:20.237808 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.008 seconds
[0m00:07:20.238514 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.009 seconds
[0m00:07:20.240489 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m00:07:20.242047 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m00:07:20.242990 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m00:07:20.244100 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m00:07:20.251277 [debug] [MainThread]: Using postgres connection "master"
[0m00:07:20.251991 [debug] [MainThread]: On master: BEGIN
[0m00:07:20.252548 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:07:20.267547 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:07:20.268117 [debug] [MainThread]: Using postgres connection "master"
[0m00:07:20.268840 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:07:20.277387 [debug] [MainThread]: SQL status: SELECT 3 in 0.008 seconds
[0m00:07:20.279174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e88e64ab-cd85-4469-bdac-c9a9754c79f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x716010b5b050>]}
[0m00:07:20.279809 [debug] [MainThread]: On master: ROLLBACK
[0m00:07:20.280611 [debug] [MainThread]: Using postgres connection "master"
[0m00:07:20.281104 [debug] [MainThread]: On master: BEGIN
[0m00:07:20.282140 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:07:20.282633 [debug] [MainThread]: On master: COMMIT
[0m00:07:20.283156 [debug] [MainThread]: Using postgres connection "master"
[0m00:07:20.283592 [debug] [MainThread]: On master: COMMIT
[0m00:07:20.284349 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:07:20.284825 [debug] [MainThread]: On master: Close
[0m00:07:20.302931 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:07:20.304063 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m00:07:20.304924 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m00:07:20.305808 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m00:07:20.306701 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m00:07:20.307548 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_movies_directors)
[0m00:07:20.308290 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:07:20.309035 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m00:07:20.321483 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:07:20.324947 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m00:07:20.326346 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:07:20.326975 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m00:07:20.509483 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m00:07:20.512620 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m00:07:20.514088 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:07:20.514764 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:07:20.515512 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m00:07:20.516183 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m00:07:20.516851 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:07:20.517590 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m00:07:20.531822 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m00:07:20.532578 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:07:20.533202 [debug] [Thread-2 (]: SQL status: BEGIN in 0.016 seconds
[0m00:07:20.533804 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m00:07:20.534476 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:07:20.535410 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m00:07:20.543687 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m00:07:20.552089 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:07:20.552902 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m00:07:20.553755 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.019 seconds
[0m00:07:20.557427 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:07:20.558053 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m00:07:20.558898 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m00:07:20.559827 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:07:20.563196 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:07:20.567272 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:07:20.568220 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m00:07:20.569263 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m00:07:20.570548 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:07:20.571228 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:07:20.599563 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m00:07:20.600371 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:07:20.600993 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:07:20.601662 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:07:20.602830 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m00:07:20.603678 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:07:20.610232 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m00:07:20.610773 [debug] [Thread-2 (]: SQL status: COMMIT in 0.006 seconds
[0m00:07:20.619854 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m00:07:20.622941 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m00:07:20.632923 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:07:20.634504 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:07:20.635208 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m00:07:20.636228 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m00:07:20.642674 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.005 seconds
[0m00:07:20.646140 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m00:07:20.646707 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.010 seconds
[0m00:07:20.648575 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m00:07:20.651483 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e88e64ab-cd85-4469-bdac-c9a9754c79f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x716010214740>]}
[0m00:07:20.652155 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e88e64ab-cd85-4469-bdac-c9a9754c79f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7160142f7110>]}
[0m00:07:20.653595 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.34s]
[0m00:07:20.654757 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.34s]
[0m00:07:20.655891 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m00:07:20.656777 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:07:20.658861 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m00:07:20.660045 [info ] [Thread-4 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m00:07:20.660835 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m00:07:20.661442 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m00:07:20.671262 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m00:07:20.672671 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m00:07:20.731211 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:07:20.731941 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

    
  
    

  create temporary table "comments_by_user_incremental__dbt_tmp000720710847"
  
  
    as
  
  (
    

WITH max_existing AS (
  
      SELECT max(load_date AT TIME ZONE 'UTC') AS max_load_date
      FROM "test_db"."public_marts"."comments_by_user_incremental"
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE (c.load_date AT TIME ZONE 'UTC') > coalesce(m.max_load_date, '1900-01-01'::timestamp)
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

final AS (
  
    SELECT * FROM "test_db"."public_marts"."comments_by_user_incremental"
    UNION ALL
    SELECT * FROM new_agg
  
),

flat AS (
  SELECT
    name,
    email,
    comment_count,
    unnest(movie_ids) AS movie_id,
    load_date
  FROM final
)


SELECT
  name,
  email,
  sum(comment_count) AS comment_count,
  array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
  max(load_date) AS load_date
FROM flat
GROUP BY name, email
ORDER BY comment_count DESC

  );
  
  
[0m00:07:20.732529 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m00:07:20.870542 [debug] [Thread-4 (]: SQL status: SELECT 236 in 0.138 seconds
[0m00:07:20.888467 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:07:20.889277 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: BEGIN
[0m00:07:20.890232 [debug] [Thread-4 (]: SQL status: BEGIN in 0.000 seconds
[0m00:07:20.890799 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:07:20.891458 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental__dbt_tmp000720710847'
        
      order by ordinal_position

  
[0m00:07:20.898460 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.006 seconds
[0m00:07:20.908945 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:07:20.909633 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m00:07:20.913240 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.003 seconds
[0m00:07:20.923959 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:07:20.924606 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m00:07:20.928724 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.003 seconds
[0m00:07:20.950952 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user_incremental"
[0m00:07:20.951964 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:07:20.952609 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      
        delete from "test_db"."public_marts"."comments_by_user_incremental" as DBT_INTERNAL_DEST
        where (name, email) in (
            select distinct name, email
            from "comments_by_user_incremental__dbt_tmp000720710847" as DBT_INTERNAL_SOURCE
        );

    

    insert into "test_db"."public_marts"."comments_by_user_incremental" ("name", "email", "comment_count", "movie_ids", "load_date")
    (
        select "name", "email", "comment_count", "movie_ids", "load_date"
        from "comments_by_user_incremental__dbt_tmp000720710847"
    )
  
[0m00:07:20.962850 [debug] [Thread-4 (]: SQL status: INSERT 0 236 in 0.009 seconds
[0m00:07:20.965255 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m00:07:20.965788 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:07:20.966398 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m00:07:20.970008 [debug] [Thread-4 (]: SQL status: COMMIT in 0.003 seconds
[0m00:07:20.971466 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m00:07:20.972401 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e88e64ab-cd85-4469-bdac-c9a9754c79f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71601425d1c0>]}
[0m00:07:20.973291 [info ] [Thread-4 (]: 3 of 3 OK created sql incremental model public_marts.comments_by_user_incremental  [[32mINSERT 0 236[0m in 0.31s]
[0m00:07:20.974313 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m00:07:20.977294 [debug] [MainThread]: Using postgres connection "master"
[0m00:07:20.977763 [debug] [MainThread]: On master: BEGIN
[0m00:07:20.978349 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:07:20.992973 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:07:20.993802 [debug] [MainThread]: On master: COMMIT
[0m00:07:20.994279 [debug] [MainThread]: Using postgres connection "master"
[0m00:07:20.994773 [debug] [MainThread]: On master: COMMIT
[0m00:07:20.995635 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:07:20.996178 [debug] [MainThread]: On master: Close
[0m00:07:20.997024 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:07:20.997489 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m00:07:20.997875 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:07:20.998376 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m00:07:20.998895 [info ] [MainThread]: 
[0m00:07:20.999631 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 0.94 seconds (0.94s).
[0m00:07:21.000898 [debug] [MainThread]: Command end result
[0m00:07:21.033205 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:07:21.035776 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:07:21.043855 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:07:21.044443 [info ] [MainThread]: 
[0m00:07:21.045086 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:07:21.045676 [info ] [MainThread]: 
[0m00:07:21.046249 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m00:07:21.048532 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.7692192, "process_in_blocks": "89800", "process_kernel_time": 0.929794, "process_mem_max_rss": "130796", "process_out_blocks": "2720", "process_user_time": 4.252206}
[0m00:07:21.049197 [debug] [MainThread]: Command `dbt run` succeeded at 00:07:21.049046 after 2.77 seconds
[0m00:07:21.049741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7160144c1ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7160150b7080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x716013df57c0>]}
[0m00:07:21.050346 [debug] [MainThread]: Flushing usage events
[0m00:07:22.586934 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:14:10.101336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744543fc2b70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744543ce1d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7445441ddbb0>]}


============================== 00:14:10.108059 | c2358bcc-0d14-402f-a52a-929529d7c6db ==============================
[0m00:14:10.108059 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:14:10.108826 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:14:10.511617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c2358bcc-0d14-402f-a52a-929529d7c6db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744543124bc0>]}
[0m00:14:10.635496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c2358bcc-0d14-402f-a52a-929529d7c6db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744545f3d4f0>]}
[0m00:14:10.640745 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:14:10.809916 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:14:11.022366 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:14:11.023429 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user_incremental.sql
[0m00:14:11.512892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c2358bcc-0d14-402f-a52a-929529d7c6db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74454196d310>]}
[0m00:14:11.610925 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:14:11.615700 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:14:11.645974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c2358bcc-0d14-402f-a52a-929529d7c6db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744541d01d00>]}
[0m00:14:11.646749 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m00:14:11.647621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c2358bcc-0d14-402f-a52a-929529d7c6db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74454194d3d0>]}
[0m00:14:11.650827 [info ] [MainThread]: 
[0m00:14:11.651647 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:14:11.652231 [info ] [MainThread]: 
[0m00:14:11.653159 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:14:11.660698 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:14:11.667717 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:14:11.756603 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:14:11.757412 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:14:11.758224 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:14:11.758823 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:14:11.759417 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:14:11.760001 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:14:11.802360 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.043 seconds
[0m00:14:11.803095 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.043 seconds
[0m00:14:11.805005 [debug] [ThreadPool]: On list_test_db: Close
[0m00:14:11.806896 [debug] [ThreadPool]: On list_test_db: Close
[0m00:14:11.810968 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m00:14:11.812365 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m00:14:11.821292 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:14:11.823867 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:14:11.824484 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m00:14:11.825074 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m00:14:11.825622 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:14:11.826349 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:14:11.839343 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m00:14:11.840045 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m00:14:11.840731 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:14:11.841344 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:14:11.842041 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m00:14:11.842637 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m00:14:11.851349 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.008 seconds
[0m00:14:11.852097 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.009 seconds
[0m00:14:11.853950 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m00:14:11.855476 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m00:14:11.856337 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m00:14:11.856820 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m00:14:11.865262 [debug] [MainThread]: Using postgres connection "master"
[0m00:14:11.866031 [debug] [MainThread]: On master: BEGIN
[0m00:14:11.866597 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:14:11.879853 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m00:14:11.880463 [debug] [MainThread]: Using postgres connection "master"
[0m00:14:11.881069 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:14:11.889438 [debug] [MainThread]: SQL status: SELECT 3 in 0.008 seconds
[0m00:14:11.891632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c2358bcc-0d14-402f-a52a-929529d7c6db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744544bd93a0>]}
[0m00:14:11.892292 [debug] [MainThread]: On master: ROLLBACK
[0m00:14:11.893106 [debug] [MainThread]: Using postgres connection "master"
[0m00:14:11.893565 [debug] [MainThread]: On master: BEGIN
[0m00:14:11.894716 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:14:11.895498 [debug] [MainThread]: On master: COMMIT
[0m00:14:11.895993 [debug] [MainThread]: Using postgres connection "master"
[0m00:14:11.896446 [debug] [MainThread]: On master: COMMIT
[0m00:14:11.897140 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:14:11.897842 [debug] [MainThread]: On master: Close
[0m00:14:11.907002 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:14:11.907690 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m00:14:11.908620 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m00:14:11.909621 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m00:14:11.910723 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m00:14:11.911363 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_movies_directors)
[0m00:14:11.911982 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:14:11.912576 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m00:14:22.713719 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:14:22.716498 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m00:14:22.717942 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:14:22.718576 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m00:14:22.895198 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m00:14:22.896043 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m00:14:22.897492 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:14:22.898217 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:14:22.898871 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m00:14:22.899584 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m00:14:22.900236 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m00:14:22.900956 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:14:22.914965 [debug] [Thread-2 (]: SQL status: BEGIN in 0.015 seconds
[0m00:14:22.915828 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:14:22.916626 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m00:14:22.917376 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m00:14:22.918267 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:14:22.918969 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m00:14:22.924129 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m00:14:22.925077 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m00:14:22.933254 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:14:22.937152 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:14:22.938008 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m00:14:22.939045 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m00:14:22.941457 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m00:14:22.942301 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m00:14:22.945914 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:14:22.949581 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:14:22.950367 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m00:14:22.951059 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m00:14:22.952416 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:14:22.953097 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:14:12.214973 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m00:14:12.216023 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:14:12.217414 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:14:12.218025 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m00:14:12.218727 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:14:12.219569 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:14:12.226549 [debug] [Thread-2 (]: SQL status: COMMIT in 0.007 seconds
[0m00:14:12.236781 [debug] [Thread-1 (]: SQL status: COMMIT in 0.016 seconds
[0m00:14:12.239097 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m00:14:12.242479 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m00:14:12.254381 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:14:12.255863 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:14:12.256655 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m00:14:12.257452 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m00:14:12.282148 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.024 seconds
[0m00:14:12.287035 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m00:14:12.288071 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.030 seconds
[0m00:14:12.290974 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m00:14:12.297323 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2358bcc-0d14-402f-a52a-929529d7c6db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74453bd52c60>]}
[0m00:14:12.298064 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2358bcc-0d14-402f-a52a-929529d7c6db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7445447027e0>]}
[0m00:14:12.299373 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.38s]
[0m00:14:12.300876 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.39s]
[0m00:14:12.302265 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:14:12.303285 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m00:14:12.305197 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m00:14:12.306158 [info ] [Thread-4 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m00:14:12.307342 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m00:14:12.308246 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m00:14:12.320279 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m00:14:12.321627 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m00:14:12.402871 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:14:12.403872 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

    
  
    

  create temporary table "comments_by_user_incremental__dbt_tmp001412372008"
  
  
    as
  
  (
    

WITH max_existing AS (
  
      SELECT max(load_date AT TIME ZONE 'UTC') AS max_load_date
      FROM "test_db"."public_marts"."comments_by_user_incremental"
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE (c.load_date AT TIME ZONE 'UTC') > coalesce(m.max_load_date, '1900-01-01'::timestamp)
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),



final AS (
    SELECT * FROM "test_db"."public_marts"."comments_by_user_incremental"
    UNION ALL
    SELECT * FROM new_agg
),

flat AS (
    SELECT
        name,
        email,
        comment_count,
        unnest(movie_ids) AS movie_id,
        load_date
    FROM final
)

SELECT
    name,
    email,
    sum(comment_count) AS comment_count,
    array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
    max(load_date) AS load_date
FROM flat
GROUP BY name, email
ORDER BY comment_count DESC


  );
  
  
[0m00:14:12.404491 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m00:14:12.555698 [debug] [Thread-4 (]: SQL status: SELECT 236 in 0.151 seconds
[0m00:14:12.575244 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:14:12.576150 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: BEGIN
[0m00:14:12.577443 [debug] [Thread-4 (]: SQL status: BEGIN in 0.000 seconds
[0m00:14:12.578101 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:14:12.578732 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental__dbt_tmp001412372008'
        
      order by ordinal_position

  
[0m00:14:12.586816 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.007 seconds
[0m00:14:12.597756 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:14:12.598553 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m00:14:12.603054 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.004 seconds
[0m00:14:12.615218 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:14:12.616144 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m00:14:12.620304 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.003 seconds
[0m00:14:12.644419 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user_incremental"
[0m00:14:12.645673 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:14:12.646368 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      
        delete from "test_db"."public_marts"."comments_by_user_incremental" as DBT_INTERNAL_DEST
        where (name, email) in (
            select distinct name, email
            from "comments_by_user_incremental__dbt_tmp001412372008" as DBT_INTERNAL_SOURCE
        );

    

    insert into "test_db"."public_marts"."comments_by_user_incremental" ("name", "email", "comment_count", "movie_ids", "load_date")
    (
        select "name", "email", "comment_count", "movie_ids", "load_date"
        from "comments_by_user_incremental__dbt_tmp001412372008"
    )
  
[0m00:14:12.658777 [debug] [Thread-4 (]: SQL status: INSERT 0 236 in 0.012 seconds
[0m00:14:12.661558 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m00:14:12.662247 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:14:12.662886 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m00:14:12.670820 [debug] [Thread-4 (]: SQL status: COMMIT in 0.007 seconds
[0m00:14:12.672633 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m00:14:12.673656 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2358bcc-0d14-402f-a52a-929529d7c6db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74453be6e0c0>]}
[0m00:14:12.674798 [info ] [Thread-4 (]: 3 of 3 OK created sql incremental model public_marts.comments_by_user_incremental  [[32mINSERT 0 236[0m in 0.37s]
[0m00:14:12.675685 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m00:14:12.679186 [debug] [MainThread]: Using postgres connection "master"
[0m00:14:12.679883 [debug] [MainThread]: On master: BEGIN
[0m00:14:12.680654 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:14:12.696259 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:14:12.697095 [debug] [MainThread]: On master: COMMIT
[0m00:14:12.697660 [debug] [MainThread]: Using postgres connection "master"
[0m00:14:12.698184 [debug] [MainThread]: On master: COMMIT
[0m00:14:12.699129 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:14:12.699880 [debug] [MainThread]: On master: Close
[0m00:14:12.701072 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:14:12.701547 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:14:12.701974 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m00:14:12.702491 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m00:14:12.703124 [info ] [MainThread]: 
[0m00:14:12.703845 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 1.05 seconds (1.05s).
[0m00:14:12.705922 [debug] [MainThread]: Command end result
[0m00:14:12.739941 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:14:12.742741 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:14:12.751955 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:14:12.752668 [info ] [MainThread]: 
[0m00:14:12.753428 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:14:12.754042 [info ] [MainThread]: 
[0m00:14:12.754674 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m00:14:12.757174 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.7626677, "process_in_blocks": "77144", "process_kernel_time": 0.969525, "process_mem_max_rss": "130444", "process_out_blocks": "2712", "process_user_time": 4.223792}
[0m00:14:12.757874 [debug] [MainThread]: Command `dbt run` succeeded at 00:14:12.757716 after 2.76 seconds
[0m00:14:12.758480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7445437acce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7445421f15b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7445421f0980>]}
[0m00:14:12.759050 [debug] [MainThread]: Flushing usage events
[0m00:14:15.416674 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:19:38.707471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703fe6c85940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703fe7087590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703fe6c87f50>]}


============================== 00:19:38.717776 | d5acaacf-0278-4783-9f39-51e54e4d22c8 ==============================
[0m00:19:38.717776 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:19:38.718613 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:19:39.155793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd5acaacf-0278-4783-9f39-51e54e4d22c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703fe748ffe0>]}
[0m00:19:39.283407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd5acaacf-0278-4783-9f39-51e54e4d22c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703fe6cce8d0>]}
[0m00:19:39.288116 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:19:39.458485 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:19:39.664154 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:19:39.665034 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user_incremental.sql
[0m00:19:40.134427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd5acaacf-0278-4783-9f39-51e54e4d22c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703fe4ff8d70>]}
[0m00:19:40.227482 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:19:40.232158 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:19:40.259406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd5acaacf-0278-4783-9f39-51e54e4d22c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703fe533d130>]}
[0m00:19:40.260100 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m00:19:40.260644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd5acaacf-0278-4783-9f39-51e54e4d22c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703fe6e54d10>]}
[0m00:19:40.263009 [info ] [MainThread]: 
[0m00:19:40.263773 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:19:40.264406 [info ] [MainThread]: 
[0m00:19:40.265375 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:19:40.272241 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:19:40.273782 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:19:40.346970 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:19:40.347721 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:19:40.348553 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:19:40.349172 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:19:40.349778 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:19:40.350385 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:19:40.379324 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.029 seconds
[0m00:19:40.379996 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.030 seconds
[0m00:19:40.381653 [debug] [ThreadPool]: On list_test_db: Close
[0m00:19:40.383713 [debug] [ThreadPool]: On list_test_db: Close
[0m00:19:40.386626 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m00:19:40.387725 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m00:19:40.396289 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:19:40.398549 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:19:40.399532 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m00:19:40.400391 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m00:19:40.401139 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:19:40.401853 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:19:40.415963 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m00:19:40.416874 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:19:40.417515 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m00:19:40.418133 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m00:19:40.418869 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:19:40.419876 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m00:19:40.427926 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.008 seconds
[0m00:19:40.428591 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.008 seconds
[0m00:19:40.430265 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m00:19:40.432006 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m00:19:40.433454 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m00:19:40.434085 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m00:19:40.442102 [debug] [MainThread]: Using postgres connection "master"
[0m00:19:40.442889 [debug] [MainThread]: On master: BEGIN
[0m00:19:40.443380 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:19:40.458480 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:19:40.459167 [debug] [MainThread]: Using postgres connection "master"
[0m00:19:40.459684 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:19:40.468559 [debug] [MainThread]: SQL status: SELECT 3 in 0.008 seconds
[0m00:19:40.470901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd5acaacf-0278-4783-9f39-51e54e4d22c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703fe57f7260>]}
[0m00:19:40.471506 [debug] [MainThread]: On master: ROLLBACK
[0m00:19:40.472460 [debug] [MainThread]: Using postgres connection "master"
[0m00:19:40.473009 [debug] [MainThread]: On master: BEGIN
[0m00:19:40.474198 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:19:40.474775 [debug] [MainThread]: On master: COMMIT
[0m00:19:40.475336 [debug] [MainThread]: Using postgres connection "master"
[0m00:19:40.475816 [debug] [MainThread]: On master: COMMIT
[0m00:19:40.476614 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:19:40.477161 [debug] [MainThread]: On master: Close
[0m00:19:40.486354 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:19:40.487175 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m00:19:40.487950 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m00:19:40.488936 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m00:19:40.489928 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m00:19:40.490643 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_movies_directors)
[0m00:19:40.491462 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:19:40.492176 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m00:19:40.503499 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:19:40.505520 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m00:19:40.507610 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:19:40.508369 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m00:19:40.684836 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m00:19:40.685970 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m00:19:40.687761 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:19:40.688371 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:19:40.689011 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m00:19:40.689710 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m00:19:40.690464 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:19:40.691235 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m00:19:40.705963 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m00:19:40.706649 [debug] [Thread-2 (]: SQL status: BEGIN in 0.015 seconds
[0m00:19:40.707370 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:19:40.708098 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:19:40.708774 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m00:19:40.709474 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m00:19:40.715520 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m00:19:40.716115 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m00:19:40.724737 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:19:40.728549 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:19:40.729545 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m00:19:40.730540 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m00:19:40.733546 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m00:19:40.734113 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m00:19:40.738618 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:19:40.742542 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:19:40.743548 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m00:19:40.744271 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m00:19:40.745562 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:19:40.746099 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:19:40.785333 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m00:19:40.784698 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:19:40.786426 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:19:40.787419 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:19:40.788513 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m00:19:40.789434 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:19:40.795692 [debug] [Thread-2 (]: SQL status: COMMIT in 0.005 seconds
[0m00:19:40.802467 [debug] [Thread-1 (]: SQL status: COMMIT in 0.012 seconds
[0m00:19:40.805227 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m00:19:40.809089 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m00:19:40.817671 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:19:40.818717 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:19:40.819438 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m00:19:40.820119 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m00:19:40.825501 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.005 seconds
[0m00:19:40.826148 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m00:19:40.829335 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m00:19:40.831890 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m00:19:40.836268 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5acaacf-0278-4783-9f39-51e54e4d22c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703fe5f21d90>]}
[0m00:19:40.836861 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5acaacf-0278-4783-9f39-51e54e4d22c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703fe7d0a540>]}
[0m00:19:40.837873 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.34s]
[0m00:19:40.839952 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:19:40.838891 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.34s]
[0m00:19:40.841714 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m00:19:40.842556 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m00:19:40.843880 [info ] [Thread-4 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m00:19:40.844862 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m00:19:40.845532 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m00:19:40.857279 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m00:19:40.858468 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m00:19:40.927374 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:19:40.928464 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

    
  
    

  create temporary table "comments_by_user_incremental__dbt_tmp001940898848"
  
  
    as
  
  (
    

WITH max_existing AS (
  
      SELECT max(load_date AT TIME ZONE 'UTC') AS max_load_date
      FROM "test_db"."public_marts"."comments_by_user_incremental"
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE (c.load_date AT TIME ZONE 'UTC') > coalesce(m.max_load_date, '1900-01-01'::timestamp)
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),


final AS (
    SELECT * FROM "test_db"."public_marts"."comments_by_user_incremental"  -- already aggregated, no need to explode
    UNION ALL
    SELECT * FROM new_agg     -- new aggregated data
)


SELECT
  name,
  email,
  sum(comment_count) AS comment_count,
  array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
  max(load_date) AS load_date
FROM (
    SELECT name, email, comment_count, unnest(movie_ids) AS movie_id, load_date
    FROM final
) flat
GROUP BY name, email
  );
  
  
[0m00:19:40.929418 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m00:19:41.060619 [debug] [Thread-4 (]: SQL status: SELECT 236 in 0.131 seconds
[0m00:19:41.078623 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:19:41.079280 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: BEGIN
[0m00:19:41.080675 [debug] [Thread-4 (]: SQL status: BEGIN in 0.001 seconds
[0m00:19:41.081189 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:19:41.081713 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental__dbt_tmp001940898848'
        
      order by ordinal_position

  
[0m00:19:41.089130 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.007 seconds
[0m00:19:41.100133 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:19:41.100766 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m00:19:41.105103 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.004 seconds
[0m00:19:41.114834 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:19:41.115395 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m00:19:41.119220 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.003 seconds
[0m00:19:41.142049 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user_incremental"
[0m00:19:41.143199 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:19:41.143831 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      
        delete from "test_db"."public_marts"."comments_by_user_incremental" as DBT_INTERNAL_DEST
        where (name, email) in (
            select distinct name, email
            from "comments_by_user_incremental__dbt_tmp001940898848" as DBT_INTERNAL_SOURCE
        );

    

    insert into "test_db"."public_marts"."comments_by_user_incremental" ("name", "email", "comment_count", "movie_ids", "load_date")
    (
        select "name", "email", "comment_count", "movie_ids", "load_date"
        from "comments_by_user_incremental__dbt_tmp001940898848"
    )
  
[0m00:19:41.152677 [debug] [Thread-4 (]: SQL status: INSERT 0 236 in 0.008 seconds
[0m00:19:41.155417 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m00:19:41.156086 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:19:41.156621 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m00:19:41.164600 [debug] [Thread-4 (]: SQL status: COMMIT in 0.007 seconds
[0m00:19:41.165723 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m00:19:41.166635 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5acaacf-0278-4783-9f39-51e54e4d22c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703fe57f4560>]}
[0m00:19:41.167607 [info ] [Thread-4 (]: 3 of 3 OK created sql incremental model public_marts.comments_by_user_incremental  [[32mINSERT 0 236[0m in 0.32s]
[0m00:19:41.168490 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m00:19:41.171823 [debug] [MainThread]: Using postgres connection "master"
[0m00:19:41.172313 [debug] [MainThread]: On master: BEGIN
[0m00:19:41.172762 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:19:41.186049 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m00:19:41.186774 [debug] [MainThread]: On master: COMMIT
[0m00:19:41.187301 [debug] [MainThread]: Using postgres connection "master"
[0m00:19:41.187781 [debug] [MainThread]: On master: COMMIT
[0m00:19:41.188493 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:19:41.188968 [debug] [MainThread]: On master: Close
[0m00:19:41.189746 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:19:41.190174 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:19:41.190635 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m00:19:41.191347 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m00:19:41.192214 [info ] [MainThread]: 
[0m00:19:41.192992 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 0.93 seconds (0.93s).
[0m00:19:41.194730 [debug] [MainThread]: Command end result
[0m00:19:41.225636 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:19:41.228641 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:19:41.236373 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:19:41.236932 [info ] [MainThread]: 
[0m00:19:41.237536 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:19:41.238070 [info ] [MainThread]: 
[0m00:19:41.238706 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m00:19:41.241176 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.6569293, "process_in_blocks": "89776", "process_kernel_time": 0.918464, "process_mem_max_rss": "130648", "process_out_blocks": "2712", "process_user_time": 4.201571}
[0m00:19:41.242044 [debug] [MainThread]: Command `dbt run` succeeded at 00:19:41.241857 after 2.66 seconds
[0m00:19:41.243137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703fe7673c20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703feb1b3410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703fe63cad50>]}
[0m00:19:41.244138 [debug] [MainThread]: Flushing usage events
[0m00:19:42.945843 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:20:02.957371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e3221599a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e322159040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e322158d70>]}


============================== 00:20:02.963061 | 861dd199-65f8-49ef-8d8d-d641a32d4f1f ==============================
[0m00:20:02.963061 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:20:02.963830 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m00:20:03.331811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '861dd199-65f8-49ef-8d8d-d641a32d4f1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e321937ad0>]}
[0m00:20:03.461867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '861dd199-65f8-49ef-8d8d-d641a32d4f1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e324cb3800>]}
[0m00:20:03.463165 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:20:03.605543 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:20:03.766059 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:20:03.766822 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:20:03.829303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '861dd199-65f8-49ef-8d8d-d641a32d4f1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e321fd3920>]}
[0m00:20:03.941179 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:20:03.944370 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:20:03.966908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '861dd199-65f8-49ef-8d8d-d641a32d4f1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e32092dd60>]}
[0m00:20:03.967764 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m00:20:03.968458 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '861dd199-65f8-49ef-8d8d-d641a32d4f1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e3215068d0>]}
[0m00:20:03.971065 [info ] [MainThread]: 
[0m00:20:03.971717 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:20:03.972271 [info ] [MainThread]: 
[0m00:20:03.973262 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:20:03.981484 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:20:03.983134 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:20:04.060484 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:20:04.061525 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:20:04.062171 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:20:04.062846 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:20:04.063419 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:20:04.064025 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:20:04.081258 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.017 seconds
[0m00:20:04.083092 [debug] [ThreadPool]: On list_test_db: Close
[0m00:20:04.083621 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.020 seconds
[0m00:20:04.085861 [debug] [ThreadPool]: On list_test_db: Close
[0m00:20:04.089354 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m00:20:04.095966 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m00:20:04.108427 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:20:04.109331 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:20:04.109806 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m00:20:04.110420 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m00:20:04.111229 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:20:04.111985 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:20:04.126646 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m00:20:04.127619 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m00:20:04.128298 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:20:04.128954 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:20:04.129549 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m00:20:04.130169 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m00:20:04.135634 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.005 seconds
[0m00:20:04.136507 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.006 seconds
[0m00:20:04.138816 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m00:20:04.141065 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m00:20:04.142053 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m00:20:04.142584 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m00:20:04.151616 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:04.152175 [debug] [MainThread]: On master: BEGIN
[0m00:20:04.152604 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:20:04.166984 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m00:20:04.167569 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:04.168083 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:20:04.177563 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m00:20:04.180184 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '861dd199-65f8-49ef-8d8d-d641a32d4f1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e32017a720>]}
[0m00:20:04.180871 [debug] [MainThread]: On master: ROLLBACK
[0m00:20:04.181891 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:04.182369 [debug] [MainThread]: On master: BEGIN
[0m00:20:04.183604 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:20:04.184062 [debug] [MainThread]: On master: COMMIT
[0m00:20:04.184516 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:04.185022 [debug] [MainThread]: On master: COMMIT
[0m00:20:04.185868 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:20:04.186380 [debug] [MainThread]: On master: Close
[0m00:20:04.192197 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:20:04.193439 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m00:20:04.194430 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m00:20:04.195723 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m00:20:04.196694 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m00:20:04.197488 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_movies_directors)
[0m00:20:04.198111 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:20:04.198701 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m00:20:04.211982 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m00:20:04.214041 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:20:04.215649 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:20:04.216526 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m00:20:04.301686 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m00:20:04.302337 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m00:20:04.303606 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:20:04.304209 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:20:04.304801 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m00:20:04.305583 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m00:20:04.306322 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:20:04.307083 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m00:20:04.322936 [debug] [Thread-2 (]: SQL status: BEGIN in 0.016 seconds
[0m00:20:04.323754 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m00:20:04.324384 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:20:04.325079 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:20:04.325790 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m00:20:04.326508 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m00:20:04.330401 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m00:20:04.331090 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m00:20:04.341477 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:20:04.345982 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:20:04.346893 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m00:20:04.347636 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m00:20:04.349179 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:20:04.349858 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:20:04.354604 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:20:04.358476 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:20:04.359294 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m00:20:04.360180 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m00:20:04.361863 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:20:04.362620 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m00:20:04.405012 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m00:20:04.409588 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:20:04.410683 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:20:04.411830 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:20:04.412584 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m00:20:04.413360 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:20:04.420509 [debug] [Thread-2 (]: SQL status: COMMIT in 0.006 seconds
[0m00:20:04.426971 [debug] [Thread-1 (]: SQL status: COMMIT in 0.013 seconds
[0m00:20:04.437891 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m00:20:04.439962 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m00:20:04.449994 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:20:04.451156 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:20:04.451913 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m00:20:04.452586 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m00:20:04.457952 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.005 seconds
[0m00:20:04.461894 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m00:20:04.462516 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.009 seconds
[0m00:20:04.464585 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m00:20:04.467564 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '861dd199-65f8-49ef-8d8d-d641a32d4f1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e31e959190>]}
[0m00:20:04.468464 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '861dd199-65f8-49ef-8d8d-d641a32d4f1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e31fdb14f0>]}
[0m00:20:04.469442 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.27s]
[0m00:20:04.470620 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.27s]
[0m00:20:04.471859 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m00:20:04.473056 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:20:04.474749 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m00:20:04.475989 [info ] [Thread-4 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m00:20:04.477032 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m00:20:04.477754 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m00:20:04.494938 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m00:20:04.496440 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m00:20:04.569499 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:20:04.570207 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

    
  
    

  create temporary table "comments_by_user_incremental__dbt_tmp002004546957"
  
  
    as
  
  (
    

WITH max_existing AS (
  
      SELECT max(load_date AT TIME ZONE 'UTC') AS max_load_date
      FROM "test_db"."public_marts"."comments_by_user_incremental"
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE (c.load_date AT TIME ZONE 'UTC') > coalesce(m.max_load_date, '1900-01-01'::timestamp)
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),


final AS (
    SELECT * FROM "test_db"."public_marts"."comments_by_user_incremental"  -- already aggregated, no need to explode
    UNION ALL
    SELECT * FROM new_agg     -- new aggregated data
)


SELECT
  name,
  email,
  sum(comment_count) AS comment_count,
  array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
  max(load_date) AS load_date
FROM (
    SELECT name, email, comment_count, unnest(movie_ids) AS movie_id, load_date
    FROM final
) flat
GROUP BY name, email
  );
  
  
[0m00:20:04.570776 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m00:20:04.675081 [debug] [Thread-4 (]: SQL status: SELECT 236 in 0.104 seconds
[0m00:20:04.692760 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:20:04.693555 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: BEGIN
[0m00:20:04.694533 [debug] [Thread-4 (]: SQL status: BEGIN in 0.000 seconds
[0m00:20:04.695176 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:20:04.695931 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental__dbt_tmp002004546957'
        
      order by ordinal_position

  
[0m00:20:04.703710 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.007 seconds
[0m00:20:04.711076 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:20:04.711754 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m00:20:04.715702 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.003 seconds
[0m00:20:04.725169 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:20:04.726031 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m00:20:04.729897 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.003 seconds
[0m00:20:04.751397 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user_incremental"
[0m00:20:04.752398 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:20:04.753057 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      
        delete from "test_db"."public_marts"."comments_by_user_incremental" as DBT_INTERNAL_DEST
        where (name, email) in (
            select distinct name, email
            from "comments_by_user_incremental__dbt_tmp002004546957" as DBT_INTERNAL_SOURCE
        );

    

    insert into "test_db"."public_marts"."comments_by_user_incremental" ("name", "email", "comment_count", "movie_ids", "load_date")
    (
        select "name", "email", "comment_count", "movie_ids", "load_date"
        from "comments_by_user_incremental__dbt_tmp002004546957"
    )
  
[0m00:20:04.761061 [debug] [Thread-4 (]: SQL status: INSERT 0 236 in 0.007 seconds
[0m00:20:04.763823 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m00:20:04.764404 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:20:04.764960 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m00:20:04.769616 [debug] [Thread-4 (]: SQL status: COMMIT in 0.004 seconds
[0m00:20:04.771062 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m00:20:04.771973 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '861dd199-65f8-49ef-8d8d-d641a32d4f1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e31e9a9550>]}
[0m00:20:04.772859 [info ] [Thread-4 (]: 3 of 3 OK created sql incremental model public_marts.comments_by_user_incremental  [[32mINSERT 0 236[0m in 0.30s]
[0m00:20:04.773987 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m00:20:04.777141 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:04.777626 [debug] [MainThread]: On master: BEGIN
[0m00:20:04.778064 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:20:04.792089 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m00:20:04.792993 [debug] [MainThread]: On master: COMMIT
[0m00:20:04.793483 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:04.793932 [debug] [MainThread]: On master: COMMIT
[0m00:20:04.794655 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:20:04.795310 [debug] [MainThread]: On master: Close
[0m00:20:04.796308 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:20:04.796752 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m00:20:04.797425 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:20:04.797889 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m00:20:04.798582 [info ] [MainThread]: 
[0m00:20:04.799279 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 0.83 seconds (0.83s).
[0m00:20:04.800689 [debug] [MainThread]: Command end result
[0m00:20:04.829900 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:20:04.832554 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:20:04.840228 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:20:04.840780 [info ] [MainThread]: 
[0m00:20:04.841549 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:20:04.842109 [info ] [MainThread]: 
[0m00:20:04.842686 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m00:20:04.844048 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.9917363, "process_in_blocks": "0", "process_kernel_time": 0.718848, "process_mem_max_rss": "127584", "process_out_blocks": "1856", "process_user_time": 3.662515}
[0m00:20:04.844770 [debug] [MainThread]: Command `dbt run` succeeded at 00:20:04.844609 after 1.99 seconds
[0m00:20:04.845508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e3223f1670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e322158d70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e320d40050>]}
[0m00:20:04.846266 [debug] [MainThread]: Flushing usage events
[0m00:20:06.129623 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:34:03.580513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7931b6d970e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7931b6d96930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7931b6d97590>]}


============================== 00:34:03.591521 | 5678d4e3-7990-4264-9b8a-e37a585258ba ==============================
[0m00:34:03.591521 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:34:03.592410 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m00:34:14.827606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5678d4e3-7990-4264-9b8a-e37a585258ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7931b5b07740>]}
[0m00:34:04.164881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5678d4e3-7990-4264-9b8a-e37a585258ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7931b72e4200>]}
[0m00:34:04.167991 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:34:04.323178 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:34:04.523799 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:34:04.524704 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user_incremental.sql
[0m00:34:05.035798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5678d4e3-7990-4264-9b8a-e37a585258ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7931b47418e0>]}
[0m00:34:05.128716 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:34:05.132838 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:34:05.161148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5678d4e3-7990-4264-9b8a-e37a585258ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7931b5fe3830>]}
[0m00:34:05.161911 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m00:34:05.162534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5678d4e3-7990-4264-9b8a-e37a585258ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7931b4b16780>]}
[0m00:34:05.165548 [info ] [MainThread]: 
[0m00:34:05.166383 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:34:05.167124 [info ] [MainThread]: 
[0m00:34:05.168250 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:34:05.175365 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:34:05.182534 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:34:05.261022 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:34:05.261826 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:34:05.262643 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:34:05.263388 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:34:05.264150 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:34:05.264880 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:34:05.299725 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.035 seconds
[0m00:34:05.300471 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.036 seconds
[0m00:34:05.302145 [debug] [ThreadPool]: On list_test_db: Close
[0m00:34:05.303753 [debug] [ThreadPool]: On list_test_db: Close
[0m00:34:05.307046 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m00:34:05.313327 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m00:34:05.318076 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:34:05.320881 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:34:05.321720 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m00:34:05.322554 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m00:34:05.323183 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:34:05.323821 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:34:05.338254 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m00:34:05.338994 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:34:05.339595 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m00:34:05.340176 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m00:34:05.340991 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:34:05.341538 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m00:34:05.349967 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.008 seconds
[0m00:34:05.350528 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.010 seconds
[0m00:34:05.352264 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m00:34:05.354252 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m00:34:05.355296 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m00:34:05.355932 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m00:34:05.364785 [debug] [MainThread]: Using postgres connection "master"
[0m00:34:05.365381 [debug] [MainThread]: On master: BEGIN
[0m00:34:05.365883 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:34:05.379138 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m00:34:05.379895 [debug] [MainThread]: Using postgres connection "master"
[0m00:34:05.380804 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:34:05.391660 [debug] [MainThread]: SQL status: SELECT 3 in 0.010 seconds
[0m00:34:05.394338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5678d4e3-7990-4264-9b8a-e37a585258ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7931b4fcdcd0>]}
[0m00:34:05.395308 [debug] [MainThread]: On master: ROLLBACK
[0m00:34:05.396353 [debug] [MainThread]: Using postgres connection "master"
[0m00:34:05.397087 [debug] [MainThread]: On master: BEGIN
[0m00:34:05.398351 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:34:05.398833 [debug] [MainThread]: On master: COMMIT
[0m00:34:05.399349 [debug] [MainThread]: Using postgres connection "master"
[0m00:34:05.399787 [debug] [MainThread]: On master: COMMIT
[0m00:34:05.400677 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:34:05.401176 [debug] [MainThread]: On master: Close
[0m00:34:05.410952 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:34:05.411828 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m00:34:05.412623 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m00:34:05.413983 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m00:34:05.415065 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m00:34:05.415857 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_movies_directors)
[0m00:34:05.416817 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:34:05.417583 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m00:34:05.431529 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m00:34:05.434254 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:34:05.435778 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m00:34:05.436838 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:34:05.628801 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m00:34:05.629872 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m00:34:05.631344 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:34:05.631977 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:34:05.632758 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m00:34:05.633490 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m00:34:05.634139 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m00:34:05.634826 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:34:05.649356 [debug] [Thread-2 (]: SQL status: BEGIN in 0.015 seconds
[0m00:34:05.650078 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m00:34:05.650673 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:34:05.651292 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:34:05.651961 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m00:34:05.652708 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m00:34:05.661537 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.008 seconds
[0m00:34:05.662355 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.009 seconds
[0m00:34:05.671399 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:34:05.675364 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:34:05.676168 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m00:34:05.677006 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m00:34:05.679725 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m00:34:05.680366 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m00:34:05.684803 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:34:05.688806 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:34:05.689815 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m00:34:05.691032 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m00:34:05.692595 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:34:05.693219 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:34:05.730775 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:34:05.731686 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m00:34:05.732378 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:34:05.733155 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:34:05.733826 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:34:05.734498 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m00:34:05.747461 [debug] [Thread-1 (]: SQL status: COMMIT in 0.012 seconds
[0m00:34:05.748455 [debug] [Thread-2 (]: SQL status: COMMIT in 0.013 seconds
[0m00:34:05.757292 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m00:34:05.759943 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m00:34:05.771175 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:34:05.773052 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:34:05.773733 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m00:34:05.774493 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m00:34:05.780316 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.005 seconds
[0m00:34:05.784286 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m00:34:05.784885 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.010 seconds
[0m00:34:05.787041 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m00:34:05.790693 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5678d4e3-7990-4264-9b8a-e37a585258ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7931b2c15610>]}
[0m00:34:05.791327 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5678d4e3-7990-4264-9b8a-e37a585258ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7931b4726660>]}
[0m00:34:05.792302 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.37s]
[0m00:34:05.793457 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.38s]
[0m00:34:05.794658 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m00:34:05.795590 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:34:05.798484 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m00:34:05.799330 [info ] [Thread-4 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m00:34:05.800323 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m00:34:05.801058 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m00:34:05.812203 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m00:34:05.813377 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m00:34:05.875894 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:34:05.876634 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

    
  
    

  create temporary table "comments_by_user_incremental__dbt_tmp003405855693"
  
  
    as
  
  (
    

WITH max_existing AS (
  
      SELECT max(load_date AT TIME ZONE 'UTC') AS max_load_date
      FROM "test_db"."public_marts"."comments_by_user_incremental"
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE (c.load_date AT TIME ZONE 'UTC') > coalesce(m.max_load_date, '1900-01-01'::timestamp)
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

final AS (
  
    SELECT * FROM "test_db"."public_marts"."comments_by_user_incremental"
    UNION ALL
    SELECT * FROM new_agg
  
),

flat AS (
  SELECT
    name,
    email,
    comment_count,
    unnest(movie_ids) AS movie_id,
    load_date
  FROM final
)


SELECT
  name,
  email,
  sum(DISTINCT comment_count) AS comment_count,
  array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
  max(load_date) AS load_date
FROM flat
GROUP BY name, email
ORDER BY comment_count DESC

  );
  
  
[0m00:34:05.877331 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m00:34:05.983939 [debug] [Thread-4 (]: SQL status: SELECT 236 in 0.107 seconds
[0m00:34:06.002305 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:34:06.002919 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: BEGIN
[0m00:34:06.004369 [debug] [Thread-4 (]: SQL status: BEGIN in 0.001 seconds
[0m00:34:06.004973 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:34:06.005561 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental__dbt_tmp003405855693'
        
      order by ordinal_position

  
[0m00:34:06.012531 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.006 seconds
[0m00:34:06.025299 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:34:06.026003 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m00:34:06.029883 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.003 seconds
[0m00:34:06.039855 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:34:06.040499 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m00:34:06.044202 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.003 seconds
[0m00:34:06.067555 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user_incremental"
[0m00:34:06.068726 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:34:06.069424 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      
        delete from "test_db"."public_marts"."comments_by_user_incremental" as DBT_INTERNAL_DEST
        where (name, email) in (
            select distinct name, email
            from "comments_by_user_incremental__dbt_tmp003405855693" as DBT_INTERNAL_SOURCE
        );

    

    insert into "test_db"."public_marts"."comments_by_user_incremental" ("name", "email", "comment_count", "movie_ids", "load_date")
    (
        select "name", "email", "comment_count", "movie_ids", "load_date"
        from "comments_by_user_incremental__dbt_tmp003405855693"
    )
  
[0m00:34:06.078849 [debug] [Thread-4 (]: SQL status: INSERT 0 236 in 0.009 seconds
[0m00:34:06.081141 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m00:34:06.081809 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:34:06.082470 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m00:34:06.089689 [debug] [Thread-4 (]: SQL status: COMMIT in 0.007 seconds
[0m00:34:06.090948 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m00:34:06.091898 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5678d4e3-7990-4264-9b8a-e37a585258ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7931b2d31f10>]}
[0m00:34:06.092785 [info ] [Thread-4 (]: 3 of 3 OK created sql incremental model public_marts.comments_by_user_incremental  [[32mINSERT 0 236[0m in 0.29s]
[0m00:34:06.093841 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m00:34:06.097533 [debug] [MainThread]: Using postgres connection "master"
[0m00:34:06.098243 [debug] [MainThread]: On master: BEGIN
[0m00:34:06.098868 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:34:06.112119 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m00:34:06.112878 [debug] [MainThread]: On master: COMMIT
[0m00:34:06.113438 [debug] [MainThread]: Using postgres connection "master"
[0m00:34:06.114001 [debug] [MainThread]: On master: COMMIT
[0m00:34:06.114901 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:34:06.115495 [debug] [MainThread]: On master: Close
[0m00:34:06.116495 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:34:06.117168 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:34:06.117840 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m00:34:06.118422 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m00:34:06.119159 [info ] [MainThread]: 
[0m00:34:06.119726 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 0.95 seconds (0.95s).
[0m00:34:06.121675 [debug] [MainThread]: Command end result
[0m00:34:06.154777 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:34:06.157500 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:34:06.165977 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:34:06.166620 [info ] [MainThread]: 
[0m00:34:06.167209 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:34:06.167751 [info ] [MainThread]: 
[0m00:34:06.168293 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m00:34:06.170673 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.7006786, "process_in_blocks": "89776", "process_kernel_time": 0.957827, "process_mem_max_rss": "130828", "process_out_blocks": "2728", "process_user_time": 4.153301}
[0m00:34:06.171352 [debug] [MainThread]: Command `dbt run` succeeded at 00:34:06.171161 after 2.70 seconds
[0m00:34:06.171864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7931b6afc8f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7931ba9b3410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7931b5726570>]}
[0m00:34:06.172452 [debug] [MainThread]: Flushing usage events
[0m00:34:07.502379 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:34:33.771149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff70a7eea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff70fb5a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff70a7ff20>]}


============================== 00:34:33.776345 | 83abc74a-e66f-43c3-ae26-e8cf25ec96ab ==============================
[0m00:34:33.776345 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:34:33.777383 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m00:34:34.063286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '83abc74a-e66f-43c3-ae26-e8cf25ec96ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff705b2d50>]}
[0m00:34:34.191464 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '83abc74a-e66f-43c3-ae26-e8cf25ec96ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff70539940>]}
[0m00:34:34.192742 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:34:34.337403 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:34:34.477317 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:34:34.478014 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:34:34.526993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '83abc74a-e66f-43c3-ae26-e8cf25ec96ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff701f6600>]}
[0m00:34:34.633982 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:34:34.636853 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:34:34.653525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '83abc74a-e66f-43c3-ae26-e8cf25ec96ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff6f531c10>]}
[0m00:34:34.654274 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m00:34:34.655043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '83abc74a-e66f-43c3-ae26-e8cf25ec96ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff6f5d3770>]}
[0m00:34:34.658124 [info ] [MainThread]: 
[0m00:34:34.658937 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:34:34.659593 [info ] [MainThread]: 
[0m00:34:34.660573 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:34:34.666748 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:34:34.682790 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:34:34.741177 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:34:34.741970 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:34:34.742555 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:34:34.743150 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:34:34.743803 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:34:34.744406 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:34:34.762779 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.018 seconds
[0m00:34:34.763406 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.020 seconds
[0m00:34:34.765136 [debug] [ThreadPool]: On list_test_db: Close
[0m00:34:34.767856 [debug] [ThreadPool]: On list_test_db: Close
[0m00:34:34.771243 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m00:34:34.772180 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m00:34:34.781119 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:34:34.784090 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:34:34.785039 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m00:34:34.785746 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m00:34:34.786565 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:34:34.787244 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:34:34.800770 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m00:34:34.801341 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m00:34:34.802118 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:34:34.802695 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:34:34.803301 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m00:34:34.803946 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m00:34:34.810499 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.006 seconds
[0m00:34:34.811495 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.007 seconds
[0m00:34:34.813235 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m00:34:34.815125 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m00:34:34.816071 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m00:34:34.816682 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m00:34:34.824671 [debug] [MainThread]: Using postgres connection "master"
[0m00:34:34.825277 [debug] [MainThread]: On master: BEGIN
[0m00:34:34.825935 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:34:34.839997 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m00:34:34.840740 [debug] [MainThread]: Using postgres connection "master"
[0m00:34:34.841378 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:34:34.849135 [debug] [MainThread]: SQL status: SELECT 3 in 0.007 seconds
[0m00:34:34.851676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '83abc74a-e66f-43c3-ae26-e8cf25ec96ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff7014eff0>]}
[0m00:34:34.852327 [debug] [MainThread]: On master: ROLLBACK
[0m00:34:34.853129 [debug] [MainThread]: Using postgres connection "master"
[0m00:34:34.853676 [debug] [MainThread]: On master: BEGIN
[0m00:34:34.854885 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:34:34.855348 [debug] [MainThread]: On master: COMMIT
[0m00:34:34.855808 [debug] [MainThread]: Using postgres connection "master"
[0m00:34:34.856235 [debug] [MainThread]: On master: COMMIT
[0m00:34:34.857198 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:34:34.857771 [debug] [MainThread]: On master: Close
[0m00:34:34.862968 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:34:34.863608 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m00:34:34.864395 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m00:34:34.865385 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m00:34:34.866904 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m00:34:34.867852 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_movies_directors)
[0m00:34:34.868489 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:34:34.869101 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m00:34:34.879547 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:34:34.882308 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m00:34:34.885193 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:34:34.896726 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m00:34:34.970622 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m00:34:34.971572 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m00:34:34.972780 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:34:34.973471 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:34:34.974181 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m00:34:34.975024 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m00:34:34.975750 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:34:34.976471 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m00:34:34.990237 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m00:34:34.991182 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:34:34.991782 [debug] [Thread-2 (]: SQL status: BEGIN in 0.015 seconds
[0m00:34:34.992418 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m00:34:34.993138 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:34:34.993984 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m00:34:34.996290 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:34:35.002556 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.009 seconds
[0m00:34:35.007109 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:34:35.011176 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:34:35.011918 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m00:34:35.012645 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m00:34:35.013978 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:34:35.014513 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:34:35.019300 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:34:35.023226 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:34:35.023956 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m00:34:35.024680 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m00:34:35.026299 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:34:35.026994 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:34:35.077042 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m00:34:35.077997 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:34:35.078825 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:34:35.079637 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:34:35.080382 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m00:34:35.081120 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:34:35.087275 [debug] [Thread-2 (]: SQL status: COMMIT in 0.005 seconds
[0m00:34:35.093662 [debug] [Thread-1 (]: SQL status: COMMIT in 0.012 seconds
[0m00:34:35.097640 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m00:34:35.101445 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m00:34:35.112053 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:34:35.113311 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:34:35.114197 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m00:34:35.114976 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m00:34:35.121046 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.005 seconds
[0m00:34:35.126036 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m00:34:35.126755 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.011 seconds
[0m00:34:35.129499 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m00:34:35.132498 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83abc74a-e66f-43c3-ae26-e8cf25ec96ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff734da6f0>]}
[0m00:34:35.133579 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83abc74a-e66f-43c3-ae26-e8cf25ec96ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff6d4549b0>]}
[0m00:34:35.135165 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.26s]
[0m00:34:35.136614 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.27s]
[0m00:34:35.138188 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m00:34:35.139417 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:34:35.141827 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m00:34:35.142752 [info ] [Thread-4 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m00:34:35.143648 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m00:34:35.144457 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m00:34:35.162196 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m00:34:35.163804 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m00:34:35.228630 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user_incremental"
[0m00:34:35.229847 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:34:35.230416 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: BEGIN
[0m00:34:35.231196 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m00:34:35.245025 [debug] [Thread-4 (]: SQL status: BEGIN in 0.014 seconds
[0m00:34:35.245755 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:34:35.246313 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      
  
    

  create  table "test_db"."public_marts"."comments_by_user_incremental"
  
  
    as
  
  (
    

WITH max_existing AS (
  
      SELECT null::timestamp AS max_load_date
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE (c.load_date AT TIME ZONE 'UTC') > coalesce(m.max_load_date, '1900-01-01'::timestamp)
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

final AS (
  
    SELECT * FROM new_agg
  
),

flat AS (
  SELECT
    name,
    email,
    comment_count,
    unnest(movie_ids) AS movie_id,
    load_date
  FROM final
)


SELECT * FROM new_agg

  );
  
  
[0m00:34:35.451171 [debug] [Thread-4 (]: SQL status: SELECT 236 in 0.204 seconds
[0m00:34:35.458311 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m00:34:35.458993 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:34:35.459494 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m00:34:35.468144 [debug] [Thread-4 (]: SQL status: COMMIT in 0.008 seconds
[0m00:34:35.469755 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m00:34:35.470788 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83abc74a-e66f-43c3-ae26-e8cf25ec96ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff6d4e8230>]}
[0m00:34:35.471740 [info ] [Thread-4 (]: 3 of 3 OK created sql incremental model public_marts.comments_by_user_incremental  [[32mSELECT 236[0m in 0.33s]
[0m00:34:35.472567 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m00:34:35.475474 [debug] [MainThread]: Using postgres connection "master"
[0m00:34:35.475964 [debug] [MainThread]: On master: BEGIN
[0m00:34:35.476389 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:34:35.489976 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m00:34:35.490692 [debug] [MainThread]: On master: COMMIT
[0m00:34:35.491210 [debug] [MainThread]: Using postgres connection "master"
[0m00:34:35.491956 [debug] [MainThread]: On master: COMMIT
[0m00:34:35.493010 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:34:35.493625 [debug] [MainThread]: On master: Close
[0m00:34:35.494680 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:34:35.495246 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:34:35.495683 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m00:34:35.496078 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m00:34:35.496622 [info ] [MainThread]: 
[0m00:34:35.497182 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 0.84 seconds (0.84s).
[0m00:34:35.498507 [debug] [MainThread]: Command end result
[0m00:34:35.526309 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:34:35.529061 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:34:35.537729 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:34:35.538354 [info ] [MainThread]: 
[0m00:34:35.538940 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:34:35.539451 [info ] [MainThread]: 
[0m00:34:35.540058 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m00:34:35.541383 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.8829124, "process_in_blocks": "0", "process_kernel_time": 0.766607, "process_mem_max_rss": "127464", "process_out_blocks": "1848", "process_user_time": 3.341929}
[0m00:34:35.542098 [debug] [MainThread]: Command `dbt run` succeeded at 00:34:35.541948 after 1.88 seconds
[0m00:34:35.542652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff70ba0350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff70ba02c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff70ba0200>]}
[0m00:34:35.543170 [debug] [MainThread]: Flushing usage events
[0m00:34:36.736381 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:35:13.595679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76895f67d250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76895d947350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76895cb88bc0>]}


============================== 00:35:13.603467 | 05fbb732-3ee3-4961-81ba-457760dcd77b ==============================
[0m00:35:13.603467 [info ] [MainThread]: Running with dbt=1.10.6
[0m00:35:13.604436 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:35:24.907384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '05fbb732-3ee3-4961-81ba-457760dcd77b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76895c7ceae0>]}
[0m00:35:14.212934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '05fbb732-3ee3-4961-81ba-457760dcd77b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76895c9846b0>]}
[0m00:35:14.214727 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:35:14.360194 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m00:35:14.553922 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:35:14.554502 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:35:14.602110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '05fbb732-3ee3-4961-81ba-457760dcd77b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76895c3ee000>]}
[0m00:35:14.700107 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:35:14.704978 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:35:14.736012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '05fbb732-3ee3-4961-81ba-457760dcd77b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76895b305f10>]}
[0m00:35:14.736860 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m00:35:14.737581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '05fbb732-3ee3-4961-81ba-457760dcd77b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76895b7bb530>]}
[0m00:35:14.740416 [info ] [MainThread]: 
[0m00:35:14.740996 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:35:14.741529 [info ] [MainThread]: 
[0m00:35:14.742395 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:35:14.748716 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:35:14.750161 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m00:35:14.821501 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:35:14.822167 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m00:35:14.822795 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:35:14.823527 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m00:35:14.824185 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:35:14.824828 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:35:14.853006 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.028 seconds
[0m00:35:14.853611 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.029 seconds
[0m00:35:14.855433 [debug] [ThreadPool]: On list_test_db: Close
[0m00:35:14.857708 [debug] [ThreadPool]: On list_test_db: Close
[0m00:35:14.861272 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m00:35:14.867634 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m00:35:14.871251 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:35:14.873971 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:35:14.874813 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m00:35:14.875760 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m00:35:14.876406 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:35:14.877030 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:35:14.890239 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m00:35:14.890821 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m00:35:14.891440 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m00:35:14.892899 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m00:35:14.893355 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m00:35:14.893825 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m00:35:14.900087 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.008 seconds
[0m00:35:14.900652 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.006 seconds
[0m00:35:14.902477 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m00:35:14.904686 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m00:35:14.905642 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m00:35:14.906068 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m00:35:14.915494 [debug] [MainThread]: Using postgres connection "master"
[0m00:35:14.916307 [debug] [MainThread]: On master: BEGIN
[0m00:35:14.916807 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:35:14.929504 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m00:35:14.930057 [debug] [MainThread]: Using postgres connection "master"
[0m00:35:14.930592 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:35:14.939370 [debug] [MainThread]: SQL status: SELECT 3 in 0.008 seconds
[0m00:35:14.941312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '05fbb732-3ee3-4961-81ba-457760dcd77b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76895d154530>]}
[0m00:35:14.941938 [debug] [MainThread]: On master: ROLLBACK
[0m00:35:14.942743 [debug] [MainThread]: Using postgres connection "master"
[0m00:35:14.943354 [debug] [MainThread]: On master: BEGIN
[0m00:35:14.944446 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:35:14.944902 [debug] [MainThread]: On master: COMMIT
[0m00:35:14.945359 [debug] [MainThread]: Using postgres connection "master"
[0m00:35:14.945826 [debug] [MainThread]: On master: COMMIT
[0m00:35:14.946900 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m00:35:14.947499 [debug] [MainThread]: On master: Close
[0m00:35:14.963794 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m00:35:14.964643 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m00:35:14.965835 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m00:35:14.966787 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m00:35:14.968192 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m00:35:14.968843 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_movies_directors)
[0m00:35:14.969547 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m00:35:14.970203 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m00:35:14.981215 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m00:35:14.984136 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m00:35:14.985744 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m00:35:14.986515 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m00:35:15.081628 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m00:35:15.082579 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m00:35:15.084196 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:35:15.084790 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:35:15.085390 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m00:35:15.086042 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m00:35:15.086766 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m00:35:15.087502 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:35:15.101292 [debug] [Thread-2 (]: SQL status: BEGIN in 0.014 seconds
[0m00:35:15.101955 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m00:35:15.102607 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:35:15.103437 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:35:15.104112 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m00:35:15.104805 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m00:35:15.110408 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m00:35:15.111168 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m00:35:15.119822 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:35:15.123440 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:35:15.124537 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m00:35:15.125436 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m00:35:15.127647 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:35:15.128319 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m00:35:15.132472 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:35:15.136497 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:35:15.137648 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m00:35:15.138577 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m00:35:15.140109 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:35:15.140651 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:35:15.175971 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m00:35:15.177954 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:35:15.178723 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:35:15.179553 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:35:15.180401 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m00:35:15.181103 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m00:35:15.187831 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m00:35:15.194533 [debug] [Thread-2 (]: SQL status: COMMIT in 0.013 seconds
[0m00:35:15.197862 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m00:35:15.201717 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m00:35:15.210568 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m00:35:15.212205 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m00:35:15.213158 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m00:35:15.213836 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m00:35:15.220494 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.006 seconds
[0m00:35:15.224082 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m00:35:15.224652 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.010 seconds
[0m00:35:15.227094 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m00:35:15.230638 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05fbb732-3ee3-4961-81ba-457760dcd77b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76895f1967b0>]}
[0m00:35:15.231347 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05fbb732-3ee3-4961-81ba-457760dcd77b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76895936f920>]}
[0m00:35:15.232479 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.26s]
[0m00:35:15.235332 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.26s]
[0m00:35:15.236604 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m00:35:15.237485 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m00:35:15.239317 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m00:35:15.240741 [info ] [Thread-4 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m00:35:15.241749 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m00:35:15.242550 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m00:35:15.261187 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m00:35:15.262533 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m00:35:15.322320 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:35:15.323135 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

    
  
    

  create temporary table "comments_by_user_incremental__dbt_tmp003515302632"
  
  
    as
  
  (
    

WITH max_existing AS (
  
      SELECT max(load_date AT TIME ZONE 'UTC') AS max_load_date
      FROM "test_db"."public_marts"."comments_by_user_incremental"
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE (c.load_date AT TIME ZONE 'UTC') > coalesce(m.max_load_date, '1900-01-01'::timestamp)
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

final AS (
  
    SELECT * FROM "test_db"."public_marts"."comments_by_user_incremental"
    UNION ALL
    SELECT * FROM new_agg
  
),

flat AS (
  SELECT
    name,
    email,
    comment_count,
    unnest(movie_ids) AS movie_id,
    load_date
  FROM final
)


SELECT
  name,
  email,
  sum(DISTINCT comment_count) AS comment_count,
  array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
  max(load_date) AS load_date
FROM flat
GROUP BY name, email
ORDER BY comment_count DESC

  );
  
  
[0m00:35:15.323718 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m00:35:15.423114 [debug] [Thread-4 (]: SQL status: SELECT 236 in 0.099 seconds
[0m00:35:15.441688 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:35:15.442405 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: BEGIN
[0m00:35:15.443812 [debug] [Thread-4 (]: SQL status: BEGIN in 0.001 seconds
[0m00:35:15.444513 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:35:15.445076 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental__dbt_tmp003515302632'
        
      order by ordinal_position

  
[0m00:35:15.452369 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.007 seconds
[0m00:35:15.463543 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:35:15.464159 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m00:35:15.468325 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.004 seconds
[0m00:35:15.477761 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:35:15.478334 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m00:35:15.482360 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.003 seconds
[0m00:35:15.504940 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user_incremental"
[0m00:35:15.505921 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:35:15.506528 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      
        delete from "test_db"."public_marts"."comments_by_user_incremental" as DBT_INTERNAL_DEST
        where (name, email) in (
            select distinct name, email
            from "comments_by_user_incremental__dbt_tmp003515302632" as DBT_INTERNAL_SOURCE
        );

    

    insert into "test_db"."public_marts"."comments_by_user_incremental" ("name", "email", "comment_count", "movie_ids", "load_date")
    (
        select "name", "email", "comment_count", "movie_ids", "load_date"
        from "comments_by_user_incremental__dbt_tmp003515302632"
    )
  
[0m00:35:15.512047 [debug] [Thread-4 (]: SQL status: INSERT 0 236 in 0.005 seconds
[0m00:35:15.514202 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m00:35:15.514770 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m00:35:15.515392 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m00:35:15.522547 [debug] [Thread-4 (]: SQL status: COMMIT in 0.006 seconds
[0m00:35:15.524336 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m00:35:15.525240 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05fbb732-3ee3-4961-81ba-457760dcd77b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768959372990>]}
[0m00:35:15.526109 [info ] [Thread-4 (]: 3 of 3 OK created sql incremental model public_marts.comments_by_user_incremental  [[32mINSERT 0 236[0m in 0.28s]
[0m00:35:15.527230 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m00:35:15.530057 [debug] [MainThread]: Using postgres connection "master"
[0m00:35:15.530523 [debug] [MainThread]: On master: BEGIN
[0m00:35:15.531063 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:35:15.546582 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:35:15.547595 [debug] [MainThread]: On master: COMMIT
[0m00:35:15.548095 [debug] [MainThread]: Using postgres connection "master"
[0m00:35:15.548571 [debug] [MainThread]: On master: COMMIT
[0m00:35:15.549547 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:35:15.550087 [debug] [MainThread]: On master: Close
[0m00:35:15.551106 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:35:15.551549 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m00:35:15.552035 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m00:35:15.552446 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m00:35:15.552975 [info ] [MainThread]: 
[0m00:35:15.553652 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 0.81 seconds (0.81s).
[0m00:35:15.555310 [debug] [MainThread]: Command end result
[0m00:35:15.583973 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m00:35:15.586713 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m00:35:15.594515 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m00:35:15.595080 [info ] [MainThread]: 
[0m00:35:15.595699 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:35:15.596242 [info ] [MainThread]: 
[0m00:35:15.596966 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m00:35:15.599979 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.1082911, "process_in_blocks": "89784", "process_kernel_time": 0.816407, "process_mem_max_rss": "127036", "process_out_blocks": "1864", "process_user_time": 3.793654}
[0m00:35:15.600877 [debug] [MainThread]: Command `dbt run` succeeded at 00:35:15.600703 after 2.11 seconds
[0m00:35:15.601483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76895cb31910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76895a763560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76895d9c0ef0>]}
[0m00:35:15.602027 [debug] [MainThread]: Flushing usage events
[0m00:35:17.182449 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:11:26.731105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7906de7c5550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7906de3b7590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7906de1a6120>]}


============================== 01:11:26.740757 | a43e50ac-0087-4c5c-9f1c-43c992284704 ==============================
[0m01:11:26.740757 [info ] [MainThread]: Running with dbt=1.10.6
[0m01:11:26.742230 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m01:11:27.182062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a43e50ac-0087-4c5c-9f1c-43c992284704', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7906ddbeac90>]}
[0m01:11:27.308837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a43e50ac-0087-4c5c-9f1c-43c992284704', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7906de51f500>]}
[0m01:11:27.313849 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m01:11:27.460661 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m01:11:38.560843 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:11:38.561733 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user_incremental.sql
[0m01:11:28.208227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a43e50ac-0087-4c5c-9f1c-43c992284704', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7906dc3f8ef0>]}
[0m01:11:28.306533 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:11:28.309277 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:11:28.344402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a43e50ac-0087-4c5c-9f1c-43c992284704', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7906dd320560>]}
[0m01:11:28.345182 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m01:11:28.345755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a43e50ac-0087-4c5c-9f1c-43c992284704', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7906dc776ed0>]}
[0m01:11:28.347973 [info ] [MainThread]: 
[0m01:11:28.348624 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:11:28.349215 [info ] [MainThread]: 
[0m01:11:28.350023 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:11:28.355824 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:11:28.357362 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:11:28.441487 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:11:28.442288 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:11:28.442907 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:11:28.443645 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:11:28.444214 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:11:28.444810 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:11:28.484149 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.040 seconds
[0m01:11:28.485175 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.040 seconds
[0m01:11:28.487222 [debug] [ThreadPool]: On list_test_db: Close
[0m01:11:28.489407 [debug] [ThreadPool]: On list_test_db: Close
[0m01:11:28.492683 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m01:11:28.499389 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m01:11:28.503168 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:11:28.506387 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:11:28.507066 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m01:11:28.507672 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m01:11:28.508266 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:11:28.508861 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:11:28.533894 [debug] [ThreadPool]: SQL status: BEGIN in 0.025 seconds
[0m01:11:28.534835 [debug] [ThreadPool]: SQL status: BEGIN in 0.026 seconds
[0m01:11:28.535619 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:11:28.536217 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:11:28.536958 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m01:11:28.537895 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m01:11:28.550209 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.011 seconds
[0m01:11:28.550889 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.012 seconds
[0m01:11:28.552649 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m01:11:28.554419 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m01:11:28.555535 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m01:11:28.556021 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m01:11:28.563898 [debug] [MainThread]: Using postgres connection "master"
[0m01:11:28.564505 [debug] [MainThread]: On master: BEGIN
[0m01:11:28.564946 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:11:28.578544 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m01:11:28.579098 [debug] [MainThread]: Using postgres connection "master"
[0m01:11:28.579619 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:11:28.592960 [debug] [MainThread]: SQL status: SELECT 3 in 0.012 seconds
[0m01:11:28.595175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a43e50ac-0087-4c5c-9f1c-43c992284704', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7906dd320f80>]}
[0m01:11:28.595799 [debug] [MainThread]: On master: ROLLBACK
[0m01:11:28.597201 [debug] [MainThread]: Using postgres connection "master"
[0m01:11:28.597707 [debug] [MainThread]: On master: BEGIN
[0m01:11:28.598778 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m01:11:28.599246 [debug] [MainThread]: On master: COMMIT
[0m01:11:28.599695 [debug] [MainThread]: Using postgres connection "master"
[0m01:11:28.600188 [debug] [MainThread]: On master: COMMIT
[0m01:11:28.600972 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:11:28.601559 [debug] [MainThread]: On master: Close
[0m01:11:28.608328 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m01:11:28.609175 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m01:11:28.609913 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m01:11:28.610880 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m01:11:28.611721 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m01:11:28.612497 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_movies_directors)
[0m01:11:28.613244 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m01:11:28.613874 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m01:11:28.625261 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m01:11:28.627873 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m01:11:28.629372 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m01:11:28.635479 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m01:11:28.826898 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m01:11:28.829841 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m01:11:28.831877 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:11:28.832626 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m01:11:28.833413 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:11:28.834234 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:11:28.835656 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m01:11:28.836312 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:11:28.850999 [debug] [Thread-2 (]: SQL status: BEGIN in 0.017 seconds
[0m01:11:28.852203 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:11:28.853441 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m01:11:28.854340 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m01:11:28.855086 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:11:28.855918 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m01:11:28.868894 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.015 seconds
[0m01:11:28.869771 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.013 seconds
[0m01:11:28.878398 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:11:28.882892 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:11:28.883553 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m01:11:28.884292 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m01:11:28.887551 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m01:11:28.888099 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m01:11:28.891800 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:11:28.895952 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:11:28.897196 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m01:11:28.898128 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m01:11:28.899486 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:11:28.900030 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:11:28.924871 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:11:28.927287 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m01:11:28.928418 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:11:28.929581 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:11:28.930631 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:11:28.931304 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m01:11:28.939160 [debug] [Thread-1 (]: SQL status: COMMIT in 0.007 seconds
[0m01:11:28.945651 [debug] [Thread-2 (]: SQL status: COMMIT in 0.013 seconds
[0m01:11:28.948525 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m01:11:28.951973 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m01:11:28.961688 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:11:28.962948 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:11:28.963696 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m01:11:28.964453 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m01:11:28.975696 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.010 seconds
[0m01:11:28.979065 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m01:11:28.979739 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.014 seconds
[0m01:11:28.982223 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m01:11:28.985207 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a43e50ac-0087-4c5c-9f1c-43c992284704', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7906dcb68ef0>]}
[0m01:11:28.986058 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a43e50ac-0087-4c5c-9f1c-43c992284704', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7906de67bec0>]}
[0m01:11:28.987080 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.37s]
[0m01:11:28.988117 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.37s]
[0m01:11:28.989726 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m01:11:28.990698 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m01:11:28.992302 [debug] [Thread-2 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m01:11:28.993390 [info ] [Thread-2 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m01:11:28.994156 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_movies_directors, now model.mongo_movies.comments_by_user_incremental)
[0m01:11:28.994794 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m01:11:29.005169 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m01:11:29.006872 [debug] [Thread-2 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m01:11:29.073982 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m01:11:29.074748 [debug] [Thread-2 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

    
  
    

  create temporary table "comments_by_user_incremental__dbt_tmp011129048206"
  
  
    as
  
  (
    

WITH max_existing AS (
  
      SELECT max(load_date AT TIME ZONE 'UTC') AS max_load_date
      FROM "test_db"."public_marts"."comments_by_user_incremental"
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE (c.load_date AT TIME ZONE 'UTC') > coalesce(m.max_load_date, '1900-01-01'::timestamp)
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

final AS (
  
    SELECT * FROM "test_db"."public_marts"."comments_by_user_incremental"
    UNION ALL
    SELECT * FROM new_agg
  
),

flat AS (
  
   SELECT
      name,
      email,
      comment_count,
      unnest(movie_ids) AS movie_id,
      load_date
    FROM (
        SELECT
            name,
            email,
            SUM(comment_count) OVER (PARTITION BY name, email) AS comment_count,
            movie_ids,
            load_date
    FROM final)
  
)


SELECT
  name,
  email,
  comment_count,
  array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
  max(load_date) AS load_date
FROM flat
GROUP BY name, email
ORDER BY comment_count DESC

  );
  
  
[0m01:11:29.075325 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:11:29.092694 [debug] [Thread-2 (]: Postgres adapter: Postgres error: column "flat.comment_count" must appear in the GROUP BY clause or be used in an aggregate function
LINE 71:   comment_count,
           ^

[0m01:11:29.093769 [debug] [Thread-2 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m01:11:29.110455 [debug] [Thread-2 (]: Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  column "flat.comment_count" must appear in the GROUP BY clause or be used in an aggregate function
  LINE 71:   comment_count,
             ^
[0m01:11:29.111243 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a43e50ac-0087-4c5c-9f1c-43c992284704', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7906dc705b50>]}
[0m01:11:29.112118 [error] [Thread-2 (]: 3 of 3 ERROR creating sql incremental model public_marts.comments_by_user_incremental  [[31mERROR[0m in 0.12s]
[0m01:11:29.113311 [debug] [Thread-2 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m01:11:29.114439 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.comments_by_user_incremental' to be skipped because of status 'error'.  Reason: Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  column "flat.comment_count" must appear in the GROUP BY clause or be used in an aggregate function
  LINE 71:   comment_count,
             ^.
[0m01:11:29.118534 [debug] [MainThread]: Using postgres connection "master"
[0m01:11:29.119018 [debug] [MainThread]: On master: BEGIN
[0m01:11:29.119477 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:11:29.132840 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m01:11:29.133759 [debug] [MainThread]: On master: COMMIT
[0m01:11:29.134342 [debug] [MainThread]: Using postgres connection "master"
[0m01:11:29.134806 [debug] [MainThread]: On master: COMMIT
[0m01:11:29.135585 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:11:29.136126 [debug] [MainThread]: On master: Close
[0m01:11:29.137018 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:11:29.137805 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m01:11:29.138315 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m01:11:29.139342 [info ] [MainThread]: 
[0m01:11:29.140623 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 0.79 seconds (0.79s).
[0m01:11:29.142676 [debug] [MainThread]: Command end result
[0m01:11:29.172523 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:11:29.175317 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:11:29.183233 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m01:11:29.183769 [info ] [MainThread]: 
[0m01:11:29.184381 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m01:11:29.185021 [info ] [MainThread]: 
[0m01:11:29.185829 [error] [MainThread]: [31mFailure in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)[0m
[0m01:11:29.186460 [error] [MainThread]:   Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  column "flat.comment_count" must appear in the GROUP BY clause or be used in an aggregate function
  LINE 71:   comment_count,
             ^
[0m01:11:29.187105 [info ] [MainThread]: 
[0m01:11:29.187795 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql
[0m01:11:29.188493 [info ] [MainThread]: 
[0m01:11:29.189345 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=3
[0m01:11:29.191732 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.5893278, "process_in_blocks": "90264", "process_kernel_time": 1.008398, "process_mem_max_rss": "130004", "process_out_blocks": "2704", "process_user_time": 4.203003}
[0m01:11:29.192629 [debug] [MainThread]: Command `dbt run` failed at 01:11:29.192436 after 2.59 seconds
[0m01:11:29.193392 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7906de67bfe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7906e0639190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7906e0639670>]}
[0m01:11:29.193955 [debug] [MainThread]: Flushing usage events
[0m01:11:30.485102 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:17:09.052775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b09617d6300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b0961da71d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b09618bdc70>]}


============================== 01:17:09.060793 | 4108b2e6-a4ed-4f6a-a31b-8c7d3a0089f3 ==============================
[0m01:17:09.060793 [info ] [MainThread]: Running with dbt=1.10.6
[0m01:17:09.061776 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m01:16:58.511608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4108b2e6-a4ed-4f6a-a31b-8c7d3a0089f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b09609c6090>]}
[0m01:16:58.642057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4108b2e6-a4ed-4f6a-a31b-8c7d3a0089f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b0963389310>]}
[0m01:16:58.643695 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m01:16:58.795958 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m01:16:58.953603 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:16:58.954605 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user_incremental.sql
[0m01:16:59.441743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4108b2e6-a4ed-4f6a-a31b-8c7d3a0089f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b095f9262d0>]}
[0m01:16:59.537033 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:16:59.539494 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:16:59.557967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4108b2e6-a4ed-4f6a-a31b-8c7d3a0089f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b095f93c740>]}
[0m01:16:59.558761 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m01:16:59.559340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4108b2e6-a4ed-4f6a-a31b-8c7d3a0089f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b09617a9430>]}
[0m01:16:59.561633 [info ] [MainThread]: 
[0m01:16:59.562251 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:16:59.562843 [info ] [MainThread]: 
[0m01:16:59.563619 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:16:59.569133 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:16:59.570971 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:16:59.640282 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:16:59.641021 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:16:59.641661 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:16:59.642318 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:16:59.642962 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:16:59.643545 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:16:59.675186 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.032 seconds
[0m01:16:59.675746 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.033 seconds
[0m01:16:59.678271 [debug] [ThreadPool]: On list_test_db: Close
[0m01:16:59.679958 [debug] [ThreadPool]: On list_test_db: Close
[0m01:16:59.683563 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m01:16:59.684522 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m01:16:59.695530 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:16:59.698500 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:16:59.699125 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m01:16:59.699796 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m01:16:59.700426 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:16:59.701197 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:16:59.715700 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m01:16:59.716264 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m01:16:59.716903 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:16:59.717590 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:16:59.718365 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m01:16:59.719043 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m01:16:59.725420 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.005 seconds
[0m01:16:59.726124 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.006 seconds
[0m01:16:59.728041 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m01:16:59.729649 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m01:16:59.730617 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m01:16:59.731122 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m01:16:59.737888 [debug] [MainThread]: Using postgres connection "master"
[0m01:16:59.738586 [debug] [MainThread]: On master: BEGIN
[0m01:16:59.739027 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:16:59.752290 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m01:16:59.752877 [debug] [MainThread]: Using postgres connection "master"
[0m01:16:59.753411 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:16:59.762820 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m01:16:59.764666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4108b2e6-a4ed-4f6a-a31b-8c7d3a0089f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b095fd8bf20>]}
[0m01:16:59.765278 [debug] [MainThread]: On master: ROLLBACK
[0m01:16:59.766225 [debug] [MainThread]: Using postgres connection "master"
[0m01:16:59.766786 [debug] [MainThread]: On master: BEGIN
[0m01:16:59.767842 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m01:16:59.768305 [debug] [MainThread]: On master: COMMIT
[0m01:16:59.768789 [debug] [MainThread]: Using postgres connection "master"
[0m01:16:59.769228 [debug] [MainThread]: On master: COMMIT
[0m01:16:59.770055 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:16:59.770665 [debug] [MainThread]: On master: Close
[0m01:16:59.777689 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m01:16:59.778474 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m01:16:59.779260 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m01:16:59.780140 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m01:16:59.781021 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m01:16:59.781697 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_movies_directors)
[0m01:16:59.782414 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m01:16:59.783049 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m01:16:59.794977 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m01:16:59.797678 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m01:16:59.799664 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m01:16:59.800414 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m01:16:59.978821 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m01:16:59.979694 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m01:16:59.980969 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:16:59.981612 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m01:16:59.982291 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:16:59.982927 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:16:59.983590 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m01:16:59.984590 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:16:59.997289 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m01:16:59.997982 [debug] [Thread-2 (]: SQL status: BEGIN in 0.013 seconds
[0m01:16:59.998746 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:16:59.999419 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:17:00.000047 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m01:17:00.000734 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m01:17:00.005740 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m01:17:00.012216 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.011 seconds
[0m01:17:00.015863 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:17:00.020176 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:17:00.021178 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m01:17:00.022470 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m01:17:00.024052 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:17:00.024934 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m01:17:00.028579 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:17:00.032654 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:17:00.033668 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m01:17:00.034876 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m01:17:00.036259 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:17:00.036801 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:17:00.076439 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m01:17:00.077300 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:17:00.077892 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:17:00.078673 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:17:00.079330 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m01:17:00.080077 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:17:00.087278 [debug] [Thread-2 (]: SQL status: COMMIT in 0.006 seconds
[0m01:17:00.093619 [debug] [Thread-1 (]: SQL status: COMMIT in 0.013 seconds
[0m01:17:00.098750 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m01:17:00.101552 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m01:17:00.111808 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:17:00.113417 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:17:00.114586 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m01:17:00.115745 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m01:17:00.122672 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.006 seconds
[0m01:17:00.126811 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m01:17:00.127435 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.010 seconds
[0m01:17:00.129226 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m01:17:00.131639 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4108b2e6-a4ed-4f6a-a31b-8c7d3a0089f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b09609c72f0>]}
[0m01:17:00.132424 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4108b2e6-a4ed-4f6a-a31b-8c7d3a0089f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b09651f07d0>]}
[0m01:17:00.133345 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.35s]
[0m01:17:00.134483 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.35s]
[0m01:17:00.135718 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m01:17:00.136658 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m01:17:00.138473 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m01:17:00.139367 [info ] [Thread-4 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m01:17:00.140490 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m01:17:00.141385 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m01:17:00.151688 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m01:17:00.152734 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m01:17:00.216964 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m01:17:00.217780 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

    
  
    

  create temporary table "comments_by_user_incremental__dbt_tmp011700189934"
  
  
    as
  
  (
    

WITH max_existing AS (
  
      SELECT max(load_date AT TIME ZONE 'UTC') AS max_load_date
      FROM "test_db"."public_marts"."comments_by_user_incremental"
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE (c.load_date AT TIME ZONE 'UTC') > coalesce(m.max_load_date, '1900-01-01'::timestamp)
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

final AS (
  
    SELECT * FROM "test_db"."public_marts"."comments_by_user_incremental"
    UNION ALL
    SELECT * FROM new_agg
  
),

flat AS (
  
   SELECT
      name,
      email,
      total_count as comment_count,
      unnest(movie_ids) AS movie_id,
      load_date
    FROM (
        SELECT
            name,
            email,
            SUM(comment_count) OVER (PARTITION BY name, email) AS total_count
            movie_ids,
            load_date
    FROM final
    GROUP BY 
  
)


SELECT
  name,
  email,
  comment_count,
  array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
  max(load_date) AS load_date
FROM flat
GROUP BY name, email
ORDER BY comment_count DESC

  );
  
  
[0m01:17:00.218485 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:17:00.234759 [debug] [Thread-4 (]: Postgres adapter: Postgres error: syntax error at or near "movie_ids"
LINE 61:             movie_ids,
                     ^

[0m01:17:00.235622 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m01:17:00.243218 [debug] [Thread-4 (]: Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  syntax error at or near "movie_ids"
  LINE 61:             movie_ids,
                       ^
[0m01:17:00.243967 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4108b2e6-a4ed-4f6a-a31b-8c7d3a0089f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b0960e90200>]}
[0m01:17:00.244877 [error] [Thread-4 (]: 3 of 3 ERROR creating sql incremental model public_marts.comments_by_user_incremental  [[31mERROR[0m in 0.10s]
[0m01:17:00.245902 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m01:17:00.246812 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.comments_by_user_incremental' to be skipped because of status 'error'.  Reason: Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  syntax error at or near "movie_ids"
  LINE 61:             movie_ids,
                       ^.
[0m01:17:00.250743 [debug] [MainThread]: Using postgres connection "master"
[0m01:17:00.251216 [debug] [MainThread]: On master: BEGIN
[0m01:17:00.251646 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:17:00.266420 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m01:17:00.267222 [debug] [MainThread]: On master: COMMIT
[0m01:17:00.267873 [debug] [MainThread]: Using postgres connection "master"
[0m01:17:00.268400 [debug] [MainThread]: On master: COMMIT
[0m01:17:00.269102 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:17:00.269554 [debug] [MainThread]: On master: Close
[0m01:17:00.270405 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:17:00.270862 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m01:17:00.271261 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m01:17:00.271648 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m01:17:00.272197 [info ] [MainThread]: 
[0m01:17:00.272778 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 0.71 seconds (0.71s).
[0m01:17:00.274025 [debug] [MainThread]: Command end result
[0m01:17:00.304794 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:17:00.307360 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:17:00.316113 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m01:17:00.316709 [info ] [MainThread]: 
[0m01:17:00.317409 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m01:17:00.318047 [info ] [MainThread]: 
[0m01:17:00.318821 [error] [MainThread]: [31mFailure in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)[0m
[0m01:17:00.319463 [error] [MainThread]:   Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  syntax error at or near "movie_ids"
  LINE 61:             movie_ids,
                       ^
[0m01:17:00.319986 [info ] [MainThread]: 
[0m01:17:00.320625 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql
[0m01:17:00.321136 [info ] [MainThread]: 
[0m01:17:00.321694 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=3
[0m01:17:00.323077 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.2911668, "process_in_blocks": "0", "process_kernel_time": 0.92488, "process_mem_max_rss": "131056", "process_out_blocks": "2704", "process_user_time": 4.106151}
[0m01:17:00.323815 [debug] [MainThread]: Command `dbt run` failed at 01:17:00.323658 after 2.29 seconds
[0m01:17:00.324387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b09618bdc70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b095f9e98e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b095f9ea930>]}
[0m01:17:00.325205 [debug] [MainThread]: Flushing usage events
[0m01:17:01.524571 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:19:43.041379 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a8079b58e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a807201970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a8073b89e0>]}


============================== 01:19:43.047709 | d68d1069-de86-44b1-a70a-a668f9e8a398 ==============================
[0m01:19:43.047709 [info ] [MainThread]: Running with dbt=1.10.6
[0m01:19:43.048479 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m01:19:54.237206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd68d1069-de86-44b1-a70a-a668f9e8a398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a8065d15b0>]}
[0m01:19:43.451697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd68d1069-de86-44b1-a70a-a668f9e8a398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a807646ba0>]}
[0m01:19:43.453381 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m01:19:43.622776 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m01:19:43.763631 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:19:43.764663 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user_incremental.sql
[0m01:19:44.240561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd68d1069-de86-44b1-a70a-a668f9e8a398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a804ded130>]}
[0m01:19:44.351696 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:19:44.354717 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:19:44.376628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd68d1069-de86-44b1-a70a-a668f9e8a398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a8051345f0>]}
[0m01:19:44.377473 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m01:19:44.378022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd68d1069-de86-44b1-a70a-a668f9e8a398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a80515faa0>]}
[0m01:19:44.380677 [info ] [MainThread]: 
[0m01:19:44.381432 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:19:44.381937 [info ] [MainThread]: 
[0m01:19:44.382660 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:19:44.388231 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:19:44.389843 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:19:44.450444 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:19:44.451310 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:19:44.452128 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:19:44.452870 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:19:44.453621 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:19:44.454234 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:19:44.471206 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.018 seconds
[0m01:19:44.471875 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.018 seconds
[0m01:19:44.473638 [debug] [ThreadPool]: On list_test_db: Close
[0m01:19:44.475824 [debug] [ThreadPool]: On list_test_db: Close
[0m01:19:44.479383 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m01:19:44.486010 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m01:19:44.489182 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:19:44.492298 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:19:44.493282 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m01:19:44.494034 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m01:19:44.494630 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:19:44.495231 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:19:44.508112 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m01:19:44.508951 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:19:44.509564 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m01:19:44.510119 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m01:19:44.510730 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:19:44.511591 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m01:19:44.516813 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.005 seconds
[0m01:19:44.517779 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.005 seconds
[0m01:19:44.519574 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m01:19:44.521886 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m01:19:44.523044 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m01:19:44.523899 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m01:19:44.532292 [debug] [MainThread]: Using postgres connection "master"
[0m01:19:44.532996 [debug] [MainThread]: On master: BEGIN
[0m01:19:44.533436 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:19:44.548307 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m01:19:44.548984 [debug] [MainThread]: Using postgres connection "master"
[0m01:19:44.549510 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:19:44.558439 [debug] [MainThread]: SQL status: SELECT 3 in 0.008 seconds
[0m01:19:44.560808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd68d1069-de86-44b1-a70a-a668f9e8a398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a803457a40>]}
[0m01:19:44.561426 [debug] [MainThread]: On master: ROLLBACK
[0m01:19:44.562351 [debug] [MainThread]: Using postgres connection "master"
[0m01:19:44.562811 [debug] [MainThread]: On master: BEGIN
[0m01:19:44.564203 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m01:19:44.564840 [debug] [MainThread]: On master: COMMIT
[0m01:19:44.565345 [debug] [MainThread]: Using postgres connection "master"
[0m01:19:44.565821 [debug] [MainThread]: On master: COMMIT
[0m01:19:44.566630 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:19:44.567154 [debug] [MainThread]: On master: Close
[0m01:19:44.572729 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m01:19:44.573377 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m01:19:44.574147 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m01:19:44.575134 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m01:19:44.576058 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m01:19:44.576894 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_movies_directors)
[0m01:19:44.577535 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m01:19:44.578194 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m01:19:44.590241 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m01:19:44.593345 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m01:19:44.594625 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m01:19:44.595427 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m01:19:44.768525 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m01:19:44.769769 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m01:19:44.771051 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:19:44.771685 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:19:44.772281 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m01:19:44.773062 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m01:19:44.773740 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:19:44.774388 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:19:44.787244 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m01:19:44.788104 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:19:44.788973 [debug] [Thread-2 (]: SQL status: BEGIN in 0.015 seconds
[0m01:19:44.789530 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m01:19:44.790230 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:19:44.790984 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m01:19:44.795556 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m01:19:44.796225 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m01:19:44.804998 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:19:44.809012 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:19:44.809795 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m01:19:44.810521 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m01:19:44.812173 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:19:44.812833 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:19:44.816611 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:19:44.819923 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:19:44.821374 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m01:19:44.822073 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m01:19:44.823575 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:19:44.824152 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:19:44.848556 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:19:44.846193 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m01:19:44.849796 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:19:44.850507 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:19:44.851177 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:19:44.851845 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m01:19:44.859025 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m01:19:44.866079 [debug] [Thread-2 (]: SQL status: COMMIT in 0.013 seconds
[0m01:19:44.868968 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m01:19:44.871775 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m01:19:44.882160 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:19:44.883939 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m01:19:44.883262 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:19:44.884997 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m01:19:44.890450 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.006 seconds
[0m01:19:44.894074 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m01:19:44.894764 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.009 seconds
[0m01:19:44.898692 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m01:19:44.899314 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd68d1069-de86-44b1-a70a-a668f9e8a398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a804d60c80>]}
[0m01:19:44.901729 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd68d1069-de86-44b1-a70a-a668f9e8a398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a807b33470>]}
[0m01:19:44.900823 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.32s]
[0m01:19:44.903026 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.32s]
[0m01:19:44.904073 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m01:19:44.905132 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m01:19:44.906517 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m01:19:44.907771 [info ] [Thread-4 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m01:19:44.908641 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m01:19:44.909231 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m01:19:44.919172 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m01:19:44.920947 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m01:19:44.980909 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m01:19:44.982063 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

    
  
    

  create temporary table "comments_by_user_incremental__dbt_tmp011944959984"
  
  
    as
  
  (
    

WITH max_existing AS (
  
      SELECT max(load_date AT TIME ZONE 'UTC') AS max_load_date
      FROM "test_db"."public_marts"."comments_by_user_incremental"
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE (c.load_date AT TIME ZONE 'UTC') > coalesce(m.max_load_date, '1900-01-01'::timestamp)
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_id,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

final AS (
  
    SELECT * FROM "test_db"."public_marts"."comments_by_user_incremental"
    UNION ALL
    SELECT * FROM new_agg
  
),

flat AS (
  
   SELECT
      name,
      email,
      total_comment_count,
      unnest(movie_ids) AS movie_id,
      load_date
    FROM (
        SELECT
            name,
            email,
            SUM(comment_count) OVER (PARTITION BY name, email) AS total_comment_count
            movie_ids,
            load_date
    FROM final
    GROUP BY 
  
)


SELECT
  name,
  email,
  total_comment_count as comment_count
  array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
  max(load_date) AS load_date
FROM flat
GROUP BY name, email
ORDER BY comment_count DESC

  );
  
  
[0m01:19:44.982844 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:19:44.996704 [debug] [Thread-4 (]: Postgres adapter: Postgres error: syntax error at or near "movie_ids"
LINE 61:             movie_ids,
                     ^

[0m01:19:44.997561 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m01:19:45.003039 [debug] [Thread-4 (]: Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  syntax error at or near "movie_ids"
  LINE 61:             movie_ids,
                       ^
[0m01:19:45.003942 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd68d1069-de86-44b1-a70a-a668f9e8a398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a8033abd10>]}
[0m01:19:45.004995 [error] [Thread-4 (]: 3 of 3 ERROR creating sql incremental model public_marts.comments_by_user_incremental  [[31mERROR[0m in 0.10s]
[0m01:19:45.006198 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m01:19:45.007158 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.comments_by_user_incremental' to be skipped because of status 'error'.  Reason: Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  syntax error at or near "movie_ids"
  LINE 61:             movie_ids,
                       ^.
[0m01:19:45.011666 [debug] [MainThread]: Using postgres connection "master"
[0m01:19:45.012353 [debug] [MainThread]: On master: BEGIN
[0m01:19:45.013107 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:19:45.027654 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m01:19:45.028326 [debug] [MainThread]: On master: COMMIT
[0m01:19:45.029050 [debug] [MainThread]: Using postgres connection "master"
[0m01:19:45.029565 [debug] [MainThread]: On master: COMMIT
[0m01:19:45.030335 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:19:45.030818 [debug] [MainThread]: On master: Close
[0m01:19:45.031837 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:19:45.032542 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m01:19:45.033055 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m01:19:45.033463 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m01:19:45.034015 [info ] [MainThread]: 
[0m01:19:45.034561 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 0.65 seconds (0.65s).
[0m01:19:45.036117 [debug] [MainThread]: Command end result
[0m01:19:45.068503 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:19:45.070873 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:19:45.078751 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m01:19:45.079330 [info ] [MainThread]: 
[0m01:19:45.079985 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m01:19:45.080984 [info ] [MainThread]: 
[0m01:19:45.081913 [error] [MainThread]: [31mFailure in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)[0m
[0m01:19:45.082720 [error] [MainThread]:   Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  syntax error at or near "movie_ids"
  LINE 61:             movie_ids,
                       ^
[0m01:19:45.083295 [info ] [MainThread]: 
[0m01:19:45.083880 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql
[0m01:19:45.084428 [info ] [MainThread]: 
[0m01:19:45.084984 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=3
[0m01:19:45.086371 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.1692612, "process_in_blocks": "0", "process_kernel_time": 0.68519, "process_mem_max_rss": "131060", "process_out_blocks": "2712", "process_user_time": 3.975695}
[0m01:19:45.087042 [debug] [MainThread]: Command `dbt run` failed at 01:19:45.086901 after 2.17 seconds
[0m01:19:45.087726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a806ba04d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a803243380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a80337f860>]}
[0m01:19:45.088288 [debug] [MainThread]: Flushing usage events
[0m01:19:46.392584 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:20:08.689474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738f77845a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738f78415a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738f778456d0>]}


============================== 01:20:08.694223 | 506d6afc-d247-4c2f-b0d4-cd399db5d431 ==============================
[0m01:20:08.694223 [info ] [MainThread]: Running with dbt=1.10.6
[0m01:20:08.695052 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:20:08.984425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '506d6afc-d247-4c2f-b0d4-cd399db5d431', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738f7795ac30>]}
[0m01:20:09.110645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '506d6afc-d247-4c2f-b0d4-cd399db5d431', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738f782228a0>]}
[0m01:20:09.111863 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m01:20:09.260905 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m01:20:09.398585 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:20:09.399663 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user_incremental.sql
[0m01:20:09.876590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '506d6afc-d247-4c2f-b0d4-cd399db5d431', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738f759ed250>]}
[0m01:20:09.973518 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:20:09.976074 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:20:09.993308 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '506d6afc-d247-4c2f-b0d4-cd399db5d431', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738f7693adb0>]}
[0m01:20:09.994064 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m01:20:09.994675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '506d6afc-d247-4c2f-b0d4-cd399db5d431', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738f759587d0>]}
[0m01:20:09.997037 [info ] [MainThread]: 
[0m01:20:09.997646 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:20:09.998260 [info ] [MainThread]: 
[0m01:20:09.999268 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:20:10.005930 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:20:10.007663 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:20:10.072156 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:20:10.072787 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:20:10.073421 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:20:10.074048 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:20:10.074622 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:20:10.075273 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:20:10.093588 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.018 seconds
[0m01:20:10.094270 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.020 seconds
[0m01:20:10.096124 [debug] [ThreadPool]: On list_test_db: Close
[0m01:20:10.098512 [debug] [ThreadPool]: On list_test_db: Close
[0m01:20:10.102414 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m01:20:10.103497 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m01:20:10.111552 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:20:10.114474 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:20:10.115443 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m01:20:10.116224 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m01:20:10.116813 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:20:10.117408 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:20:10.130247 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m01:20:10.131024 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:20:10.131597 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m01:20:10.132215 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m01:20:10.132848 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:20:10.133784 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m01:20:10.140041 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.006 seconds
[0m01:20:10.140692 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.006 seconds
[0m01:20:10.142329 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m01:20:10.144164 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m01:20:10.145085 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m01:20:10.145814 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m01:20:10.153961 [debug] [MainThread]: Using postgres connection "master"
[0m01:20:10.154540 [debug] [MainThread]: On master: BEGIN
[0m01:20:10.155189 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:20:10.168126 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m01:20:10.168777 [debug] [MainThread]: Using postgres connection "master"
[0m01:20:10.169672 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:20:10.179196 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m01:20:10.181169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '506d6afc-d247-4c2f-b0d4-cd399db5d431', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738f76de6810>]}
[0m01:20:10.181885 [debug] [MainThread]: On master: ROLLBACK
[0m01:20:10.182638 [debug] [MainThread]: Using postgres connection "master"
[0m01:20:10.183092 [debug] [MainThread]: On master: BEGIN
[0m01:20:10.184199 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m01:20:10.184665 [debug] [MainThread]: On master: COMMIT
[0m01:20:10.185181 [debug] [MainThread]: Using postgres connection "master"
[0m01:20:10.185828 [debug] [MainThread]: On master: COMMIT
[0m01:20:10.186551 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:20:10.187012 [debug] [MainThread]: On master: Close
[0m01:20:10.192318 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m01:20:10.192956 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m01:20:10.193895 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m01:20:10.194779 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m01:20:10.195678 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m01:20:10.196346 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_movies_directors)
[0m01:20:10.197020 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m01:20:10.197624 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m01:20:10.210023 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m01:20:10.212922 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m01:20:10.214579 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m01:20:10.215303 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m01:20:10.423555 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m01:20:10.427313 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m01:20:10.429063 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:20:10.429758 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:20:10.430365 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m01:20:10.431027 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m01:20:10.431733 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:10.432390 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:20:10.446513 [debug] [Thread-2 (]: SQL status: BEGIN in 0.014 seconds
[0m01:20:10.447381 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m01:20:10.447966 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:20:10.448646 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:20:10.449337 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m01:20:10.450071 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m01:20:10.453035 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m01:20:10.458998 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.008 seconds
[0m01:20:10.462557 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:20:10.466729 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:20:10.467812 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m01:20:10.468531 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m01:20:10.469904 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:20:10.470465 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:20:10.474948 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:20:10.478694 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:20:10.479870 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m01:20:10.480861 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m01:20:10.482496 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:20:10.483332 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:20:10.507674 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:20:10.508179 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m01:20:10.508819 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:20:10.509485 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:20:10.510222 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:20:10.510918 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m01:20:10.517805 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m01:20:10.524540 [debug] [Thread-2 (]: SQL status: COMMIT in 0.013 seconds
[0m01:20:10.527497 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m01:20:10.530697 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m01:20:10.540573 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:20:10.541725 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:20:10.542468 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m01:20:10.543233 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m01:20:10.549043 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.005 seconds
[0m01:20:10.552897 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m01:20:10.553580 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.010 seconds
[0m01:20:10.556185 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m01:20:10.559639 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '506d6afc-d247-4c2f-b0d4-cd399db5d431', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738f7856b170>]}
[0m01:20:10.560587 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '506d6afc-d247-4c2f-b0d4-cd399db5d431', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738f778a07d0>]}
[0m01:20:10.561680 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.36s]
[0m01:20:10.562881 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.36s]
[0m01:20:10.564121 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m01:20:10.565009 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m01:20:10.567030 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m01:20:10.567948 [info ] [Thread-4 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m01:20:10.568849 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m01:20:10.569554 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m01:20:10.590405 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m01:20:10.595584 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m01:20:10.665432 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m01:20:10.666127 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

    
  
    

  create temporary table "comments_by_user_incremental__dbt_tmp012010642563"
  
  
    as
  
  (
    

WITH max_existing AS (
  
      SELECT max(load_date AT TIME ZONE 'UTC') AS max_load_date
      FROM "test_db"."public_marts"."comments_by_user_incremental"
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE (c.load_date AT TIME ZONE 'UTC') > coalesce(m.max_load_date, '1900-01-01'::timestamp)
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

final AS (
  
    SELECT * FROM "test_db"."public_marts"."comments_by_user_incremental"
    UNION ALL
    SELECT * FROM new_agg
  
),

flat AS (
  
   SELECT
      name,
      email,
      total_comment_count,
      unnest(movie_ids) AS movie_id,
      load_date
    FROM (
        SELECT
            name,
            email,
            SUM(comment_count) OVER (PARTITION BY name, email) AS total_comment_count,
            movie_ids,
            load_date
    FROM final
    GROUP BY 
  
)
)


SELECT
  name,
  email,
  total_comment_count as comment_count
  array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
  max(load_date) AS load_date
FROM flat
GROUP BY name, email
ORDER BY comment_count DESC

  );
  
  
[0m01:20:10.666702 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:20:10.681202 [debug] [Thread-4 (]: Postgres adapter: Postgres error: syntax error at or near ")"
LINE 66: )
         ^

[0m01:20:10.682007 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m01:20:10.688733 [debug] [Thread-4 (]: Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  syntax error at or near ")"
  LINE 66: )
           ^
[0m01:20:10.689867 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '506d6afc-d247-4c2f-b0d4-cd399db5d431', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738f6fe72ae0>]}
[0m01:20:10.690881 [error] [Thread-4 (]: 3 of 3 ERROR creating sql incremental model public_marts.comments_by_user_incremental  [[31mERROR[0m in 0.12s]
[0m01:20:10.691926 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m01:20:10.692801 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.comments_by_user_incremental' to be skipped because of status 'error'.  Reason: Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  syntax error at or near ")"
  LINE 66: )
           ^.
[0m01:20:10.697350 [debug] [MainThread]: Using postgres connection "master"
[0m01:20:10.697828 [debug] [MainThread]: On master: BEGIN
[0m01:20:10.698334 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:20:10.712274 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m01:20:10.713062 [debug] [MainThread]: On master: COMMIT
[0m01:20:10.713820 [debug] [MainThread]: Using postgres connection "master"
[0m01:20:10.715443 [debug] [MainThread]: On master: COMMIT
[0m01:20:10.716717 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m01:20:10.717662 [debug] [MainThread]: On master: Close
[0m01:20:10.718548 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:20:10.719004 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m01:20:10.719721 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m01:20:10.720148 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m01:20:10.720669 [info ] [MainThread]: 
[0m01:20:10.721294 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 0.72 seconds (0.72s).
[0m01:20:10.723090 [debug] [MainThread]: Command end result
[0m01:20:10.760899 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:20:10.763269 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:20:10.770901 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m01:20:10.771591 [info ] [MainThread]: 
[0m01:20:10.772503 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m01:20:10.773306 [info ] [MainThread]: 
[0m01:20:10.774233 [error] [MainThread]: [31mFailure in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)[0m
[0m01:20:10.774881 [error] [MainThread]:   Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  syntax error at or near ")"
  LINE 66: )
           ^
[0m01:20:10.775562 [info ] [MainThread]: 
[0m01:20:10.776202 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql
[0m01:20:10.776886 [info ] [MainThread]: 
[0m01:20:10.777590 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=3
[0m01:20:10.779017 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.2227445, "process_in_blocks": "0", "process_kernel_time": 0.7015, "process_mem_max_rss": "131156", "process_out_blocks": "2704", "process_user_time": 4.045586}
[0m01:20:10.779955 [debug] [MainThread]: Command `dbt run` failed at 01:20:10.779804 after 2.22 seconds
[0m01:20:10.780727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738f77908680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738f778cffb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738f6fe9ab70>]}
[0m01:20:10.781547 [debug] [MainThread]: Flushing usage events
[0m01:20:11.934843 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:22:04.948870 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7668dc7f5640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7668dc582480>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7668dc6841a0>]}


============================== 01:22:04.953806 | de536db9-af20-4339-896e-6904cb6822dc ==============================
[0m01:22:04.953806 [info ] [MainThread]: Running with dbt=1.10.6
[0m01:22:04.954770 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:22:05.280278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'de536db9-af20-4339-896e-6904cb6822dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7668dbf36600>]}
[0m01:22:05.404633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'de536db9-af20-4339-896e-6904cb6822dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7668dbfddf40>]}
[0m01:22:05.405760 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m01:22:05.559062 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m01:22:05.702547 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:22:05.703903 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user_incremental.sql
[0m01:22:06.207769 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'de536db9-af20-4339-896e-6904cb6822dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7668dabe5160>]}
[0m01:22:06.313273 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:22:06.316038 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:22:06.334950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'de536db9-af20-4339-896e-6904cb6822dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7668dbfdd970>]}
[0m01:22:06.335652 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m01:22:06.336353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'de536db9-af20-4339-896e-6904cb6822dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7668dab2b530>]}
[0m01:22:06.339197 [info ] [MainThread]: 
[0m01:22:06.339815 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:22:06.340461 [info ] [MainThread]: 
[0m01:22:06.341485 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:22:06.348811 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:22:06.350894 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:22:06.419653 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:22:06.420407 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:22:06.421139 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:22:06.421841 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:22:06.422507 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:22:06.423238 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:22:06.444667 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.022 seconds
[0m01:22:06.445274 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.022 seconds
[0m01:22:06.447377 [debug] [ThreadPool]: On list_test_db: Close
[0m01:22:06.449315 [debug] [ThreadPool]: On list_test_db: Close
[0m01:22:06.452917 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m01:22:06.454087 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m01:22:06.463237 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:22:06.466040 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:22:06.466915 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m01:22:06.467718 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m01:22:06.468454 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:22:06.469118 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:22:06.483281 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m01:22:06.484270 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:22:06.485003 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m01:22:06.485697 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m01:22:06.486720 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:22:06.487829 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m01:22:06.497416 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.008 seconds
[0m01:22:06.498035 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.010 seconds
[0m01:22:06.500193 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m01:22:06.501901 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m01:22:06.502988 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m01:22:06.503456 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m01:22:06.512126 [debug] [MainThread]: Using postgres connection "master"
[0m01:22:06.512675 [debug] [MainThread]: On master: BEGIN
[0m01:22:06.513125 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:22:06.526960 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m01:22:06.527788 [debug] [MainThread]: Using postgres connection "master"
[0m01:22:06.528328 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:22:06.537475 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m01:22:06.539633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'de536db9-af20-4339-896e-6904cb6822dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7668d8e6caa0>]}
[0m01:22:06.540537 [debug] [MainThread]: On master: ROLLBACK
[0m01:22:06.541433 [debug] [MainThread]: Using postgres connection "master"
[0m01:22:06.542155 [debug] [MainThread]: On master: BEGIN
[0m01:22:06.543469 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m01:22:06.544245 [debug] [MainThread]: On master: COMMIT
[0m01:22:06.544916 [debug] [MainThread]: Using postgres connection "master"
[0m01:22:06.545548 [debug] [MainThread]: On master: COMMIT
[0m01:22:06.546419 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:22:06.547209 [debug] [MainThread]: On master: Close
[0m01:22:06.553671 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m01:22:06.554505 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m01:22:06.555638 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m01:22:06.556525 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m01:22:06.557348 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m01:22:06.557980 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_movies_directors)
[0m01:22:06.558603 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m01:22:06.559305 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m01:22:06.572400 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m01:22:06.576221 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m01:22:06.577632 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m01:22:06.578288 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m01:22:06.737448 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m01:22:06.741258 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m01:22:06.743095 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:22:06.743691 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:22:06.744317 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m01:22:06.744991 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m01:22:06.745672 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:22:06.746419 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:22:06.760489 [debug] [Thread-2 (]: SQL status: BEGIN in 0.015 seconds
[0m01:22:06.761319 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m01:22:06.762178 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:22:06.763083 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:22:06.763771 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m01:22:06.764480 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m01:22:06.768250 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m01:22:06.775123 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m01:22:06.779439 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:22:06.784127 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:22:06.784933 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m01:22:06.785646 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m01:22:06.787362 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:22:06.788079 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m01:22:06.791661 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:22:06.795334 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:22:06.796307 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m01:22:06.796994 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m01:22:06.798208 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:22:06.798862 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:22:06.835899 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m01:22:06.837224 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:22:06.837825 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:22:06.838562 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:22:06.839406 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m01:22:06.840096 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:22:06.847726 [debug] [Thread-2 (]: SQL status: COMMIT in 0.007 seconds
[0m01:22:06.848347 [debug] [Thread-1 (]: SQL status: COMMIT in 0.007 seconds
[0m01:22:06.857562 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m01:22:06.860496 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m01:22:06.870609 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:22:06.872136 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:22:06.872792 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m01:22:06.873854 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m01:22:06.880090 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.005 seconds
[0m01:22:06.880966 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.006 seconds
[0m01:22:06.884499 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m01:22:06.886332 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m01:22:06.889468 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'de536db9-af20-4339-896e-6904cb6822dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7668dab5d190>]}
[0m01:22:06.889980 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'de536db9-af20-4339-896e-6904cb6822dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7668dc41cf50>]}
[0m01:22:06.891080 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.33s]
[0m01:22:06.892239 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.33s]
[0m01:22:06.893418 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m01:22:06.894264 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m01:22:06.896612 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m01:22:06.897386 [info ] [Thread-4 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m01:22:06.898173 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m01:22:06.898725 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m01:22:06.909162 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m01:22:06.910187 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m01:22:06.970275 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m01:22:06.971012 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

    
  
    

  create temporary table "comments_by_user_incremental__dbt_tmp012206949850"
  
  
    as
  
  (
    

WITH max_existing AS (
  
      SELECT max(load_date AT TIME ZONE 'UTC') AS max_load_date
      FROM "test_db"."public_marts"."comments_by_user_incremental"
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE (c.load_date AT TIME ZONE 'UTC') > coalesce(m.max_load_date, '1900-01-01'::timestamp)
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

final AS (
  
    SELECT * FROM "test_db"."public_marts"."comments_by_user_incremental"
    UNION ALL
    SELECT * FROM new_agg
  
),

flat AS (
  
   SELECT
      name,
      email,
      total_comment_count,
      unnest(movie_ids) AS movie_id,
      load_date
    FROM (
        SELECT
            name,
            email,
            SUM(comment_count) OVER (PARTITION BY name, email) AS total_comment_count,
            movie_ids,
            load_date
    FROM final)
  
)


SELECT
  name,
  email,
  total_comment_count as comment_count
  array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
  max(load_date) AS load_date
FROM flat
GROUP BY name, email
ORDER BY comment_count DESC

  );
  
  
[0m01:22:06.971601 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:22:06.985750 [debug] [Thread-4 (]: Postgres adapter: Postgres error: syntax error at or near "array_agg"
LINE 72:   array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_id...
           ^

[0m01:22:06.986710 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m01:22:06.993364 [debug] [Thread-4 (]: Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  syntax error at or near "array_agg"
  LINE 72:   array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_id...
             ^
[0m01:22:06.994107 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'de536db9-af20-4339-896e-6904cb6822dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7668db3d4da0>]}
[0m01:22:06.995049 [error] [Thread-4 (]: 3 of 3 ERROR creating sql incremental model public_marts.comments_by_user_incremental  [[31mERROR[0m in 0.10s]
[0m01:22:06.996085 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m01:22:06.997062 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.comments_by_user_incremental' to be skipped because of status 'error'.  Reason: Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  syntax error at or near "array_agg"
  LINE 72:   array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_id...
             ^.
[0m01:22:07.000884 [debug] [MainThread]: Using postgres connection "master"
[0m01:22:07.001430 [debug] [MainThread]: On master: BEGIN
[0m01:22:07.001876 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:22:07.014988 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m01:22:07.015601 [debug] [MainThread]: On master: COMMIT
[0m01:22:07.016241 [debug] [MainThread]: Using postgres connection "master"
[0m01:22:07.016923 [debug] [MainThread]: On master: COMMIT
[0m01:22:07.017902 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:22:07.018545 [debug] [MainThread]: On master: Close
[0m01:22:07.019732 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:22:07.020376 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m01:22:07.020931 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m01:22:07.021462 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m01:22:07.022202 [info ] [MainThread]: 
[0m01:22:07.023014 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 0.68 seconds (0.68s).
[0m01:22:07.024977 [debug] [MainThread]: Command end result
[0m01:22:07.060174 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:22:07.062567 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:22:07.071741 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m01:22:07.072339 [info ] [MainThread]: 
[0m01:22:07.072917 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m01:22:07.073531 [info ] [MainThread]: 
[0m01:22:07.074243 [error] [MainThread]: [31mFailure in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)[0m
[0m01:22:07.074893 [error] [MainThread]:   Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  syntax error at or near "array_agg"
  LINE 72:   array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_id...
             ^
[0m01:22:07.075420 [info ] [MainThread]: 
[0m01:22:07.076022 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql
[0m01:22:07.076595 [info ] [MainThread]: 
[0m01:22:07.077134 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=3
[0m01:22:07.078498 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.2533414, "process_in_blocks": "0", "process_kernel_time": 0.869076, "process_mem_max_rss": "131528", "process_out_blocks": "2696", "process_user_time": 4.097074}
[0m01:22:07.079244 [debug] [MainThread]: Command `dbt run` failed at 01:22:07.079104 after 2.25 seconds
[0m01:22:07.079756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7668dca5bf20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7668de1e7080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7668d8e7a870>]}
[0m01:22:07.080317 [debug] [MainThread]: Flushing usage events
[0m01:22:08.280022 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:22:23.082245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ebe7ba8b30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ebe728e4b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ebe7ba8170>]}


============================== 01:22:23.087127 | ec2476f0-4d05-4a88-9fc9-c426f85adb5e ==============================
[0m01:22:23.087127 [info ] [MainThread]: Running with dbt=1.10.6
[0m01:22:23.088042 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'version_check': 'True', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m01:22:23.378008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ec2476f0-4d05-4a88-9fc9-c426f85adb5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ebe6da6c60>]}
[0m01:22:34.437279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ec2476f0-4d05-4a88-9fc9-c426f85adb5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ebe6d08ad0>]}
[0m01:22:34.438381 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m01:22:34.590308 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m01:22:23.830824 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:22:23.831693 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user_incremental.sql
[0m01:22:24.332209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ec2476f0-4d05-4a88-9fc9-c426f85adb5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ebe55e9100>]}
[0m01:22:24.430653 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:22:24.433145 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:22:24.449790 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ec2476f0-4d05-4a88-9fc9-c426f85adb5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ebe614b4d0>]}
[0m01:22:24.450516 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m01:22:24.451251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ec2476f0-4d05-4a88-9fc9-c426f85adb5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ebe6916b40>]}
[0m01:22:24.455026 [info ] [MainThread]: 
[0m01:22:24.455901 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:22:24.456708 [info ] [MainThread]: 
[0m01:22:24.457999 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:22:24.465122 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:22:24.466871 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:22:24.536200 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:22:24.536925 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:22:24.537598 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:22:24.538250 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:22:24.538829 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:22:24.539434 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:22:24.555293 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.016 seconds
[0m01:22:24.555916 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.016 seconds
[0m01:22:24.557773 [debug] [ThreadPool]: On list_test_db: Close
[0m01:22:24.559971 [debug] [ThreadPool]: On list_test_db: Close
[0m01:22:24.563163 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m01:22:24.569828 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m01:22:24.573203 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:22:24.576044 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:22:24.577065 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m01:22:24.577776 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m01:22:24.578395 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:22:24.578996 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:22:24.593297 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m01:22:24.593924 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:22:24.594398 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m01:22:24.598494 [debug] [ThreadPool]: SQL status: BEGIN in 0.019 seconds
[0m01:22:24.599003 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:22:24.599483 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.005 seconds
[0m01:22:24.600044 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m01:22:24.601994 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m01:22:24.603470 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m01:22:24.609260 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.006 seconds
[0m01:22:24.611347 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m01:22:24.612336 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m01:22:24.618522 [debug] [MainThread]: Using postgres connection "master"
[0m01:22:24.619072 [debug] [MainThread]: On master: BEGIN
[0m01:22:24.619626 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:22:24.638793 [debug] [MainThread]: SQL status: BEGIN in 0.019 seconds
[0m01:22:24.639437 [debug] [MainThread]: Using postgres connection "master"
[0m01:22:24.639956 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:22:24.648857 [debug] [MainThread]: SQL status: SELECT 3 in 0.008 seconds
[0m01:22:24.651345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ec2476f0-4d05-4a88-9fc9-c426f85adb5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ebe59735c0>]}
[0m01:22:24.652239 [debug] [MainThread]: On master: ROLLBACK
[0m01:22:24.653454 [debug] [MainThread]: Using postgres connection "master"
[0m01:22:24.654109 [debug] [MainThread]: On master: BEGIN
[0m01:22:24.655416 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m01:22:24.656055 [debug] [MainThread]: On master: COMMIT
[0m01:22:24.656778 [debug] [MainThread]: Using postgres connection "master"
[0m01:22:24.657331 [debug] [MainThread]: On master: COMMIT
[0m01:22:24.658207 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:22:24.658818 [debug] [MainThread]: On master: Close
[0m01:22:24.664509 [debug] [Thread-1 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m01:22:24.665214 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_comments
[0m01:22:24.666617 [debug] [Thread-3 (]: Began running node model.mongo_movies.stg_movies_directors
[0m01:22:24.666008 [info ] [Thread-1 (]: 1 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m01:22:24.667952 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m01:22:24.668940 [info ] [Thread-3 (]: 3 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m01:22:24.669957 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.comments_by_user_incremental)
[0m01:22:24.670922 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m01:22:24.671893 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.stg_movies_directors'
[0m01:22:24.672673 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m01:22:24.673318 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_comments
[0m01:22:24.674315 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m01:22:24.694531 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m01:22:24.697382 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m01:22:24.698820 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_comments
[0m01:22:24.699395 [debug] [Thread-3 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m01:22:24.858858 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m01:22:24.861436 [debug] [Thread-3 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m01:22:24.862953 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:22:24.864268 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:22:24.864980 [debug] [Thread-2 (]: On model.mongo_movies.stg_comments: BEGIN
[0m01:22:24.865904 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m01:22:24.867073 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:22:24.867852 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:22:24.872538 [debug] [Thread-1 (]: Compilation Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  dbt was unable to infer all dependencies for the model "comments_by_user_incremental".
  This typically happens when ref() is placed within a conditional block.
  
  To fix this, add the following hint to the top of the model "comments_by_user_incremental":
  
  -- depends_on: {{ ref('stg_comments') }}
[0m01:22:24.874846 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec2476f0-4d05-4a88-9fc9-c426f85adb5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ebe518ade0>]}
[0m01:22:24.875736 [error] [Thread-1 (]: 1 of 3 ERROR creating sql incremental model public_marts.comments_by_user_incremental  [[31mERROR[0m in 0.20s]
[0m01:22:24.876780 [debug] [Thread-1 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m01:22:24.877567 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.comments_by_user_incremental' to be skipped because of status 'error'.  Reason: Compilation Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  dbt was unable to infer all dependencies for the model "comments_by_user_incremental".
  This typically happens when ref() is placed within a conditional block.
  
  To fix this, add the following hint to the top of the model "comments_by_user_incremental":
  
  -- depends_on: {{ ref('stg_comments') }}.
[0m01:22:24.880536 [debug] [Thread-2 (]: SQL status: BEGIN in 0.013 seconds
[0m01:22:24.881152 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:22:24.881698 [debug] [Thread-2 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m01:22:24.884395 [debug] [Thread-3 (]: SQL status: BEGIN in 0.017 seconds
[0m01:22:24.885093 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:22:24.885673 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m01:22:24.886300 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m01:22:24.896079 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:22:24.897068 [debug] [Thread-2 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m01:22:24.898219 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:22:24.901986 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:22:24.902743 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m01:22:24.903575 [debug] [Thread-2 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m01:22:24.907634 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:22:24.908830 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m01:22:24.909858 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:22:24.910411 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:22:24.936338 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:22:24.937639 [debug] [Thread-2 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:22:24.938720 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m01:22:24.939425 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:22:24.940223 [debug] [Thread-2 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:22:24.940915 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:22:24.943244 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m01:22:24.943806 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:22:24.944321 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m01:22:24.948282 [debug] [Thread-2 (]: SQL status: COMMIT in 0.007 seconds
[0m01:22:24.955088 [debug] [Thread-3 (]: SQL status: COMMIT in 0.010 seconds
[0m01:22:24.957738 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m01:22:24.961064 [debug] [Thread-3 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m01:22:24.971419 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:22:24.972655 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:22:24.973377 [debug] [Thread-2 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m01:22:24.974075 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m01:22:24.977518 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.003 seconds
[0m01:22:24.980625 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: Close
[0m01:22:24.981442 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.007 seconds
[0m01:22:24.982250 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec2476f0-4d05-4a88-9fc9-c426f85adb5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ebe6d5c110>]}
[0m01:22:24.983913 [debug] [Thread-2 (]: On model.mongo_movies.stg_comments: Close
[0m01:22:24.984908 [info ] [Thread-3 (]: 3 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.31s]
[0m01:22:24.986272 [debug] [Thread-3 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m01:22:24.987196 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec2476f0-4d05-4a88-9fc9-c426f85adb5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ebe5551310>]}
[0m01:22:24.988770 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.32s]
[0m01:22:24.989623 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_comments
[0m01:22:24.992409 [debug] [MainThread]: Using postgres connection "master"
[0m01:22:24.993021 [debug] [MainThread]: On master: BEGIN
[0m01:22:24.993561 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:22:25.006312 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m01:22:25.007078 [debug] [MainThread]: On master: COMMIT
[0m01:22:25.007852 [debug] [MainThread]: Using postgres connection "master"
[0m01:22:25.008597 [debug] [MainThread]: On master: COMMIT
[0m01:22:25.009362 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:22:25.010061 [debug] [MainThread]: On master: Close
[0m01:22:25.011251 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:22:25.011846 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m01:22:25.012484 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m01:22:25.013115 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m01:22:25.013905 [info ] [MainThread]: 
[0m01:22:25.014741 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 0.56 seconds (0.56s).
[0m01:22:25.016810 [debug] [MainThread]: Command end result
[0m01:22:25.061636 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:22:25.066876 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:22:25.079094 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m01:22:25.079985 [info ] [MainThread]: 
[0m01:22:25.081107 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m01:22:25.081924 [info ] [MainThread]: 
[0m01:22:25.082791 [error] [MainThread]: [31mFailure in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)[0m
[0m01:22:25.083501 [error] [MainThread]:   Compilation Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  dbt was unable to infer all dependencies for the model "comments_by_user_incremental".
  This typically happens when ref() is placed within a conditional block.
  
  To fix this, add the following hint to the top of the model "comments_by_user_incremental":
  
  -- depends_on: {{ ref('stg_comments') }}
[0m01:22:25.084075 [info ] [MainThread]: 
[0m01:22:25.084695 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=3
[0m01:22:25.086166 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.105514, "process_in_blocks": "648", "process_kernel_time": 0.801285, "process_mem_max_rss": "129468", "process_out_blocks": "2688", "process_user_time": 3.854185}
[0m01:22:25.086906 [debug] [MainThread]: Command `dbt run` failed at 01:22:25.086709 after 2.11 seconds
[0m01:22:25.087619 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ebeb7b3410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ebe7f07d70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ebe5182b40>]}
[0m01:22:25.088243 [debug] [MainThread]: Flushing usage events
[0m01:22:26.214200 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:23:43.188728 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e3b0e0cc410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e3b0e0cede0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e3b0dbc3fe0>]}


============================== 01:23:43.194586 | ef196d60-333d-4edd-9f5d-e485da225298 ==============================
[0m01:23:43.194586 [info ] [MainThread]: Running with dbt=1.10.6
[0m01:23:43.195768 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:23:43.545615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ef196d60-333d-4edd-9f5d-e485da225298', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e3b0e649340>]}
[0m01:23:54.614815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ef196d60-333d-4edd-9f5d-e485da225298', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e3b0d2a70e0>]}
[0m01:23:54.616119 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m01:23:43.909948 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m01:23:44.082872 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:23:44.084177 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user_incremental.sql
[0m01:23:44.488594 [error] [MainThread]: Encountered an error:
Compilation Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  invalid syntax for function call expression
    line 1
      {{ config(
[0m01:23:44.490629 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.4289377, "process_in_blocks": "0", "process_kernel_time": 0.771673, "process_mem_max_rss": "117860", "process_out_blocks": "24", "process_user_time": 3.44816}
[0m01:23:44.491334 [debug] [MainThread]: Command `dbt run` failed at 01:23:44.491167 after 1.43 seconds
[0m01:23:44.492045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e3b0d765790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e3b0cb1edb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e3b0d2ed0d0>]}
[0m01:23:44.492587 [debug] [MainThread]: Flushing usage events
[0m01:23:45.712697 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:24:05.299850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c4166d1ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c4166d0980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c417e52600>]}


============================== 01:24:05.304935 | a006b1ad-53bd-48ce-84b6-0373e05aeb47 ==============================
[0m01:24:05.304935 [info ] [MainThread]: Running with dbt=1.10.6
[0m01:24:05.306443 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m01:24:05.630120 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a006b1ad-53bd-48ce-84b6-0373e05aeb47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c41573f0e0>]}
[0m01:24:05.756299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a006b1ad-53bd-48ce-84b6-0373e05aeb47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c4163c1940>]}
[0m01:24:05.757498 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m01:24:05.911904 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m01:24:06.057214 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:24:06.058148 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user_incremental.sql
[0m01:24:06.629463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a006b1ad-53bd-48ce-84b6-0373e05aeb47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c4143e9040>]}
[0m01:24:06.725701 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:24:06.728068 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:24:06.745824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a006b1ad-53bd-48ce-84b6-0373e05aeb47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c415bf3620>]}
[0m01:24:06.746641 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m01:24:06.747251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a006b1ad-53bd-48ce-84b6-0373e05aeb47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c414330f80>]}
[0m01:24:06.749706 [info ] [MainThread]: 
[0m01:24:06.750365 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:24:06.750924 [info ] [MainThread]: 
[0m01:24:06.751773 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:24:06.757655 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:24:06.759133 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:24:06.826986 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:24:06.827762 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:24:06.828711 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:24:06.829422 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:24:06.830035 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:24:06.830660 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:24:06.849204 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.019 seconds
[0m01:24:06.850094 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.019 seconds
[0m01:24:06.851875 [debug] [ThreadPool]: On list_test_db: Close
[0m01:24:06.854172 [debug] [ThreadPool]: On list_test_db: Close
[0m01:24:06.857993 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m01:24:06.864509 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m01:24:06.870053 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:24:06.874067 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:24:06.874797 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m01:24:06.875423 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m01:24:06.876028 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:24:06.876631 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:24:06.890110 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m01:24:06.890896 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m01:24:06.891465 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:24:06.892062 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:24:06.892706 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m01:24:06.893424 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m01:24:06.898396 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.004 seconds
[0m01:24:06.900790 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m01:24:06.901405 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.007 seconds
[0m01:24:06.903096 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m01:24:06.903596 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m01:24:06.905845 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m01:24:06.912121 [debug] [MainThread]: Using postgres connection "master"
[0m01:24:06.912653 [debug] [MainThread]: On master: BEGIN
[0m01:24:06.913215 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:24:06.927141 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m01:24:06.927735 [debug] [MainThread]: Using postgres connection "master"
[0m01:24:06.928286 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:24:06.937445 [debug] [MainThread]: SQL status: SELECT 3 in 0.008 seconds
[0m01:24:06.939494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a006b1ad-53bd-48ce-84b6-0373e05aeb47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c4157deea0>]}
[0m01:24:06.940182 [debug] [MainThread]: On master: ROLLBACK
[0m01:24:06.941266 [debug] [MainThread]: Using postgres connection "master"
[0m01:24:06.941771 [debug] [MainThread]: On master: BEGIN
[0m01:24:06.942899 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m01:24:06.943372 [debug] [MainThread]: On master: COMMIT
[0m01:24:06.943832 [debug] [MainThread]: Using postgres connection "master"
[0m01:24:06.944262 [debug] [MainThread]: On master: COMMIT
[0m01:24:06.945175 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:24:06.945659 [debug] [MainThread]: On master: Close
[0m01:24:06.951057 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m01:24:06.951704 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m01:24:06.952478 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m01:24:06.953901 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m01:24:06.954801 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m01:24:06.955756 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_movies_directors)
[0m01:24:06.957024 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m01:24:06.958103 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m01:24:06.969337 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m01:24:06.971587 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m01:24:06.972996 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m01:24:06.973786 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m01:24:07.157586 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m01:24:07.158632 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m01:24:07.160398 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:24:07.161240 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:24:07.161922 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m01:24:07.162572 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m01:24:07.163308 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:24:07.163969 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:24:07.176467 [debug] [Thread-2 (]: SQL status: BEGIN in 0.013 seconds
[0m01:24:07.177369 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:24:07.178008 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m01:24:07.178672 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m01:24:07.179362 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:24:07.180247 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m01:24:07.183791 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m01:24:07.184617 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m01:24:07.194625 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:24:07.198877 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:24:07.199591 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m01:24:07.200316 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m01:24:07.201961 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:24:07.202551 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:24:07.206078 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:24:07.211156 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:24:07.212075 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m01:24:07.212804 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m01:24:07.214480 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:24:07.215140 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:24:07.251230 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m01:24:07.253507 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:24:07.254178 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:24:07.254826 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:24:07.255513 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m01:24:07.256204 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:24:07.263223 [debug] [Thread-2 (]: SQL status: COMMIT in 0.006 seconds
[0m01:24:07.270191 [debug] [Thread-1 (]: SQL status: COMMIT in 0.013 seconds
[0m01:24:07.273371 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m01:24:07.277611 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m01:24:07.287174 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:24:07.288468 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:24:07.289248 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m01:24:07.289961 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m01:24:07.301510 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.010 seconds
[0m01:24:07.305552 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m01:24:07.306431 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.015 seconds
[0m01:24:07.309976 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m01:24:07.313604 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a006b1ad-53bd-48ce-84b6-0373e05aeb47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c41297e960>]}
[0m01:24:07.314927 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a006b1ad-53bd-48ce-84b6-0373e05aeb47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c4188d4a70>]}
[0m01:24:07.316011 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.36s]
[0m01:24:07.318641 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m01:24:07.317251 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.36s]
[0m01:24:07.320287 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m01:24:07.321955 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m01:24:07.324064 [info ] [Thread-4 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m01:24:07.325373 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m01:24:07.326395 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m01:24:07.340353 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m01:24:07.342024 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m01:24:07.415047 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m01:24:07.416083 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

    
  
    

  create temporary table "comments_by_user_incremental__dbt_tmp012407386137"
  
  
    as
  
  (
    

depends_on: "test_db"."public_staging"."stg_comments"

WITH max_existing AS (
  
      SELECT max(load_date AT TIME ZONE 'UTC') AS max_load_date
      FROM "test_db"."public_marts"."comments_by_user_incremental"
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE (c.load_date AT TIME ZONE 'UTC') > coalesce(m.max_load_date, '1900-01-01'::timestamp)
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

final AS (
  
    SELECT * FROM "test_db"."public_marts"."comments_by_user_incremental"
    UNION ALL
    SELECT * FROM new_agg
  
),

flat AS (
  
   SELECT
      name,
      email,
      total_comment_count,
      unnest(movie_ids) AS movie_id,
      load_date
    FROM (
        SELECT
            name,
            email,
            SUM(comment_count) OVER (PARTITION BY name, email) AS total_comment_count,
            movie_ids,
            load_date
    FROM final)
  
)


SELECT
  name,
  email,
  total_comment_count as comment_count,
  array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
  max(load_date) AS load_date
FROM flat
GROUP BY name, email
ORDER BY comment_count DESC

  );
  
  
[0m01:24:07.416732 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:24:07.430285 [debug] [Thread-4 (]: Postgres adapter: Postgres error: syntax error at or near "depends_on"
LINE 15: depends_on: "test_db"."public_staging"."stg_comments"
         ^

[0m01:24:07.431113 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m01:24:07.436073 [debug] [Thread-4 (]: Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  syntax error at or near "depends_on"
  LINE 15: depends_on: "test_db"."public_staging"."stg_comments"
           ^
[0m01:24:07.436852 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a006b1ad-53bd-48ce-84b6-0373e05aeb47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c4157dfa10>]}
[0m01:24:07.438287 [error] [Thread-4 (]: 3 of 3 ERROR creating sql incremental model public_marts.comments_by_user_incremental  [[31mERROR[0m in 0.11s]
[0m01:24:07.439196 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m01:24:07.440057 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.comments_by_user_incremental' to be skipped because of status 'error'.  Reason: Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  syntax error at or near "depends_on"
  LINE 15: depends_on: "test_db"."public_staging"."stg_comments"
           ^.
[0m01:24:07.444333 [debug] [MainThread]: Using postgres connection "master"
[0m01:24:07.445000 [debug] [MainThread]: On master: BEGIN
[0m01:24:07.445487 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:24:07.458755 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m01:24:07.459593 [debug] [MainThread]: On master: COMMIT
[0m01:24:07.460329 [debug] [MainThread]: Using postgres connection "master"
[0m01:24:07.460927 [debug] [MainThread]: On master: COMMIT
[0m01:24:07.461918 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:24:07.462463 [debug] [MainThread]: On master: Close
[0m01:24:07.463374 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:24:07.463876 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m01:24:07.464541 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m01:24:07.465189 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m01:24:07.465861 [info ] [MainThread]: 
[0m01:24:07.466478 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 0.71 seconds (0.71s).
[0m01:24:07.468122 [debug] [MainThread]: Command end result
[0m01:24:07.501516 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:24:07.503823 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:24:07.513137 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m01:24:07.513684 [info ] [MainThread]: 
[0m01:24:07.514433 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m01:24:07.514976 [info ] [MainThread]: 
[0m01:24:07.515600 [error] [MainThread]: [31mFailure in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)[0m
[0m01:24:07.516206 [error] [MainThread]:   Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  syntax error at or near "depends_on"
  LINE 15: depends_on: "test_db"."public_staging"."stg_comments"
           ^
[0m01:24:07.516812 [info ] [MainThread]: 
[0m01:24:07.517562 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql
[0m01:24:07.518152 [info ] [MainThread]: 
[0m01:24:07.518741 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=3
[0m01:24:07.520119 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.3575718, "process_in_blocks": "0", "process_kernel_time": 0.787684, "process_mem_max_rss": "130912", "process_out_blocks": "2704", "process_user_time": 4.118352}
[0m01:24:07.520961 [debug] [MainThread]: Command `dbt run` failed at 01:24:07.520746 after 2.36 seconds
[0m01:24:07.521600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c4143ebf80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c41660d7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c413f84230>]}
[0m01:24:07.522202 [debug] [MainThread]: Flushing usage events
[0m01:24:19.618426 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:24:26.457282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcbde4b4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcbde4ba70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcbd8fe1b0>]}


============================== 01:24:26.461874 | f1f6c347-051a-48f5-b7f2-1226990f6dd6 ==============================
[0m01:24:26.461874 [info ] [MainThread]: Running with dbt=1.10.6
[0m01:24:26.462863 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:24:26.762560 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f1f6c347-051a-48f5-b7f2-1226990f6dd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcbc71a510>]}
[0m01:24:26.890757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f1f6c347-051a-48f5-b7f2-1226990f6dd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcbcf65100>]}
[0m01:24:26.892026 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m01:24:27.038444 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m01:24:27.175562 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:24:27.176407 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user_incremental.sql
[0m01:24:27.658999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f1f6c347-051a-48f5-b7f2-1226990f6dd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcbb3f9070>]}
[0m01:24:27.756635 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:24:27.759122 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:24:27.776371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f1f6c347-051a-48f5-b7f2-1226990f6dd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcbb74de80>]}
[0m01:24:27.777139 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m01:24:27.777799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f1f6c347-051a-48f5-b7f2-1226990f6dd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcbb38c230>]}
[0m01:24:27.780178 [info ] [MainThread]: 
[0m01:24:27.780758 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:24:27.781361 [info ] [MainThread]: 
[0m01:24:27.782135 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:24:27.788449 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:24:27.789968 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:24:27.853738 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:24:27.854495 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:24:27.855102 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:24:27.855679 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:24:27.856257 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:24:27.856793 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:24:27.874560 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.018 seconds
[0m01:24:27.875207 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.018 seconds
[0m01:24:27.876863 [debug] [ThreadPool]: On list_test_db: Close
[0m01:24:27.879076 [debug] [ThreadPool]: On list_test_db: Close
[0m01:24:27.882070 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m01:24:27.883045 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m01:24:27.891839 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:24:27.894299 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:24:27.894919 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m01:24:27.895757 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m01:24:27.896643 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:24:27.897282 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:24:27.911158 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m01:24:27.911812 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m01:24:27.912416 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:24:27.912964 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:24:27.913719 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m01:24:27.914406 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m01:24:27.919663 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.004 seconds
[0m01:24:27.920292 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.005 seconds
[0m01:24:27.922070 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m01:24:27.923687 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m01:24:27.924659 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m01:24:27.925245 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m01:24:27.932054 [debug] [MainThread]: Using postgres connection "master"
[0m01:24:27.932555 [debug] [MainThread]: On master: BEGIN
[0m01:24:27.932989 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:24:27.946580 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m01:24:27.947161 [debug] [MainThread]: Using postgres connection "master"
[0m01:24:27.947678 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:24:27.957000 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m01:24:27.959375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f1f6c347-051a-48f5-b7f2-1226990f6dd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcbb38c230>]}
[0m01:24:27.960043 [debug] [MainThread]: On master: ROLLBACK
[0m01:24:27.960973 [debug] [MainThread]: Using postgres connection "master"
[0m01:24:27.961537 [debug] [MainThread]: On master: BEGIN
[0m01:24:27.962642 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m01:24:27.963109 [debug] [MainThread]: On master: COMMIT
[0m01:24:27.963566 [debug] [MainThread]: Using postgres connection "master"
[0m01:24:27.964011 [debug] [MainThread]: On master: COMMIT
[0m01:24:27.964937 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:24:27.965492 [debug] [MainThread]: On master: Close
[0m01:24:27.971060 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m01:24:27.971704 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m01:24:27.972595 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m01:24:27.973842 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m01:24:27.974969 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m01:24:27.975639 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_movies_directors)
[0m01:24:27.976309 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m01:24:27.976979 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m01:24:27.989586 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m01:24:27.992467 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m01:24:27.994660 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m01:24:27.995407 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m01:24:28.155397 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m01:24:28.156563 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m01:24:28.158034 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:24:28.158638 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:24:28.159279 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m01:24:28.159955 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m01:24:28.160640 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:24:28.161358 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:24:28.174838 [debug] [Thread-2 (]: SQL status: BEGIN in 0.014 seconds
[0m01:24:28.175503 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:24:28.176122 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m01:24:28.176752 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m01:24:28.177532 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:24:28.178119 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m01:24:28.179628 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m01:24:28.188284 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m01:24:28.189163 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:24:28.192816 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:24:28.194002 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m01:24:28.194799 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m01:24:28.196181 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:24:28.196854 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:24:28.200672 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:24:28.204844 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:24:28.206273 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m01:24:28.207255 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m01:24:28.208649 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:24:28.209426 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:24:28.248949 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m01:24:28.254168 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:24:28.255104 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:24:28.255977 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:24:28.256888 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m01:24:28.257801 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:24:28.304230 [debug] [Thread-2 (]: SQL status: COMMIT in 0.045 seconds
[0m01:24:28.315738 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m01:24:28.325174 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:24:28.325975 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m01:24:28.331277 [debug] [Thread-1 (]: SQL status: COMMIT in 0.073 seconds
[0m01:24:28.334565 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m01:24:28.335282 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.008 seconds
[0m01:24:28.336993 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:24:28.340344 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m01:24:28.341101 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m01:24:28.344336 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f1f6c347-051a-48f5-b7f2-1226990f6dd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcbf836420>]}
[0m01:24:28.346309 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m01:24:28.345702 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.37s]
[0m01:24:28.348578 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m01:24:28.349749 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m01:24:28.351002 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f1f6c347-051a-48f5-b7f2-1226990f6dd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcbd96a060>]}
[0m01:24:28.351786 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.38s]
[0m01:24:28.352978 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m01:24:28.355254 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m01:24:28.356073 [info ] [Thread-4 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m01:24:28.356936 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m01:24:28.357563 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m01:24:28.367567 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m01:24:28.368630 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m01:24:28.440623 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m01:24:28.441392 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

    
  
    

  create temporary table "comments_by_user_incremental__dbt_tmp012428413708"
  
  
    as
  
  (
    



WITH max_existing AS (
  
      SELECT max(load_date AT TIME ZONE 'UTC') AS max_load_date
      FROM "test_db"."public_marts"."comments_by_user_incremental"
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE (c.load_date AT TIME ZONE 'UTC') > coalesce(m.max_load_date, '1900-01-01'::timestamp)
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

final AS (
  
    SELECT * FROM "test_db"."public_marts"."comments_by_user_incremental"
    UNION ALL
    SELECT * FROM new_agg
  
),

flat AS (
  
   SELECT
      name,
      email,
      total_comment_count,
      unnest(movie_ids) AS movie_id,
      load_date
    FROM (
        SELECT
            name,
            email,
            SUM(comment_count) OVER (PARTITION BY name, email) AS total_comment_count,
            movie_ids,
            load_date
    FROM final)
  
)


SELECT
  name,
  email,
  total_comment_count as comment_count,
  array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
  max(load_date) AS load_date
FROM flat
GROUP BY name, email
ORDER BY comment_count DESC

  );
  
  
[0m01:24:28.442032 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:24:28.460225 [debug] [Thread-4 (]: Postgres adapter: Postgres error: column "flat.total_comment_count" must appear in the GROUP BY clause or be used in an aggregate function
LINE 73:   total_comment_count as comment_count,
           ^

[0m01:24:28.461124 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m01:24:28.466365 [debug] [Thread-4 (]: Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  column "flat.total_comment_count" must appear in the GROUP BY clause or be used in an aggregate function
  LINE 73:   total_comment_count as comment_count,
             ^
[0m01:24:28.467175 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f1f6c347-051a-48f5-b7f2-1226990f6dd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcbafae570>]}
[0m01:24:28.468030 [error] [Thread-4 (]: 3 of 3 ERROR creating sql incremental model public_marts.comments_by_user_incremental  [[31mERROR[0m in 0.11s]
[0m01:24:28.469046 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m01:24:28.470582 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.comments_by_user_incremental' to be skipped because of status 'error'.  Reason: Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  column "flat.total_comment_count" must appear in the GROUP BY clause or be used in an aggregate function
  LINE 73:   total_comment_count as comment_count,
             ^.
[0m01:24:28.474685 [debug] [MainThread]: Using postgres connection "master"
[0m01:24:28.475162 [debug] [MainThread]: On master: BEGIN
[0m01:24:28.475729 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:24:28.490338 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m01:24:28.491298 [debug] [MainThread]: On master: COMMIT
[0m01:24:28.491946 [debug] [MainThread]: Using postgres connection "master"
[0m01:24:28.492477 [debug] [MainThread]: On master: COMMIT
[0m01:24:28.493243 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:24:28.493959 [debug] [MainThread]: On master: Close
[0m01:24:28.495118 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:24:28.495771 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m01:24:28.496470 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m01:24:28.497180 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m01:24:28.498081 [info ] [MainThread]: 
[0m01:24:28.498909 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in 0 hours 0 minutes and 0.72 seconds (0.72s).
[0m01:24:28.501012 [debug] [MainThread]: Command end result
[0m01:24:28.545116 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:24:28.547520 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:24:28.556521 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m01:24:28.557021 [info ] [MainThread]: 
[0m01:24:28.557914 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m01:24:28.558746 [info ] [MainThread]: 
[0m01:24:28.559806 [error] [MainThread]: [31mFailure in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)[0m
[0m01:24:28.560665 [error] [MainThread]:   Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  column "flat.total_comment_count" must appear in the GROUP BY clause or be used in an aggregate function
  LINE 73:   total_comment_count as comment_count,
             ^
[0m01:24:28.561523 [info ] [MainThread]: 
[0m01:24:28.562315 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql
[0m01:24:28.562928 [info ] [MainThread]: 
[0m01:24:28.563689 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=3
[0m01:24:28.565399 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.2136781, "process_in_blocks": "0", "process_kernel_time": 0.703842, "process_mem_max_rss": "130952", "process_out_blocks": "2704", "process_user_time": 4.004349}
[0m01:24:28.566348 [debug] [MainThread]: Command `dbt run` failed at 01:24:28.566129 after 2.21 seconds
[0m01:24:28.567144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcbda5bcb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcc155b410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcbaf94ad0>]}
[0m01:24:28.567908 [debug] [MainThread]: Flushing usage events
[0m01:24:29.745275 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:25:12.360776 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746a18447380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746a17c83bc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746a184c1a60>]}


============================== 01:25:12.366283 | 232e288b-7ed5-4f69-a19e-4f6301b447d3 ==============================
[0m01:25:12.366283 [info ] [MainThread]: Running with dbt=1.10.6
[0m01:25:12.367156 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:25:12.727685 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '232e288b-7ed5-4f69-a19e-4f6301b447d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746a1737e6c0>]}
[0m01:25:12.846892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '232e288b-7ed5-4f69-a19e-4f6301b447d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746a17f1d790>]}
[0m01:25:12.848075 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m01:25:13.024232 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m01:25:13.197291 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:25:13.198175 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user_incremental.sql
[0m01:25:13.677159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '232e288b-7ed5-4f69-a19e-4f6301b447d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746a15bf4d10>]}
[0m01:25:24.713845 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:25:24.716495 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:25:24.739366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '232e288b-7ed5-4f69-a19e-4f6301b447d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746a15f95970>]}
[0m01:25:24.740113 [info ] [MainThread]: Found 4 models, 4 sources, 434 macros
[0m01:25:24.740678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '232e288b-7ed5-4f69-a19e-4f6301b447d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746a16b576e0>]}
[0m01:25:24.743842 [info ] [MainThread]: 
[0m01:25:24.744596 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:25:24.745445 [info ] [MainThread]: 
[0m01:25:24.746408 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:25:24.753771 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:25:24.755768 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m01:25:24.818863 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:25:24.819611 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m01:25:24.820258 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:25:24.820946 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m01:25:24.821694 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:25:24.822237 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:25:24.846019 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.024 seconds
[0m01:25:24.847847 [debug] [ThreadPool]: On list_test_db: Close
[0m01:25:24.848420 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.026 seconds
[0m01:25:24.850263 [debug] [ThreadPool]: On list_test_db: Close
[0m01:25:24.853733 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m01:25:24.854855 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m01:25:24.863122 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:25:24.865670 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:25:24.866310 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m01:25:24.866881 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m01:25:24.867448 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:25:24.867986 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:25:24.880697 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m01:25:24.881589 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m01:25:24.882110 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m01:25:24.882680 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m01:25:24.883242 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m01:25:24.884070 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m01:25:13.978337 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.006 seconds
[0m01:25:13.979048 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.006 seconds
[0m01:25:13.987956 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m01:25:13.989935 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m01:25:13.991266 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m01:25:13.991892 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m01:25:14.001027 [debug] [MainThread]: Using postgres connection "master"
[0m01:25:14.001873 [debug] [MainThread]: On master: BEGIN
[0m01:25:14.002413 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:25:14.016517 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m01:25:14.017272 [debug] [MainThread]: Using postgres connection "master"
[0m01:25:14.018159 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:25:14.028903 [debug] [MainThread]: SQL status: SELECT 3 in 0.010 seconds
[0m01:25:14.030992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '232e288b-7ed5-4f69-a19e-4f6301b447d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746a157a75f0>]}
[0m01:25:14.031665 [debug] [MainThread]: On master: ROLLBACK
[0m01:25:14.032480 [debug] [MainThread]: Using postgres connection "master"
[0m01:25:14.032978 [debug] [MainThread]: On master: BEGIN
[0m01:25:14.033989 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m01:25:14.034461 [debug] [MainThread]: On master: COMMIT
[0m01:25:14.034906 [debug] [MainThread]: Using postgres connection "master"
[0m01:25:14.035367 [debug] [MainThread]: On master: COMMIT
[0m01:25:14.036154 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:25:14.036628 [debug] [MainThread]: On master: Close
[0m01:25:14.041946 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m01:25:14.042839 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies_directors
[0m01:25:14.043802 [info ] [Thread-1 (]: 1 of 3 START sql view model public_staging.stg_comments ........................ [RUN]
[0m01:25:14.044713 [info ] [Thread-2 (]: 2 of 3 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m01:25:14.045663 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m01:25:14.046502 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_movies_directors)
[0m01:25:14.047218 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m01:25:14.047828 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m01:25:14.061368 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m01:25:14.063857 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m01:25:14.065841 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m01:25:14.077938 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m01:25:14.275312 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m01:25:14.276371 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m01:25:14.278003 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:25:14.278767 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:25:14.279370 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m01:25:14.280059 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m01:25:14.280701 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:25:14.281572 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:25:14.295977 [debug] [Thread-2 (]: SQL status: BEGIN in 0.015 seconds
[0m01:25:14.296683 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m01:25:14.297564 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:25:14.298454 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:25:14.299225 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM mongo_data.movies__directors
  );
[0m01:25:14.299906 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m01:25:14.304172 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m01:25:14.311450 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m01:25:14.317913 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:25:14.322873 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:25:14.323816 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m01:25:14.324777 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m01:25:14.326468 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:25:14.326998 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:25:14.330747 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:25:14.334305 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:25:14.335297 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m01:25:14.336283 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m01:25:14.337673 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:25:14.338231 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:25:14.366916 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:25:14.367815 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m01:25:14.368511 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:25:14.369235 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:25:14.369992 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m01:25:14.370676 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m01:25:14.376817 [debug] [Thread-1 (]: SQL status: COMMIT in 0.005 seconds
[0m01:25:14.383580 [debug] [Thread-2 (]: SQL status: COMMIT in 0.012 seconds
[0m01:25:14.386471 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m01:25:14.389516 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m01:25:14.398882 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m01:25:14.400146 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m01:25:14.400829 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m01:25:14.401618 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m01:25:14.404851 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.002 seconds
[0m01:25:14.408950 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies_directors: Close
[0m01:25:14.409780 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.007 seconds
[0m01:25:14.411922 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m01:25:14.414790 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '232e288b-7ed5-4f69-a19e-4f6301b447d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746a146010a0>]}
[0m01:25:14.415685 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '232e288b-7ed5-4f69-a19e-4f6301b447d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746a179ba090>]}
[0m01:25:14.416796 [info ] [Thread-2 (]: 2 of 3 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.37s]
[0m01:25:14.418143 [info ] [Thread-1 (]: 1 of 3 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.37s]
[0m01:25:14.419258 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m01:25:14.420156 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m01:25:14.422063 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m01:25:14.423590 [info ] [Thread-4 (]: 3 of 3 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m01:25:14.424679 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.comments_by_user_incremental'
[0m01:25:14.425637 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m01:25:14.439162 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m01:25:14.440361 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m01:25:14.514251 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m01:25:14.514984 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

    
  
    

  create temporary table "comments_by_user_incremental__dbt_tmp012514494535"
  
  
    as
  
  (
    



WITH max_existing AS (
  
      SELECT max(load_date AT TIME ZONE 'UTC') AS max_load_date
      FROM "test_db"."public_marts"."comments_by_user_incremental"
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE (c.load_date AT TIME ZONE 'UTC') > coalesce(m.max_load_date, '1900-01-01'::timestamp)
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

final AS (
  
    SELECT * FROM "test_db"."public_marts"."comments_by_user_incremental"
    UNION ALL
    SELECT * FROM new_agg
  
),

flat AS (
  
   SELECT
      name,
      email,
      total_comment_count,
      unnest(movie_ids) AS movie_id,
      load_date
    FROM (
        SELECT
            name,
            email,
            SUM(comment_count) OVER (PARTITION BY name, email) AS total_comment_count,
            movie_ids,
            load_date
    FROM final)
  
)


SELECT
  name,
  email,
  MAX(total_comment_count) as comment_count,
  array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
  max(load_date) AS load_date
FROM flat
GROUP BY name, email
ORDER BY comment_count DESC

  );
  
  
[0m01:25:14.515572 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:25:14.592545 [debug] [Thread-4 (]: SQL status: SELECT 236 in 0.077 seconds
[0m01:25:14.610910 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m01:25:14.611552 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: BEGIN
[0m01:25:14.612805 [debug] [Thread-4 (]: SQL status: BEGIN in 0.001 seconds
[0m01:25:14.613396 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m01:25:14.613963 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental__dbt_tmp012514494535'
        
      order by ordinal_position

  
[0m01:25:14.625395 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.011 seconds
[0m01:25:14.640658 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m01:25:14.641342 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m01:25:14.645989 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.004 seconds
[0m01:25:14.655915 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m01:25:14.656472 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m01:25:14.660025 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.003 seconds
[0m01:25:14.681865 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user_incremental"
[0m01:25:14.682841 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m01:25:14.683478 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      
        delete from "test_db"."public_marts"."comments_by_user_incremental" as DBT_INTERNAL_DEST
        where (name, email) in (
            select distinct name, email
            from "comments_by_user_incremental__dbt_tmp012514494535" as DBT_INTERNAL_SOURCE
        );

    

    insert into "test_db"."public_marts"."comments_by_user_incremental" ("name", "email", "comment_count", "movie_ids", "load_date")
    (
        select "name", "email", "comment_count", "movie_ids", "load_date"
        from "comments_by_user_incremental__dbt_tmp012514494535"
    )
  
[0m01:25:14.698129 [debug] [Thread-4 (]: SQL status: INSERT 0 236 in 0.014 seconds
[0m01:25:14.700277 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m01:25:14.700814 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m01:25:14.701353 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m01:25:14.706099 [debug] [Thread-4 (]: SQL status: COMMIT in 0.004 seconds
[0m01:25:14.707885 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m01:25:14.709051 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '232e288b-7ed5-4f69-a19e-4f6301b447d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746a146a0c50>]}
[0m01:25:14.710030 [info ] [Thread-4 (]: 3 of 3 OK created sql incremental model public_marts.comments_by_user_incremental  [[32mINSERT 0 236[0m in 0.28s]
[0m01:25:14.710917 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m01:25:14.714238 [debug] [MainThread]: Using postgres connection "master"
[0m01:25:14.714844 [debug] [MainThread]: On master: BEGIN
[0m01:25:14.715445 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:25:14.729777 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m01:25:14.730435 [debug] [MainThread]: On master: COMMIT
[0m01:25:14.731139 [debug] [MainThread]: Using postgres connection "master"
[0m01:25:14.731821 [debug] [MainThread]: On master: COMMIT
[0m01:25:14.732582 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:25:14.733189 [debug] [MainThread]: On master: Close
[0m01:25:14.734161 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:25:14.734601 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m01:25:14.735013 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m01:25:14.735482 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m01:25:14.736009 [info ] [MainThread]: 
[0m01:25:14.736636 [info ] [MainThread]: Finished running 1 incremental model, 2 view models in -1 hours 59 minutes and 49.99 seconds (-10.01s).
[0m01:25:14.738054 [debug] [MainThread]: Command end result
[0m01:25:14.767591 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m01:25:14.770254 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m01:25:14.779745 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m01:25:14.780356 [info ] [MainThread]: 
[0m01:25:14.780981 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:25:14.781618 [info ] [MainThread]: 
[0m01:25:14.782220 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m01:25:14.783720 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.5266716, "process_in_blocks": "8", "process_kernel_time": 0.819172, "process_mem_max_rss": "130924", "process_out_blocks": "2720", "process_user_time": 4.19625}
[0m01:25:14.784361 [debug] [MainThread]: Command `dbt run` succeeded at 01:25:14.784223 after 2.53 seconds
[0m01:25:14.784914 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746a16f39a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746a16f39a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746a16f3a060>]}
[0m01:25:14.785529 [debug] [MainThread]: Flushing usage events
[0m01:25:16.011264 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:43:10.681380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c88a81c080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c889be54c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c88c5ecda0>]}


============================== 23:43:10.688451 | 960f484e-c66c-4b41-ad58-4b266f61a865 ==============================
[0m23:43:10.688451 [info ] [MainThread]: Running with dbt=1.10.6
[0m23:43:10.689604 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'invocation_command': 'dbt compile', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:43:11.159918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '960f484e-c66c-4b41-ad58-4b266f61a865', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c889a849b0>]}
[0m23:43:11.280015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '960f484e-c66c-4b41-ad58-4b266f61a865', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c889a87f20>]}
[0m23:43:11.281901 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:43:11.432849 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m23:43:11.658756 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 4 files added, 4 files changed.
[0m23:43:11.659688 [debug] [MainThread]: Partial parsing: added file: mongo_movies://models/mongo_movies/genres_and_directors_with_good_comment_each_user.sql
[0m23:43:11.660380 [debug] [MainThread]: Partial parsing: added file: mongo_movies://models/mongo_movies/comments_by_user.sql
[0m23:43:11.660987 [debug] [MainThread]: Partial parsing: added file: mongo_movies://models/staging/stg_movies.sql
[0m23:43:11.661663 [debug] [MainThread]: Partial parsing: added file: mongo_movies://models/mongo_movies/movies_genres_directors.sql
[0m23:43:11.662864 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/sources/sources.yml
[0m23:43:11.663677 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user_incremental.sql
[0m23:43:11.664733 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/staging/stg_movies_genres.sql
[0m23:43:11.665835 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/staging/stg_movies_directors.sql
[0m23:43:12.544218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '960f484e-c66c-4b41-ad58-4b266f61a865', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c8850f77a0>]}
[0m23:43:12.682437 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:43:12.689104 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:43:12.840678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '960f484e-c66c-4b41-ad58-4b266f61a865', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c887535940>]}
[0m23:43:12.841416 [info ] [MainThread]: Found 8 models, 6 sources, 434 macros
[0m23:43:12.841999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '960f484e-c66c-4b41-ad58-4b266f61a865', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c887548110>]}
[0m23:43:12.844607 [info ] [MainThread]: 
[0m23:43:12.845187 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:43:12.845799 [info ] [MainThread]: 
[0m23:43:12.846681 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:43:12.853105 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_marts'
[0m23:43:12.854405 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_staging'
[0m23:43:12.978937 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:43:12.979599 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:43:12.980345 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m23:43:12.980989 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m23:43:12.981708 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:43:12.982452 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:43:13.011027 [debug] [ThreadPool]: SQL status: BEGIN in 0.028 seconds
[0m23:43:13.011999 [debug] [ThreadPool]: SQL status: BEGIN in 0.030 seconds
[0m23:43:13.012659 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:43:13.013292 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:43:13.013951 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m23:43:13.014622 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m23:43:13.020135 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.005 seconds
[0m23:43:13.021174 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.006 seconds
[0m23:43:13.023002 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m23:43:13.025601 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m23:43:13.026540 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m23:43:13.027346 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m23:43:13.039236 [debug] [MainThread]: Using postgres connection "master"
[0m23:43:13.039851 [debug] [MainThread]: On master: BEGIN
[0m23:43:13.040428 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:43:13.054485 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m23:43:13.055155 [debug] [MainThread]: Using postgres connection "master"
[0m23:43:13.055773 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:43:13.104708 [debug] [MainThread]: SQL status: SELECT 5 in 0.048 seconds
[0m23:43:13.106849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '960f484e-c66c-4b41-ad58-4b266f61a865', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c889173d40>]}
[0m23:43:13.107545 [debug] [MainThread]: On master: ROLLBACK
[0m23:43:13.108607 [debug] [MainThread]: On master: Close
[0m23:43:13.116033 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m23:43:13.116825 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies
[0m23:43:13.117664 [debug] [Thread-3 (]: Began running node model.mongo_movies.stg_movies_directors
[0m23:43:13.118333 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m23:43:13.118895 [debug] [Thread-4 (]: Began running node model.mongo_movies.stg_movies_genres
[0m23:43:13.119651 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_movies)
[0m23:43:13.120582 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.stg_movies_directors'
[0m23:43:13.121243 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m23:43:13.122092 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.stg_movies_genres'
[0m23:43:13.122747 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies
[0m23:43:13.123409 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m23:43:13.134189 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m23:43:13.134951 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.stg_movies_genres
[0m23:43:13.138364 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies"
[0m23:43:13.141664 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m23:43:13.145753 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_genres"
[0m23:43:13.147691 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m23:43:13.148654 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies
[0m23:43:13.150422 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m23:43:13.151038 [debug] [Thread-3 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m23:43:13.152407 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies
[0m23:43:13.153058 [debug] [Thread-4 (]: Began executing node model.mongo_movies.stg_movies_genres
[0m23:43:13.155150 [debug] [Thread-3 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m23:43:13.156121 [debug] [Thread-1 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m23:43:13.157559 [debug] [Thread-4 (]: Finished running node model.mongo_movies.stg_movies_genres
[0m23:43:13.158625 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_comments, now model.mongo_movies.comments_by_user_incremental)
[0m23:43:13.159976 [debug] [Thread-2 (]: Began running node model.mongo_movies.movies_genres_directors
[0m23:43:13.160726 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m23:43:13.161481 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_movies, now model.mongo_movies.movies_genres_directors)
[0m23:43:13.167944 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m23:43:13.168785 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.movies_genres_directors
[0m23:43:13.173102 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.movies_genres_directors"
[0m23:43:13.174157 [debug] [Thread-1 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m23:43:13.174884 [debug] [Thread-2 (]: Began executing node model.mongo_movies.movies_genres_directors
[0m23:43:13.175909 [debug] [Thread-1 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m23:43:13.177134 [debug] [Thread-2 (]: Finished running node model.mongo_movies.movies_genres_directors
[0m23:43:13.178961 [debug] [Thread-4 (]: Began running node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:43:13.179841 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_movies_genres, now model.mongo_movies.genres_and_directors_with_good_comment_each_user)
[0m23:43:13.180514 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:43:13.183983 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:43:13.184977 [debug] [Thread-4 (]: Began executing node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:43:13.186083 [debug] [Thread-4 (]: Finished running node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:43:13.189209 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:43:13.189927 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m23:43:13.190470 [debug] [MainThread]: Connection 'model.mongo_movies.movies_genres_directors' was properly closed.
[0m23:43:13.190895 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m23:43:13.191324 [debug] [MainThread]: Connection 'model.mongo_movies.genres_and_directors_with_good_comment_each_user' was properly closed.
[0m23:43:13.193512 [debug] [MainThread]: Command end result
[0m23:43:13.230003 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:43:13.232426 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:43:13.242408 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m23:43:13.247678 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 2.7112107, "process_in_blocks": "123864", "process_kernel_time": 1.238627, "process_mem_max_rss": "129492", "process_out_blocks": "2784", "process_user_time": 4.503009}
[0m23:43:13.248956 [debug] [MainThread]: Command `dbt compile` succeeded at 23:43:13.248723 after 2.71 seconds
[0m23:43:13.249798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c88a81c080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c889561640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c88506d6a0>]}
[0m23:43:13.250716 [debug] [MainThread]: Flushing usage events
[0m23:43:15.052598 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:43:36.132968 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71f11e686900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71f11e6c40e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71f11e6c42f0>]}


============================== 23:43:36.137463 | 201778c4-ce37-4141-b966-fa473b897d3c ==============================
[0m23:43:36.137463 [info ] [MainThread]: Running with dbt=1.10.6
[0m23:43:36.138375 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:43:36.420973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '201778c4-ce37-4141-b966-fa473b897d3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71f11e687f80>]}
[0m23:43:36.555158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '201778c4-ce37-4141-b966-fa473b897d3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71f1204e79e0>]}
[0m23:43:36.556577 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:43:36.716756 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m23:43:36.871319 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:43:36.872010 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:43:36.919434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '201778c4-ce37-4141-b966-fa473b897d3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71f11dfe9d60>]}
[0m23:43:37.015183 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:43:37.017750 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:43:37.036352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '201778c4-ce37-4141-b966-fa473b897d3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71f11cf011c0>]}
[0m23:43:37.037085 [info ] [MainThread]: Found 8 models, 6 sources, 434 macros
[0m23:43:37.037719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '201778c4-ce37-4141-b966-fa473b897d3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71f11db6b0e0>]}
[0m23:43:37.040828 [info ] [MainThread]: 
[0m23:43:37.041555 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:43:37.042176 [info ] [MainThread]: 
[0m23:43:37.043156 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:43:37.050899 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:43:37.052289 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:43:37.137561 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:43:37.138494 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:43:37.139349 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:43:37.140146 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:43:37.140928 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:43:37.141630 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:43:37.160001 [debug] [ThreadPool]: SQL status: SELECT 21 in 0.018 seconds
[0m23:43:37.160665 [debug] [ThreadPool]: SQL status: SELECT 21 in 0.020 seconds
[0m23:43:37.162959 [debug] [ThreadPool]: On list_test_db: Close
[0m23:43:37.164564 [debug] [ThreadPool]: On list_test_db: Close
[0m23:43:37.168699 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m23:43:37.169655 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m23:43:37.178209 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:43:37.180576 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:43:37.181216 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m23:43:37.182230 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m23:43:37.183096 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:43:37.183714 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:43:37.199472 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m23:43:37.200597 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:43:37.201180 [debug] [ThreadPool]: SQL status: BEGIN in 0.017 seconds
[0m23:43:37.201824 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m23:43:37.202566 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:43:37.203438 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m23:43:37.208827 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.006 seconds
[0m23:43:37.209503 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.005 seconds
[0m23:43:37.211635 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m23:43:37.213417 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m23:43:37.214411 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m23:43:37.214903 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m23:43:37.224175 [debug] [MainThread]: Using postgres connection "master"
[0m23:43:37.224886 [debug] [MainThread]: On master: BEGIN
[0m23:43:37.225432 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:43:37.238859 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m23:43:37.239673 [debug] [MainThread]: Using postgres connection "master"
[0m23:43:37.240518 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:43:37.288707 [debug] [MainThread]: SQL status: SELECT 5 in 0.048 seconds
[0m23:43:37.290932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '201778c4-ce37-4141-b966-fa473b897d3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71f11df26b70>]}
[0m23:43:37.291604 [debug] [MainThread]: On master: ROLLBACK
[0m23:43:37.292475 [debug] [MainThread]: Using postgres connection "master"
[0m23:43:37.293043 [debug] [MainThread]: On master: BEGIN
[0m23:43:37.294194 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:43:37.294813 [debug] [MainThread]: On master: COMMIT
[0m23:43:37.295378 [debug] [MainThread]: Using postgres connection "master"
[0m23:43:37.295944 [debug] [MainThread]: On master: COMMIT
[0m23:43:37.296739 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:43:37.297203 [debug] [MainThread]: On master: Close
[0m23:43:37.304802 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m23:43:37.305681 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies
[0m23:43:37.307306 [debug] [Thread-3 (]: Began running node model.mongo_movies.stg_movies_directors
[0m23:43:37.307991 [debug] [Thread-4 (]: Began running node model.mongo_movies.stg_movies_genres
[0m23:43:37.306714 [info ] [Thread-1 (]: 1 of 7 START sql view model public_staging.stg_comments ........................ [RUN]
[0m23:43:37.308959 [info ] [Thread-2 (]: 2 of 7 START sql view model public_staging.stg_movies .......................... [RUN]
[0m23:43:37.310003 [info ] [Thread-3 (]: 3 of 7 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m23:43:37.310992 [info ] [Thread-4 (]: 4 of 7 START sql view model public_staging.stg_movies_genres ................... [RUN]
[0m23:43:37.312111 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m23:43:37.313103 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_movies)
[0m23:43:37.313889 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.stg_movies_directors'
[0m23:43:37.314946 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.stg_movies_genres'
[0m23:43:37.315810 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m23:43:37.316677 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies
[0m23:43:37.317588 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m23:43:37.318584 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.stg_movies_genres
[0m23:43:37.333695 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m23:43:37.337641 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies"
[0m23:43:37.344627 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m23:43:37.348284 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_genres"
[0m23:43:37.350616 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies
[0m23:43:37.351571 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m23:43:37.352440 [debug] [Thread-3 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m23:43:37.363917 [debug] [Thread-4 (]: Began executing node model.mongo_movies.stg_movies_genres
[0m23:43:37.453596 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m23:43:37.454648 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies"
[0m23:43:37.459981 [debug] [Thread-3 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m23:43:37.464693 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_genres"
[0m23:43:37.468217 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:43:37.469547 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m23:43:37.470576 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:43:37.471914 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:43:37.472628 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m23:43:37.473527 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:43:37.474528 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m23:43:37.475494 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: BEGIN
[0m23:43:37.476738 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: BEGIN
[0m23:43:37.477726 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:43:37.478844 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m23:43:37.479625 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:43:37.497173 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m23:43:37.498308 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:43:37.499254 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m23:43:37.500729 [debug] [Thread-3 (]: SQL status: BEGIN in 0.028 seconds
[0m23:43:37.501928 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:43:37.502888 [debug] [Thread-4 (]: SQL status: BEGIN in 0.024 seconds
[0m23:43:37.503662 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM "test_db"."mongo_data"."movies__directors"
  );
[0m23:43:37.504636 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m23:43:37.505501 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:43:37.506338 [debug] [Thread-2 (]: SQL status: BEGIN in 0.027 seconds
[0m23:43:37.512957 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m23:43:37.518851 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:43:37.519933 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */

  create view "test_db"."public_staging"."stg_movies_genres__dbt_tmp"
    
    
  as (
    SELECT value AS genre, _dlt_parent_id AS movie_id 
FROM "test_db"."mongo_data"."movies__genres"
  );
[0m23:43:37.520828 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:43:37.527229 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:43:37.528326 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m23:43:37.529574 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */

  create view "test_db"."public_staging"."stg_movies__dbt_tmp"
    
    
  as (
    SELECT * FROM "test_db"."mongo_data"."movies"
  );
[0m23:43:37.530541 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m23:43:37.532069 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:43:37.532850 [debug] [Thread-4 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m23:43:37.533572 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:43:37.539618 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.008 seconds
[0m23:43:37.540507 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:43:37.545260 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:43:37.550431 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:43:37.554260 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:43:37.555413 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m23:43:37.556235 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */
alter table "test_db"."public_staging"."stg_movies_genres" rename to "stg_movies_genres__dbt_backup"
[0m23:43:37.556961 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m23:43:37.557668 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */
alter table "test_db"."public_staging"."stg_movies" rename to "stg_movies__dbt_backup"
[0m23:43:37.559234 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:43:37.559818 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:43:37.566677 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.008 seconds
[0m23:43:37.567230 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.008 seconds
[0m23:43:37.588736 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:43:37.589928 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:43:37.592604 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:43:37.596702 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:43:37.597734 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */
alter table "test_db"."public_staging"."stg_movies_genres__dbt_tmp" rename to "stg_movies_genres"
[0m23:43:37.598542 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:43:37.599246 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:43:37.599883 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */
alter table "test_db"."public_staging"."stg_movies__dbt_tmp" rename to "stg_movies"
[0m23:43:37.600998 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:43:37.601562 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:43:37.602601 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:43:37.605170 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: COMMIT
[0m23:43:37.605811 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m23:43:37.606919 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:43:37.609258 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: COMMIT
[0m23:43:37.609969 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: COMMIT
[0m23:43:37.610684 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:43:37.611384 [debug] [Thread-1 (]: SQL status: COMMIT in 0.008 seconds
[0m23:43:37.612195 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: COMMIT
[0m23:43:37.612818 [debug] [Thread-3 (]: SQL status: COMMIT in 0.006 seconds
[0m23:43:37.619101 [debug] [Thread-4 (]: SQL status: COMMIT in 0.007 seconds
[0m23:43:37.623309 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m23:43:37.627000 [debug] [Thread-3 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m23:43:37.627706 [debug] [Thread-2 (]: SQL status: COMMIT in 0.004 seconds
[0m23:43:37.630797 [debug] [Thread-4 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_genres__dbt_backup"
[0m23:43:37.640361 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:43:37.641643 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:43:37.644708 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies__dbt_backup"
[0m23:43:37.646645 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:43:37.647600 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m23:43:37.648725 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m23:43:37.650098 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:43:37.651325 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */
drop view if exists "test_db"."public_staging"."stg_movies_genres__dbt_backup" cascade
[0m23:43:37.652645 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */
drop view if exists "test_db"."public_staging"."stg_movies__dbt_backup" cascade
[0m23:43:37.655251 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m23:43:37.658848 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m23:43:37.659615 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.006 seconds
[0m23:43:37.660209 [debug] [Thread-4 (]: SQL status: DROP VIEW in 0.007 seconds
[0m23:43:37.660837 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.008 seconds
[0m23:43:37.662955 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: Close
[0m23:43:37.666880 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: Close
[0m23:43:37.668828 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: Close
[0m23:43:37.669511 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '201778c4-ce37-4141-b966-fa473b897d3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71f120e1e5d0>]}
[0m23:43:37.670679 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '201778c4-ce37-4141-b966-fa473b897d3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71f11af34500>]}
[0m23:43:37.671579 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '201778c4-ce37-4141-b966-fa473b897d3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71f11afc4ef0>]}
[0m23:43:37.673117 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.35s]
[0m23:43:37.674526 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '201778c4-ce37-4141-b966-fa473b897d3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71f11cb56480>]}
[0m23:43:37.676132 [info ] [Thread-2 (]: 2 of 7 OK created sql view model public_staging.stg_movies ..................... [[32mCREATE VIEW[0m in 0.36s]
[0m23:43:37.677848 [info ] [Thread-4 (]: 4 of 7 OK created sql view model public_staging.stg_movies_genres .............. [[32mCREATE VIEW[0m in 0.36s]
[0m23:43:37.679643 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m23:43:37.681266 [info ] [Thread-3 (]: 3 of 7 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.36s]
[0m23:43:37.683189 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies
[0m23:43:37.684817 [debug] [Thread-4 (]: Finished running node model.mongo_movies.stg_movies_genres
[0m23:43:37.687290 [debug] [Thread-3 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m23:43:37.688707 [debug] [Thread-2 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m23:43:37.691188 [debug] [Thread-1 (]: Began running node model.mongo_movies.movies_genres_directors
[0m23:43:37.692767 [info ] [Thread-2 (]: 5 of 7 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m23:43:37.694367 [info ] [Thread-1 (]: 6 of 7 START sql table model public_marts.movies_genres_directors .............. [RUN]
[0m23:43:37.695797 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_movies, now model.mongo_movies.comments_by_user_incremental)
[0m23:43:37.696906 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_comments, now model.mongo_movies.movies_genres_directors)
[0m23:43:37.698031 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m23:43:37.699131 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.movies_genres_directors
[0m23:43:37.715360 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m23:43:37.807440 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.movies_genres_directors"
[0m23:43:37.808793 [debug] [Thread-2 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m23:43:37.809369 [debug] [Thread-1 (]: Began executing node model.mongo_movies.movies_genres_directors
[0m23:43:37.879515 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.movies_genres_directors"
[0m23:43:37.884778 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user_incremental"
[0m23:43:37.886613 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:43:37.887433 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:43:37.888011 [debug] [Thread-1 (]: On model.mongo_movies.movies_genres_directors: BEGIN
[0m23:43:37.888686 [debug] [Thread-2 (]: On model.mongo_movies.comments_by_user_incremental: BEGIN
[0m23:43:37.889907 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:43:37.891009 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:43:37.904887 [debug] [Thread-2 (]: SQL status: BEGIN in 0.014 seconds
[0m23:43:37.905619 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m23:43:37.906351 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:43:37.907041 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:43:37.907761 [debug] [Thread-2 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      
  
    

  create  table "test_db"."public_marts"."comments_by_user_incremental"
  
  
    as
  
  (
    



WITH max_existing AS (
  
      SELECT null::timestamp AS max_load_date
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE (c.load_date AT TIME ZONE 'UTC') > coalesce(m.max_load_date, '1900-01-01'::timestamp)
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

final AS (
  
),

flat AS (
  
)


SELECT * FROM new_agg

  );
  
  
[0m23:43:37.908512 [debug] [Thread-1 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */

  
    

  create  table "test_db"."public_marts"."movies_genres_directors__dbt_tmp"
  
  
    as
  
  (
    SELECT m.title, m._id AS movie_id, g.genre, d.director FROM "test_db"."public_staging"."stg_movies" m 
JOIN "test_db"."public_staging"."stg_movies_genres" g ON m._dlt_id = g.movie_id
JOIN "test_db"."public_staging"."stg_movies_directors" d ON m._dlt_id = d.movie_id
  );
  
[0m23:43:37.910022 [debug] [Thread-2 (]: Postgres adapter: Postgres error: syntax error at or near ")"
LINE 43: ),
         ^

[0m23:43:37.910693 [debug] [Thread-2 (]: On model.mongo_movies.comments_by_user_incremental: ROLLBACK
[0m23:43:37.911609 [debug] [Thread-2 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m23:43:37.923824 [debug] [Thread-2 (]: Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  syntax error at or near ")"
  LINE 43: ),
           ^
  compiled code at target/run/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql
[0m23:43:37.924735 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '201778c4-ce37-4141-b966-fa473b897d3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71f11af08440>]}
[0m23:43:37.925669 [error] [Thread-2 (]: 5 of 7 ERROR creating sql incremental model public_marts.comments_by_user_incremental  [[31mERROR[0m in 0.23s]
[0m23:43:37.926593 [debug] [Thread-2 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m23:43:37.927452 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.comments_by_user_incremental' to be skipped because of status 'error'.  Reason: Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  syntax error at or near ")"
  LINE 43: ),
           ^
  compiled code at target/run/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql.
[0m23:43:38.040160 [debug] [Thread-1 (]: SQL status: SELECT 49379 in 0.130 seconds
[0m23:43:38.049750 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:43:38.050407 [debug] [Thread-1 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */
alter table "test_db"."public_marts"."movies_genres_directors" rename to "movies_genres_directors__dbt_backup"
[0m23:43:38.051917 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:43:38.055517 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:43:38.056278 [debug] [Thread-1 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */
alter table "test_db"."public_marts"."movies_genres_directors__dbt_tmp" rename to "movies_genres_directors"
[0m23:43:38.057527 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:43:38.060186 [debug] [Thread-1 (]: On model.mongo_movies.movies_genres_directors: COMMIT
[0m23:43:38.060794 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:43:38.061313 [debug] [Thread-1 (]: On model.mongo_movies.movies_genres_directors: COMMIT
[0m23:43:38.080483 [debug] [Thread-1 (]: SQL status: COMMIT in 0.018 seconds
[0m23:43:38.084454 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_marts"."movies_genres_directors__dbt_backup"
[0m23:43:38.090437 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:43:38.091411 [debug] [Thread-1 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */
drop table if exists "test_db"."public_marts"."movies_genres_directors__dbt_backup" cascade
[0m23:43:38.097686 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.006 seconds
[0m23:43:38.100193 [debug] [Thread-1 (]: On model.mongo_movies.movies_genres_directors: Close
[0m23:43:38.101355 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '201778c4-ce37-4141-b966-fa473b897d3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71f118608350>]}
[0m23:43:38.102652 [info ] [Thread-1 (]: 6 of 7 OK created sql table model public_marts.movies_genres_directors ......... [[32mSELECT 49379[0m in 0.40s]
[0m23:43:38.103872 [debug] [Thread-1 (]: Finished running node model.mongo_movies.movies_genres_directors
[0m23:43:38.105727 [debug] [Thread-3 (]: Began running node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:43:38.106844 [info ] [Thread-3 (]: 7 of 7 START sql table model public_marts.genres_and_directors_with_good_comment_each_user  [RUN]
[0m23:43:38.108024 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_movies_directors, now model.mongo_movies.genres_and_directors_with_good_comment_each_user)
[0m23:43:38.108978 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:43:38.114340 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:43:38.115942 [debug] [Thread-3 (]: Began executing node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:43:38.124205 [debug] [Thread-3 (]: Writing runtime sql for node "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:43:38.125634 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:43:38.126553 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: BEGIN
[0m23:43:38.127354 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m23:43:38.143208 [debug] [Thread-3 (]: SQL status: BEGIN in 0.016 seconds
[0m23:43:38.144139 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:43:38.144735 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */

  
    

  create  table "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_tmp"
  
  
    as
  
  (
    SELECT 
    c.email,
    COALESCE(array_agg(DISTINCT gd.director) FILTER (
      WHERE c.text ~* '\mgood\M' AND c.text !~* 'not\s+good'
    ), '{}') AS fav_directors,

    COALESCE(array_agg(DISTINCT gd.genre) FILTER (
      WHERE c.text ~* '\mgood\M' AND c.text !~* 'not\s+good'
    ), '{}') AS fav_genres,

    COALESCE(array_agg(DISTINCT gd.title) FILTER (
      WHERE c.text ~* '\mgood\M' AND c.text !~* 'not\s+good'
    ), '{}') AS fav_movies
FROM "test_db"."public_staging"."stg_comments" c
JOIN "test_db"."public_marts"."movies_genres_directors" gd ON c.movie_id = gd.movie_id
GROUP BY c.email
  );
  
[0m23:43:52.844900 [debug] [Thread-3 (]: SQL status: SELECT 236 in 1.125 seconds
[0m23:43:52.852403 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:43:52.853372 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */
alter table "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user" rename to "genres_and_directors_with_good_comment_each_user__dbt_backup"
[0m23:43:52.854552 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:43:52.858921 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:43:52.859507 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */
alter table "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_tmp" rename to "genres_and_directors_with_good_comment_each_user"
[0m23:43:52.860556 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m23:43:52.862937 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: COMMIT
[0m23:43:52.863603 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:43:52.864244 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: COMMIT
[0m23:43:52.870023 [debug] [Thread-3 (]: SQL status: COMMIT in 0.005 seconds
[0m23:43:52.874069 [debug] [Thread-3 (]: Applying DROP to: "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_backup"
[0m23:43:52.875271 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:43:52.875854 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */
drop table if exists "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_backup" cascade
[0m23:43:52.879404 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.003 seconds
[0m23:43:52.881540 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: Close
[0m23:43:52.882809 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '201778c4-ce37-4141-b966-fa473b897d3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71f11afc7e00>]}
[0m23:43:52.884068 [info ] [Thread-3 (]: 7 of 7 OK created sql table model public_marts.genres_and_directors_with_good_comment_each_user  [[32mSELECT 236[0m in 14.77s]
[0m23:43:52.885313 [debug] [Thread-3 (]: Finished running node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:43:52.889248 [debug] [MainThread]: Using postgres connection "master"
[0m23:43:52.890024 [debug] [MainThread]: On master: BEGIN
[0m23:43:52.890680 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:43:52.906694 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m23:43:52.907423 [debug] [MainThread]: On master: COMMIT
[0m23:43:52.907985 [debug] [MainThread]: Using postgres connection "master"
[0m23:43:52.908561 [debug] [MainThread]: On master: COMMIT
[0m23:43:52.909882 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:43:52.910695 [debug] [MainThread]: On master: Close
[0m23:43:52.911975 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:43:52.912702 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m23:43:52.913404 [debug] [MainThread]: Connection 'model.mongo_movies.movies_genres_directors' was properly closed.
[0m23:43:52.914056 [debug] [MainThread]: Connection 'model.mongo_movies.genres_and_directors_with_good_comment_each_user' was properly closed.
[0m23:43:52.914704 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_genres' was properly closed.
[0m23:43:52.915652 [info ] [MainThread]: 
[0m23:43:52.916375 [info ] [MainThread]: Finished running 1 incremental model, 2 table models, 4 view models in 0 hours 0 minutes and 15.87 seconds (15.87s).
[0m23:43:52.919024 [debug] [MainThread]: Command end result
[0m23:43:39.433800 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:43:39.436351 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:43:39.444954 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m23:43:39.445725 [info ] [MainThread]: 
[0m23:43:39.446647 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:43:39.447466 [info ] [MainThread]: 
[0m23:43:39.448228 [error] [MainThread]: [31mFailure in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)[0m
[0m23:43:39.449123 [error] [MainThread]:   Database Error in model comments_by_user_incremental (models/mongo_movies/comments_by_user_incremental.sql)
  syntax error at or near ")"
  LINE 43: ),
           ^
  compiled code at target/run/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql
[0m23:43:39.450198 [info ] [MainThread]: 
[0m23:43:39.450873 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/mongo_movies/comments_by_user_incremental.sql
[0m23:43:39.451599 [info ] [MainThread]: 
[0m23:43:39.452774 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=7
[0m23:43:39.454660 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.3785617, "process_in_blocks": "560", "process_kernel_time": 0.756385, "process_mem_max_rss": "128080", "process_out_blocks": "2040", "process_user_time": 4.01805}
[0m23:43:39.455705 [debug] [MainThread]: Command `dbt run` failed at 23:43:39.455525 after 3.38 seconds
[0m23:43:39.456405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71f11e575250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71f1186bc9e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71f11e6c42f0>]}
[0m23:43:39.457224 [debug] [MainThread]: Flushing usage events
[0m23:43:40.847774 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:47:16.245201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745ba7d54b30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745ba81df320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745ba81df140>]}


============================== 23:47:16.250235 | 0d8e3b0c-7b19-47ee-b77a-5301f31abd48 ==============================
[0m23:47:16.250235 [info ] [MainThread]: Running with dbt=1.10.6
[0m23:47:16.251018 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:47:16.544998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0d8e3b0c-7b19-47ee-b77a-5301f31abd48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745ba7998bf0>]}
[0m23:47:16.675361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0d8e3b0c-7b19-47ee-b77a-5301f31abd48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745ba94b5190>]}
[0m23:47:16.676555 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:47:16.833754 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m23:47:16.989479 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:47:16.990380 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/comments_by_user_incremental.sql
[0m23:47:17.474927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0d8e3b0c-7b19-47ee-b77a-5301f31abd48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745ba578b380>]}
[0m23:47:17.598705 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:47:17.601262 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:47:17.623138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0d8e3b0c-7b19-47ee-b77a-5301f31abd48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745ba5bab860>]}
[0m23:47:17.624012 [info ] [MainThread]: Found 8 models, 6 sources, 434 macros
[0m23:47:17.624664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0d8e3b0c-7b19-47ee-b77a-5301f31abd48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745ba5b3dbb0>]}
[0m23:47:17.627208 [info ] [MainThread]: 
[0m23:47:17.627887 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:47:17.628455 [info ] [MainThread]: 
[0m23:47:17.629412 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:47:17.636705 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:47:17.638094 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:47:17.707662 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:47:17.708325 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:47:17.708868 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:47:17.709436 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:47:17.710044 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:47:17.710712 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:47:17.728313 [debug] [ThreadPool]: SQL status: SELECT 21 in 0.018 seconds
[0m23:47:17.728884 [debug] [ThreadPool]: SQL status: SELECT 21 in 0.018 seconds
[0m23:47:17.730640 [debug] [ThreadPool]: On list_test_db: Close
[0m23:47:17.733051 [debug] [ThreadPool]: On list_test_db: Close
[0m23:47:17.737291 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m23:47:17.738447 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m23:47:17.747456 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:47:17.750198 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:47:17.750781 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m23:47:17.751842 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m23:47:17.752792 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:47:17.753396 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:47:17.766621 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m23:47:17.767365 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:47:17.768175 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m23:47:17.768784 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m23:47:17.769401 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:47:17.770400 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m23:47:17.774961 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.005 seconds
[0m23:47:17.777064 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m23:47:17.777608 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.007 seconds
[0m23:47:17.779430 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m23:47:17.780045 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m23:47:17.781016 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m23:47:17.790596 [debug] [MainThread]: Using postgres connection "master"
[0m23:47:17.791186 [debug] [MainThread]: On master: BEGIN
[0m23:47:17.791773 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:47:17.806364 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m23:47:17.806999 [debug] [MainThread]: Using postgres connection "master"
[0m23:47:17.807642 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:47:17.854678 [debug] [MainThread]: SQL status: SELECT 5 in 0.046 seconds
[0m23:47:17.857195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0d8e3b0c-7b19-47ee-b77a-5301f31abd48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745b9ff2d910>]}
[0m23:47:17.857831 [debug] [MainThread]: On master: ROLLBACK
[0m23:47:17.858831 [debug] [MainThread]: Using postgres connection "master"
[0m23:47:17.859293 [debug] [MainThread]: On master: BEGIN
[0m23:47:17.860513 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:47:17.861034 [debug] [MainThread]: On master: COMMIT
[0m23:47:17.861713 [debug] [MainThread]: Using postgres connection "master"
[0m23:47:17.862453 [debug] [MainThread]: On master: COMMIT
[0m23:47:17.863333 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:47:17.864068 [debug] [MainThread]: On master: Close
[0m23:47:17.880074 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m23:47:17.881298 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies
[0m23:47:17.883230 [debug] [Thread-3 (]: Began running node model.mongo_movies.stg_movies_directors
[0m23:47:17.882429 [info ] [Thread-1 (]: 1 of 7 START sql view model public_staging.stg_comments ........................ [RUN]
[0m23:47:17.884742 [debug] [Thread-4 (]: Began running node model.mongo_movies.stg_movies_genres
[0m23:47:17.886508 [info ] [Thread-2 (]: 2 of 7 START sql view model public_staging.stg_movies .......................... [RUN]
[0m23:47:17.887946 [info ] [Thread-3 (]: 3 of 7 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m23:47:17.889282 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m23:47:17.890571 [info ] [Thread-4 (]: 4 of 7 START sql view model public_staging.stg_movies_genres ................... [RUN]
[0m23:47:17.891836 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_movies)
[0m23:47:17.892802 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.stg_movies_directors'
[0m23:47:17.893767 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m23:47:17.894930 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.stg_movies_genres'
[0m23:47:17.895889 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies
[0m23:47:17.896810 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m23:47:17.911499 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m23:47:17.913063 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.stg_movies_genres
[0m23:47:17.917840 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies"
[0m23:47:17.923756 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m23:47:17.927279 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_genres"
[0m23:47:17.928894 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies
[0m23:47:17.929575 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m23:47:18.021639 [debug] [Thread-3 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m23:47:18.032663 [debug] [Thread-4 (]: Began executing node model.mongo_movies.stg_movies_genres
[0m23:47:18.076458 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies"
[0m23:47:18.078604 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m23:47:18.082857 [debug] [Thread-3 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m23:47:18.087099 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_genres"
[0m23:47:18.090149 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:47:18.091032 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:47:18.091828 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:47:18.092380 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m23:47:18.092918 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:47:18.093632 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: BEGIN
[0m23:47:18.094382 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m23:47:18.095143 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:47:18.095820 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: BEGIN
[0m23:47:18.096470 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:47:18.097130 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m23:47:18.098399 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m23:47:18.112641 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m23:47:18.113381 [debug] [Thread-2 (]: SQL status: BEGIN in 0.017 seconds
[0m23:47:18.114012 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:47:18.114934 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:47:18.115899 [debug] [Thread-3 (]: SQL status: BEGIN in 0.019 seconds
[0m23:47:18.116555 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m23:47:18.117134 [debug] [Thread-4 (]: SQL status: BEGIN in 0.019 seconds
[0m23:47:18.117828 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */

  create view "test_db"."public_staging"."stg_movies__dbt_tmp"
    
    
  as (
    SELECT * FROM "test_db"."mongo_data"."movies"
  );
[0m23:47:18.118532 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:47:18.119700 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:47:18.120590 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM "test_db"."mongo_data"."movies__directors"
  );
[0m23:47:18.121275 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */

  create view "test_db"."public_staging"."stg_movies_genres__dbt_tmp"
    
    
  as (
    SELECT value AS genre, _dlt_parent_id AS movie_id 
FROM "test_db"."mongo_data"."movies__genres"
  );
[0m23:47:18.123757 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m23:47:18.124405 [debug] [Thread-4 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m23:47:18.131056 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.009 seconds
[0m23:47:18.132117 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.012 seconds
[0m23:47:18.142222 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:47:18.143179 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:47:18.146803 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:47:18.152482 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:47:18.153540 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m23:47:18.154614 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */
alter table "test_db"."public_staging"."stg_movies_genres" rename to "stg_movies_genres__dbt_backup"
[0m23:47:18.155374 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m23:47:18.156362 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */
alter table "test_db"."public_staging"."stg_movies" rename to "stg_movies__dbt_backup"
[0m23:47:18.157898 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:47:18.158618 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:47:18.159139 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:47:18.159898 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:47:18.163419 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:47:18.167705 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:47:18.171756 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:47:18.175693 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:47:18.176737 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */
alter table "test_db"."public_staging"."stg_movies_genres__dbt_tmp" rename to "stg_movies_genres"
[0m23:47:18.177815 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m23:47:18.178519 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */
alter table "test_db"."public_staging"."stg_movies__dbt_tmp" rename to "stg_movies"
[0m23:47:18.179199 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m23:47:18.180926 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:47:18.181659 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:47:18.182518 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:47:18.206668 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.026 seconds
[0m23:47:18.213377 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:47:18.216375 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: COMMIT
[0m23:47:18.218854 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: COMMIT
[0m23:47:18.221350 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:47:18.222104 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:47:18.222876 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:47:18.223859 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:47:18.224694 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:47:18.225404 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:47:18.226028 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: COMMIT
[0m23:47:18.226660 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: COMMIT
[0m23:47:18.227638 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:47:18.234464 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m23:47:18.241756 [debug] [Thread-4 (]: SQL status: COMMIT in 0.013 seconds
[0m23:47:18.244951 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m23:47:18.245589 [debug] [Thread-3 (]: SQL status: COMMIT in 0.017 seconds
[0m23:47:18.246321 [debug] [Thread-2 (]: SQL status: COMMIT in 0.017 seconds
[0m23:47:18.249213 [debug] [Thread-4 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_genres__dbt_backup"
[0m23:47:18.257962 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:47:18.261258 [debug] [Thread-3 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m23:47:18.264584 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies__dbt_backup"
[0m23:47:18.265864 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:47:18.266524 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m23:47:18.267867 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:47:18.268966 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:47:18.269664 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */
drop view if exists "test_db"."public_staging"."stg_movies_genres__dbt_backup" cascade
[0m23:47:18.270629 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m23:47:18.271582 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */
drop view if exists "test_db"."public_staging"."stg_movies__dbt_backup" cascade
[0m23:47:18.288330 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.018 seconds
[0m23:47:18.291871 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m23:47:18.293118 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.020 seconds
[0m23:47:18.295784 [debug] [Thread-4 (]: SQL status: DROP VIEW in 0.023 seconds
[0m23:47:18.297930 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: Close
[0m23:47:18.298451 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.026 seconds
[0m23:47:18.299020 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d8e3b0c-7b19-47ee-b77a-5301f31abd48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745b9ff033b0>]}
[0m23:47:18.301063 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: Close
[0m23:47:18.304108 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: Close
[0m23:47:18.305178 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d8e3b0c-7b19-47ee-b77a-5301f31abd48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745ba5f49e20>]}
[0m23:47:18.306558 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.40s]
[0m23:47:18.307945 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d8e3b0c-7b19-47ee-b77a-5301f31abd48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745ba5f18ec0>]}
[0m23:47:18.310118 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d8e3b0c-7b19-47ee-b77a-5301f31abd48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745b9ff95070>]}
[0m23:47:18.309329 [info ] [Thread-2 (]: 2 of 7 OK created sql view model public_staging.stg_movies ..................... [[32mCREATE VIEW[0m in 0.41s]
[0m23:47:18.311646 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m23:47:18.312899 [info ] [Thread-4 (]: 4 of 7 OK created sql view model public_staging.stg_movies_genres .............. [[32mCREATE VIEW[0m in 0.41s]
[0m23:47:18.314196 [info ] [Thread-3 (]: 3 of 7 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.42s]
[0m23:47:18.315841 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies
[0m23:47:18.317860 [debug] [Thread-4 (]: Finished running node model.mongo_movies.stg_movies_genres
[0m23:47:18.319408 [debug] [Thread-3 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m23:47:18.320614 [debug] [Thread-1 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m23:47:18.324634 [debug] [Thread-2 (]: Began running node model.mongo_movies.movies_genres_directors
[0m23:47:18.323475 [info ] [Thread-1 (]: 5 of 7 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m23:47:18.326249 [info ] [Thread-2 (]: 6 of 7 START sql table model public_marts.movies_genres_directors .............. [RUN]
[0m23:47:18.327428 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_comments, now model.mongo_movies.comments_by_user_incremental)
[0m23:47:18.328546 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_movies, now model.mongo_movies.movies_genres_directors)
[0m23:47:18.329551 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m23:47:18.330533 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.movies_genres_directors
[0m23:47:18.338373 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m23:47:18.346008 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.movies_genres_directors"
[0m23:47:18.347352 [debug] [Thread-2 (]: Began executing node model.mongo_movies.movies_genres_directors
[0m23:47:18.348317 [debug] [Thread-1 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m23:47:18.412127 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.movies_genres_directors"
[0m23:47:18.438230 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user_incremental"
[0m23:47:18.439385 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:47:18.440345 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:47:18.441110 [debug] [Thread-1 (]: On model.mongo_movies.comments_by_user_incremental: BEGIN
[0m23:47:18.441837 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: BEGIN
[0m23:47:18.442523 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:47:18.443252 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:47:18.456836 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m23:47:18.457981 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:47:18.458526 [debug] [Thread-2 (]: SQL status: BEGIN in 0.015 seconds
[0m23:47:18.459201 [debug] [Thread-1 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      
  
    

  create  table "test_db"."public_marts"."comments_by_user_incremental"
  
  
    as
  
  (
    



WITH max_existing AS (
  
      SELECT null::timestamp AS max_load_date
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE (c.load_date AT TIME ZONE 'UTC') > coalesce(m.max_load_date, '1900-01-01'::timestamp)
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

final AS (
  
    SELECT * FROM new_agg
  
),

flat AS (
  
    SELECT * FROM new_agg
  
)


SELECT * FROM new_agg

  );
  
  
[0m23:47:18.459951 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:47:18.460802 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */

  
    

  create  table "test_db"."public_marts"."movies_genres_directors__dbt_tmp"
  
  
    as
  
  (
    SELECT m.title, m._id AS movie_id, g.genre, d.director FROM "test_db"."public_staging"."stg_movies" m 
JOIN "test_db"."public_staging"."stg_movies_genres" g ON m._dlt_id = g.movie_id
JOIN "test_db"."public_staging"."stg_movies_directors" d ON m._dlt_id = d.movie_id
  );
  
[0m23:47:18.632623 [debug] [Thread-2 (]: SQL status: SELECT 49379 in 0.171 seconds
[0m23:47:18.643717 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:47:18.644477 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */
alter table "test_db"."public_marts"."movies_genres_directors" rename to "movies_genres_directors__dbt_backup"
[0m23:47:18.645732 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:47:18.649398 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:47:18.650031 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */
alter table "test_db"."public_marts"."movies_genres_directors__dbt_tmp" rename to "movies_genres_directors"
[0m23:47:18.651125 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:47:18.653292 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: COMMIT
[0m23:47:18.653888 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:47:18.654460 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: COMMIT
[0m23:47:18.690276 [debug] [Thread-2 (]: SQL status: COMMIT in 0.035 seconds
[0m23:47:18.693858 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_marts"."movies_genres_directors__dbt_backup"
[0m23:47:18.698969 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:47:18.699512 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */
drop table if exists "test_db"."public_marts"."movies_genres_directors__dbt_backup" cascade
[0m23:47:18.701901 [debug] [Thread-1 (]: SQL status: SELECT 236 in 0.241 seconds
[0m23:47:18.704628 [debug] [Thread-1 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m23:47:18.705190 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:47:18.705759 [debug] [Thread-1 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m23:47:18.706970 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.007 seconds
[0m23:47:18.708809 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: Close
[0m23:47:18.709801 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d8e3b0c-7b19-47ee-b77a-5301f31abd48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745b9ffd81a0>]}
[0m23:47:18.710478 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m23:47:18.711629 [info ] [Thread-2 (]: 6 of 7 OK created sql table model public_marts.movies_genres_directors ......... [[32mSELECT 49379[0m in 0.38s]
[0m23:47:18.712995 [debug] [Thread-1 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m23:47:18.713862 [debug] [Thread-2 (]: Finished running node model.mongo_movies.movies_genres_directors
[0m23:47:18.715297 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d8e3b0c-7b19-47ee-b77a-5301f31abd48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745ba5734740>]}
[0m23:47:18.716078 [debug] [Thread-3 (]: Began running node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:47:18.717012 [info ] [Thread-1 (]: 5 of 7 OK created sql incremental model public_marts.comments_by_user_incremental  [[32mSELECT 236[0m in 0.39s]
[0m23:47:18.718079 [info ] [Thread-3 (]: 7 of 7 START sql table model public_marts.genres_and_directors_with_good_comment_each_user  [RUN]
[0m23:47:18.719116 [debug] [Thread-1 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m23:47:18.719913 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_movies_directors, now model.mongo_movies.genres_and_directors_with_good_comment_each_user)
[0m23:47:18.721043 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:47:18.725595 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:47:18.726631 [debug] [Thread-3 (]: Began executing node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:47:18.731001 [debug] [Thread-3 (]: Writing runtime sql for node "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:47:18.732128 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:47:18.732710 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: BEGIN
[0m23:47:18.733216 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m23:47:18.747107 [debug] [Thread-3 (]: SQL status: BEGIN in 0.014 seconds
[0m23:47:18.748052 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:47:18.748729 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */

  
    

  create  table "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_tmp"
  
  
    as
  
  (
    SELECT 
    c.email,
    COALESCE(array_agg(DISTINCT gd.director) FILTER (
      WHERE c.text ~* '\mgood\M' AND c.text !~* 'not\s+good'
    ), '{}') AS fav_directors,

    COALESCE(array_agg(DISTINCT gd.genre) FILTER (
      WHERE c.text ~* '\mgood\M' AND c.text !~* 'not\s+good'
    ), '{}') AS fav_genres,

    COALESCE(array_agg(DISTINCT gd.title) FILTER (
      WHERE c.text ~* '\mgood\M' AND c.text !~* 'not\s+good'
    ), '{}') AS fav_movies
FROM "test_db"."public_staging"."stg_comments" c
JOIN "test_db"."public_marts"."movies_genres_directors" gd ON c.movie_id = gd.movie_id
GROUP BY c.email
  );
  
[0m23:47:19.831240 [debug] [Thread-3 (]: SQL status: SELECT 236 in 1.076 seconds
[0m23:47:19.837021 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:47:19.837901 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */
alter table "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user" rename to "genres_and_directors_with_good_comment_each_user__dbt_backup"
[0m23:47:19.839519 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:47:19.849032 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:47:19.850184 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */
alter table "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_tmp" rename to "genres_and_directors_with_good_comment_each_user"
[0m23:47:19.851925 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:47:19.855091 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: COMMIT
[0m23:47:19.855847 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:47:19.856570 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: COMMIT
[0m23:47:19.859209 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m23:47:19.863103 [debug] [Thread-3 (]: Applying DROP to: "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_backup"
[0m23:47:19.864363 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:47:19.865277 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */
drop table if exists "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_backup" cascade
[0m23:47:19.868815 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.003 seconds
[0m23:47:19.870927 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: Close
[0m23:47:19.871861 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d8e3b0c-7b19-47ee-b77a-5301f31abd48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745b9ff31130>]}
[0m23:47:19.872759 [info ] [Thread-3 (]: 7 of 7 OK created sql table model public_marts.genres_and_directors_with_good_comment_each_user  [[32mSELECT 236[0m in 1.15s]
[0m23:47:19.873795 [debug] [Thread-3 (]: Finished running node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:47:19.876779 [debug] [MainThread]: Using postgres connection "master"
[0m23:47:19.877439 [debug] [MainThread]: On master: BEGIN
[0m23:47:19.877910 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:47:19.892611 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m23:47:19.893440 [debug] [MainThread]: On master: COMMIT
[0m23:47:19.893915 [debug] [MainThread]: Using postgres connection "master"
[0m23:47:19.894351 [debug] [MainThread]: On master: COMMIT
[0m23:47:19.895056 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:47:19.895564 [debug] [MainThread]: On master: Close
[0m23:47:19.896483 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:47:19.896970 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m23:47:19.897632 [debug] [MainThread]: Connection 'model.mongo_movies.movies_genres_directors' was properly closed.
[0m23:47:19.898109 [debug] [MainThread]: Connection 'model.mongo_movies.genres_and_directors_with_good_comment_each_user' was properly closed.
[0m23:47:19.898567 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_genres' was properly closed.
[0m23:47:19.899275 [info ] [MainThread]: 
[0m23:47:19.899933 [info ] [MainThread]: Finished running 1 incremental model, 2 table models, 4 view models in 0 hours 0 minutes and 2.27 seconds (2.27s).
[0m23:47:19.903530 [debug] [MainThread]: Command end result
[0m23:47:19.937572 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:47:19.940597 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:47:19.950806 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m23:47:19.951594 [info ] [MainThread]: 
[0m23:47:19.952269 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:47:19.952789 [info ] [MainThread]: 
[0m23:47:19.953598 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m23:47:19.955295 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.8105953, "process_in_blocks": "0", "process_kernel_time": 0.861393, "process_mem_max_rss": "132676", "process_out_blocks": "2920", "process_user_time": 4.511298}
[0m23:47:19.956189 [debug] [MainThread]: Command `dbt run` succeeded at 23:47:19.955977 after 3.81 seconds
[0m23:47:19.956892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745ba7998230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745ba5bdf4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745ba8616570>]}
[0m23:47:19.957951 [debug] [MainThread]: Flushing usage events
[0m23:47:21.550330 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:49:02.420125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c05c5b9a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c05f7b3dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c05bb61760>]}


============================== 23:49:02.426082 | 9e7f39c6-8a33-47e6-9e8a-043e60096c08 ==============================
[0m23:49:02.426082 [info ] [MainThread]: Running with dbt=1.10.6
[0m23:49:02.426926 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'version_check': 'True', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt compile', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:49:02.733359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9e7f39c6-8a33-47e6-9e8a-043e60096c08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c05bfeb4a0>]}
[0m23:49:02.866107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9e7f39c6-8a33-47e6-9e8a-043e60096c08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c05baec680>]}
[0m23:49:02.867503 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:49:03.018971 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m23:49:03.168537 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:49:03.169189 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:49:03.216822 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9e7f39c6-8a33-47e6-9e8a-043e60096c08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c05adf1f40>]}
[0m23:49:03.342443 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:49:03.344810 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:49:03.361561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9e7f39c6-8a33-47e6-9e8a-043e60096c08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c05a576db0>]}
[0m23:49:03.362327 [info ] [MainThread]: Found 8 models, 6 sources, 434 macros
[0m23:49:03.362887 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9e7f39c6-8a33-47e6-9e8a-043e60096c08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c05ad29730>]}
[0m23:49:03.365359 [info ] [MainThread]: 
[0m23:49:03.365923 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:49:03.366522 [info ] [MainThread]: 
[0m23:49:03.367324 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:49:03.373917 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_marts'
[0m23:49:03.383116 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_staging'
[0m23:49:03.447498 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:49:03.448374 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:49:03.449040 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m23:49:03.449661 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m23:49:03.450327 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:49:03.450948 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:49:03.468922 [debug] [ThreadPool]: SQL status: BEGIN in 0.018 seconds
[0m23:49:03.469800 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:49:03.470381 [debug] [ThreadPool]: SQL status: BEGIN in 0.020 seconds
[0m23:49:03.470929 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m23:49:03.471573 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:49:03.472960 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m23:49:03.478447 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.005 seconds
[0m23:49:03.479049 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.007 seconds
[0m23:49:03.481082 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m23:49:03.482817 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m23:49:03.483775 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m23:49:03.484471 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m23:49:03.493718 [debug] [MainThread]: Using postgres connection "master"
[0m23:49:03.494309 [debug] [MainThread]: On master: BEGIN
[0m23:49:03.494809 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:49:03.509471 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m23:49:03.510063 [debug] [MainThread]: Using postgres connection "master"
[0m23:49:03.510582 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:49:03.556672 [debug] [MainThread]: SQL status: SELECT 5 in 0.045 seconds
[0m23:49:03.558709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9e7f39c6-8a33-47e6-9e8a-043e60096c08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c05a1b0500>]}
[0m23:49:03.559323 [debug] [MainThread]: On master: ROLLBACK
[0m23:49:03.560293 [debug] [MainThread]: On master: Close
[0m23:49:03.565664 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m23:49:03.566382 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies
[0m23:49:03.567070 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_comments)
[0m23:49:03.567797 [debug] [Thread-3 (]: Began running node model.mongo_movies.stg_movies_directors
[0m23:49:03.568697 [debug] [Thread-4 (]: Began running node model.mongo_movies.stg_movies_genres
[0m23:49:03.569376 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_movies)
[0m23:49:03.570100 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m23:49:03.571119 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.stg_movies_directors'
[0m23:49:03.572053 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.stg_movies_genres'
[0m23:49:03.572782 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies
[0m23:49:03.584697 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m23:49:03.583397 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m23:49:03.585486 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.stg_movies_genres
[0m23:49:03.589022 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies"
[0m23:49:03.592792 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m23:49:03.596825 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_genres"
[0m23:49:03.598105 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m23:49:03.599069 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies
[0m23:49:03.600553 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m23:49:03.601359 [debug] [Thread-3 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m23:49:03.602575 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies
[0m23:49:03.603077 [debug] [Thread-4 (]: Began executing node model.mongo_movies.stg_movies_genres
[0m23:49:03.604767 [debug] [Thread-3 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m23:49:03.605280 [debug] [Thread-1 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m23:49:03.606716 [debug] [Thread-4 (]: Finished running node model.mongo_movies.stg_movies_genres
[0m23:49:03.608078 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_comments, now model.mongo_movies.comments_by_user_incremental)
[0m23:49:03.609225 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m23:49:03.615119 [debug] [Thread-2 (]: Began running node model.mongo_movies.movies_genres_directors
[0m23:49:03.625685 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m23:49:03.626514 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_movies, now model.mongo_movies.movies_genres_directors)
[0m23:49:03.627424 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.movies_genres_directors
[0m23:49:03.631081 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.movies_genres_directors"
[0m23:49:03.632198 [debug] [Thread-1 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m23:49:03.632819 [debug] [Thread-2 (]: Began executing node model.mongo_movies.movies_genres_directors
[0m23:49:03.633798 [debug] [Thread-1 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m23:49:03.634835 [debug] [Thread-2 (]: Finished running node model.mongo_movies.movies_genres_directors
[0m23:49:03.637064 [debug] [Thread-4 (]: Began running node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:49:03.637726 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_movies_genres, now model.mongo_movies.genres_and_directors_with_good_comment_each_user)
[0m23:49:03.638286 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:49:03.641809 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:49:03.642637 [debug] [Thread-4 (]: Began executing node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:49:03.643741 [debug] [Thread-4 (]: Finished running node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:49:03.646345 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:49:03.646826 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m23:49:03.647237 [debug] [MainThread]: Connection 'model.mongo_movies.movies_genres_directors' was properly closed.
[0m23:49:03.647634 [debug] [MainThread]: Connection 'model.mongo_movies.stg_movies_directors' was properly closed.
[0m23:49:03.648166 [debug] [MainThread]: Connection 'model.mongo_movies.genres_and_directors_with_good_comment_each_user' was properly closed.
[0m23:49:03.649765 [debug] [MainThread]: Command end result
[0m23:49:03.677976 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:49:03.680392 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:49:03.689516 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m23:49:03.690764 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 1.3998588, "process_in_blocks": "0", "process_kernel_time": 0.784305, "process_mem_max_rss": "124800", "process_out_blocks": "1928", "process_user_time": 3.329298}
[0m23:49:03.691446 [debug] [MainThread]: Command `dbt compile` succeeded at 23:49:03.691247 after 1.40 seconds
[0m23:49:03.692041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c05fbb33b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c05b7a8350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c05bc24920>]}
[0m23:49:03.692652 [debug] [MainThread]: Flushing usage events
[0m23:49:04.960147 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:49:34.209457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7617b7a77ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7617b7a763c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7617b7a778f0>]}


============================== 23:49:34.214105 | 408052b5-a8cf-4fee-a90f-07358d496f04 ==============================
[0m23:49:34.214105 [info ] [MainThread]: Running with dbt=1.10.6
[0m23:49:34.214933 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:49:34.501270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '408052b5-a8cf-4fee-a90f-07358d496f04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7617b75aeb40>]}
[0m23:49:34.627489 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '408052b5-a8cf-4fee-a90f-07358d496f04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7617b7d0a060>]}
[0m23:49:34.628811 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:49:48.337260 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m23:49:48.482648 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m23:49:48.483486 [debug] [MainThread]: Partial parsing: added file: mongo_movies://models/mongo_movies/count_comments_each_user.sql
[0m23:49:48.484028 [debug] [MainThread]: Partial parsing: deleted file: mongo_movies://models/mongo_movies/comments_by_user.sql
[0m23:49:35.468579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '408052b5-a8cf-4fee-a90f-07358d496f04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7617b5978a40>]}
[0m23:49:35.615897 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:49:35.619190 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:49:35.678524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '408052b5-a8cf-4fee-a90f-07358d496f04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7617b65eca10>]}
[0m23:49:35.679607 [info ] [MainThread]: Found 8 models, 6 sources, 434 macros
[0m23:49:35.689373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '408052b5-a8cf-4fee-a90f-07358d496f04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7617b61db590>]}
[0m23:49:35.694288 [info ] [MainThread]: 
[0m23:49:35.695365 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:49:35.696129 [info ] [MainThread]: 
[0m23:49:35.697275 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:49:35.710420 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:49:35.717587 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:49:35.814038 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:49:35.814847 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:49:35.815519 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:49:35.816361 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:49:35.817313 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:49:35.818105 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:49:35.836952 [debug] [ThreadPool]: SQL status: SELECT 21 in 0.019 seconds
[0m23:49:35.837879 [debug] [ThreadPool]: SQL status: SELECT 21 in 0.021 seconds
[0m23:49:35.840506 [debug] [ThreadPool]: On list_test_db: Close
[0m23:49:35.842818 [debug] [ThreadPool]: On list_test_db: Close
[0m23:49:35.847614 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m23:49:35.854491 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m23:49:35.866754 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:49:35.870793 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:49:35.871674 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m23:49:35.872511 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m23:49:35.873419 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:49:35.874171 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:49:35.890026 [debug] [ThreadPool]: SQL status: BEGIN in 0.017 seconds
[0m23:49:35.890974 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:49:35.891820 [debug] [ThreadPool]: SQL status: BEGIN in 0.018 seconds
[0m23:49:35.892429 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m23:49:35.893168 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:49:35.894067 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m23:49:35.901782 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.007 seconds
[0m23:49:35.902575 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.009 seconds
[0m23:49:35.904466 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m23:49:35.906484 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m23:49:35.907634 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m23:49:35.908326 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m23:49:35.918934 [debug] [MainThread]: Using postgres connection "master"
[0m23:49:35.919554 [debug] [MainThread]: On master: BEGIN
[0m23:49:35.920031 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:49:35.934026 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m23:49:35.934645 [debug] [MainThread]: Using postgres connection "master"
[0m23:49:35.935226 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:49:35.981631 [debug] [MainThread]: SQL status: SELECT 5 in 0.046 seconds
[0m23:49:35.984025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '408052b5-a8cf-4fee-a90f-07358d496f04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7617b7a9bec0>]}
[0m23:49:35.984709 [debug] [MainThread]: On master: ROLLBACK
[0m23:49:35.985724 [debug] [MainThread]: Using postgres connection "master"
[0m23:49:35.986195 [debug] [MainThread]: On master: BEGIN
[0m23:49:35.987378 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:49:35.987852 [debug] [MainThread]: On master: COMMIT
[0m23:49:35.988324 [debug] [MainThread]: Using postgres connection "master"
[0m23:49:35.988776 [debug] [MainThread]: On master: COMMIT
[0m23:49:35.989757 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:49:35.990239 [debug] [MainThread]: On master: Close
[0m23:49:35.996046 [debug] [Thread-1 (]: Began running node model.mongo_movies.count_comments_each_user
[0m23:49:35.997300 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_comments
[0m23:49:35.998481 [info ] [Thread-1 (]: 1 of 8 START sql table model public_marts.count_comments_each_user ............. [RUN]
[0m23:49:35.999384 [debug] [Thread-3 (]: Began running node model.mongo_movies.stg_movies
[0m23:49:36.000151 [info ] [Thread-2 (]: 2 of 8 START sql view model public_staging.stg_comments ........................ [RUN]
[0m23:49:36.001212 [debug] [Thread-4 (]: Began running node model.mongo_movies.stg_movies_directors
[0m23:49:36.002116 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.count_comments_each_user)
[0m23:49:36.003183 [info ] [Thread-3 (]: 3 of 8 START sql view model public_staging.stg_movies .......................... [RUN]
[0m23:49:36.004306 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m23:49:36.005461 [info ] [Thread-4 (]: 4 of 8 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m23:49:36.006604 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.count_comments_each_user
[0m23:49:36.007772 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.stg_movies'
[0m23:49:36.008716 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_comments
[0m23:49:36.009985 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.stg_movies_directors'
[0m23:49:36.036154 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.stg_movies
[0m23:49:36.042936 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m23:49:36.044267 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m23:49:36.048364 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.stg_movies"
[0m23:49:36.057790 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m23:49:36.058632 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_comments
[0m23:49:36.194076 [debug] [Thread-3 (]: Began executing node model.mongo_movies.stg_movies
[0m23:49:36.196742 [debug] [Thread-4 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m23:49:36.328637 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m23:49:36.324692 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m23:49:36.332125 [debug] [Thread-3 (]: Writing runtime sql for node "model.mongo_movies.stg_movies"
[0m23:49:36.335049 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:49:36.336067 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m23:49:36.336870 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m23:49:36.338679 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:49:36.339546 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:49:36.340492 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies: BEGIN
[0m23:49:36.341294 [debug] [Thread-2 (]: On model.mongo_movies.stg_comments: BEGIN
[0m23:49:36.342195 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m23:49:36.343169 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:49:36.345087 [debug] [Thread-1 (]: Compilation Error in model count_comments_each_user (models/mongo_movies/count_comments_each_user.sql)
  dbt was unable to infer all dependencies for the model "count_comments_each_user".
  This typically happens when ref() is placed within a conditional block.
  
  To fix this, add the following hint to the top of the model "count_comments_each_user":
  
  -- depends_on: {{ ref('stg_comments') }}
[0m23:49:36.348399 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '408052b5-a8cf-4fee-a90f-07358d496f04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7617ba408770>]}
[0m23:49:36.349742 [error] [Thread-1 (]: 1 of 8 ERROR creating sql table model public_marts.count_comments_each_user .... [[31mERROR[0m in 0.34s]
[0m23:49:36.351113 [debug] [Thread-1 (]: Finished running node model.mongo_movies.count_comments_each_user
[0m23:49:36.351874 [debug] [Thread-4 (]: SQL status: BEGIN in 0.015 seconds
[0m23:49:36.352640 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_movies_genres
[0m23:49:36.353592 [debug] [Thread-7 (]: Marking all children of 'model.mongo_movies.count_comments_each_user' to be skipped because of status 'error'.  Reason: Compilation Error in model count_comments_each_user (models/mongo_movies/count_comments_each_user.sql)
  dbt was unable to infer all dependencies for the model "count_comments_each_user".
  This typically happens when ref() is placed within a conditional block.
  
  To fix this, add the following hint to the top of the model "count_comments_each_user":
  
  -- depends_on: {{ ref('stg_comments') }}.
[0m23:49:36.354261 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:49:36.355116 [info ] [Thread-1 (]: 5 of 8 START sql view model public_staging.stg_movies_genres ................... [RUN]
[0m23:49:36.357206 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM "test_db"."mongo_data"."movies__directors"
  );
[0m23:49:36.358172 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.mongo_movies.count_comments_each_user, now model.mongo_movies.stg_movies_genres)
[0m23:49:36.359434 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_movies_genres
[0m23:49:36.360177 [debug] [Thread-3 (]: SQL status: BEGIN in 0.018 seconds
[0m23:49:36.364273 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_genres"
[0m23:49:36.365389 [debug] [Thread-2 (]: SQL status: BEGIN in 0.022 seconds
[0m23:49:36.366240 [debug] [Thread-4 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m23:49:36.366958 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:49:36.368027 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:49:36.374600 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_movies_genres
[0m23:49:36.378231 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:49:36.379067 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */

  create view "test_db"."public_staging"."stg_movies__dbt_tmp"
    
    
  as (
    SELECT * FROM "test_db"."mongo_data"."movies"
  );
[0m23:49:36.380358 [debug] [Thread-2 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m23:49:36.385662 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_genres"
[0m23:49:36.386380 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m23:49:36.388445 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:49:36.389166 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:49:36.389940 [debug] [Thread-1 (]: On model.mongo_movies.stg_movies_genres: BEGIN
[0m23:49:36.393944 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:49:36.394691 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.008 seconds
[0m23:49:36.395430 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.008 seconds
[0m23:49:36.396030 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:49:36.396713 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m23:49:36.400751 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:49:36.406269 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:49:36.408224 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */
alter table "test_db"."public_staging"."stg_movies" rename to "stg_movies__dbt_backup"
[0m23:49:36.409185 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:49:36.409779 [debug] [Thread-2 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m23:49:36.416114 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.006 seconds
[0m23:49:36.435848 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:49:36.436598 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m23:49:36.437254 [debug] [Thread-1 (]: SQL status: BEGIN in 0.041 seconds
[0m23:49:36.440948 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:49:36.441752 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:49:36.445791 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:49:36.446861 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:49:36.447862 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */
alter table "test_db"."public_staging"."stg_movies__dbt_tmp" rename to "stg_movies"
[0m23:49:36.448603 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:49:36.449338 [debug] [Thread-2 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m23:49:36.450057 [debug] [Thread-1 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */

  create view "test_db"."public_staging"."stg_movies_genres__dbt_tmp"
    
    
  as (
    SELECT value AS genre, _dlt_parent_id AS movie_id 
FROM "test_db"."mongo_data"."movies__genres"
  );
[0m23:49:36.451685 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:49:36.452256 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:49:36.454266 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies: COMMIT
[0m23:49:36.455317 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m23:49:36.457534 [debug] [Thread-2 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:49:36.458387 [debug] [Thread-4 (]: SQL status: COMMIT in 0.007 seconds
[0m23:49:36.459076 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:49:36.462937 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:49:36.463989 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:49:36.473182 [debug] [Thread-4 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m23:49:36.474383 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies: COMMIT
[0m23:49:36.475113 [debug] [Thread-1 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */
alter table "test_db"."public_staging"."stg_movies_genres" rename to "stg_movies_genres__dbt_backup"
[0m23:49:36.476007 [debug] [Thread-2 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:49:36.486166 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:49:36.487831 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:49:36.488802 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m23:49:36.492770 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:49:36.493518 [debug] [Thread-2 (]: SQL status: COMMIT in 0.006 seconds
[0m23:49:36.494379 [debug] [Thread-3 (]: SQL status: COMMIT in 0.007 seconds
[0m23:49:36.495174 [debug] [Thread-1 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */
alter table "test_db"."public_staging"."stg_movies_genres__dbt_tmp" rename to "stg_movies_genres"
[0m23:49:36.498352 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m23:49:36.501728 [debug] [Thread-3 (]: Applying DROP to: "test_db"."public_staging"."stg_movies__dbt_backup"
[0m23:49:36.502437 [debug] [Thread-4 (]: SQL status: DROP VIEW in 0.007 seconds
[0m23:49:36.503769 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:49:36.504428 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:49:36.505453 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:49:36.508617 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_directors: Close
[0m23:49:36.509727 [debug] [Thread-2 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m23:49:36.512046 [debug] [Thread-1 (]: On model.mongo_movies.stg_movies_genres: COMMIT
[0m23:49:36.512917 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */
drop view if exists "test_db"."public_staging"."stg_movies__dbt_backup" cascade
[0m23:49:36.514843 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '408052b5-a8cf-4fee-a90f-07358d496f04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7617ba4fe5d0>]}
[0m23:49:36.515637 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:49:36.517201 [info ] [Thread-4 (]: 4 of 8 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.51s]
[0m23:49:36.518300 [debug] [Thread-1 (]: On model.mongo_movies.stg_movies_genres: COMMIT
[0m23:49:36.519303 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.005 seconds
[0m23:49:36.520201 [debug] [Thread-4 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m23:49:36.522754 [debug] [Thread-2 (]: On model.mongo_movies.stg_comments: Close
[0m23:49:36.523359 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.007 seconds
[0m23:49:36.526400 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies: Close
[0m23:49:36.527568 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '408052b5-a8cf-4fee-a90f-07358d496f04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7617ba54c800>]}
[0m23:49:36.529947 [debug] [Thread-1 (]: SQL status: COMMIT in 0.009 seconds
[0m23:49:36.530895 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '408052b5-a8cf-4fee-a90f-07358d496f04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7617b6153a40>]}
[0m23:49:36.535666 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_genres__dbt_backup"
[0m23:49:36.529261 [info ] [Thread-2 (]: 2 of 8 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.52s]
[0m23:49:36.537457 [info ] [Thread-3 (]: 3 of 8 OK created sql view model public_staging.stg_movies ..................... [[32mCREATE VIEW[0m in 0.52s]
[0m23:49:36.539007 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:49:36.539957 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_comments
[0m23:49:36.541124 [debug] [Thread-3 (]: Finished running node model.mongo_movies.stg_movies
[0m23:49:36.542176 [debug] [Thread-1 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */
drop view if exists "test_db"."public_staging"."stg_movies_genres__dbt_backup" cascade
[0m23:49:36.545734 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m23:49:36.547195 [info ] [Thread-4 (]: 6 of 8 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m23:49:36.548334 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_movies_directors, now model.mongo_movies.comments_by_user_incremental)
[0m23:49:36.549274 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m23:49:36.550054 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m23:49:36.569418 [debug] [Thread-1 (]: On model.mongo_movies.stg_movies_genres: Close
[0m23:49:36.571064 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m23:49:36.572342 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '408052b5-a8cf-4fee-a90f-07358d496f04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76178e327470>]}
[0m23:49:36.573642 [info ] [Thread-1 (]: 5 of 8 OK created sql view model public_staging.stg_movies_genres .............. [[32mCREATE VIEW[0m in 0.21s]
[0m23:49:36.575039 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_movies_genres
[0m23:49:36.576327 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m23:49:36.577429 [debug] [Thread-3 (]: Began running node model.mongo_movies.movies_genres_directors
[0m23:49:36.612577 [info ] [Thread-3 (]: 7 of 8 START sql table model public_marts.movies_genres_directors .............. [RUN]
[0m23:49:36.629948 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_movies, now model.mongo_movies.movies_genres_directors)
[0m23:49:36.636106 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.movies_genres_directors
[0m23:49:36.646446 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:49:36.650979 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.movies_genres_directors"
[0m23:49:36.652225 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

    
  
    

  create temporary table "comments_by_user_incremental__dbt_tmp234936619819"
  
  
    as
  
  (
    



WITH max_existing AS (
  
      SELECT max(load_date AT TIME ZONE 'UTC') AS max_load_date
      FROM "test_db"."public_marts"."comments_by_user_incremental"
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE (c.load_date AT TIME ZONE 'UTC') > coalesce(m.max_load_date, '1900-01-01'::timestamp)
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

final AS (
  
    SELECT * FROM "test_db"."public_marts"."comments_by_user_incremental"
    UNION ALL
    SELECT * FROM new_agg
  
),

flat AS (
  
   SELECT
      name,
      email,
      total_comment_count,
      unnest(movie_ids) AS movie_id,
      load_date
    FROM (
        SELECT
            name,
            email,
            SUM(comment_count) OVER (PARTITION BY name, email) AS total_comment_count,
            movie_ids,
            load_date
        FROM final
    )
  
)


SELECT
  name,
  email,
  MAX(total_comment_count) as comment_count,
  array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
  max(load_date) AS load_date
FROM flat
GROUP BY name, email
ORDER BY comment_count DESC

  );
  
  
[0m23:49:36.653453 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m23:49:36.654837 [debug] [Thread-3 (]: Began executing node model.mongo_movies.movies_genres_directors
[0m23:49:36.672261 [debug] [Thread-3 (]: Writing runtime sql for node "model.mongo_movies.movies_genres_directors"
[0m23:49:36.673682 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:49:36.674535 [debug] [Thread-3 (]: On model.mongo_movies.movies_genres_directors: BEGIN
[0m23:49:36.675092 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m23:49:36.688285 [debug] [Thread-3 (]: SQL status: BEGIN in 0.013 seconds
[0m23:49:36.689044 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:49:36.689726 [debug] [Thread-3 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */

  
    

  create  table "test_db"."public_marts"."movies_genres_directors__dbt_tmp"
  
  
    as
  
  (
    SELECT m.title, m._id AS movie_id, g.genre, d.director FROM "test_db"."public_staging"."stg_movies" m 
JOIN "test_db"."public_staging"."stg_movies_genres" g ON m._dlt_id = g.movie_id
JOIN "test_db"."public_staging"."stg_movies_directors" d ON m._dlt_id = d.movie_id
  );
  
[0m23:49:36.747251 [debug] [Thread-4 (]: SQL status: SELECT 236 in 0.094 seconds
[0m23:49:36.766201 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:49:36.766889 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: BEGIN
[0m23:49:36.768436 [debug] [Thread-4 (]: SQL status: BEGIN in 0.001 seconds
[0m23:49:36.769369 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:49:36.770153 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental__dbt_tmp234936619819'
        
      order by ordinal_position

  
[0m23:49:36.789801 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.018 seconds
[0m23:49:36.799652 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:49:36.800492 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m23:49:36.805006 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.004 seconds
[0m23:49:36.820219 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:49:36.821353 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m23:49:36.826052 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.004 seconds
[0m23:49:36.851962 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user_incremental"
[0m23:49:36.852623 [debug] [Thread-3 (]: SQL status: SELECT 49379 in 0.162 seconds
[0m23:49:36.861795 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:49:36.862736 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:49:36.863431 [debug] [Thread-3 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */
alter table "test_db"."public_marts"."movies_genres_directors" rename to "movies_genres_directors__dbt_backup"
[0m23:49:36.864206 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      
        delete from "test_db"."public_marts"."comments_by_user_incremental" as DBT_INTERNAL_DEST
        where (name, email) in (
            select distinct name, email
            from "comments_by_user_incremental__dbt_tmp234936619819" as DBT_INTERNAL_SOURCE
        );

    

    insert into "test_db"."public_marts"."comments_by_user_incremental" ("name", "email", "comment_count", "movie_ids", "load_date")
    (
        select "name", "email", "comment_count", "movie_ids", "load_date"
        from "comments_by_user_incremental__dbt_tmp234936619819"
    )
  
[0m23:49:36.865596 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:49:36.869273 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:49:36.869898 [debug] [Thread-3 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */
alter table "test_db"."public_marts"."movies_genres_directors__dbt_tmp" rename to "movies_genres_directors"
[0m23:49:36.870651 [debug] [Thread-4 (]: SQL status: INSERT 0 236 in 0.005 seconds
[0m23:49:36.873208 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m23:49:36.873780 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:49:36.874517 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:49:36.877474 [debug] [Thread-3 (]: On model.mongo_movies.movies_genres_directors: COMMIT
[0m23:49:36.878515 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m23:49:36.879449 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:49:36.880473 [debug] [Thread-3 (]: On model.mongo_movies.movies_genres_directors: COMMIT
[0m23:49:36.907923 [debug] [Thread-4 (]: SQL status: COMMIT in 0.027 seconds
[0m23:49:36.909615 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m23:49:36.910560 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '408052b5-a8cf-4fee-a90f-07358d496f04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7617b711e9f0>]}
[0m23:49:36.911194 [debug] [Thread-3 (]: SQL status: COMMIT in 0.030 seconds
[0m23:49:36.912295 [info ] [Thread-4 (]: 6 of 8 OK created sql incremental model public_marts.comments_by_user_incremental  [[32mINSERT 0 236[0m in 0.36s]
[0m23:49:36.917835 [debug] [Thread-3 (]: Applying DROP to: "test_db"."public_marts"."movies_genres_directors__dbt_backup"
[0m23:49:36.919004 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m23:49:36.933042 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:49:36.934219 [debug] [Thread-3 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */
drop table if exists "test_db"."public_marts"."movies_genres_directors__dbt_backup" cascade
[0m23:49:36.942187 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.007 seconds
[0m23:49:36.944858 [debug] [Thread-3 (]: On model.mongo_movies.movies_genres_directors: Close
[0m23:49:36.945917 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '408052b5-a8cf-4fee-a90f-07358d496f04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76178c207da0>]}
[0m23:49:36.946743 [info ] [Thread-3 (]: 7 of 8 OK created sql table model public_marts.movies_genres_directors ......... [[32mSELECT 49379[0m in 0.32s]
[0m23:49:36.947725 [debug] [Thread-3 (]: Finished running node model.mongo_movies.movies_genres_directors
[0m23:49:36.949419 [debug] [Thread-1 (]: Began running node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:49:36.950230 [info ] [Thread-1 (]: 8 of 8 START sql table model public_marts.genres_and_directors_with_good_comment_each_user  [RUN]
[0m23:49:36.951182 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_movies_genres, now model.mongo_movies.genres_and_directors_with_good_comment_each_user)
[0m23:49:36.951881 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:49:36.956618 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:49:36.957770 [debug] [Thread-1 (]: Began executing node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:49:36.962664 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:49:36.963684 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:49:36.964251 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: BEGIN
[0m23:49:36.964819 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:49:36.978793 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m23:49:36.979523 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:49:36.980075 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */

  
    

  create  table "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_tmp"
  
  
    as
  
  (
    SELECT 
    c.email,
    COALESCE(array_agg(DISTINCT gd.director) FILTER (
      WHERE c.text ~* '\mgood\M' AND c.text !~* 'not\s+good'
    ), '{}') AS fav_directors,

    COALESCE(array_agg(DISTINCT gd.genre) FILTER (
      WHERE c.text ~* '\mgood\M' AND c.text !~* 'not\s+good'
    ), '{}') AS fav_genres,

    COALESCE(array_agg(DISTINCT gd.title) FILTER (
      WHERE c.text ~* '\mgood\M' AND c.text !~* 'not\s+good'
    ), '{}') AS fav_movies
FROM "test_db"."public_staging"."stg_comments" c
JOIN "test_db"."public_marts"."movies_genres_directors" gd ON c.movie_id = gd.movie_id
GROUP BY c.email
  );
  
[0m23:49:38.078875 [debug] [Thread-1 (]: SQL status: SELECT 236 in 1.098 seconds
[0m23:49:38.083212 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:49:38.083770 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */
alter table "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user" rename to "genres_and_directors_with_good_comment_each_user__dbt_backup"
[0m23:49:38.085293 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:49:38.088566 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:49:38.089192 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */
alter table "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_tmp" rename to "genres_and_directors_with_good_comment_each_user"
[0m23:49:38.090564 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:49:38.092481 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: COMMIT
[0m23:49:38.093207 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:49:38.093857 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: COMMIT
[0m23:49:38.098571 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m23:49:38.102083 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_backup"
[0m23:49:38.103144 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:49:38.103782 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */
drop table if exists "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_backup" cascade
[0m23:49:38.109898 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m23:49:38.111923 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: Close
[0m23:49:38.113507 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '408052b5-a8cf-4fee-a90f-07358d496f04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7617b7186570>]}
[0m23:49:38.114506 [info ] [Thread-1 (]: 8 of 8 OK created sql table model public_marts.genres_and_directors_with_good_comment_each_user  [[32mSELECT 236[0m in 1.16s]
[0m23:49:38.115508 [debug] [Thread-1 (]: Finished running node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:49:38.118505 [debug] [MainThread]: Using postgres connection "master"
[0m23:49:38.119007 [debug] [MainThread]: On master: BEGIN
[0m23:49:38.119508 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:49:38.134180 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m23:49:38.134918 [debug] [MainThread]: On master: COMMIT
[0m23:49:38.135472 [debug] [MainThread]: Using postgres connection "master"
[0m23:49:38.135977 [debug] [MainThread]: On master: COMMIT
[0m23:49:38.137096 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:49:38.138087 [debug] [MainThread]: On master: Close
[0m23:49:38.139224 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:49:38.139900 [debug] [MainThread]: Connection 'model.mongo_movies.stg_comments' was properly closed.
[0m23:49:38.140530 [debug] [MainThread]: Connection 'model.mongo_movies.genres_and_directors_with_good_comment_each_user' was properly closed.
[0m23:49:38.141198 [debug] [MainThread]: Connection 'model.mongo_movies.movies_genres_directors' was properly closed.
[0m23:49:38.141827 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m23:49:38.142648 [info ] [MainThread]: 
[0m23:49:38.143464 [info ] [MainThread]: Finished running 1 incremental model, 3 table models, 4 view models in 0 hours 0 minutes and 2.45 seconds (2.45s).
[0m23:49:38.147043 [debug] [MainThread]: Command end result
[0m23:49:38.183959 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:49:38.186624 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:49:38.195919 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m23:49:38.196526 [info ] [MainThread]: 
[0m23:49:38.197294 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:49:38.197928 [info ] [MainThread]: 
[0m23:49:38.198614 [error] [MainThread]: [31mFailure in model count_comments_each_user (models/mongo_movies/count_comments_each_user.sql)[0m
[0m23:49:38.199368 [error] [MainThread]:   Compilation Error in model count_comments_each_user (models/mongo_movies/count_comments_each_user.sql)
  dbt was unable to infer all dependencies for the model "count_comments_each_user".
  This typically happens when ref() is placed within a conditional block.
  
  To fix this, add the following hint to the top of the model "count_comments_each_user":
  
  -- depends_on: {{ ref('stg_comments') }}
[0m23:49:38.199982 [info ] [MainThread]: 
[0m23:49:38.200584 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=8
[0m23:49:38.202231 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.091548, "process_in_blocks": "384", "process_kernel_time": 0.95999, "process_mem_max_rss": "133336", "process_out_blocks": "2936", "process_user_time": 4.675434}
[0m23:49:38.202913 [debug] [MainThread]: Command `dbt run` failed at 23:49:38.202766 after 4.09 seconds
[0m23:49:38.203586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7617b7b981a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7617b7b980e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76178e30e330>]}
[0m23:49:38.204442 [debug] [MainThread]: Flushing usage events
[0m23:49:39.707939 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:52:50.355334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7539d952dbe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7539d90b04d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7539d9cc1760>]}


============================== 23:52:50.361211 | a4ef4789-7d10-4b85-bea8-9ae560ca37cc ==============================
[0m23:52:50.361211 [info ] [MainThread]: Running with dbt=1.10.6
[0m23:52:50.362295 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:52:50.692686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a4ef4789-7d10-4b85-bea8-9ae560ca37cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7539d8b52cc0>]}
[0m23:52:50.828351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a4ef4789-7d10-4b85-bea8-9ae560ca37cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7539d8714f80>]}
[0m23:52:50.829759 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:52:50.970608 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m23:52:51.129807 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:52:51.131093 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/mongo_movies/count_comments_each_user.sql
[0m23:52:51.721812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a4ef4789-7d10-4b85-bea8-9ae560ca37cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7539d6f8c9b0>]}
[0m23:52:51.845195 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:52:51.848626 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:52:51.869271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a4ef4789-7d10-4b85-bea8-9ae560ca37cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7539d7704fe0>]}
[0m23:52:51.870285 [info ] [MainThread]: Found 8 models, 6 sources, 434 macros
[0m23:52:51.871011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a4ef4789-7d10-4b85-bea8-9ae560ca37cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7539d6f8f8f0>]}
[0m23:52:51.874540 [info ] [MainThread]: 
[0m23:52:51.875311 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:52:51.876033 [info ] [MainThread]: 
[0m23:52:51.877042 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:52:51.884039 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:52:51.890669 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:52:51.964929 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:52:51.965790 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:52:51.966397 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:52:51.967017 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:52:51.967683 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:52:51.968589 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:52:51.986273 [debug] [ThreadPool]: SQL status: SELECT 23 in 0.018 seconds
[0m23:52:51.986961 [debug] [ThreadPool]: SQL status: SELECT 23 in 0.019 seconds
[0m23:52:51.988786 [debug] [ThreadPool]: On list_test_db: Close
[0m23:52:51.990449 [debug] [ThreadPool]: On list_test_db: Close
[0m23:52:51.994513 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m23:52:51.995721 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m23:52:52.004858 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:52:52.007683 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:52:52.008495 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m23:52:52.009332 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m23:52:52.009968 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:52:52.010600 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:52:52.024538 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m23:52:52.025420 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:52:52.025984 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m23:52:52.026742 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m23:52:52.027372 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:52:52.028296 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m23:52:52.033878 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.006 seconds
[0m23:52:52.036622 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m23:52:52.037517 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.008 seconds
[0m23:52:52.038276 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m23:52:52.039784 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m23:52:52.042222 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m23:52:52.049387 [debug] [MainThread]: Using postgres connection "master"
[0m23:52:52.050026 [debug] [MainThread]: On master: BEGIN
[0m23:52:52.050482 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:52:52.065009 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m23:52:52.065580 [debug] [MainThread]: Using postgres connection "master"
[0m23:52:52.066096 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:52:52.113011 [debug] [MainThread]: SQL status: SELECT 5 in 0.046 seconds
[0m23:52:52.115112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a4ef4789-7d10-4b85-bea8-9ae560ca37cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7539d6f1cc50>]}
[0m23:52:52.115805 [debug] [MainThread]: On master: ROLLBACK
[0m23:52:52.116679 [debug] [MainThread]: Using postgres connection "master"
[0m23:52:52.117236 [debug] [MainThread]: On master: BEGIN
[0m23:52:52.118404 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:52:52.118908 [debug] [MainThread]: On master: COMMIT
[0m23:52:52.119442 [debug] [MainThread]: Using postgres connection "master"
[0m23:52:52.120036 [debug] [MainThread]: On master: COMMIT
[0m23:52:52.120785 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:52:52.121323 [debug] [MainThread]: On master: Close
[0m23:52:52.126721 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m23:52:52.127466 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies
[0m23:52:52.128462 [debug] [Thread-3 (]: Began running node model.mongo_movies.stg_movies_directors
[0m23:52:52.129487 [debug] [Thread-4 (]: Began running node model.mongo_movies.stg_movies_genres
[0m23:52:52.130414 [info ] [Thread-1 (]: 1 of 8 START sql view model public_staging.stg_comments ........................ [RUN]
[0m23:52:52.131713 [info ] [Thread-2 (]: 2 of 8 START sql view model public_staging.stg_movies .......................... [RUN]
[0m23:52:52.132741 [info ] [Thread-3 (]: 3 of 8 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m23:52:52.133830 [info ] [Thread-4 (]: 4 of 8 START sql view model public_staging.stg_movies_genres ................... [RUN]
[0m23:52:52.134895 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m23:52:52.135634 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_movies)
[0m23:52:52.136559 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.stg_movies_directors'
[0m23:52:52.137401 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.stg_movies_genres'
[0m23:52:52.138298 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m23:52:52.139112 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies
[0m23:52:52.139991 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m23:52:52.140940 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.stg_movies_genres
[0m23:52:52.160776 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies"
[0m23:52:52.163829 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m23:52:52.157489 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m23:52:52.170615 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_genres"
[0m23:52:52.172706 [debug] [Thread-3 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m23:52:52.173297 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies
[0m23:52:52.174088 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m23:52:52.362790 [debug] [Thread-4 (]: Began executing node model.mongo_movies.stg_movies_genres
[0m23:52:52.385239 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m23:52:52.384282 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies"
[0m23:52:52.386441 [debug] [Thread-3 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m23:52:52.390846 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_genres"
[0m23:52:52.393952 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:52:52.395624 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:52:52.396240 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m23:52:52.396779 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:52:52.397433 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:52:52.398160 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: BEGIN
[0m23:52:52.398786 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:52:52.399404 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: BEGIN
[0m23:52:52.400110 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m23:52:52.400749 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m23:52:52.401689 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:52:52.402369 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m23:52:52.418204 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m23:52:52.419373 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:52:52.420381 [debug] [Thread-4 (]: SQL status: BEGIN in 0.020 seconds
[0m23:52:52.421134 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m23:52:52.422655 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:52:52.423490 [debug] [Thread-3 (]: SQL status: BEGIN in 0.021 seconds
[0m23:52:52.424215 [debug] [Thread-2 (]: SQL status: BEGIN in 0.022 seconds
[0m23:52:52.425336 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */

  create view "test_db"."public_staging"."stg_movies_genres__dbt_tmp"
    
    
  as (
    SELECT value AS genre, _dlt_parent_id AS movie_id 
FROM "test_db"."mongo_data"."movies__genres"
  );
[0m23:52:52.426406 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:52:52.427500 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:52:52.428704 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM "test_db"."mongo_data"."movies__directors"
  );
[0m23:52:52.429704 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */

  create view "test_db"."public_staging"."stg_movies__dbt_tmp"
    
    
  as (
    SELECT * FROM "test_db"."mongo_data"."movies"
  );
[0m23:52:52.430500 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m23:52:52.431319 [debug] [Thread-4 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m23:52:52.441497 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:52:52.447647 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:52:52.443557 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.011 seconds
[0m23:52:52.442404 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m23:52:52.448679 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m23:52:52.449379 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */
alter table "test_db"."public_staging"."stg_movies_genres" rename to "stg_movies_genres__dbt_backup"
[0m23:52:52.452997 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:52:52.456604 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:52:52.457824 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m23:52:52.458962 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:52:52.459567 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:52:52.460239 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */
alter table "test_db"."public_staging"."stg_movies" rename to "stg_movies__dbt_backup"
[0m23:52:52.469153 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:52:52.470087 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.009 seconds
[0m23:52:52.475404 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:52:52.477099 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */
alter table "test_db"."public_staging"."stg_movies_genres__dbt_tmp" rename to "stg_movies_genres"
[0m23:52:52.477841 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:52:52.483532 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:52:52.485105 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m23:52:52.491530 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.006 seconds
[0m23:52:52.492252 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:52:52.493077 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m23:52:52.499640 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.006 seconds
[0m23:52:52.511111 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */
alter table "test_db"."public_staging"."stg_movies__dbt_tmp" rename to "stg_movies"
[0m23:52:52.522954 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: COMMIT
[0m23:52:52.527060 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:52:52.528398 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m23:52:52.529434 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:52:52.530344 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:52:52.531134 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:52:52.533613 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:52:52.534415 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: COMMIT
[0m23:52:52.536773 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: COMMIT
[0m23:52:52.537618 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:52:52.538397 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:52:52.539469 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:52:52.540558 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:52:52.541474 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: COMMIT
[0m23:52:52.545238 [debug] [Thread-4 (]: SQL status: COMMIT in 0.006 seconds
[0m23:52:52.552750 [debug] [Thread-2 (]: SQL status: COMMIT in 0.010 seconds
[0m23:52:52.553714 [debug] [Thread-3 (]: SQL status: COMMIT in 0.012 seconds
[0m23:52:52.554372 [debug] [Thread-1 (]: SQL status: COMMIT in 0.014 seconds
[0m23:52:52.565586 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies__dbt_backup"
[0m23:52:52.566257 [debug] [Thread-4 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_genres__dbt_backup"
[0m23:52:52.570013 [debug] [Thread-3 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m23:52:52.573959 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m23:52:52.584203 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:52:52.585765 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:52:52.587234 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:52:52.588587 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:52:52.589394 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */
drop view if exists "test_db"."public_staging"."stg_movies__dbt_backup" cascade
[0m23:52:52.590341 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */
drop view if exists "test_db"."public_staging"."stg_movies_genres__dbt_backup" cascade
[0m23:52:52.591342 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m23:52:52.592332 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m23:52:52.599023 [debug] [Thread-4 (]: SQL status: DROP VIEW in 0.005 seconds
[0m23:52:52.603864 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: Close
[0m23:52:52.605247 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.012 seconds
[0m23:52:52.605924 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.013 seconds
[0m23:52:52.606636 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.013 seconds
[0m23:52:52.609560 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: Close
[0m23:52:52.614873 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: Close
[0m23:52:52.615545 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4ef4789-7d10-4b85-bea8-9ae560ca37cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7539db832840>]}
[0m23:52:52.617976 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m23:52:52.619336 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4ef4789-7d10-4b85-bea8-9ae560ca37cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7539d991c080>]}
[0m23:52:52.621507 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4ef4789-7d10-4b85-bea8-9ae560ca37cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7539dba079e0>]}
[0m23:52:52.620623 [info ] [Thread-4 (]: 4 of 8 OK created sql view model public_staging.stg_movies_genres .............. [[32mCREATE VIEW[0m in 0.47s]
[0m23:52:52.624086 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4ef4789-7d10-4b85-bea8-9ae560ca37cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7539d773cc20>]}
[0m23:52:52.623110 [info ] [Thread-3 (]: 3 of 8 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.48s]
[0m23:52:52.625727 [info ] [Thread-2 (]: 2 of 8 OK created sql view model public_staging.stg_movies ..................... [[32mCREATE VIEW[0m in 0.49s]
[0m23:52:52.626997 [debug] [Thread-4 (]: Finished running node model.mongo_movies.stg_movies_genres
[0m23:52:52.628316 [info ] [Thread-1 (]: 1 of 8 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.49s]
[0m23:52:52.629703 [debug] [Thread-3 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m23:52:52.631312 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies
[0m23:52:52.633102 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m23:52:52.634997 [debug] [Thread-4 (]: Began running node model.mongo_movies.movies_genres_directors
[0m23:52:52.636843 [info ] [Thread-4 (]: 5 of 8 START sql table model public_marts.movies_genres_directors .............. [RUN]
[0m23:52:52.638168 [debug] [Thread-2 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m23:52:52.639207 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_movies_genres, now model.mongo_movies.movies_genres_directors)
[0m23:52:52.639832 [debug] [Thread-1 (]: Began running node model.mongo_movies.count_comments_each_user
[0m23:52:52.641134 [info ] [Thread-2 (]: 6 of 8 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m23:52:52.642250 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.movies_genres_directors
[0m23:52:52.643447 [info ] [Thread-1 (]: 7 of 8 START sql table model public_marts.count_comments_each_user ............. [RUN]
[0m23:52:52.644653 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_movies, now model.mongo_movies.comments_by_user_incremental)
[0m23:52:52.650413 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.movies_genres_directors"
[0m23:52:52.651668 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_comments, now model.mongo_movies.count_comments_each_user)
[0m23:52:52.652654 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m23:52:52.653710 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.count_comments_each_user
[0m23:52:52.668349 [debug] [Thread-4 (]: Began executing node model.mongo_movies.movies_genres_directors
[0m23:52:52.685361 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m23:52:52.686225 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.count_comments_each_user"
[0m23:52:52.724861 [debug] [Thread-2 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m23:52:52.733733 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.movies_genres_directors"
[0m23:52:52.745358 [debug] [Thread-1 (]: Began executing node model.mongo_movies.count_comments_each_user
[0m23:52:52.761653 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.count_comments_each_user"
[0m23:52:52.796183 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:52:52.797189 [debug] [Thread-4 (]: On model.mongo_movies.movies_genres_directors: BEGIN
[0m23:52:52.798134 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m23:52:52.798954 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.count_comments_each_user"
[0m23:52:52.800169 [debug] [Thread-1 (]: On model.mongo_movies.count_comments_each_user: BEGIN
[0m23:52:52.806462 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:52:52.807665 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:52:52.808946 [debug] [Thread-2 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

    
  
    

  create temporary table "comments_by_user_incremental__dbt_tmp235252787254"
  
  
    as
  
  (
    



WITH max_existing AS (
  
      SELECT max(load_date AT TIME ZONE 'UTC') AS max_load_date
      FROM "test_db"."public_marts"."comments_by_user_incremental"
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE (c.load_date AT TIME ZONE 'UTC') > coalesce(m.max_load_date, '1900-01-01'::timestamp)
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

final AS (
  
    SELECT * FROM "test_db"."public_marts"."comments_by_user_incremental"
    UNION ALL
    SELECT * FROM new_agg
  
),

flat AS (
  
   SELECT
      name,
      email,
      total_comment_count,
      unnest(movie_ids) AS movie_id,
      load_date
    FROM (
        SELECT
            name,
            email,
            SUM(comment_count) OVER (PARTITION BY name, email) AS total_comment_count,
            movie_ids,
            load_date
        FROM final
    )
  
)


SELECT
  name,
  email,
  MAX(total_comment_count) as comment_count,
  array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
  max(load_date) AS load_date
FROM flat
GROUP BY name, email
ORDER BY comment_count DESC

  );
  
  
[0m23:52:52.809762 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:52:52.826046 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m23:52:52.827000 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.count_comments_each_user"
[0m23:52:52.827798 [debug] [Thread-1 (]: On model.mongo_movies.count_comments_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.count_comments_each_user"} */

  
    

  create  table "test_db"."public_marts"."count_comments_each_user__dbt_tmp"
  
  
    as
  
  (
    -- depends_on: "test_db"."public_staging"."stg_comments"

SELECT name, email, count(text) as total_comment_count, 
count(distinct movie_id) as total_movies_count
FROM "test_db"."public_staging"."stg_comments" 
GROUP BY name, email
ORDER BY email
  );
  
[0m23:52:52.830766 [debug] [Thread-4 (]: SQL status: BEGIN in 0.033 seconds
[0m23:52:52.834265 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:52:52.837186 [debug] [Thread-4 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */

  
    

  create  table "test_db"."public_marts"."movies_genres_directors__dbt_tmp"
  
  
    as
  
  (
    SELECT m.title, m._id AS movie_id, g.genre, d.director FROM "test_db"."public_staging"."stg_movies" m 
JOIN "test_db"."public_staging"."stg_movies_genres" g ON m._dlt_id = g.movie_id
JOIN "test_db"."public_staging"."stg_movies_directors" d ON m._dlt_id = d.movie_id
  );
  
[0m23:52:52.948909 [debug] [Thread-2 (]: SQL status: SELECT 236 in 0.139 seconds
[0m23:52:52.982578 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:52:52.983673 [debug] [Thread-2 (]: On model.mongo_movies.comments_by_user_incremental: BEGIN
[0m23:52:52.985287 [debug] [Thread-2 (]: SQL status: BEGIN in 0.001 seconds
[0m23:52:52.985907 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:52:52.986545 [debug] [Thread-2 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental__dbt_tmp235252787254'
        
      order by ordinal_position

  
[0m23:52:52.996113 [debug] [Thread-2 (]: SQL status: SELECT 5 in 0.009 seconds
[0m23:52:53.005234 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:52:53.006088 [debug] [Thread-2 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m23:52:53.006951 [debug] [Thread-1 (]: SQL status: SELECT 236 in 0.178 seconds
[0m23:52:53.016911 [debug] [Thread-2 (]: SQL status: SELECT 5 in 0.009 seconds
[0m23:52:53.019408 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.count_comments_each_user"
[0m23:52:53.031341 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:52:53.032650 [debug] [Thread-1 (]: On model.mongo_movies.count_comments_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.count_comments_each_user"} */
alter table "test_db"."public_marts"."count_comments_each_user__dbt_tmp" rename to "count_comments_each_user"
[0m23:52:53.033547 [debug] [Thread-2 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m23:52:53.035570 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:52:53.037880 [debug] [Thread-1 (]: On model.mongo_movies.count_comments_each_user: COMMIT
[0m23:52:53.038728 [debug] [Thread-2 (]: SQL status: SELECT 5 in 0.004 seconds
[0m23:52:53.039419 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.count_comments_each_user"
[0m23:52:53.056575 [debug] [Thread-1 (]: On model.mongo_movies.count_comments_each_user: COMMIT
[0m23:52:53.070634 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user_incremental"
[0m23:52:53.071815 [debug] [Thread-4 (]: SQL status: SELECT 49379 in 0.234 seconds
[0m23:52:53.077050 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:52:53.077860 [debug] [Thread-1 (]: SQL status: COMMIT in 0.010 seconds
[0m23:52:53.078549 [debug] [Thread-4 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */
alter table "test_db"."public_marts"."movies_genres_directors" rename to "movies_genres_directors__dbt_backup"
[0m23:52:53.079365 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:52:53.084546 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_marts"."count_comments_each_user__dbt_backup"
[0m23:52:53.086244 [debug] [Thread-2 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      
        delete from "test_db"."public_marts"."comments_by_user_incremental" as DBT_INTERNAL_DEST
        where (name, email) in (
            select distinct name, email
            from "comments_by_user_incremental__dbt_tmp235252787254" as DBT_INTERNAL_SOURCE
        );

    

    insert into "test_db"."public_marts"."comments_by_user_incremental" ("name", "email", "comment_count", "movie_ids", "load_date")
    (
        select "name", "email", "comment_count", "movie_ids", "load_date"
        from "comments_by_user_incremental__dbt_tmp235252787254"
    )
  
[0m23:52:53.087262 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:52:53.094019 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.count_comments_each_user"
[0m23:52:53.100659 [debug] [Thread-2 (]: SQL status: INSERT 0 236 in 0.006 seconds
[0m23:52:53.099860 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:52:53.101804 [debug] [Thread-1 (]: On model.mongo_movies.count_comments_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.count_comments_each_user"} */
drop table if exists "test_db"."public_marts"."count_comments_each_user__dbt_backup" cascade
[0m23:52:53.104241 [debug] [Thread-2 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m23:52:53.105074 [debug] [Thread-4 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */
alter table "test_db"."public_marts"."movies_genres_directors__dbt_tmp" rename to "movies_genres_directors"
[0m23:52:53.106141 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:52:53.107271 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.001 seconds
[0m23:52:53.108278 [debug] [Thread-2 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m23:52:53.108974 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:52:53.111124 [debug] [Thread-1 (]: On model.mongo_movies.count_comments_each_user: Close
[0m23:52:53.115082 [debug] [Thread-4 (]: On model.mongo_movies.movies_genres_directors: COMMIT
[0m23:52:53.116568 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:52:53.117864 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4ef4789-7d10-4b85-bea8-9ae560ca37cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75398f7ee4b0>]}
[0m23:52:53.118474 [debug] [Thread-4 (]: On model.mongo_movies.movies_genres_directors: COMMIT
[0m23:52:53.119208 [debug] [Thread-2 (]: SQL status: COMMIT in 0.007 seconds
[0m23:52:53.120682 [info ] [Thread-1 (]: 7 of 8 OK created sql table model public_marts.count_comments_each_user ........ [[32mSELECT 236[0m in 0.47s]
[0m23:52:53.122674 [debug] [Thread-2 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m23:52:53.123702 [debug] [Thread-1 (]: Finished running node model.mongo_movies.count_comments_each_user
[0m23:52:53.124596 [debug] [Thread-4 (]: SQL status: COMMIT in 0.003 seconds
[0m23:52:53.125930 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4ef4789-7d10-4b85-bea8-9ae560ca37cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7539da35d490>]}
[0m23:52:53.130493 [debug] [Thread-4 (]: Applying DROP to: "test_db"."public_marts"."movies_genres_directors__dbt_backup"
[0m23:52:53.132040 [info ] [Thread-2 (]: 6 of 8 OK created sql incremental model public_marts.comments_by_user_incremental  [[32mINSERT 0 236[0m in 0.48s]
[0m23:52:53.133786 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:52:53.135228 [debug] [Thread-2 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m23:52:53.136512 [debug] [Thread-4 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */
drop table if exists "test_db"."public_marts"."movies_genres_directors__dbt_backup" cascade
[0m23:52:53.145936 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.008 seconds
[0m23:52:53.148710 [debug] [Thread-4 (]: On model.mongo_movies.movies_genres_directors: Close
[0m23:52:53.149980 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4ef4789-7d10-4b85-bea8-9ae560ca37cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75398f7ed040>]}
[0m23:52:53.151382 [info ] [Thread-4 (]: 5 of 8 OK created sql table model public_marts.movies_genres_directors ......... [[32mSELECT 49379[0m in 0.51s]
[0m23:52:53.153125 [debug] [Thread-4 (]: Finished running node model.mongo_movies.movies_genres_directors
[0m23:52:53.155556 [debug] [Thread-3 (]: Began running node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:52:53.156747 [info ] [Thread-3 (]: 8 of 8 START sql table model public_marts.genres_and_directors_with_good_comment_each_user  [RUN]
[0m23:52:53.157768 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_movies_directors, now model.mongo_movies.genres_and_directors_with_good_comment_each_user)
[0m23:52:53.158785 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:52:53.163909 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:52:53.165754 [debug] [Thread-3 (]: Began executing node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:52:53.173978 [debug] [Thread-3 (]: Writing runtime sql for node "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:52:53.175845 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:52:53.176963 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: BEGIN
[0m23:52:53.178017 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m23:52:53.193767 [debug] [Thread-3 (]: SQL status: BEGIN in 0.016 seconds
[0m23:52:53.194676 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:52:53.195380 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */

  
    

  create  table "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_tmp"
  
  
    as
  
  (
    SELECT 
    c.email,
    COALESCE(array_agg(DISTINCT gd.director) FILTER (
      WHERE c.text ~* '\mgood\M' AND c.text !~* 'not\s+good'
    ), '{}') AS fav_directors,

    COALESCE(array_agg(DISTINCT gd.genre) FILTER (
      WHERE c.text ~* '\mgood\M' AND c.text !~* 'not\s+good'
    ), '{}') AS fav_genres,

    COALESCE(array_agg(DISTINCT gd.title) FILTER (
      WHERE c.text ~* '\mgood\M' AND c.text !~* 'not\s+good'
    ), '{}') AS fav_movies
FROM "test_db"."public_staging"."stg_comments" c
JOIN "test_db"."public_marts"."movies_genres_directors" gd ON c.movie_id = gd.movie_id
GROUP BY c.email
  );
  
[0m23:52:54.510677 [debug] [Thread-3 (]: SQL status: SELECT 236 in 1.269 seconds
[0m23:52:54.517427 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:52:54.518210 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */
alter table "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user" rename to "genres_and_directors_with_good_comment_each_user__dbt_backup"
[0m23:52:54.519773 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:52:54.524481 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:52:54.525298 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */
alter table "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_tmp" rename to "genres_and_directors_with_good_comment_each_user"
[0m23:52:54.526610 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:52:54.529101 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: COMMIT
[0m23:52:54.529881 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:52:54.530724 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: COMMIT
[0m23:52:54.535833 [debug] [Thread-3 (]: SQL status: COMMIT in 0.004 seconds
[0m23:52:54.540199 [debug] [Thread-3 (]: Applying DROP to: "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_backup"
[0m23:52:54.541761 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:52:54.542719 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */
drop table if exists "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_backup" cascade
[0m23:52:54.548873 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.005 seconds
[0m23:52:54.551575 [debug] [Thread-3 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: Close
[0m23:52:54.553117 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4ef4789-7d10-4b85-bea8-9ae560ca37cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75398f722a80>]}
[0m23:52:54.554355 [info ] [Thread-3 (]: 8 of 8 OK created sql table model public_marts.genres_and_directors_with_good_comment_each_user  [[32mSELECT 236[0m in 1.40s]
[0m23:52:54.555808 [debug] [Thread-3 (]: Finished running node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:52:54.561320 [debug] [MainThread]: Using postgres connection "master"
[0m23:52:54.562230 [debug] [MainThread]: On master: BEGIN
[0m23:52:54.562860 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:52:54.582772 [debug] [MainThread]: SQL status: BEGIN in 0.020 seconds
[0m23:52:54.583576 [debug] [MainThread]: On master: COMMIT
[0m23:52:54.584157 [debug] [MainThread]: Using postgres connection "master"
[0m23:52:54.584701 [debug] [MainThread]: On master: COMMIT
[0m23:52:54.585766 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:52:54.586255 [debug] [MainThread]: On master: Close
[0m23:52:54.587121 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:52:54.587630 [debug] [MainThread]: Connection 'model.mongo_movies.count_comments_each_user' was properly closed.
[0m23:52:54.588148 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m23:52:54.588617 [debug] [MainThread]: Connection 'model.mongo_movies.genres_and_directors_with_good_comment_each_user' was properly closed.
[0m23:52:54.589337 [debug] [MainThread]: Connection 'model.mongo_movies.movies_genres_directors' was properly closed.
[0m23:52:54.590075 [info ] [MainThread]: 
[0m23:52:54.590871 [info ] [MainThread]: Finished running 1 incremental model, 3 table models, 4 view models in 0 hours 0 minutes and 2.71 seconds (2.71s).
[0m23:52:54.594351 [debug] [MainThread]: Command end result
[0m23:52:54.635524 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:52:54.638482 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:52:54.647353 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m23:52:54.648198 [info ] [MainThread]: 
[0m23:52:54.649095 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:52:54.649914 [info ] [MainThread]: 
[0m23:52:54.650722 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=8
[0m23:52:54.652791 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.3837605, "process_in_blocks": "0", "process_kernel_time": 0.843109, "process_mem_max_rss": "133476", "process_out_blocks": "2960", "process_user_time": 4.849888}
[0m23:52:54.653906 [debug] [MainThread]: Command `dbt run` succeeded at 23:52:54.653672 after 4.39 seconds
[0m23:52:54.654737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7539d96862d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7539d9e40830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7539d9e41850>]}
[0m23:52:54.655479 [debug] [MainThread]: Flushing usage events
[0m23:52:56.119812 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:56:15.333793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c0fb83ae000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c0fb7cc9f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c0fb8afb200>]}


============================== 23:56:28.939434 | 4b849243-8c6f-45df-a2e0-e505bc1ac922 ==============================
[0m23:56:28.939434 [info ] [MainThread]: Running with dbt=1.10.6
[0m23:56:28.940579 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'invocation_command': 'dbt clean', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:56:15.628807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4b849243-8c6f-45df-a2e0-e505bc1ac922', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c0fb7d57080>]}
[0m23:56:15.667866 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.4114127, "process_in_blocks": "528", "process_kernel_time": 0.578897, "process_mem_max_rss": "104780", "process_out_blocks": "8", "process_user_time": 2.491255}
[0m23:56:15.668752 [debug] [MainThread]: Command `dbt clean` succeeded at 23:56:15.668568 after 0.41 seconds
[0m23:56:15.669499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c0fb83ae000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c0fb7c41010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c0fba771280>]}
[0m23:56:15.670341 [debug] [MainThread]: Flushing usage events
[0m23:56:16.944790 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:56:41.221215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b7f220f3320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b7f220f3650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b7f220f32c0>]}


============================== 23:56:41.225901 | 1f1c9f6e-26a4-4166-9a05-3e9e4f999dd0 ==============================
[0m23:56:41.225901 [info ] [MainThread]: Running with dbt=1.10.6
[0m23:56:41.226750 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'debug': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:56:41.518750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1f1c9f6e-26a4-4166-9a05-3e9e4f999dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b7f221962d0>]}
[0m23:56:41.657102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1f1c9f6e-26a4-4166-9a05-3e9e4f999dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b7f227c9400>]}
[0m23:56:41.658380 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:56:41.824271 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m23:56:41.825285 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m23:56:41.825855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '1f1c9f6e-26a4-4166-9a05-3e9e4f999dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b7f21162f90>]}
[0m23:56:43.543033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1f1c9f6e-26a4-4166-9a05-3e9e4f999dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b7f2019f8c0>]}
[0m23:56:43.642656 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:56:43.645159 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:56:43.665221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1f1c9f6e-26a4-4166-9a05-3e9e4f999dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b7f1f9127e0>]}
[0m23:56:43.665942 [info ] [MainThread]: Found 8 models, 6 sources, 434 macros
[0m23:56:43.666565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f1c9f6e-26a4-4166-9a05-3e9e4f999dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b7f1fd31ee0>]}
[0m23:56:43.669188 [info ] [MainThread]: 
[0m23:56:43.669896 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:56:43.670494 [info ] [MainThread]: 
[0m23:56:43.671599 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:56:43.679494 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:56:43.680968 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m23:56:43.749219 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:56:43.749927 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m23:56:43.750926 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:56:43.751636 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m23:56:43.752391 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:56:43.753009 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:56:43.772663 [debug] [ThreadPool]: SQL status: SELECT 25 in 0.020 seconds
[0m23:56:43.773683 [debug] [ThreadPool]: SQL status: SELECT 25 in 0.021 seconds
[0m23:56:43.775689 [debug] [ThreadPool]: On list_test_db: Close
[0m23:56:43.777598 [debug] [ThreadPool]: On list_test_db: Close
[0m23:56:43.781802 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m23:56:43.782905 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m23:56:43.790847 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:56:43.793436 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:56:43.794263 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m23:56:43.795512 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m23:56:43.796147 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:56:43.796809 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:56:43.811537 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m23:56:43.812518 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m23:56:43.813173 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m23:56:43.813814 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m23:56:43.814420 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m23:56:43.815285 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m23:56:43.820383 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.005 seconds
[0m23:56:43.821080 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.005 seconds
[0m23:56:43.823089 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m23:56:43.824885 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m23:56:43.826088 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m23:56:43.826703 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m23:56:43.837810 [debug] [MainThread]: Using postgres connection "master"
[0m23:56:43.838430 [debug] [MainThread]: On master: BEGIN
[0m23:56:43.839036 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:56:43.852572 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m23:56:43.853082 [debug] [MainThread]: Using postgres connection "master"
[0m23:56:43.853607 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:56:43.901177 [debug] [MainThread]: SQL status: SELECT 5 in 0.047 seconds
[0m23:56:43.903453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f1c9f6e-26a4-4166-9a05-3e9e4f999dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b7f240acfe0>]}
[0m23:56:43.904094 [debug] [MainThread]: On master: ROLLBACK
[0m23:56:43.905063 [debug] [MainThread]: Using postgres connection "master"
[0m23:56:43.905536 [debug] [MainThread]: On master: BEGIN
[0m23:56:43.906961 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:56:43.907462 [debug] [MainThread]: On master: COMMIT
[0m23:56:43.907933 [debug] [MainThread]: Using postgres connection "master"
[0m23:56:43.908385 [debug] [MainThread]: On master: COMMIT
[0m23:56:43.909216 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:56:43.909700 [debug] [MainThread]: On master: Close
[0m23:56:43.915442 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m23:56:43.916480 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies
[0m23:56:43.917250 [info ] [Thread-1 (]: 1 of 8 START sql view model public_staging.stg_comments ........................ [RUN]
[0m23:56:43.918424 [info ] [Thread-2 (]: 2 of 8 START sql view model public_staging.stg_movies .......................... [RUN]
[0m23:56:43.919421 [debug] [Thread-3 (]: Began running node model.mongo_movies.stg_movies_directors
[0m23:56:43.920120 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m23:56:43.920713 [debug] [Thread-4 (]: Began running node model.mongo_movies.stg_movies_genres
[0m23:56:43.921432 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_movies)
[0m23:56:43.922258 [info ] [Thread-3 (]: 3 of 8 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m23:56:43.923479 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m23:56:43.924362 [info ] [Thread-4 (]: 4 of 8 START sql view model public_staging.stg_movies_genres ................... [RUN]
[0m23:56:43.925325 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies
[0m23:56:43.926312 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.stg_movies_directors'
[0m23:56:43.942972 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m23:56:43.944065 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.stg_movies_genres'
[0m23:56:43.948663 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies"
[0m23:56:43.949809 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m23:56:43.951330 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.stg_movies_genres
[0m23:56:43.955876 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m23:56:43.960465 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_genres"
[0m23:56:43.964850 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies
[0m23:56:43.965790 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m23:56:43.966486 [debug] [Thread-3 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m23:56:43.972542 [debug] [Thread-4 (]: Began executing node model.mongo_movies.stg_movies_genres
[0m23:56:44.066554 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies"
[0m23:56:44.068788 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m23:56:44.073033 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_genres"
[0m23:56:44.074052 [debug] [Thread-3 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m23:56:44.079922 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:56:44.080827 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: BEGIN
[0m23:56:44.081644 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:56:44.086340 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:56:44.087675 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:56:44.088677 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m23:56:44.089794 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:56:44.090640 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: BEGIN
[0m23:56:44.091608 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m23:56:44.092561 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m23:56:44.093547 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m23:56:44.094765 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:56:44.101700 [debug] [Thread-2 (]: SQL status: BEGIN in 0.020 seconds
[0m23:56:44.102710 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:56:44.103520 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */

  create view "test_db"."public_staging"."stg_movies__dbt_tmp"
    
    
  as (
    SELECT * FROM "test_db"."mongo_data"."movies"
  );
[0m23:56:44.110054 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m23:56:44.120392 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:56:44.121499 [debug] [Thread-4 (]: SQL status: BEGIN in 0.028 seconds
[0m23:56:44.122503 [debug] [Thread-3 (]: SQL status: BEGIN in 0.031 seconds
[0m23:56:44.123405 [debug] [Thread-1 (]: SQL status: BEGIN in 0.029 seconds
[0m23:56:44.123982 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */
alter table "test_db"."public_staging"."stg_movies" rename to "stg_movies__dbt_backup"
[0m23:56:44.124614 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:56:44.125462 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:56:44.126221 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:56:44.127239 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */

  create view "test_db"."public_staging"."stg_movies_genres__dbt_tmp"
    
    
  as (
    SELECT value AS genre, _dlt_parent_id AS movie_id 
FROM "test_db"."mongo_data"."movies__genres"
  );
[0m23:56:44.128071 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:56:44.128675 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM "test_db"."mongo_data"."movies__directors"
  );
[0m23:56:44.129328 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m23:56:44.134321 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:56:44.135346 [debug] [Thread-4 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m23:56:44.136394 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */
alter table "test_db"."public_staging"."stg_movies__dbt_tmp" rename to "stg_movies"
[0m23:56:44.141409 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:56:44.142165 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m23:56:44.142875 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m23:56:44.143763 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */
alter table "test_db"."public_staging"."stg_movies_genres" rename to "stg_movies_genres__dbt_backup"
[0m23:56:44.144363 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:56:44.148604 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:56:44.153106 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:56:44.170955 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.017 seconds
[0m23:56:44.180003 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: COMMIT
[0m23:56:44.181242 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m23:56:44.182167 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m23:56:44.186776 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:56:44.187544 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:56:44.188695 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */
alter table "test_db"."public_staging"."stg_movies_genres__dbt_tmp" rename to "stg_movies_genres"
[0m23:56:44.189666 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:56:44.190859 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:56:44.191783 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: COMMIT
[0m23:56:44.197157 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:56:44.197826 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m23:56:44.201086 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:56:44.202105 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m23:56:44.204427 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: COMMIT
[0m23:56:44.205142 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m23:56:44.206088 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:56:44.207324 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:56:44.208201 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: COMMIT
[0m23:56:44.208791 [debug] [Thread-2 (]: SQL status: COMMIT in 0.007 seconds
[0m23:56:44.209378 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:56:44.211501 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:56:44.218777 [debug] [Thread-4 (]: SQL status: COMMIT in 0.006 seconds
[0m23:56:44.221606 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies__dbt_backup"
[0m23:56:44.223884 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:56:44.224765 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:56:44.228004 [debug] [Thread-4 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_genres__dbt_backup"
[0m23:56:44.237504 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m23:56:44.238642 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:56:44.239632 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m23:56:44.241152 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m23:56:44.241979 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */
drop view if exists "test_db"."public_staging"."stg_movies__dbt_backup" cascade
[0m23:56:44.242835 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m23:56:44.243799 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */
drop view if exists "test_db"."public_staging"."stg_movies_genres__dbt_backup" cascade
[0m23:56:44.269872 [debug] [Thread-3 (]: SQL status: COMMIT in 0.026 seconds
[0m23:56:44.273977 [debug] [Thread-3 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m23:56:44.275488 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m23:56:44.276118 [debug] [Thread-1 (]: SQL status: COMMIT in 0.031 seconds
[0m23:56:44.276710 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.032 seconds
[0m23:56:44.277323 [debug] [Thread-4 (]: SQL status: DROP VIEW in 0.033 seconds
[0m23:56:44.277998 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m23:56:44.281286 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m23:56:44.285026 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: Close
[0m23:56:44.287525 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: Close
[0m23:56:44.288774 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m23:56:44.292978 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m23:56:44.294135 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.006 seconds
[0m23:56:44.294946 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f1c9f6e-26a4-4166-9a05-3e9e4f999dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b7f23fda780>]}
[0m23:56:44.295603 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f1c9f6e-26a4-4166-9a05-3e9e4f999dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b7f21162420>]}
[0m23:56:44.298135 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: Close
[0m23:56:44.299534 [info ] [Thread-2 (]: 2 of 8 OK created sql view model public_staging.stg_movies ..................... [[32mCREATE VIEW[0m in 0.37s]
[0m23:56:44.300768 [info ] [Thread-4 (]: 4 of 8 OK created sql view model public_staging.stg_movies_genres .............. [[32mCREATE VIEW[0m in 0.35s]
[0m23:56:44.301475 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m23:56:44.302739 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies
[0m23:56:44.303617 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f1c9f6e-26a4-4166-9a05-3e9e4f999dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b7ed7f97e30>]}
[0m23:56:44.304366 [debug] [Thread-4 (]: Finished running node model.mongo_movies.stg_movies_genres
[0m23:56:44.306251 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m23:56:44.307742 [info ] [Thread-3 (]: 3 of 8 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.38s]
[0m23:56:44.309666 [debug] [Thread-3 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m23:56:44.310343 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f1c9f6e-26a4-4166-9a05-3e9e4f999dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b7ed7fbcaa0>]}
[0m23:56:44.312636 [debug] [Thread-2 (]: Began running node model.mongo_movies.movies_genres_directors
[0m23:56:44.312043 [info ] [Thread-1 (]: 1 of 8 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.39s]
[0m23:56:44.313625 [info ] [Thread-2 (]: 5 of 8 START sql table model public_marts.movies_genres_directors .............. [RUN]
[0m23:56:44.314866 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m23:56:44.315744 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_movies, now model.mongo_movies.movies_genres_directors)
[0m23:56:44.317032 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.movies_genres_directors
[0m23:56:44.321621 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.movies_genres_directors"
[0m23:56:44.322788 [debug] [Thread-3 (]: Began running node model.mongo_movies.comments_by_user
[0m23:56:44.323397 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m23:56:44.324619 [info ] [Thread-3 (]: 6 of 8 START sql table model public_marts.comments_by_user ..................... [RUN]
[0m23:56:44.325684 [info ] [Thread-4 (]: 7 of 8 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m23:56:44.327426 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_movies_directors, now model.mongo_movies.comments_by_user)
[0m23:56:44.328442 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_movies_genres, now model.mongo_movies.comments_by_user_incremental)
[0m23:56:44.329322 [debug] [Thread-2 (]: Began executing node model.mongo_movies.movies_genres_directors
[0m23:56:44.329942 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.comments_by_user
[0m23:56:44.330700 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m23:56:44.358618 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user"
[0m23:56:44.380137 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.movies_genres_directors"
[0m23:56:44.388232 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m23:56:44.389693 [debug] [Thread-3 (]: Began executing node model.mongo_movies.comments_by_user
[0m23:56:44.395990 [debug] [Thread-3 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user"
[0m23:56:44.397079 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m23:56:44.397860 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:56:44.409607 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m23:56:44.420066 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: BEGIN
[0m23:56:44.436117 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: BEGIN
[0m23:56:44.443565 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:56:44.444451 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m23:56:44.445807 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m23:56:44.446629 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

    
  
    

  create temporary table "comments_by_user_incremental__dbt_tmp235644434635"
  
  
    as
  
  (
    



WITH max_existing AS (
  
      SELECT max(load_date AT TIME ZONE 'UTC') AS max_load_date
      FROM "test_db"."public_marts"."comments_by_user_incremental"
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE (c.load_date AT TIME ZONE 'UTC') > coalesce(m.max_load_date, '1900-01-01'::timestamp)
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

final AS (
  
    SELECT * FROM "test_db"."public_marts"."comments_by_user_incremental"
    UNION ALL
    SELECT * FROM new_agg
  
),

flat AS (
  
   SELECT
      name,
      email,
      total_comment_count,
      unnest(movie_ids) AS movie_id,
      load_date
    FROM (
        SELECT
            name,
            email,
            SUM(comment_count) OVER (PARTITION BY name, email) AS total_comment_count,
            movie_ids,
            load_date
        FROM final
    )
  
)


SELECT
  name,
  email,
  MAX(total_comment_count) as comment_count,
  array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
  max(load_date) AS load_date
FROM flat
GROUP BY name, email
ORDER BY comment_count DESC

  );
  
  
[0m23:56:44.448045 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m23:56:44.460706 [debug] [Thread-2 (]: SQL status: BEGIN in 0.016 seconds
[0m23:56:44.461629 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:56:44.462386 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */

  
    

  create  table "test_db"."public_marts"."movies_genres_directors__dbt_tmp"
  
  
    as
  
  (
    SELECT m.title, m._id AS movie_id, g.genre, d.director FROM "test_db"."public_staging"."stg_movies" m 
JOIN "test_db"."public_staging"."stg_movies_genres" g ON m._dlt_id = g.movie_id
JOIN "test_db"."public_staging"."stg_movies_directors" d ON m._dlt_id = d.movie_id
  );
  
[0m23:56:44.463693 [debug] [Thread-3 (]: SQL status: BEGIN in 0.018 seconds
[0m23:56:44.464476 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m23:56:44.465240 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */

  
    

  create  table "test_db"."public_marts"."comments_by_user__dbt_tmp"
  
  
    as
  
  (
    -- depends_on: "test_db"."public_staging"."stg_comments"

SELECT name, email, count(text) as total_comment_count, 
count(distinct movie_id) as total_movies_count
FROM "test_db"."public_staging"."stg_comments" 
GROUP BY name, email
ORDER BY email
  );
  
[0m23:56:44.540236 [debug] [Thread-4 (]: SQL status: SELECT 236 in 0.092 seconds
[0m23:56:44.564127 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:56:44.565093 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: BEGIN
[0m23:56:44.566275 [debug] [Thread-4 (]: SQL status: BEGIN in 0.000 seconds
[0m23:56:44.567002 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:56:44.567775 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental__dbt_tmp235644434635'
        
      order by ordinal_position

  
[0m23:56:44.580608 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.012 seconds
[0m23:56:44.589076 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:56:44.589765 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m23:56:44.593766 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.003 seconds
[0m23:56:44.611421 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:56:44.612509 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m23:56:44.616321 [debug] [Thread-4 (]: SQL status: SELECT 5 in 0.003 seconds
[0m23:56:44.634241 [debug] [Thread-3 (]: SQL status: SELECT 236 in 0.168 seconds
[0m23:56:44.640983 [debug] [Thread-2 (]: SQL status: SELECT 49379 in 0.177 seconds
[0m23:56:44.642275 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user_incremental"
[0m23:56:44.650790 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m23:56:44.654951 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:56:44.656400 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */
alter table "test_db"."public_marts"."comments_by_user__dbt_tmp" rename to "comments_by_user"
[0m23:56:44.657408 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:56:44.657984 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */
alter table "test_db"."public_marts"."movies_genres_directors" rename to "movies_genres_directors__dbt_backup"
[0m23:56:44.659078 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      
        delete from "test_db"."public_marts"."comments_by_user_incremental" as DBT_INTERNAL_DEST
        where (name, email) in (
            select distinct name, email
            from "comments_by_user_incremental__dbt_tmp235644434635" as DBT_INTERNAL_SOURCE
        );

    

    insert into "test_db"."public_marts"."comments_by_user_incremental" ("name", "email", "comment_count", "movie_ids", "load_date")
    (
        select "name", "email", "comment_count", "movie_ids", "load_date"
        from "comments_by_user_incremental__dbt_tmp235644434635"
    )
  
[0m23:56:44.659750 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:56:44.661874 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: COMMIT
[0m23:56:44.662574 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:56:44.663540 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m23:56:44.670099 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:56:44.671147 [debug] [Thread-4 (]: SQL status: INSERT 0 236 in 0.011 seconds
[0m23:56:44.671726 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: COMMIT
[0m23:56:44.672377 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */
alter table "test_db"."public_marts"."movies_genres_directors__dbt_tmp" rename to "movies_genres_directors"
[0m23:56:44.674219 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m23:56:44.675916 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m23:56:44.676679 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:56:44.677234 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m23:56:44.679426 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: COMMIT
[0m23:56:44.680292 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:56:44.680833 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: COMMIT
[0m23:56:44.691903 [debug] [Thread-3 (]: SQL status: COMMIT in 0.017 seconds
[0m23:56:44.695562 [debug] [Thread-3 (]: Applying DROP to: "test_db"."public_marts"."comments_by_user__dbt_backup"
[0m23:56:44.696676 [debug] [Thread-2 (]: SQL status: COMMIT in 0.015 seconds
[0m23:56:44.697544 [debug] [Thread-4 (]: SQL status: COMMIT in 0.017 seconds
[0m23:56:44.703663 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m23:56:44.707088 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_marts"."movies_genres_directors__dbt_backup"
[0m23:56:44.709549 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m23:56:44.710355 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */
drop table if exists "test_db"."public_marts"."comments_by_user__dbt_backup" cascade
[0m23:56:44.711570 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m23:56:44.712739 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f1c9f6e-26a4-4166-9a05-3e9e4f999dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b7ed7eb38c0>]}
[0m23:56:44.713411 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.001 seconds
[0m23:56:44.713994 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */
drop table if exists "test_db"."public_marts"."movies_genres_directors__dbt_backup" cascade
[0m23:56:44.715101 [info ] [Thread-4 (]: 7 of 8 OK created sql incremental model public_marts.comments_by_user_incremental  [[32mINSERT 0 236[0m in 0.38s]
[0m23:56:44.717151 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user: Close
[0m23:56:44.718448 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m23:56:44.720169 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f1c9f6e-26a4-4166-9a05-3e9e4f999dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b7ed557ff80>]}
[0m23:56:44.721251 [info ] [Thread-3 (]: 6 of 8 OK created sql table model public_marts.comments_by_user ................ [[32mSELECT 236[0m in 0.39s]
[0m23:56:44.722191 [debug] [Thread-3 (]: Finished running node model.mongo_movies.comments_by_user
[0m23:56:44.723995 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m23:56:44.726309 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: Close
[0m23:56:44.727407 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f1c9f6e-26a4-4166-9a05-3e9e4f999dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b7ed558dfa0>]}
[0m23:56:44.728263 [info ] [Thread-2 (]: 5 of 8 OK created sql table model public_marts.movies_genres_directors ......... [[32mSELECT 49379[0m in 0.41s]
[0m23:56:44.729103 [debug] [Thread-2 (]: Finished running node model.mongo_movies.movies_genres_directors
[0m23:56:44.730920 [debug] [Thread-1 (]: Began running node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:56:44.731914 [info ] [Thread-1 (]: 8 of 8 START sql table model public_marts.genres_and_directors_with_good_comment_each_user  [RUN]
[0m23:56:44.732726 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_comments, now model.mongo_movies.genres_and_directors_with_good_comment_each_user)
[0m23:56:44.733391 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:56:44.737395 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:56:44.738436 [debug] [Thread-1 (]: Began executing node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:56:44.743259 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:56:44.744215 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:56:44.744797 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: BEGIN
[0m23:56:44.745341 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:56:44.759971 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m23:56:44.760881 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:56:44.761531 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */

  
    

  create  table "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_tmp"
  
  
    as
  
  (
    SELECT 
    c.email,
    COALESCE(array_agg(DISTINCT gd.director) FILTER (
      WHERE c.text ~* '\mgood\M' AND c.text !~* 'not\s+good'
    ), '{}') AS fav_directors,

    COALESCE(array_agg(DISTINCT gd.genre) FILTER (
      WHERE c.text ~* '\mgood\M' AND c.text !~* 'not\s+good'
    ), '{}') AS fav_genres,

    COALESCE(array_agg(DISTINCT gd.title) FILTER (
      WHERE c.text ~* '\mgood\M' AND c.text !~* 'not\s+good'
    ), '{}') AS fav_movies
FROM "test_db"."public_staging"."stg_comments" c
JOIN "test_db"."public_marts"."movies_genres_directors" gd ON c.movie_id = gd.movie_id
GROUP BY c.email
  );
  
[0m23:56:45.821416 [debug] [Thread-1 (]: SQL status: SELECT 236 in 1.069 seconds
[0m23:56:45.825941 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:56:45.826509 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */
alter table "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user" rename to "genres_and_directors_with_good_comment_each_user__dbt_backup"
[0m23:56:45.828167 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:56:45.832405 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:56:45.833125 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */
alter table "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_tmp" rename to "genres_and_directors_with_good_comment_each_user"
[0m23:56:45.834339 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:56:45.836672 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: COMMIT
[0m23:56:45.837284 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:56:45.837904 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: COMMIT
[0m23:56:45.844448 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m23:56:45.848134 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_backup"
[0m23:56:45.850063 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m23:56:45.850935 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */
drop table if exists "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_backup" cascade
[0m23:56:45.854319 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.003 seconds
[0m23:56:45.856142 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: Close
[0m23:56:45.857111 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f1c9f6e-26a4-4166-9a05-3e9e4f999dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b7ed7f7d3a0>]}
[0m23:56:45.858093 [info ] [Thread-1 (]: 8 of 8 OK created sql table model public_marts.genres_and_directors_with_good_comment_each_user  [[32mSELECT 236[0m in 1.12s]
[0m23:56:45.859129 [debug] [Thread-1 (]: Finished running node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m23:56:45.862431 [debug] [MainThread]: Using postgres connection "master"
[0m23:56:45.863043 [debug] [MainThread]: On master: BEGIN
[0m23:56:45.863534 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:56:45.884441 [debug] [MainThread]: SQL status: BEGIN in 0.021 seconds
[0m23:56:45.885553 [debug] [MainThread]: On master: COMMIT
[0m23:56:45.886344 [debug] [MainThread]: Using postgres connection "master"
[0m23:56:45.887063 [debug] [MainThread]: On master: COMMIT
[0m23:56:45.888170 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:56:45.889031 [debug] [MainThread]: On master: Close
[0m23:56:45.890181 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:56:45.890762 [debug] [MainThread]: Connection 'model.mongo_movies.movies_genres_directors' was properly closed.
[0m23:56:45.891434 [debug] [MainThread]: Connection 'model.mongo_movies.genres_and_directors_with_good_comment_each_user' was properly closed.
[0m23:56:45.892010 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user' was properly closed.
[0m23:56:45.893014 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m23:56:45.894518 [info ] [MainThread]: 
[0m23:56:45.896433 [info ] [MainThread]: Finished running 1 incremental model, 3 table models, 4 view models in 0 hours 0 minutes and 2.22 seconds (2.22s).
[0m23:56:45.901927 [debug] [MainThread]: Command end result
[0m23:56:45.937055 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m23:56:45.939499 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m23:56:45.947755 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m23:56:45.948389 [info ] [MainThread]: 
[0m23:56:45.949437 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:56:45.950182 [info ] [MainThread]: 
[0m23:56:45.950955 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=8
[0m23:56:45.952799 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.845887, "process_in_blocks": "0", "process_kernel_time": 0.77965, "process_mem_max_rss": "133532", "process_out_blocks": "2952", "process_user_time": 5.619141}
[0m23:56:45.953702 [debug] [MainThread]: Command `dbt run` succeeded at 23:56:45.953495 after 4.85 seconds
[0m23:56:45.954350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b7f25f473b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b7f1f964770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b7f220f3320>]}
[0m23:56:45.955156 [debug] [MainThread]: Flushing usage events
[0m23:56:47.502797 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:23:55.297866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77058ef5dbe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77058f459e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77058ef5d790>]}


============================== 22:23:55.307087 | 912abef7-2264-4d07-a191-48c9b9810439 ==============================
[0m22:23:55.307087 [info ] [MainThread]: Running with dbt=1.10.6
[0m22:23:55.308228 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m22:23:55.761718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '912abef7-2264-4d07-a191-48c9b9810439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77058eb7cb30>]}
[0m22:23:55.898960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '912abef7-2264-4d07-a191-48c9b9810439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77058ebd0b30>]}
[0m22:23:55.902052 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m22:23:56.069297 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m22:23:56.281719 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:23:56.282306 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:23:56.342186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '912abef7-2264-4d07-a191-48c9b9810439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77058e3535c0>]}
[0m22:23:56.460541 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m22:23:56.464099 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m22:23:56.517906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '912abef7-2264-4d07-a191-48c9b9810439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77058df65d90>]}
[0m22:23:56.518661 [info ] [MainThread]: Found 8 models, 6 sources, 434 macros
[0m22:23:56.519236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '912abef7-2264-4d07-a191-48c9b9810439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77058d712330>]}
[0m22:23:56.521704 [info ] [MainThread]: 
[0m22:23:56.522307 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:23:56.522917 [info ] [MainThread]: 
[0m22:23:56.523781 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:23:56.530872 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m22:23:56.539539 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db'
[0m22:23:56.647552 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m22:23:56.648518 [debug] [ThreadPool]: Using postgres connection "list_test_db"
[0m22:23:56.649245 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m22:23:56.649888 [debug] [ThreadPool]: On list_test_db: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db"} */

    select distinct nspname from pg_namespace
  
[0m22:23:56.650521 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:23:56.651209 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:23:56.683572 [debug] [ThreadPool]: SQL status: SELECT 25 in 0.033 seconds
[0m22:23:56.684717 [debug] [ThreadPool]: SQL status: SELECT 25 in 0.033 seconds
[0m22:23:56.686559 [debug] [ThreadPool]: On list_test_db: Close
[0m22:23:56.688317 [debug] [ThreadPool]: On list_test_db: Close
[0m22:23:56.691955 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_staging)
[0m22:23:56.699498 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_test_db, now list_test_db_public_marts)
[0m22:23:56.704103 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m22:23:56.707820 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m22:23:56.709040 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m22:23:56.709954 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m22:23:56.710573 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:23:56.711188 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:23:56.726653 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m22:23:56.727244 [debug] [ThreadPool]: SQL status: BEGIN in 0.017 seconds
[0m22:23:56.727910 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m22:23:56.728574 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m22:23:56.729248 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m22:23:56.729905 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m22:23:56.736122 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.005 seconds
[0m22:23:56.736835 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.006 seconds
[0m22:23:56.738635 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m22:23:56.740932 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m22:23:56.742414 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m22:23:56.742971 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m22:23:56.751347 [debug] [MainThread]: Using postgres connection "master"
[0m22:23:56.751896 [debug] [MainThread]: On master: BEGIN
[0m22:23:56.752406 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:23:56.768056 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m22:23:56.768736 [debug] [MainThread]: Using postgres connection "master"
[0m22:23:56.769249 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m22:23:56.820884 [debug] [MainThread]: SQL status: SELECT 5 in 0.051 seconds
[0m22:23:56.823884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '912abef7-2264-4d07-a191-48c9b9810439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77058e71e3f0>]}
[0m22:23:56.824646 [debug] [MainThread]: On master: ROLLBACK
[0m22:23:56.825543 [debug] [MainThread]: Using postgres connection "master"
[0m22:23:56.825999 [debug] [MainThread]: On master: BEGIN
[0m22:23:56.827005 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:23:56.827462 [debug] [MainThread]: On master: COMMIT
[0m22:23:56.827996 [debug] [MainThread]: Using postgres connection "master"
[0m22:23:56.828481 [debug] [MainThread]: On master: COMMIT
[0m22:23:56.829223 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:23:56.829712 [debug] [MainThread]: On master: Close
[0m22:23:56.837511 [debug] [Thread-1 (]: Began running node model.mongo_movies.stg_comments
[0m22:23:56.838186 [debug] [Thread-2 (]: Began running node model.mongo_movies.stg_movies
[0m22:23:56.838945 [debug] [Thread-3 (]: Began running node model.mongo_movies.stg_movies_directors
[0m22:23:56.839502 [debug] [Thread-4 (]: Began running node model.mongo_movies.stg_movies_genres
[0m22:23:56.840330 [info ] [Thread-1 (]: 1 of 8 START sql view model public_staging.stg_comments ........................ [RUN]
[0m22:23:56.841354 [info ] [Thread-2 (]: 2 of 8 START sql view model public_staging.stg_movies .......................... [RUN]
[0m22:23:56.842368 [info ] [Thread-3 (]: 3 of 8 START sql view model public_staging.stg_movies_directors ................ [RUN]
[0m22:23:56.843211 [info ] [Thread-4 (]: 4 of 8 START sql view model public_staging.stg_movies_genres ................... [RUN]
[0m22:23:56.844337 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now model.mongo_movies.stg_comments)
[0m22:23:56.845040 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now model.mongo_movies.stg_movies)
[0m22:23:56.845833 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.mongo_movies.stg_movies_directors'
[0m22:23:56.846835 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.mongo_movies.stg_movies_genres'
[0m22:23:56.847515 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.stg_comments
[0m22:23:56.848353 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.stg_movies
[0m22:23:56.849037 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.stg_movies_directors
[0m22:23:56.849771 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.stg_movies_genres
[0m22:23:56.865357 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.stg_comments"
[0m22:23:56.871000 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.stg_movies"
[0m22:23:56.875232 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_directors"
[0m22:23:56.880617 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.stg_movies_genres"
[0m22:23:56.883763 [debug] [Thread-2 (]: Began executing node model.mongo_movies.stg_movies
[0m22:23:56.884339 [debug] [Thread-1 (]: Began executing node model.mongo_movies.stg_comments
[0m22:23:56.885142 [debug] [Thread-3 (]: Began executing node model.mongo_movies.stg_movies_directors
[0m22:23:56.891457 [debug] [Thread-4 (]: Began executing node model.mongo_movies.stg_movies_genres
[0m22:23:56.979596 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.stg_comments"
[0m22:23:56.983206 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.stg_movies"
[0m22:23:56.986923 [debug] [Thread-3 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_directors"
[0m22:23:56.992241 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.stg_movies_genres"
[0m22:23:56.994300 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m22:23:56.994942 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m22:23:56.995703 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: BEGIN
[0m22:23:56.996457 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: BEGIN
[0m22:23:56.997123 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m22:23:56.997785 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:23:56.998485 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m22:23:56.999041 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:23:56.999690 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: BEGIN
[0m22:23:57.000617 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: BEGIN
[0m22:23:57.001576 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:23:57.002207 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:23:57.020971 [debug] [Thread-3 (]: SQL status: BEGIN in 0.023 seconds
[0m22:23:57.021866 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m22:23:57.022665 [debug] [Thread-2 (]: SQL status: BEGIN in 0.024 seconds
[0m22:23:57.023243 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */

  create view "test_db"."public_staging"."stg_movies_directors__dbt_tmp"
    
    
  as (
    SELECT value AS director, _dlt_parent_id AS movie_id 
FROM "test_db"."mongo_data"."movies__directors"
  );
[0m22:23:57.024133 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m22:23:57.025213 [debug] [Thread-4 (]: SQL status: BEGIN in 0.023 seconds
[0m22:23:57.026333 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */

  create view "test_db"."public_staging"."stg_movies__dbt_tmp"
    
    
  as (
    SELECT * FROM "test_db"."mongo_data"."movies"
  );
[0m22:23:57.027045 [debug] [Thread-1 (]: SQL status: BEGIN in 0.025 seconds
[0m22:23:57.027914 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m22:23:57.028581 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m22:23:57.029385 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m22:23:57.030077 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */

  create view "test_db"."public_staging"."stg_movies_genres__dbt_tmp"
    
    
  as (
    SELECT value AS genre, _dlt_parent_id AS movie_id 
FROM "test_db"."mongo_data"."movies__genres"
  );
[0m22:23:57.036212 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m22:23:57.039517 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m22:23:57.040366 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */

  create view "test_db"."public_staging"."stg_comments__dbt_tmp"
    
    
  as (
    select c.*, d.inserted_at as load_date from "test_db"."mongo_data"."comments" c
join "test_db"."mongo_data"."_dlt_loads" d
on c._dlt_load_id = d.load_id
  );
[0m22:23:57.045997 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m22:23:57.047048 [debug] [Thread-4 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m22:23:57.047866 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors" rename to "stg_movies_directors__dbt_backup"
[0m22:23:57.048827 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */
alter table "test_db"."public_staging"."stg_movies" rename to "stg_movies__dbt_backup"
[0m22:23:57.052517 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m22:23:57.053152 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m22:23:57.054662 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */
alter table "test_db"."public_staging"."stg_movies_genres" rename to "stg_movies_genres__dbt_backup"
[0m22:23:57.055260 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:23:57.055953 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:23:57.061174 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m22:23:57.065476 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m22:23:57.066370 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m22:23:57.070257 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m22:23:57.071213 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments" rename to "stg_comments__dbt_backup"
[0m22:23:57.072092 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
alter table "test_db"."public_staging"."stg_movies_directors__dbt_tmp" rename to "stg_movies_directors"
[0m22:23:57.075773 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m22:23:57.076660 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */
alter table "test_db"."public_staging"."stg_movies__dbt_tmp" rename to "stg_movies"
[0m22:23:57.077842 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */
alter table "test_db"."public_staging"."stg_movies_genres__dbt_tmp" rename to "stg_movies_genres"
[0m22:23:57.078901 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:23:57.079602 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:23:57.091366 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.011 seconds
[0m22:23:57.114984 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m22:23:57.115945 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.035 seconds
[0m22:23:57.120281 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m22:23:57.122901 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: COMMIT
[0m22:23:57.124129 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m22:23:57.126539 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: COMMIT
[0m22:23:57.127233 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
alter table "test_db"."public_staging"."stg_comments__dbt_tmp" rename to "stg_comments"
[0m22:23:57.128100 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m22:23:57.128878 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: COMMIT
[0m22:23:57.129544 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m22:23:57.130371 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: COMMIT
[0m22:23:57.130889 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:23:57.131824 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: COMMIT
[0m22:23:57.134224 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m22:23:57.135334 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m22:23:57.136497 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: COMMIT
[0m22:23:57.137258 [debug] [Thread-3 (]: SQL status: COMMIT in 0.006 seconds
[0m22:23:57.146437 [debug] [Thread-3 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_directors__dbt_backup"
[0m22:23:57.147421 [debug] [Thread-1 (]: SQL status: COMMIT in 0.010 seconds
[0m22:23:57.148467 [debug] [Thread-2 (]: SQL status: COMMIT in 0.014 seconds
[0m22:23:57.149096 [debug] [Thread-4 (]: SQL status: COMMIT in 0.017 seconds
[0m22:23:57.160138 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.stg_movies_directors"
[0m22:23:57.163576 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_staging"."stg_comments__dbt_backup"
[0m22:23:57.166520 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_staging"."stg_movies__dbt_backup"
[0m22:23:57.169814 [debug] [Thread-4 (]: Applying DROP to: "test_db"."public_staging"."stg_movies_genres__dbt_backup"
[0m22:23:57.170549 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_directors"} */
drop view if exists "test_db"."public_staging"."stg_movies_directors__dbt_backup" cascade
[0m22:23:57.171857 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.stg_comments"
[0m22:23:57.173031 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.stg_movies"
[0m22:23:57.174120 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.stg_movies_genres"
[0m22:23:57.174938 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_comments"} */
drop view if exists "test_db"."public_staging"."stg_comments__dbt_backup" cascade
[0m22:23:57.176098 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies"} */
drop view if exists "test_db"."public_staging"."stg_movies__dbt_backup" cascade
[0m22:23:57.176849 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.stg_movies_genres"} */
drop view if exists "test_db"."public_staging"."stg_movies_genres__dbt_backup" cascade
[0m22:23:57.178406 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.003 seconds
[0m22:23:57.186071 [debug] [Thread-3 (]: On model.mongo_movies.stg_movies_directors: Close
[0m22:23:57.188440 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.010 seconds
[0m22:23:57.189784 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.012 seconds
[0m22:23:57.191326 [debug] [Thread-4 (]: SQL status: DROP VIEW in 0.013 seconds
[0m22:23:57.196061 [debug] [Thread-2 (]: On model.mongo_movies.stg_movies: Close
[0m22:23:57.198310 [debug] [Thread-1 (]: On model.mongo_movies.stg_comments: Close
[0m22:23:57.199042 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '912abef7-2264-4d07-a191-48c9b9810439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77058b743890>]}
[0m22:23:57.200745 [debug] [Thread-4 (]: On model.mongo_movies.stg_movies_genres: Close
[0m22:23:57.201881 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '912abef7-2264-4d07-a191-48c9b9810439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77058cb8dcd0>]}
[0m22:23:57.203593 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '912abef7-2264-4d07-a191-48c9b9810439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77058cb9f710>]}
[0m22:23:57.202806 [info ] [Thread-3 (]: 3 of 8 OK created sql view model public_staging.stg_movies_directors ........... [[32mCREATE VIEW[0m in 0.35s]
[0m22:23:57.206009 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '912abef7-2264-4d07-a191-48c9b9810439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77058cb16360>]}
[0m22:23:57.205287 [info ] [Thread-2 (]: 2 of 8 OK created sql view model public_staging.stg_movies ..................... [[32mCREATE VIEW[0m in 0.36s]
[0m22:23:57.207744 [info ] [Thread-1 (]: 1 of 8 OK created sql view model public_staging.stg_comments ................... [[32mCREATE VIEW[0m in 0.36s]
[0m22:23:57.209310 [debug] [Thread-3 (]: Finished running node model.mongo_movies.stg_movies_directors
[0m22:23:57.211991 [debug] [Thread-2 (]: Finished running node model.mongo_movies.stg_movies
[0m22:23:57.210602 [info ] [Thread-4 (]: 4 of 8 OK created sql view model public_staging.stg_movies_genres .............. [[32mCREATE VIEW[0m in 0.36s]
[0m22:23:57.213421 [debug] [Thread-1 (]: Finished running node model.mongo_movies.stg_comments
[0m22:23:57.216042 [debug] [Thread-4 (]: Finished running node model.mongo_movies.stg_movies_genres
[0m22:23:57.217822 [debug] [Thread-4 (]: Began running node model.mongo_movies.comments_by_user
[0m22:23:57.219035 [debug] [Thread-3 (]: Began running node model.mongo_movies.comments_by_user_incremental
[0m22:23:57.220201 [debug] [Thread-2 (]: Began running node model.mongo_movies.movies_genres_directors
[0m22:23:57.221260 [info ] [Thread-4 (]: 5 of 8 START sql table model public_marts.comments_by_user ..................... [RUN]
[0m22:23:57.222441 [info ] [Thread-3 (]: 6 of 8 START sql incremental model public_marts.comments_by_user_incremental ... [RUN]
[0m22:23:57.223604 [info ] [Thread-2 (]: 7 of 8 START sql table model public_marts.movies_genres_directors .............. [RUN]
[0m22:23:57.224892 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_movies_genres, now model.mongo_movies.comments_by_user)
[0m22:23:57.226004 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_movies_directors, now model.mongo_movies.comments_by_user_incremental)
[0m22:23:57.226751 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_movies, now model.mongo_movies.movies_genres_directors)
[0m22:23:57.227625 [debug] [Thread-4 (]: Began compiling node model.mongo_movies.comments_by_user
[0m22:23:57.228842 [debug] [Thread-3 (]: Began compiling node model.mongo_movies.comments_by_user_incremental
[0m22:23:57.229597 [debug] [Thread-2 (]: Began compiling node model.mongo_movies.movies_genres_directors
[0m22:23:57.236126 [debug] [Thread-4 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user"
[0m22:23:57.354903 [debug] [Thread-2 (]: Writing injected SQL for node "model.mongo_movies.movies_genres_directors"
[0m22:23:57.356042 [debug] [Thread-3 (]: Writing injected SQL for node "model.mongo_movies.comments_by_user_incremental"
[0m22:23:57.357959 [debug] [Thread-2 (]: Began executing node model.mongo_movies.movies_genres_directors
[0m22:23:57.358790 [debug] [Thread-4 (]: Began executing node model.mongo_movies.comments_by_user
[0m22:23:57.410035 [debug] [Thread-2 (]: Writing runtime sql for node "model.mongo_movies.movies_genres_directors"
[0m22:23:57.411556 [debug] [Thread-3 (]: Began executing node model.mongo_movies.comments_by_user_incremental
[0m22:23:57.416504 [debug] [Thread-4 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user"
[0m22:23:57.449248 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m22:23:57.464273 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m22:23:57.465189 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m22:23:57.465807 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: BEGIN
[0m22:23:57.466524 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

    
  
    

  create temporary table "comments_by_user_incremental__dbt_tmp222357455975"
  
  
    as
  
  (
    



WITH max_existing AS (
  
      SELECT max(load_date AT TIME ZONE 'UTC') AS max_load_date
      FROM "test_db"."public_marts"."comments_by_user_incremental"
  
),

filtered_new AS (
  SELECT *
  FROM "test_db"."public_staging"."stg_comments" c
  JOIN max_existing m ON true
  WHERE (c.load_date AT TIME ZONE 'UTC') > coalesce(m.max_load_date, '1900-01-01'::timestamp)
),

new_agg AS (
  SELECT
    name,
    email,
    count(*) AS comment_count,
    array_agg(distinct movie_id) AS movie_ids,
    max(load_date) AS load_date
  FROM filtered_new
  GROUP BY name, email
),

final AS (
  
    SELECT * FROM "test_db"."public_marts"."comments_by_user_incremental"
    UNION ALL
    SELECT * FROM new_agg
  
),

flat AS (
  
   SELECT
      name,
      email,
      total_comment_count,
      unnest(movie_ids) AS movie_id,
      load_date
    FROM (
        SELECT
            name,
            email,
            SUM(comment_count) OVER (PARTITION BY name, email) AS total_comment_count,
            movie_ids,
            load_date
        FROM final
    )
  
)


SELECT
  name,
  email,
  MAX(total_comment_count) as comment_count,
  array_agg(DISTINCT movie_id ORDER BY movie_id) AS movie_ids,
  max(load_date) AS load_date
FROM flat
GROUP BY name, email
ORDER BY comment_count DESC

  );
  
  
[0m22:23:57.467371 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user: BEGIN
[0m22:23:57.468100 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:23:57.468885 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:23:57.469556 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:23:57.482598 [debug] [Thread-2 (]: SQL status: BEGIN in 0.014 seconds
[0m22:23:57.483248 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m22:23:57.484094 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */

  
    

  create  table "test_db"."public_marts"."movies_genres_directors__dbt_tmp"
  
  
    as
  
  (
    SELECT m.title, m._id AS movie_id, g.genre, d.director FROM "test_db"."public_staging"."stg_movies" m 
JOIN "test_db"."public_staging"."stg_movies_genres" g ON m._dlt_id = g.movie_id
JOIN "test_db"."public_staging"."stg_movies_directors" d ON m._dlt_id = d.movie_id
  );
  
[0m22:23:57.485356 [debug] [Thread-4 (]: SQL status: BEGIN in 0.016 seconds
[0m22:23:57.485877 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m22:23:57.486394 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */

  
    

  create  table "test_db"."public_marts"."comments_by_user__dbt_tmp"
  
  
    as
  
  (
    -- depends_on: "test_db"."public_staging"."stg_comments"

SELECT name, email, count(text) as total_comment_count, 
count(distinct movie_id) as total_movies_count
FROM "test_db"."public_staging"."stg_comments" 
GROUP BY name, email
ORDER BY email
  );
  
[0m22:23:57.565348 [debug] [Thread-3 (]: SQL status: SELECT 236 in 0.096 seconds
[0m22:23:57.592519 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m22:23:57.593437 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user_incremental: BEGIN
[0m22:23:57.594485 [debug] [Thread-3 (]: SQL status: BEGIN in 0.000 seconds
[0m22:23:57.595063 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m22:23:57.595746 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental__dbt_tmp222357455975'
        
      order by ordinal_position

  
[0m22:23:57.606700 [debug] [Thread-3 (]: SQL status: SELECT 5 in 0.010 seconds
[0m22:23:57.614086 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m22:23:57.614782 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m22:23:57.618915 [debug] [Thread-3 (]: SQL status: SELECT 5 in 0.003 seconds
[0m22:23:57.635289 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m22:23:57.636310 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "test_db".INFORMATION_SCHEMA.columns
      where table_name = 'comments_by_user_incremental'
        
        and table_schema = 'public_marts'
        
      order by ordinal_position

  
[0m22:23:57.640067 [debug] [Thread-3 (]: SQL status: SELECT 5 in 0.003 seconds
[0m22:23:57.663173 [debug] [Thread-4 (]: SQL status: SELECT 236 in 0.176 seconds
[0m22:24:12.226959 [debug] [Thread-3 (]: Writing runtime sql for node "model.mongo_movies.comments_by_user_incremental"
[0m22:24:12.229118 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m22:24:12.230072 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */
alter table "test_db"."public_marts"."comments_by_user" rename to "comments_by_user__dbt_backup"
[0m22:24:12.231355 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m22:24:12.232296 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:24:12.233144 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user_incremental: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user_incremental"} */

      
        delete from "test_db"."public_marts"."comments_by_user_incremental" as DBT_INTERNAL_DEST
        where (name, email) in (
            select distinct name, email
            from "comments_by_user_incremental__dbt_tmp222357455975" as DBT_INTERNAL_SOURCE
        );

    

    insert into "test_db"."public_marts"."comments_by_user_incremental" ("name", "email", "comment_count", "movie_ids", "load_date")
    (
        select "name", "email", "comment_count", "movie_ids", "load_date"
        from "comments_by_user_incremental__dbt_tmp222357455975"
    )
  
[0m22:24:12.236967 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m22:24:12.238365 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */
alter table "test_db"."public_marts"."comments_by_user__dbt_tmp" rename to "comments_by_user"
[0m22:24:12.239144 [debug] [Thread-2 (]: SQL status: SELECT 49379 in 0.215 seconds
[0m22:24:12.239818 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:24:12.243547 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m22:24:12.244466 [debug] [Thread-3 (]: SQL status: INSERT 0 236 in 0.007 seconds
[0m22:24:12.246326 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user: COMMIT
[0m22:24:12.247637 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */
alter table "test_db"."public_marts"."movies_genres_directors" rename to "movies_genres_directors__dbt_backup"
[0m22:24:12.250212 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m22:24:12.250932 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m22:24:12.251872 [debug] [Thread-3 (]: Using postgres connection "model.mongo_movies.comments_by_user_incremental"
[0m22:24:12.252585 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:24:12.253118 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user: COMMIT
[0m22:24:12.254053 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user_incremental: COMMIT
[0m22:24:12.257737 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m22:24:12.259004 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */
alter table "test_db"."public_marts"."movies_genres_directors__dbt_tmp" rename to "movies_genres_directors"
[0m22:24:12.260084 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:24:12.261965 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: COMMIT
[0m22:24:12.262481 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m22:24:12.263001 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: COMMIT
[0m22:24:12.279995 [debug] [Thread-4 (]: SQL status: COMMIT in 0.021 seconds
[0m22:24:12.281832 [debug] [Thread-2 (]: SQL status: COMMIT in 0.018 seconds
[0m22:24:12.283694 [debug] [Thread-3 (]: SQL status: COMMIT in 0.025 seconds
[0m22:24:12.288127 [debug] [Thread-4 (]: Applying DROP to: "test_db"."public_marts"."comments_by_user__dbt_backup"
[0m22:24:12.292175 [debug] [Thread-2 (]: Applying DROP to: "test_db"."public_marts"."movies_genres_directors__dbt_backup"
[0m22:24:12.293754 [debug] [Thread-3 (]: On model.mongo_movies.comments_by_user_incremental: Close
[0m22:24:12.299817 [debug] [Thread-4 (]: Using postgres connection "model.mongo_movies.comments_by_user"
[0m22:24:12.301087 [debug] [Thread-2 (]: Using postgres connection "model.mongo_movies.movies_genres_directors"
[0m22:24:12.301997 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.comments_by_user"} */
drop table if exists "test_db"."public_marts"."comments_by_user__dbt_backup" cascade
[0m22:24:12.302852 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '912abef7-2264-4d07-a191-48c9b9810439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770588e6cbf0>]}
[0m22:24:12.303716 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.movies_genres_directors"} */
drop table if exists "test_db"."public_marts"."movies_genres_directors__dbt_backup" cascade
[0m22:24:12.305064 [info ] [Thread-3 (]: 6 of 8 OK created sql incremental model public_marts.comments_by_user_incremental  [[32mINSERT 0 236[0m in 15.08s]
[0m22:24:12.306530 [debug] [Thread-3 (]: Finished running node model.mongo_movies.comments_by_user_incremental
[0m22:24:12.307857 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.003 seconds
[0m22:24:12.310224 [debug] [Thread-4 (]: On model.mongo_movies.comments_by_user: Close
[0m22:24:12.310926 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.005 seconds
[0m22:24:12.313365 [debug] [Thread-2 (]: On model.mongo_movies.movies_genres_directors: Close
[0m22:24:12.314268 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '912abef7-2264-4d07-a191-48c9b9810439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77058d7cfda0>]}
[0m22:24:12.316813 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '912abef7-2264-4d07-a191-48c9b9810439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77058f6c2c00>]}
[0m22:24:12.315897 [info ] [Thread-4 (]: 5 of 8 OK created sql table model public_marts.comments_by_user ................ [[32mSELECT 236[0m in 15.09s]
[0m22:24:12.318170 [info ] [Thread-2 (]: 7 of 8 OK created sql table model public_marts.movies_genres_directors ......... [[32mSELECT 49379[0m in 15.09s]
[0m22:24:12.319832 [debug] [Thread-4 (]: Finished running node model.mongo_movies.comments_by_user
[0m22:24:12.320959 [debug] [Thread-2 (]: Finished running node model.mongo_movies.movies_genres_directors
[0m22:24:12.322982 [debug] [Thread-1 (]: Began running node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m22:24:12.324735 [info ] [Thread-1 (]: 8 of 8 START sql table model public_marts.genres_and_directors_with_good_comment_each_user  [RUN]
[0m22:24:12.325757 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.mongo_movies.stg_comments, now model.mongo_movies.genres_and_directors_with_good_comment_each_user)
[0m22:24:12.326545 [debug] [Thread-1 (]: Began compiling node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m22:24:12.331829 [debug] [Thread-1 (]: Writing injected SQL for node "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m22:24:12.334474 [debug] [Thread-1 (]: Began executing node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m22:24:12.339627 [debug] [Thread-1 (]: Writing runtime sql for node "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m22:24:12.341370 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m22:24:12.342135 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: BEGIN
[0m22:24:12.342653 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:24:12.364070 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m22:24:12.364761 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m22:24:12.365306 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */

  
    

  create  table "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_tmp"
  
  
    as
  
  (
    SELECT 
    c.email,
    COALESCE(array_agg(DISTINCT gd.director) FILTER (
      WHERE c.text ~* '\mgood\M' AND c.text !~* 'not\s+good'
    ), '{}') AS fav_directors,

    COALESCE(array_agg(DISTINCT gd.genre) FILTER (
      WHERE c.text ~* '\mgood\M' AND c.text !~* 'not\s+good'
    ), '{}') AS fav_genres,

    COALESCE(array_agg(DISTINCT gd.title) FILTER (
      WHERE c.text ~* '\mgood\M' AND c.text !~* 'not\s+good'
    ), '{}') AS fav_movies
FROM "test_db"."public_staging"."stg_comments" c
JOIN "test_db"."public_marts"."movies_genres_directors" gd ON c.movie_id = gd.movie_id
GROUP BY c.email
  );
  
[0m22:23:59.290286 [debug] [Thread-1 (]: SQL status: SELECT 236 in 1.449 seconds
[0m22:23:59.295229 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m22:23:59.296045 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */
alter table "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user" rename to "genres_and_directors_with_good_comment_each_user__dbt_backup"
[0m22:23:59.297564 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:23:59.301242 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m22:23:59.301772 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */
alter table "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_tmp" rename to "genres_and_directors_with_good_comment_each_user"
[0m22:23:59.303067 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:23:59.305319 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: COMMIT
[0m22:23:59.306057 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m22:23:59.306960 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: COMMIT
[0m22:23:59.311217 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m22:23:59.319336 [debug] [Thread-1 (]: Applying DROP to: "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_backup"
[0m22:23:59.321226 [debug] [Thread-1 (]: Using postgres connection "model.mongo_movies.genres_and_directors_with_good_comment_each_user"
[0m22:23:59.322024 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "model.mongo_movies.genres_and_directors_with_good_comment_each_user"} */
drop table if exists "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user__dbt_backup" cascade
[0m22:23:59.326335 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.004 seconds
[0m22:23:59.329224 [debug] [Thread-1 (]: On model.mongo_movies.genres_and_directors_with_good_comment_each_user: Close
[0m22:23:59.330524 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '912abef7-2264-4d07-a191-48c9b9810439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77058b73cb60>]}
[0m22:23:59.331789 [info ] [Thread-1 (]: 8 of 8 OK created sql table model public_marts.genres_and_directors_with_good_comment_each_user  [[32mSELECT 236[0m in -13.00s]
[0m22:23:59.333078 [debug] [Thread-1 (]: Finished running node model.mongo_movies.genres_and_directors_with_good_comment_each_user
[0m22:23:59.336632 [debug] [MainThread]: Using postgres connection "master"
[0m22:23:59.337105 [debug] [MainThread]: On master: BEGIN
[0m22:23:59.337535 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:23:59.353032 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m22:23:59.353860 [debug] [MainThread]: On master: COMMIT
[0m22:23:59.354394 [debug] [MainThread]: Using postgres connection "master"
[0m22:23:59.354981 [debug] [MainThread]: On master: COMMIT
[0m22:23:59.355696 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:23:59.356176 [debug] [MainThread]: On master: Close
[0m22:23:59.357017 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:23:59.357534 [debug] [MainThread]: Connection 'model.mongo_movies.movies_genres_directors' was properly closed.
[0m22:23:59.358005 [debug] [MainThread]: Connection 'model.mongo_movies.genres_and_directors_with_good_comment_each_user' was properly closed.
[0m22:23:59.358620 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user_incremental' was properly closed.
[0m22:23:59.359253 [debug] [MainThread]: Connection 'model.mongo_movies.comments_by_user' was properly closed.
[0m22:23:59.360006 [info ] [MainThread]: 
[0m22:23:59.360798 [info ] [MainThread]: Finished running 1 incremental model, 3 table models, 4 view models in 0 hours 0 minutes and 2.84 seconds (2.84s).
[0m22:23:59.363917 [debug] [MainThread]: Command end result
[0m22:23:59.411295 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m22:23:59.414321 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m22:23:59.422486 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m22:23:59.423152 [info ] [MainThread]: 
[0m22:23:59.423781 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:23:59.424302 [info ] [MainThread]: 
[0m22:23:59.425003 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=8
[0m22:23:59.427769 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.252047, "process_in_blocks": "122168", "process_kernel_time": 1.23013, "process_mem_max_rss": "127792", "process_out_blocks": "2072", "process_user_time": 4.397915}
[0m22:23:59.428922 [debug] [MainThread]: Command `dbt run` succeeded at 22:23:59.428715 after 4.25 seconds
[0m22:23:59.429607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705909d4890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77058fd6faa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77058d735ca0>]}
[0m22:23:59.430353 [debug] [MainThread]: Flushing usage events
[0m22:24:01.149694 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:17:33.907997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f85096a84d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8509755520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8509755be0>]}


============================== 21:17:33.913517 | 880aef58-0880-4efa-847e-07046caf69aa ==============================
[0m21:17:33.913517 [info ] [MainThread]: Running with dbt=1.10.6
[0m21:17:33.914489 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt deps', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m21:17:34.073217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '880aef58-0880-4efa-847e-07046caf69aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8509eef3b0>]}
[0m21:17:34.095215 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-mb1n0h8x'
[0m21:17:34.095787 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m21:17:34.626798 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m21:17:34.627746 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m21:17:34.760428 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m21:17:34.773875 [info ] [MainThread]: Updating lock file in file path: /home/adminxx/astro-dlt-dbt/include/dbt/package-lock.yml
[0m21:17:34.777657 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-m13xcivq'
[0m21:17:34.780930 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m21:17:35.387004 [info ] [MainThread]: Installed from version 1.3.0
[0m21:17:35.387700 [info ] [MainThread]: Up to date!
[0m21:17:35.388306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '880aef58-0880-4efa-847e-07046caf69aa', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f85093f0440>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f85093f0320>]}
[0m21:17:35.389851 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 1.5612056, "process_in_blocks": "51824", "process_kernel_time": 0.547703, "process_mem_max_rss": "105524", "process_out_blocks": "2320", "process_user_time": 1.943334}
[0m21:17:35.390387 [debug] [MainThread]: Command `dbt deps` succeeded at 21:17:35.390274 after 1.56 seconds
[0m21:17:35.390745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8509755af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8509c7e8a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8509eef3b0>]}
[0m21:17:35.391099 [debug] [MainThread]: Flushing usage events
[0m21:17:36.599178 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:18:03.179450 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca5e0d65ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca5e0d659a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca5e0d65b80>]}


============================== 21:18:03.182936 | 96cc5136-1c62-4c1c-a10e-85722bb989be ==============================
[0m21:18:03.182936 [info ] [MainThread]: Running with dbt=1.10.6
[0m21:18:03.183689 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt test', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m21:18:03.444088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '96cc5136-1c62-4c1c-a10e-85722bb989be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca5e16ff440>]}
[0m21:18:03.536718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '96cc5136-1c62-4c1c-a10e-85722bb989be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca5e1c4b800>]}
[0m21:18:03.538066 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m21:18:03.640255 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m21:18:03.736107 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m21:18:03.736704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '96cc5136-1c62-4c1c-a10e-85722bb989be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca5e16fed50>]}
[0m21:18:05.380865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '96cc5136-1c62-4c1c-a10e-85722bb989be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca5dc952c30>]}
[0m21:18:05.477843 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m21:18:05.480368 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m21:18:05.507877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '96cc5136-1c62-4c1c-a10e-85722bb989be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca5dc8291f0>]}
[0m21:18:05.508387 [info ] [MainThread]: Found 8 models, 11 data tests, 6 sources, 550 macros
[0m21:18:05.508783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '96cc5136-1c62-4c1c-a10e-85722bb989be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca5dc8d5df0>]}
[0m21:18:05.510838 [info ] [MainThread]: 
[0m21:18:05.511251 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:18:05.511610 [info ] [MainThread]: 
[0m21:18:05.512150 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m21:18:05.518047 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_staging'
[0m21:18:05.525163 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_marts'
[0m21:18:05.670358 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m21:18:05.670914 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m21:18:05.671387 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m21:18:05.671818 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m21:18:05.672252 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:18:05.672665 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:18:05.712923 [debug] [ThreadPool]: SQL status: BEGIN in 0.041 seconds
[0m21:18:05.713440 [debug] [ThreadPool]: SQL status: BEGIN in 0.041 seconds
[0m21:18:05.713912 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m21:18:05.714480 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m21:18:05.715095 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m21:18:05.715752 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m21:18:05.746691 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.030 seconds
[0m21:18:05.747658 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.031 seconds
[0m21:18:05.749400 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m21:18:05.750756 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m21:18:05.751550 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m21:18:05.751884 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m21:18:05.758505 [debug] [MainThread]: Using postgres connection "master"
[0m21:18:05.758880 [debug] [MainThread]: On master: BEGIN
[0m21:18:05.759216 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:18:05.769307 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m21:18:05.769839 [debug] [MainThread]: Using postgres connection "master"
[0m21:18:05.770342 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m21:18:05.810136 [debug] [MainThread]: SQL status: SELECT 5 in 0.039 seconds
[0m21:18:05.812058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '96cc5136-1c62-4c1c-a10e-85722bb989be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca5dc96c3b0>]}
[0m21:18:05.812582 [debug] [MainThread]: On master: ROLLBACK
[0m21:18:05.813414 [debug] [MainThread]: Using postgres connection "master"
[0m21:18:05.814256 [debug] [MainThread]: On master: BEGIN
[0m21:18:05.815373 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m21:18:05.815767 [debug] [MainThread]: On master: COMMIT
[0m21:18:05.816137 [debug] [MainThread]: Using postgres connection "master"
[0m21:18:05.816456 [debug] [MainThread]: On master: COMMIT
[0m21:18:05.816988 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m21:18:05.817378 [debug] [MainThread]: On master: Close
[0m21:18:05.822361 [debug] [Thread-1 (]: Began running node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f
[0m21:18:05.822827 [debug] [Thread-2 (]: Began running node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:18:05.823305 [debug] [Thread-3 (]: Began running node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:18:05.824077 [debug] [Thread-4 (]: Began running node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:18:05.823738 [info ] [Thread-1 (]: 1 of 11 START test dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0  [RUN]
[0m21:18:05.824832 [info ] [Thread-2 (]: 2 of 11 START test not_null_comments_by_user_email ............................. [RUN]
[0m21:18:05.825486 [info ] [Thread-3 (]: 3 of 11 START test not_null_comments_by_user_name .............................. [RUN]
[0m21:18:05.826029 [info ] [Thread-4 (]: 4 of 11 START test not_null_genres_and_directors_with_good_comment_each_user_email  [RUN]
[0m21:18:05.826882 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f)
[0m21:18:05.827565 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now test.mongo_movies.not_null_comments_by_user_email.761242fc5c)
[0m21:18:05.828079 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.mongo_movies.not_null_comments_by_user_name.5e48cf6675'
[0m21:18:05.828605 [debug] [Thread-4 (]: Acquiring new postgres connection 'test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750'
[0m21:18:05.829040 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f
[0m21:18:05.829519 [debug] [Thread-2 (]: Began compiling node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:18:05.829999 [debug] [Thread-3 (]: Began compiling node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:18:05.830518 [debug] [Thread-4 (]: Began compiling node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:18:05.839226 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f"
[0m21:18:05.845413 [debug] [Thread-2 (]: Writing injected SQL for node "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:18:05.849488 [debug] [Thread-3 (]: Writing injected SQL for node "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:18:05.855909 [debug] [Thread-4 (]: Writing injected SQL for node "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:18:05.858276 [debug] [Thread-2 (]: Began executing node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:18:05.858748 [debug] [Thread-1 (]: Began executing node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f
[0m21:18:05.859158 [debug] [Thread-3 (]: Began executing node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:18:05.873023 [debug] [Thread-4 (]: Began executing node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:18:05.880993 [debug] [Thread-2 (]: Writing runtime sql for node "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:18:05.883902 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f"
[0m21:18:05.886529 [debug] [Thread-3 (]: Writing runtime sql for node "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:18:05.889221 [debug] [Thread-4 (]: Writing runtime sql for node "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:18:05.891382 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:18:05.892491 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: BEGIN
[0m21:18:05.893266 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f"
[0m21:18:05.893799 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:18:05.894331 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:18:05.894885 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:18:05.895482 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f: BEGIN
[0m21:18:05.896078 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: BEGIN
[0m21:18:05.896953 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: BEGIN
[0m21:18:05.897530 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:18:05.898310 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:18:05.898978 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:18:05.907561 [debug] [Thread-2 (]: SQL status: BEGIN in 0.013 seconds
[0m21:18:05.908246 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:18:05.908806 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select email
from "test_db"."public_marts"."comments_by_user"
where email is null



  
  
      
    ) dbt_internal_test
[0m21:18:05.909773 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m21:18:05.910538 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f"
[0m21:18:05.911041 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  



select
    1
from "test_db"."public_marts"."comments_by_user"

where not(total_comment_count count > 0)


  
  
      
    ) dbt_internal_test
[0m21:18:05.911595 [debug] [Thread-4 (]: SQL status: BEGIN in 0.013 seconds
[0m21:18:05.912170 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "count"
LINE 18: where not(total_comment_count count > 0)
                                       ^

[0m21:18:05.912564 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:18:05.912989 [debug] [Thread-3 (]: SQL status: BEGIN in 0.014 seconds
[0m21:18:05.913431 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f: ROLLBACK
[0m21:18:05.913953 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select email
from "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user"
where email is null



  
  
      
    ) dbt_internal_test
[0m21:18:05.914512 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:18:05.915379 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f: Close
[0m21:18:05.915896 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.007 seconds
[0m21:18:05.916367 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select name
from "test_db"."public_marts"."comments_by_user"
where name is null



  
  
      
    ) dbt_internal_test
[0m21:18:05.920804 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: ROLLBACK
[0m21:18:05.921327 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.006 seconds
[0m21:18:05.924595 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: ROLLBACK
[0m21:18:05.925545 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: Close
[0m21:18:05.926139 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.003 seconds
[0m21:18:05.926972 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: Close
[0m21:18:05.929239 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: ROLLBACK
[0m21:18:05.927897 [info ] [Thread-2 (]: 2 of 11 PASS not_null_comments_by_user_email ................................... [[32mPASS[0m in 0.10s]
[0m21:18:05.930958 [info ] [Thread-4 (]: 4 of 11 PASS not_null_genres_and_directors_with_good_comment_each_user_email ... [[32mPASS[0m in 0.10s]
[0m21:18:05.932639 [debug] [Thread-2 (]: Finished running node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:18:05.933174 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: Close
[0m21:18:05.934346 [debug] [Thread-4 (]: Finished running node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:18:05.935039 [debug] [Thread-2 (]: Began running node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:18:05.937539 [debug] [Thread-1 (]: Database Error in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0 (models/schema.yml)
  syntax error at or near "count"
  LINE 18: where not(total_comment_count count > 0)
                                         ^
  compiled code at target/run/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_3cd001263630cb35cc6c9670cf8db01f.sql
[0m21:18:05.938542 [info ] [Thread-3 (]: 3 of 11 PASS not_null_comments_by_user_name .................................... [[32mPASS[0m in 0.11s]
[0m21:18:05.939403 [debug] [Thread-4 (]: Began running node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:18:05.940003 [info ] [Thread-2 (]: 5 of 11 START test not_null_stg_comments__id ................................... [RUN]
[0m21:18:05.940652 [error] [Thread-1 (]: 1 of 11 ERROR dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0  [[31mERROR[0m in 0.11s]
[0m21:18:05.941350 [debug] [Thread-3 (]: Finished running node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:18:05.941879 [info ] [Thread-4 (]: 6 of 11 START test not_null_stg_movies__id ..................................... [RUN]
[0m21:18:05.942635 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_comments_by_user_email.761242fc5c, now test.mongo_movies.not_null_stg_comments__id.3928158263)
[0m21:18:05.943233 [debug] [Thread-1 (]: Finished running node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f
[0m21:18:05.943769 [debug] [Thread-3 (]: Began running node test.mongo_movies.relationships_stg_comments_movie_id___id__ref_stg_movies_.c1c6c59b95
[0m21:18:05.944528 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750, now test.mongo_movies.not_null_stg_movies__id.66af63a991)
[0m21:18:05.945080 [debug] [Thread-2 (]: Began compiling node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:18:05.945822 [debug] [Thread-1 (]: Began running node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:18:05.946526 [debug] [Thread-7 (]: Marking all children of 'test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f' to be skipped because of status 'error'.  Reason: Database Error in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0 (models/schema.yml)
  syntax error at or near "count"
  LINE 18: where not(total_comment_count count > 0)
                                         ^
  compiled code at target/run/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_3cd001263630cb35cc6c9670cf8db01f.sql.
[0m21:18:05.946948 [info ] [Thread-3 (]: 7 of 11 START test relationships_stg_comments_movie_id___id__ref_stg_movies_ ... [RUN]
[0m21:18:05.947837 [debug] [Thread-4 (]: Began compiling node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:18:05.952635 [debug] [Thread-2 (]: Writing injected SQL for node "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:18:05.953360 [info ] [Thread-1 (]: 8 of 11 START test unique_comments_by_user__name___email_ ...................... [RUN]
[0m21:18:05.955075 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_comments_by_user_name.5e48cf6675, now test.mongo_movies.relationships_stg_comments_movie_id___id__ref_stg_movies_.c1c6c59b95)
[0m21:18:05.961243 [debug] [Thread-4 (]: Writing injected SQL for node "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:18:05.962132 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f, now test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71)
[0m21:18:05.962958 [debug] [Thread-2 (]: Began executing node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:18:05.963447 [debug] [Thread-3 (]: Began compiling node test.mongo_movies.relationships_stg_comments_movie_id___id__ref_stg_movies_.c1c6c59b95
[0m21:18:05.964172 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:18:05.967857 [debug] [Thread-2 (]: Writing runtime sql for node "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:18:05.968545 [debug] [Thread-4 (]: Began executing node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:18:05.976073 [debug] [Thread-3 (]: Writing injected SQL for node "test.mongo_movies.relationships_stg_comments_movie_id___id__ref_stg_movies_.c1c6c59b95"
[0m21:18:05.985086 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:18:05.988357 [debug] [Thread-4 (]: Writing runtime sql for node "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:18:05.988938 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:18:05.989920 [debug] [Thread-3 (]: Began executing node test.mongo_movies.relationships_stg_comments_movie_id___id__ref_stg_movies_.c1c6c59b95
[0m21:18:05.990376 [debug] [Thread-1 (]: Began executing node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:18:05.990969 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: BEGIN
[0m21:18:05.991532 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:18:05.993585 [debug] [Thread-3 (]: Writing runtime sql for node "test.mongo_movies.relationships_stg_comments_movie_id___id__ref_stg_movies_.c1c6c59b95"
[0m21:18:05.996108 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:18:05.996653 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:18:05.997267 [debug] [Thread-4 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: BEGIN
[0m21:18:05.998594 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.relationships_stg_comments_movie_id___id__ref_stg_movies_.c1c6c59b95"
[0m21:18:05.999082 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:18:05.999683 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:18:06.000141 [debug] [Thread-3 (]: On test.mongo_movies.relationships_stg_comments_movie_id___id__ref_stg_movies_.c1c6c59b95: BEGIN
[0m21:18:06.000633 [debug] [Thread-1 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: BEGIN
[0m21:18:06.001369 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:18:06.001827 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:18:06.008610 [debug] [Thread-2 (]: SQL status: BEGIN in 0.012 seconds
[0m21:18:06.009260 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:18:06.009851 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_stg_comments__id.3928158263"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select _id
from "test_db"."public_staging"."stg_comments"
where _id is null



  
  
      
    ) dbt_internal_test
[0m21:18:06.010498 [debug] [Thread-4 (]: SQL status: BEGIN in 0.011 seconds
[0m21:18:06.011127 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:18:06.011524 [debug] [Thread-4 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_stg_movies__id.66af63a991"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select _id
from "test_db"."public_staging"."stg_movies"
where _id is null



  
  
      
    ) dbt_internal_test
[0m21:18:06.012420 [debug] [Thread-3 (]: SQL status: BEGIN in 0.011 seconds
[0m21:18:06.013236 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.relationships_stg_comments_movie_id___id__ref_stg_movies_.c1c6c59b95"
[0m21:18:06.013874 [debug] [Thread-3 (]: On test.mongo_movies.relationships_stg_comments_movie_id___id__ref_stg_movies_.c1c6c59b95: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.relationships_stg_comments_movie_id___id__ref_stg_movies_.c1c6c59b95"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with child as (
    select movie_id as from_field
    from "test_db"."public_staging"."stg_comments"
    where movie_id is not null
),

parent as (
    select _id as to_field
    from "test_db"."public_staging"."stg_movies"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



  
  
      
    ) dbt_internal_test
[0m21:18:06.014406 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m21:18:06.015037 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:18:06.015535 [debug] [Thread-1 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    (name || '_' || email) as unique_field,
    count(*) as n_records

from "test_db"."public_marts"."comments_by_user"
where (name || '_' || email) is not null
group by (name || '_' || email)
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:18:06.018277 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m21:18:06.020155 [debug] [Thread-1 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: ROLLBACK
[0m21:18:06.020841 [debug] [Thread-1 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: Close
[0m21:18:06.021822 [info ] [Thread-1 (]: 8 of 11 PASS unique_comments_by_user__name___email_ ............................ [[32mPASS[0m in 0.06s]
[0m21:18:06.022826 [debug] [Thread-1 (]: Finished running node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:18:06.023446 [debug] [Thread-1 (]: Began running node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:18:06.024132 [info ] [Thread-1 (]: 9 of 11 START test unique_genres_and_directors_with_good_comment_each_user_email  [RUN]
[0m21:18:06.024694 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71, now test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24)
[0m21:18:06.025109 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:18:06.031118 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:18:06.032081 [debug] [Thread-1 (]: Began executing node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:18:06.035183 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:18:06.035940 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:18:06.036353 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: BEGIN
[0m21:18:06.036910 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:18:06.049234 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m21:18:06.049911 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:18:06.050589 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    email as unique_field,
    count(*) as n_records

from "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user"
where email is not null
group by email
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:18:06.053237 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m21:18:06.054968 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: ROLLBACK
[0m21:18:06.055638 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: Close
[0m21:18:06.056636 [info ] [Thread-1 (]: 9 of 11 PASS unique_genres_and_directors_with_good_comment_each_user_email ..... [[32mPASS[0m in 0.03s]
[0m21:18:06.057660 [debug] [Thread-1 (]: Finished running node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:18:06.058363 [debug] [Thread-1 (]: Began running node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:18:06.058977 [info ] [Thread-1 (]: 10 of 11 START test unique_stg_comments__id .................................... [RUN]
[0m21:18:06.059531 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24, now test.mongo_movies.unique_stg_comments__id.517cb0eade)
[0m21:18:06.059978 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:18:06.065897 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:18:06.066873 [debug] [Thread-1 (]: Began executing node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:18:06.069999 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:18:06.070860 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:18:06.071485 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: BEGIN
[0m21:18:06.072109 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:18:06.084460 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m21:18:06.085223 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:18:06.085918 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_stg_comments__id.517cb0eade"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    _id as unique_field,
    count(*) as n_records

from "test_db"."public_staging"."stg_comments"
where _id is not null
group by _id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:18:06.131463 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.120 seconds
[0m21:18:06.133743 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: ROLLBACK
[0m21:18:06.135036 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: Close
[0m21:18:06.136279 [info ] [Thread-2 (]: 5 of 11 PASS not_null_stg_comments__id ......................................... [[32mPASS[0m in 0.19s]
[0m21:18:06.137353 [debug] [Thread-2 (]: Finished running node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:18:06.138146 [debug] [Thread-2 (]: Began running node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:18:06.139127 [info ] [Thread-2 (]: 11 of 11 START test unique_stg_movies__id ...................................... [RUN]
[0m21:18:06.139847 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_stg_comments__id.3928158263, now test.mongo_movies.unique_stg_movies__id.8c3f08cf1c)
[0m21:18:06.140380 [debug] [Thread-2 (]: Began compiling node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:18:06.145808 [debug] [Thread-2 (]: Writing injected SQL for node "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:18:06.146513 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.060 seconds
[0m21:18:06.147096 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.135 seconds
[0m21:18:06.148757 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: ROLLBACK
[0m21:18:06.150764 [debug] [Thread-4 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: ROLLBACK
[0m21:18:06.151333 [debug] [Thread-2 (]: Began executing node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:18:06.154921 [debug] [Thread-2 (]: Writing runtime sql for node "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:18:06.155516 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: Close
[0m21:18:06.156025 [debug] [Thread-4 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: Close
[0m21:18:06.157087 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:18:06.157872 [info ] [Thread-4 (]: 6 of 11 PASS not_null_stg_movies__id ........................................... [[32mPASS[0m in 0.21s]
[0m21:18:06.159339 [debug] [Thread-2 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: BEGIN
[0m21:18:06.158888 [info ] [Thread-1 (]: 10 of 11 PASS unique_stg_comments__id .......................................... [[32mPASS[0m in 0.10s]
[0m21:18:06.160167 [debug] [Thread-4 (]: Finished running node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:18:06.160636 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:18:06.161454 [debug] [Thread-1 (]: Finished running node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:18:06.165233 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.150 seconds
[0m21:18:06.167464 [debug] [Thread-3 (]: On test.mongo_movies.relationships_stg_comments_movie_id___id__ref_stg_movies_.c1c6c59b95: ROLLBACK
[0m21:18:06.168556 [debug] [Thread-3 (]: On test.mongo_movies.relationships_stg_comments_movie_id___id__ref_stg_movies_.c1c6c59b95: Close
[0m21:18:06.169852 [error] [Thread-3 (]: 7 of 11 FAIL 927 relationships_stg_comments_movie_id___id__ref_stg_movies_ ..... [[31mFAIL 927[0m in 0.21s]
[0m21:18:06.171141 [debug] [Thread-3 (]: Finished running node test.mongo_movies.relationships_stg_comments_movie_id___id__ref_stg_movies_.c1c6c59b95
[0m21:18:06.173259 [debug] [Thread-2 (]: SQL status: BEGIN in 0.013 seconds
[0m21:18:06.173979 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:18:06.174663 [debug] [Thread-2 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    _id as unique_field,
    count(*) as n_records

from "test_db"."public_staging"."stg_movies"
where _id is not null
group by _id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:18:06.212094 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.037 seconds
[0m21:18:06.213775 [debug] [Thread-2 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: ROLLBACK
[0m21:18:06.214608 [debug] [Thread-2 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: Close
[0m21:18:06.215548 [info ] [Thread-2 (]: 11 of 11 PASS unique_stg_movies__id ............................................ [[32mPASS[0m in 0.08s]
[0m21:18:06.216435 [debug] [Thread-2 (]: Finished running node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:18:06.219151 [debug] [MainThread]: Using postgres connection "master"
[0m21:18:06.219580 [debug] [MainThread]: On master: BEGIN
[0m21:18:06.219927 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:18:06.230143 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m21:18:06.230818 [debug] [MainThread]: On master: COMMIT
[0m21:18:06.231252 [debug] [MainThread]: Using postgres connection "master"
[0m21:18:06.231643 [debug] [MainThread]: On master: COMMIT
[0m21:18:06.232249 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m21:18:06.232727 [debug] [MainThread]: On master: Close
[0m21:18:06.233400 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:18:06.233728 [debug] [MainThread]: Connection 'test.mongo_movies.unique_stg_movies__id.8c3f08cf1c' was properly closed.
[0m21:18:06.234108 [debug] [MainThread]: Connection 'test.mongo_movies.unique_stg_comments__id.517cb0eade' was properly closed.
[0m21:18:06.234651 [debug] [MainThread]: Connection 'test.mongo_movies.relationships_stg_comments_movie_id___id__ref_stg_movies_.c1c6c59b95' was properly closed.
[0m21:18:06.235017 [debug] [MainThread]: Connection 'test.mongo_movies.not_null_stg_movies__id.66af63a991' was properly closed.
[0m21:18:06.235401 [info ] [MainThread]: 
[0m21:18:06.235829 [info ] [MainThread]: Finished running 11 data tests in 0 hours 0 minutes and 0.72 seconds (0.72s).
[0m21:18:06.238015 [debug] [MainThread]: Command end result
[0m21:18:06.267535 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m21:18:06.269622 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m21:18:06.276069 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m21:18:06.276448 [info ] [MainThread]: 
[0m21:18:06.276909 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m21:18:06.277296 [info ] [MainThread]: 
[0m21:18:06.277770 [error] [MainThread]: [31mFailure in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0 (models/schema.yml)[0m
[0m21:18:06.278244 [error] [MainThread]:   Database Error in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0 (models/schema.yml)
  syntax error at or near "count"
  LINE 18: where not(total_comment_count count > 0)
                                         ^
  compiled code at target/run/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_3cd001263630cb35cc6c9670cf8db01f.sql
[0m21:18:06.278623 [info ] [MainThread]: 
[0m21:18:06.279029 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_3cd001263630cb35cc6c9670cf8db01f.sql
[0m21:18:06.279393 [info ] [MainThread]: 
[0m21:18:06.279821 [error] [MainThread]: [31mFailure in test relationships_stg_comments_movie_id___id__ref_stg_movies_ (models/schema.yml)[0m
[0m21:18:06.280220 [error] [MainThread]:   Got 927 results, configured to fail if != 0
[0m21:18:06.280556 [info ] [MainThread]: 
[0m21:18:06.280948 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/schema.yml/relationships_stg_comments_movie_id___id__ref_stg_movies_.sql
[0m21:18:06.281296 [info ] [MainThread]: 
[0m21:18:06.281755 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=2 SKIP=0 NO-OP=0 TOTAL=11
[0m21:18:06.282818 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": false, "command_wall_clock_time": 3.2472556, "process_in_blocks": "18536", "process_kernel_time": 0.618922, "process_mem_max_rss": "135556", "process_out_blocks": "3912", "process_user_time": 4.217398}
[0m21:18:06.283304 [debug] [MainThread]: Command `dbt test` failed at 21:18:06.283199 after 3.25 seconds
[0m21:18:06.283713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca5dc6fb530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca5dc8682f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca5dc4b8260>]}
[0m21:18:06.284112 [debug] [MainThread]: Flushing usage events
[0m21:18:07.471496 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:18:52.885345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790a46db0b60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790a46e0adb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790a46e094f0>]}


============================== 21:18:52.888990 | 3f6d37cc-7b20-4ccd-8371-d54596104049 ==============================
[0m21:18:52.888990 [info ] [MainThread]: Running with dbt=1.10.6
[0m21:18:52.889655 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt test', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m21:18:53.103249 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3f6d37cc-7b20-4ccd-8371-d54596104049', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790a45f60c50>]}
[0m21:18:53.192617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3f6d37cc-7b20-4ccd-8371-d54596104049', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790a483d9940>]}
[0m21:18:53.193579 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m21:18:53.306707 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m21:18:53.429967 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:18:53.430806 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/schema.yml
[0m21:18:53.978954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3f6d37cc-7b20-4ccd-8371-d54596104049', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790a41ed4830>]}
[0m21:18:54.130983 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m21:18:54.133052 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m21:18:54.155684 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3f6d37cc-7b20-4ccd-8371-d54596104049', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790a447c35c0>]}
[0m21:18:54.156590 [info ] [MainThread]: Found 8 models, 10 data tests, 6 sources, 550 macros
[0m21:18:54.157063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3f6d37cc-7b20-4ccd-8371-d54596104049', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790a447ef110>]}
[0m21:18:54.159203 [info ] [MainThread]: 
[0m21:18:54.159645 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:18:54.160125 [info ] [MainThread]: 
[0m21:18:54.160798 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m21:18:54.165668 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_staging'
[0m21:18:54.166690 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_marts'
[0m21:18:54.212202 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m21:18:54.212811 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m21:18:54.213389 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m21:18:54.213892 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m21:18:54.214280 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:18:54.214754 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:18:54.227882 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m21:18:54.228796 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m21:18:54.229453 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m21:18:54.229991 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m21:18:54.230727 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m21:18:54.231140 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m21:18:54.235113 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.005 seconds
[0m21:18:54.236802 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m21:18:54.237240 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.006 seconds
[0m21:18:54.238645 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m21:18:54.238965 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m21:18:54.239551 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m21:18:54.247268 [debug] [MainThread]: Using postgres connection "master"
[0m21:18:54.247629 [debug] [MainThread]: On master: BEGIN
[0m21:18:54.247939 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:18:54.257493 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m21:18:54.257871 [debug] [MainThread]: Using postgres connection "master"
[0m21:18:54.258243 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m21:18:54.291015 [debug] [MainThread]: SQL status: SELECT 5 in 0.032 seconds
[0m21:18:54.292718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3f6d37cc-7b20-4ccd-8371-d54596104049', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790a44385220>]}
[0m21:18:54.293223 [debug] [MainThread]: On master: ROLLBACK
[0m21:18:54.293764 [debug] [MainThread]: Using postgres connection "master"
[0m21:18:54.294087 [debug] [MainThread]: On master: BEGIN
[0m21:18:54.294776 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m21:18:54.295128 [debug] [MainThread]: On master: COMMIT
[0m21:18:54.295446 [debug] [MainThread]: Using postgres connection "master"
[0m21:18:54.295839 [debug] [MainThread]: On master: COMMIT
[0m21:18:54.296460 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m21:18:54.296810 [debug] [MainThread]: On master: Close
[0m21:18:54.301571 [debug] [Thread-1 (]: Began running node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f
[0m21:18:54.302252 [debug] [Thread-2 (]: Began running node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:18:54.302818 [debug] [Thread-3 (]: Began running node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:18:54.303600 [debug] [Thread-4 (]: Began running node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:18:54.303250 [info ] [Thread-1 (]: 1 of 10 START test dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0  [RUN]
[0m21:18:54.304519 [info ] [Thread-2 (]: 2 of 10 START test not_null_comments_by_user_email ............................. [RUN]
[0m21:18:54.305191 [info ] [Thread-3 (]: 3 of 10 START test not_null_comments_by_user_name .............................. [RUN]
[0m21:18:54.305832 [info ] [Thread-4 (]: 4 of 10 START test not_null_genres_and_directors_with_good_comment_each_user_email  [RUN]
[0m21:18:54.306467 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f)
[0m21:18:54.306934 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now test.mongo_movies.not_null_comments_by_user_email.761242fc5c)
[0m21:18:54.307506 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.mongo_movies.not_null_comments_by_user_name.5e48cf6675'
[0m21:18:54.308144 [debug] [Thread-4 (]: Acquiring new postgres connection 'test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750'
[0m21:18:54.308736 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f
[0m21:18:54.309209 [debug] [Thread-2 (]: Began compiling node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:18:54.309717 [debug] [Thread-3 (]: Began compiling node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:18:54.310233 [debug] [Thread-4 (]: Began compiling node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:19:09.801573 [debug] [Thread-2 (]: Writing injected SQL for node "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:19:09.799287 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f"
[0m21:19:09.808224 [debug] [Thread-3 (]: Writing injected SQL for node "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:19:09.812091 [debug] [Thread-4 (]: Writing injected SQL for node "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:19:09.814015 [debug] [Thread-1 (]: Began executing node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f
[0m21:19:09.814999 [debug] [Thread-4 (]: Began executing node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:19:09.815555 [debug] [Thread-2 (]: Began executing node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:19:09.815974 [debug] [Thread-3 (]: Began executing node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:19:09.848825 [debug] [Thread-4 (]: Writing runtime sql for node "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:19:09.850665 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f"
[0m21:19:09.853622 [debug] [Thread-2 (]: Writing runtime sql for node "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:19:09.856244 [debug] [Thread-3 (]: Writing runtime sql for node "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:19:09.858697 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:19:09.859217 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f"
[0m21:19:09.859726 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:19:09.860323 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: BEGIN
[0m21:19:09.861132 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:19:09.861737 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f: BEGIN
[0m21:19:09.862432 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: BEGIN
[0m21:19:09.863070 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:19:09.863714 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: BEGIN
[0m21:19:09.864241 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:19:09.864735 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:19:09.865517 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:19:09.877683 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m21:19:09.878453 [debug] [Thread-2 (]: SQL status: BEGIN in 0.015 seconds
[0m21:19:09.878944 [debug] [Thread-4 (]: SQL status: BEGIN in 0.014 seconds
[0m21:19:09.879375 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f"
[0m21:19:09.879908 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:19:09.880342 [debug] [Thread-3 (]: SQL status: BEGIN in 0.015 seconds
[0m21:19:09.880756 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:19:09.881338 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  



select
    1
from "test_db"."public_marts"."comments_by_user"

where not(total_comment_count count > 0)


  
  
      
    ) dbt_internal_test
[0m21:19:09.881788 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select email
from "test_db"."public_marts"."comments_by_user"
where email is null



  
  
      
    ) dbt_internal_test
[0m21:19:09.882227 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:19:09.882769 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select email
from "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user"
where email is null



  
  
      
    ) dbt_internal_test
[0m21:19:09.883476 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select name
from "test_db"."public_marts"."comments_by_user"
where name is null



  
  
      
    ) dbt_internal_test
[0m21:19:09.884046 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "count"
LINE 18: where not(total_comment_count count > 0)
                                       ^

[0m21:19:09.884438 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m21:19:09.885236 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f: ROLLBACK
[0m21:19:09.889617 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: ROLLBACK
[0m21:19:09.890464 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.005 seconds
[0m21:19:09.890869 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.006 seconds
[0m21:19:09.892384 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: ROLLBACK
[0m21:19:09.892875 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f: Close
[0m21:19:09.893321 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: Close
[0m21:19:09.894564 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: ROLLBACK
[0m21:19:09.895279 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: Close
[0m21:19:09.897015 [info ] [Thread-2 (]: 2 of 10 PASS not_null_comments_by_user_email ................................... [[32mPASS[0m in 15.59s]
[0m21:19:09.898480 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: Close
[0m21:19:09.899430 [info ] [Thread-3 (]: 3 of 10 PASS not_null_comments_by_user_name .................................... [[32mPASS[0m in 15.59s]
[0m21:19:09.900497 [debug] [Thread-2 (]: Finished running node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:19:09.902166 [info ] [Thread-4 (]: 4 of 10 PASS not_null_genres_and_directors_with_good_comment_each_user_email ... [[32mPASS[0m in 15.59s]
[0m21:19:09.903181 [debug] [Thread-3 (]: Finished running node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:19:09.904386 [debug] [Thread-2 (]: Began running node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:19:09.905747 [debug] [Thread-1 (]: Database Error in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0 (models/schema.yml)
  syntax error at or near "count"
  LINE 18: where not(total_comment_count count > 0)
                                         ^
  compiled code at target/run/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_3cd001263630cb35cc6c9670cf8db01f.sql
[0m21:19:09.906681 [debug] [Thread-4 (]: Finished running node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:19:09.907314 [debug] [Thread-3 (]: Began running node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:19:09.908101 [info ] [Thread-2 (]: 5 of 10 START test not_null_stg_comments__id ................................... [RUN]
[0m21:19:09.908897 [error] [Thread-1 (]: 1 of 10 ERROR dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0  [[31mERROR[0m in 15.60s]
[0m21:19:09.909820 [debug] [Thread-4 (]: Began running node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:19:09.910468 [info ] [Thread-3 (]: 6 of 10 START test not_null_stg_movies__id ..................................... [RUN]
[0m21:19:09.911228 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_comments_by_user_email.761242fc5c, now test.mongo_movies.not_null_stg_comments__id.3928158263)
[0m21:19:09.911914 [debug] [Thread-1 (]: Finished running node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f
[0m21:19:09.912604 [info ] [Thread-4 (]: 7 of 10 START test unique_comments_by_user__name___email_ ...................... [RUN]
[0m21:19:09.913616 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_comments_by_user_name.5e48cf6675, now test.mongo_movies.not_null_stg_movies__id.66af63a991)
[0m21:19:09.914203 [debug] [Thread-2 (]: Began compiling node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:19:09.914790 [debug] [Thread-1 (]: Began running node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:19:09.915536 [debug] [Thread-7 (]: Marking all children of 'test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f' to be skipped because of status 'error'.  Reason: Database Error in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0 (models/schema.yml)
  syntax error at or near "count"
  LINE 18: where not(total_comment_count count > 0)
                                         ^
  compiled code at target/run/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_3cd001263630cb35cc6c9670cf8db01f.sql.
[0m21:19:09.916090 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750, now test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71)
[0m21:19:09.916702 [debug] [Thread-3 (]: Began compiling node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:19:09.921266 [debug] [Thread-2 (]: Writing injected SQL for node "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:19:09.922081 [info ] [Thread-1 (]: 8 of 10 START test unique_genres_and_directors_with_good_comment_each_user_email  [RUN]
[0m21:19:09.923954 [debug] [Thread-4 (]: Began compiling node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:19:09.928990 [debug] [Thread-3 (]: Writing injected SQL for node "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:19:09.930159 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0.4ce05fef6f, now test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24)
[0m21:19:09.939242 [debug] [Thread-4 (]: Writing injected SQL for node "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:19:09.939754 [debug] [Thread-2 (]: Began executing node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:19:09.940753 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:19:09.941405 [debug] [Thread-3 (]: Began executing node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:19:09.944189 [debug] [Thread-2 (]: Writing runtime sql for node "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:19:09.948082 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:19:09.948579 [debug] [Thread-4 (]: Began executing node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:19:09.951340 [debug] [Thread-3 (]: Writing runtime sql for node "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:19:09.954403 [debug] [Thread-4 (]: Writing runtime sql for node "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:19:09.955398 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:19:09.955944 [debug] [Thread-1 (]: Began executing node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:19:09.956759 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: BEGIN
[0m21:19:09.957340 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:19:09.958006 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:19:09.960117 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:19:09.960588 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:19:09.961033 [debug] [Thread-3 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: BEGIN
[0m21:19:09.961537 [debug] [Thread-4 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: BEGIN
[0m21:19:09.962573 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:19:09.963080 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:19:09.963524 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:19:09.964240 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: BEGIN
[0m21:19:09.964961 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:19:09.971881 [debug] [Thread-2 (]: SQL status: BEGIN in 0.011 seconds
[0m21:19:09.972292 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:19:09.972750 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_stg_comments__id.3928158263"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select _id
from "test_db"."public_staging"."stg_comments"
where _id is null



  
  
      
    ) dbt_internal_test
[0m21:19:09.973313 [debug] [Thread-3 (]: SQL status: BEGIN in 0.011 seconds
[0m21:19:09.974038 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:19:09.974594 [debug] [Thread-4 (]: SQL status: BEGIN in 0.011 seconds
[0m21:19:09.974982 [debug] [Thread-3 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_stg_movies__id.66af63a991"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select _id
from "test_db"."public_staging"."stg_movies"
where _id is null



  
  
      
    ) dbt_internal_test
[0m21:19:09.975558 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:19:09.976070 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m21:19:09.976632 [debug] [Thread-4 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    (name || '_' || email) as unique_field,
    count(*) as n_records

from "test_db"."public_marts"."comments_by_user"
where (name || '_' || email) is not null
group by (name || '_' || email)
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:19:09.977174 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:19:09.977827 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    email as unique_field,
    count(*) as n_records

from "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user"
where email is not null
group by email
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:19:09.979336 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.002 seconds
[0m21:19:09.979987 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m21:19:09.981501 [debug] [Thread-4 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: ROLLBACK
[0m21:19:09.982906 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: ROLLBACK
[0m21:19:09.983544 [debug] [Thread-4 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: Close
[0m21:19:09.983895 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: Close
[0m21:19:09.985932 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.012 seconds
[0m21:19:09.984800 [info ] [Thread-4 (]: 7 of 10 PASS unique_comments_by_user__name___email_ ............................ [[32mPASS[0m in 0.07s]
[0m21:18:54.507589 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: ROLLBACK
[0m21:19:09.985517 [info ] [Thread-1 (]: 8 of 10 PASS unique_genres_and_directors_with_good_comment_each_user_email ..... [[32mPASS[0m in 0.06s]
[0m21:18:54.509081 [debug] [Thread-4 (]: Finished running node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:18:54.509999 [debug] [Thread-1 (]: Finished running node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:18:54.510609 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: Close
[0m21:18:54.511351 [debug] [Thread-4 (]: Began running node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:18:54.512313 [debug] [Thread-1 (]: Began running node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:18:54.513256 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.017 seconds
[0m21:18:54.514154 [info ] [Thread-2 (]: 5 of 10 PASS not_null_stg_comments__id ......................................... [[32mPASS[0m in -15.40s]
[0m21:18:54.514536 [info ] [Thread-4 (]: 9 of 10 START test unique_stg_comments__id ..................................... [RUN]
[0m21:18:54.517036 [debug] [Thread-3 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: ROLLBACK
[0m21:18:54.515258 [info ] [Thread-1 (]: 10 of 10 START test unique_stg_movies__id ...................................... [RUN]
[0m21:18:54.517811 [debug] [Thread-2 (]: Finished running node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:18:54.518337 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71, now test.mongo_movies.unique_stg_comments__id.517cb0eade)
[0m21:18:54.518991 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24, now test.mongo_movies.unique_stg_movies__id.8c3f08cf1c)
[0m21:18:54.519477 [debug] [Thread-3 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: Close
[0m21:18:54.520230 [debug] [Thread-4 (]: Began compiling node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:18:54.520809 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:18:54.527386 [debug] [Thread-4 (]: Writing injected SQL for node "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:18:54.526957 [info ] [Thread-3 (]: 6 of 10 PASS not_null_stg_movies__id ........................................... [[32mPASS[0m in -15.39s]
[0m21:18:54.534278 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:18:54.535622 [debug] [Thread-3 (]: Finished running node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:18:54.536846 [debug] [Thread-4 (]: Began executing node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:18:54.539892 [debug] [Thread-4 (]: Writing runtime sql for node "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:18:54.540503 [debug] [Thread-1 (]: Began executing node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:18:54.543362 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:18:54.544592 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:18:54.545292 [debug] [Thread-4 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: BEGIN
[0m21:18:54.545872 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:18:54.546486 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:18:54.547105 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: BEGIN
[0m21:18:54.548071 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:18:54.557879 [debug] [Thread-4 (]: SQL status: BEGIN in 0.011 seconds
[0m21:18:54.558609 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:18:54.559370 [debug] [Thread-4 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_stg_comments__id.517cb0eade"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    _id as unique_field,
    count(*) as n_records

from "test_db"."public_staging"."stg_comments"
where _id is not null
group by _id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:18:54.560043 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m21:18:54.561137 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:18:54.561718 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    _id as unique_field,
    count(*) as n_records

from "test_db"."public_staging"."stg_movies"
where _id is not null
group by _id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:18:54.595704 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.033 seconds
[0m21:18:54.597532 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: ROLLBACK
[0m21:18:54.598317 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: Close
[0m21:18:54.599119 [info ] [Thread-1 (]: 10 of 10 PASS unique_stg_movies__id ............................................ [[32mPASS[0m in 0.08s]
[0m21:18:54.599819 [debug] [Thread-1 (]: Finished running node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:18:54.606504 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.046 seconds
[0m21:18:54.608618 [debug] [Thread-4 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: ROLLBACK
[0m21:18:54.609299 [debug] [Thread-4 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: Close
[0m21:18:54.610126 [info ] [Thread-4 (]: 9 of 10 PASS unique_stg_comments__id ........................................... [[32mPASS[0m in 0.09s]
[0m21:18:54.610877 [debug] [Thread-4 (]: Finished running node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:18:54.613827 [debug] [MainThread]: Using postgres connection "master"
[0m21:18:54.614383 [debug] [MainThread]: On master: BEGIN
[0m21:18:54.614815 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:18:54.624972 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m21:18:54.625657 [debug] [MainThread]: On master: COMMIT
[0m21:18:54.626254 [debug] [MainThread]: Using postgres connection "master"
[0m21:18:54.626691 [debug] [MainThread]: On master: COMMIT
[0m21:18:54.627352 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m21:18:54.627737 [debug] [MainThread]: On master: Close
[0m21:18:54.628545 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:18:54.629006 [debug] [MainThread]: Connection 'test.mongo_movies.not_null_stg_comments__id.3928158263' was properly closed.
[0m21:18:54.629453 [debug] [MainThread]: Connection 'test.mongo_movies.unique_stg_movies__id.8c3f08cf1c' was properly closed.
[0m21:18:54.629847 [debug] [MainThread]: Connection 'test.mongo_movies.not_null_stg_movies__id.66af63a991' was properly closed.
[0m21:18:54.630294 [debug] [MainThread]: Connection 'test.mongo_movies.unique_stg_comments__id.517cb0eade' was properly closed.
[0m21:18:54.630758 [info ] [MainThread]: 
[0m21:18:54.631286 [info ] [MainThread]: Finished running 10 data tests in 0 hours 0 minutes and 0.47 seconds (0.47s).
[0m21:18:54.633597 [debug] [MainThread]: Command end result
[0m21:18:54.667545 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m21:18:54.669598 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m21:18:54.675904 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m21:18:54.676379 [info ] [MainThread]: 
[0m21:18:54.676917 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:18:54.677339 [info ] [MainThread]: 
[0m21:18:54.677803 [error] [MainThread]: [31mFailure in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0 (models/schema.yml)[0m
[0m21:18:54.678243 [error] [MainThread]:   Database Error in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__count_0 (models/schema.yml)
  syntax error at or near "count"
  LINE 18: where not(total_comment_count count > 0)
                                         ^
  compiled code at target/run/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_3cd001263630cb35cc6c9670cf8db01f.sql
[0m21:18:54.678604 [info ] [MainThread]: 
[0m21:18:54.679015 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_3cd001263630cb35cc6c9670cf8db01f.sql
[0m21:18:54.679402 [info ] [MainThread]: 
[0m21:18:54.679791 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=10
[0m21:18:54.680804 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": false, "command_wall_clock_time": 1.894066, "process_in_blocks": "0", "process_kernel_time": 0.681411, "process_mem_max_rss": "134776", "process_out_blocks": "3896", "process_user_time": 3.086392}
[0m21:18:54.681291 [debug] [MainThread]: Command `dbt test` failed at 21:18:54.681162 after 1.89 seconds
[0m21:18:54.681683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790a46598380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790a40c84a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790a48dcd0a0>]}
[0m21:18:54.682093 [debug] [MainThread]: Flushing usage events
[0m21:18:55.982431 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:19:24.107781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaed7ccf290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaed88b3260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaed8a81ca0>]}


============================== 21:19:24.111787 | 027b7edb-0065-41b7-8970-b6f829684703 ==============================
[0m21:19:24.111787 [info ] [MainThread]: Running with dbt=1.10.6
[0m21:19:24.112471 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt test', 'send_anonymous_usage_stats': 'True'}
[0m21:19:39.828459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '027b7edb-0065-41b7-8970-b6f829684703', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaed7147590>]}
[0m21:19:39.939233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '027b7edb-0065-41b7-8970-b6f829684703', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaed7cce030>]}
[0m21:19:39.940317 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m21:19:24.568268 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m21:19:24.710391 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:19:24.711340 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/schema.yml
[0m21:19:25.382286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '027b7edb-0065-41b7-8970-b6f829684703', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaed41a3b90>]}
[0m21:19:25.469624 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m21:19:25.471574 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m21:19:25.494479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '027b7edb-0065-41b7-8970-b6f829684703', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaed5df52e0>]}
[0m21:19:25.495055 [info ] [MainThread]: Found 8 models, 10 data tests, 6 sources, 550 macros
[0m21:19:25.495452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '027b7edb-0065-41b7-8970-b6f829684703', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaed59ba600>]}
[0m21:19:25.497525 [info ] [MainThread]: 
[0m21:19:25.498123 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:19:25.498990 [info ] [MainThread]: 
[0m21:19:25.499660 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m21:19:25.504171 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_staging'
[0m21:19:25.505126 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_marts'
[0m21:19:25.550995 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m21:19:25.551585 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m21:19:25.552357 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m21:19:25.552990 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m21:19:25.553560 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:19:25.554012 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:19:25.568908 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m21:19:25.569644 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m21:19:25.570217 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m21:19:25.570769 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m21:19:25.571364 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m21:19:25.572049 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m21:19:25.578617 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.006 seconds
[0m21:19:25.579342 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.006 seconds
[0m21:19:25.581666 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m21:19:25.583921 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m21:19:25.584974 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m21:19:25.585682 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m21:19:25.595293 [debug] [MainThread]: Using postgres connection "master"
[0m21:19:25.595975 [debug] [MainThread]: On master: BEGIN
[0m21:19:25.596531 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:19:25.608556 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m21:19:25.609163 [debug] [MainThread]: Using postgres connection "master"
[0m21:19:25.609889 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m21:19:25.652426 [debug] [MainThread]: SQL status: SELECT 5 in 0.042 seconds
[0m21:19:25.654310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '027b7edb-0065-41b7-8970-b6f829684703', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaed596be90>]}
[0m21:19:25.654860 [debug] [MainThread]: On master: ROLLBACK
[0m21:19:25.655494 [debug] [MainThread]: Using postgres connection "master"
[0m21:19:25.655909 [debug] [MainThread]: On master: BEGIN
[0m21:19:25.656656 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m21:19:25.656995 [debug] [MainThread]: On master: COMMIT
[0m21:19:25.657470 [debug] [MainThread]: Using postgres connection "master"
[0m21:19:25.657944 [debug] [MainThread]: On master: COMMIT
[0m21:19:25.658670 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m21:19:25.659014 [debug] [MainThread]: On master: Close
[0m21:19:25.663866 [debug] [Thread-1 (]: Began running node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd
[0m21:19:25.664812 [debug] [Thread-2 (]: Began running node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:19:25.665498 [debug] [Thread-3 (]: Began running node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:19:25.666649 [debug] [Thread-4 (]: Began running node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:19:25.666202 [info ] [Thread-1 (]: 1 of 10 START test dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0  [RUN]
[0m21:19:25.667454 [info ] [Thread-2 (]: 2 of 10 START test not_null_comments_by_user_email ............................. [RUN]
[0m21:19:25.668104 [info ] [Thread-3 (]: 3 of 10 START test not_null_comments_by_user_name .............................. [RUN]
[0m21:19:25.668790 [info ] [Thread-4 (]: 4 of 10 START test not_null_genres_and_directors_with_good_comment_each_user_email  [RUN]
[0m21:19:25.669564 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd)
[0m21:19:25.670221 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now test.mongo_movies.not_null_comments_by_user_email.761242fc5c)
[0m21:19:25.670976 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.mongo_movies.not_null_comments_by_user_name.5e48cf6675'
[0m21:19:25.671628 [debug] [Thread-4 (]: Acquiring new postgres connection 'test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750'
[0m21:19:25.672267 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd
[0m21:19:25.672872 [debug] [Thread-2 (]: Began compiling node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:19:25.673406 [debug] [Thread-3 (]: Began compiling node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:19:25.673963 [debug] [Thread-4 (]: Began compiling node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:19:25.684336 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd"
[0m21:19:25.692608 [debug] [Thread-2 (]: Writing injected SQL for node "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:19:25.697113 [debug] [Thread-3 (]: Writing injected SQL for node "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:19:25.705020 [debug] [Thread-4 (]: Writing injected SQL for node "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:19:25.706614 [debug] [Thread-1 (]: Began executing node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd
[0m21:19:25.707617 [debug] [Thread-2 (]: Began executing node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:19:25.725703 [debug] [Thread-3 (]: Began executing node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:19:25.727131 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd"
[0m21:19:25.730012 [debug] [Thread-2 (]: Writing runtime sql for node "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:19:25.730631 [debug] [Thread-4 (]: Began executing node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:19:25.734023 [debug] [Thread-3 (]: Writing runtime sql for node "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:19:25.737423 [debug] [Thread-4 (]: Writing runtime sql for node "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:19:25.738256 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:19:25.738785 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd"
[0m21:19:25.739760 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: BEGIN
[0m21:19:25.740596 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:19:25.741115 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd: BEGIN
[0m21:19:25.741787 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:19:25.742187 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:19:25.742636 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: BEGIN
[0m21:19:25.743164 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:19:25.743595 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: BEGIN
[0m21:19:25.744386 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:19:25.745145 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:19:25.755371 [debug] [Thread-2 (]: SQL status: BEGIN in 0.013 seconds
[0m21:19:25.756270 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:19:25.756800 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m21:19:25.757604 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select email
from "test_db"."public_marts"."comments_by_user"
where email is null



  
  
      
    ) dbt_internal_test
[0m21:19:25.758478 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd"
[0m21:19:25.759054 [debug] [Thread-3 (]: SQL status: BEGIN in 0.014 seconds
[0m21:19:25.759660 [debug] [Thread-4 (]: SQL status: BEGIN in 0.015 seconds
[0m21:19:25.760355 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  



select
    1
from "test_db"."public_marts"."comments_by_user"

where not(total_comment_count total_comment_count > 0)


  
  
      
    ) dbt_internal_test
[0m21:19:25.760882 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:19:25.761501 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:19:25.761990 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.002 seconds
[0m21:19:25.762663 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select name
from "test_db"."public_marts"."comments_by_user"
where name is null



  
  
      
    ) dbt_internal_test
[0m21:19:25.763157 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "total_comment_count"
LINE 18: where not(total_comment_count total_comment_count > 0)
                                       ^

[0m21:19:25.763711 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select email
from "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user"
where email is null



  
  
      
    ) dbt_internal_test
[0m21:19:25.770325 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: ROLLBACK
[0m21:19:25.771113 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd: ROLLBACK
[0m21:19:25.772019 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: Close
[0m21:19:25.772949 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m21:19:25.773498 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.003 seconds
[0m21:19:25.774326 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd: Close
[0m21:19:25.775145 [info ] [Thread-2 (]: 2 of 10 PASS not_null_comments_by_user_email ................................... [[32mPASS[0m in 0.10s]
[0m21:19:25.777012 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: ROLLBACK
[0m21:19:25.779160 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: ROLLBACK
[0m21:19:25.780195 [debug] [Thread-2 (]: Finished running node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:19:25.782847 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: Close
[0m21:19:25.784518 [debug] [Thread-2 (]: Began running node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:19:25.785574 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: Close
[0m21:19:25.786833 [info ] [Thread-4 (]: 4 of 10 PASS not_null_genres_and_directors_with_good_comment_each_user_email ... [[32mPASS[0m in 0.12s]
[0m21:19:25.787867 [info ] [Thread-2 (]: 5 of 10 START test not_null_stg_comments__id ................................... [RUN]
[0m21:19:25.790655 [debug] [Thread-4 (]: Finished running node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:19:25.789687 [info ] [Thread-3 (]: 3 of 10 PASS not_null_comments_by_user_name .................................... [[32mPASS[0m in 0.12s]
[0m21:19:25.793100 [debug] [Thread-1 (]: Database Error in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0 (models/schema.yml)
  syntax error at or near "total_comment_count"
  LINE 18: where not(total_comment_count total_comment_count > 0)
                                         ^
  compiled code at target/run/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_fda3dc8cb8c3a1f3e87127391fb46e83.sql
[0m21:19:25.793906 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_comments_by_user_email.761242fc5c, now test.mongo_movies.not_null_stg_comments__id.3928158263)
[0m21:19:25.794941 [debug] [Thread-4 (]: Began running node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:19:25.796191 [debug] [Thread-3 (]: Finished running node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:19:25.797111 [error] [Thread-1 (]: 1 of 10 ERROR dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0  [[31mERROR[0m in 0.13s]
[0m21:19:25.797917 [debug] [Thread-2 (]: Began compiling node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:19:25.798410 [info ] [Thread-4 (]: 6 of 10 START test not_null_stg_movies__id ..................................... [RUN]
[0m21:19:25.799144 [debug] [Thread-3 (]: Began running node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:19:25.800036 [debug] [Thread-1 (]: Finished running node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd
[0m21:19:25.805752 [debug] [Thread-2 (]: Writing injected SQL for node "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:19:25.806705 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750, now test.mongo_movies.not_null_stg_movies__id.66af63a991)
[0m21:19:25.807572 [info ] [Thread-3 (]: 7 of 10 START test unique_comments_by_user__name___email_ ...................... [RUN]
[0m21:19:25.808472 [debug] [Thread-1 (]: Began running node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:19:25.809200 [debug] [Thread-7 (]: Marking all children of 'test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd' to be skipped because of status 'error'.  Reason: Database Error in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0 (models/schema.yml)
  syntax error at or near "total_comment_count"
  LINE 18: where not(total_comment_count total_comment_count > 0)
                                         ^
  compiled code at target/run/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_fda3dc8cb8c3a1f3e87127391fb46e83.sql.
[0m21:19:25.810012 [debug] [Thread-4 (]: Began compiling node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:19:25.810628 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_comments_by_user_name.5e48cf6675, now test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71)
[0m21:19:25.811116 [debug] [Thread-2 (]: Began executing node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:19:25.811531 [info ] [Thread-1 (]: 8 of 10 START test unique_genres_and_directors_with_good_comment_each_user_email  [RUN]
[0m21:19:25.818384 [debug] [Thread-4 (]: Writing injected SQL for node "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:19:25.819302 [debug] [Thread-3 (]: Began compiling node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:19:25.821954 [debug] [Thread-2 (]: Writing runtime sql for node "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:19:25.822866 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd, now test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24)
[0m21:19:25.831303 [debug] [Thread-3 (]: Writing injected SQL for node "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:19:25.832273 [debug] [Thread-4 (]: Began executing node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:19:25.832876 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:19:25.833759 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:19:25.839104 [debug] [Thread-4 (]: Writing runtime sql for node "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:19:25.843230 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:19:25.843896 [debug] [Thread-3 (]: Began executing node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:19:25.844485 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: BEGIN
[0m21:19:25.847297 [debug] [Thread-3 (]: Writing runtime sql for node "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:19:25.847798 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:19:25.848257 [debug] [Thread-1 (]: Began executing node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:19:25.848642 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:19:25.849522 [debug] [Thread-4 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: BEGIN
[0m21:19:25.850139 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:19:25.852548 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:19:25.853315 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:19:25.853815 [debug] [Thread-3 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: BEGIN
[0m21:19:25.854919 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:19:25.855449 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:19:25.856166 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: BEGIN
[0m21:19:25.856677 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:19:25.863649 [debug] [Thread-2 (]: SQL status: BEGIN in 0.015 seconds
[0m21:19:25.864322 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:19:25.864819 [debug] [Thread-4 (]: SQL status: BEGIN in 0.012 seconds
[0m21:19:25.865440 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_stg_comments__id.3928158263"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select _id
from "test_db"."public_staging"."stg_comments"
where _id is null



  
  
      
    ) dbt_internal_test
[0m21:19:25.866293 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:19:25.866992 [debug] [Thread-3 (]: SQL status: BEGIN in 0.012 seconds
[0m21:19:25.868035 [debug] [Thread-4 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_stg_movies__id.66af63a991"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select _id
from "test_db"."public_staging"."stg_movies"
where _id is null



  
  
      
    ) dbt_internal_test
[0m21:19:25.868576 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m21:19:25.869102 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:19:25.869944 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:19:25.870585 [debug] [Thread-3 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    (name || '_' || email) as unique_field,
    count(*) as n_records

from "test_db"."public_marts"."comments_by_user"
where (name || '_' || email) is not null
group by (name || '_' || email)
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:19:25.871205 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    email as unique_field,
    count(*) as n_records

from "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user"
where email is not null
group by email
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:19:25.873886 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m21:19:25.874720 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.003 seconds
[0m21:19:25.876682 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: ROLLBACK
[0m21:19:25.878759 [debug] [Thread-3 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: ROLLBACK
[0m21:19:25.879610 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: Close
[0m21:19:25.880121 [debug] [Thread-3 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: Close
[0m21:19:25.881164 [info ] [Thread-1 (]: 8 of 10 PASS unique_genres_and_directors_with_good_comment_each_user_email ..... [[32mPASS[0m in 0.06s]
[0m21:19:25.883759 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.016 seconds
[0m21:19:25.882697 [info ] [Thread-3 (]: 7 of 10 PASS unique_comments_by_user__name___email_ ............................ [[32mPASS[0m in 0.07s]
[0m21:19:25.884973 [debug] [Thread-1 (]: Finished running node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:19:25.886997 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: ROLLBACK
[0m21:19:25.887854 [debug] [Thread-3 (]: Finished running node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:19:25.888412 [debug] [Thread-1 (]: Began running node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:19:25.889011 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.019 seconds
[0m21:19:25.889829 [debug] [Thread-3 (]: Began running node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:19:25.890312 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: Close
[0m21:19:25.890874 [info ] [Thread-1 (]: 9 of 10 START test unique_stg_comments__id ..................................... [RUN]
[0m21:19:25.892416 [debug] [Thread-4 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: ROLLBACK
[0m21:19:25.892890 [info ] [Thread-3 (]: 10 of 10 START test unique_stg_movies__id ...................................... [RUN]
[0m21:19:25.893762 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24, now test.mongo_movies.unique_stg_comments__id.517cb0eade)
[0m21:19:25.894504 [info ] [Thread-2 (]: 5 of 10 PASS not_null_stg_comments__id ......................................... [[32mPASS[0m in 0.10s]
[0m21:19:25.895243 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71, now test.mongo_movies.unique_stg_movies__id.8c3f08cf1c)
[0m21:19:25.895690 [debug] [Thread-4 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: Close
[0m21:19:25.896197 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:19:25.896926 [debug] [Thread-2 (]: Finished running node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:19:25.897613 [debug] [Thread-3 (]: Began compiling node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:19:25.904574 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:19:25.903873 [info ] [Thread-4 (]: 6 of 10 PASS not_null_stg_movies__id ........................................... [[32mPASS[0m in 0.10s]
[0m21:19:25.912353 [debug] [Thread-3 (]: Writing injected SQL for node "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:19:25.913485 [debug] [Thread-4 (]: Finished running node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:19:25.915247 [debug] [Thread-3 (]: Began executing node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:19:25.915948 [debug] [Thread-1 (]: Began executing node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:19:25.919002 [debug] [Thread-3 (]: Writing runtime sql for node "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:19:25.922471 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:19:25.924048 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:19:25.924829 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:19:25.925702 [debug] [Thread-3 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: BEGIN
[0m21:19:25.926287 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: BEGIN
[0m21:19:25.926811 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:19:25.927347 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:19:25.938138 [debug] [Thread-3 (]: SQL status: BEGIN in 0.011 seconds
[0m21:19:25.939021 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:19:25.939684 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m21:19:25.940510 [debug] [Thread-3 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    _id as unique_field,
    count(*) as n_records

from "test_db"."public_staging"."stg_movies"
where _id is not null
group by _id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:19:25.941191 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:19:25.942038 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_stg_comments__id.517cb0eade"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    _id as unique_field,
    count(*) as n_records

from "test_db"."public_staging"."stg_comments"
where _id is not null
group by _id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:19:25.976974 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.035 seconds
[0m21:19:25.979446 [debug] [Thread-3 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: ROLLBACK
[0m21:19:25.980448 [debug] [Thread-3 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: Close
[0m21:19:25.981708 [info ] [Thread-3 (]: 10 of 10 PASS unique_stg_movies__id ............................................ [[32mPASS[0m in 0.09s]
[0m21:19:25.982774 [debug] [Thread-3 (]: Finished running node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:19:25.995907 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.053 seconds
[0m21:19:25.998130 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: ROLLBACK
[0m21:19:25.998933 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: Close
[0m21:19:26.000081 [info ] [Thread-1 (]: 9 of 10 PASS unique_stg_comments__id ........................................... [[32mPASS[0m in 0.11s]
[0m21:19:26.001086 [debug] [Thread-1 (]: Finished running node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:19:26.004029 [debug] [MainThread]: Using postgres connection "master"
[0m21:19:26.004652 [debug] [MainThread]: On master: BEGIN
[0m21:19:26.005207 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:19:26.017400 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m21:19:26.018192 [debug] [MainThread]: On master: COMMIT
[0m21:19:26.018848 [debug] [MainThread]: Using postgres connection "master"
[0m21:19:26.019371 [debug] [MainThread]: On master: COMMIT
[0m21:19:26.020200 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m21:19:26.020711 [debug] [MainThread]: On master: Close
[0m21:19:26.022056 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:19:26.022669 [debug] [MainThread]: Connection 'test.mongo_movies.not_null_stg_comments__id.3928158263' was properly closed.
[0m21:19:26.023305 [debug] [MainThread]: Connection 'test.mongo_movies.unique_stg_comments__id.517cb0eade' was properly closed.
[0m21:19:26.023880 [debug] [MainThread]: Connection 'test.mongo_movies.unique_stg_movies__id.8c3f08cf1c' was properly closed.
[0m21:19:26.024340 [debug] [MainThread]: Connection 'test.mongo_movies.not_null_stg_movies__id.66af63a991' was properly closed.
[0m21:19:26.024937 [info ] [MainThread]: 
[0m21:19:26.025632 [info ] [MainThread]: Finished running 10 data tests in 0 hours 0 minutes and 0.53 seconds (0.53s).
[0m21:19:26.028860 [debug] [MainThread]: Command end result
[0m21:19:26.074243 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m21:19:26.076701 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m21:19:26.086054 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m21:19:26.086733 [info ] [MainThread]: 
[0m21:19:26.087346 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:19:26.087893 [info ] [MainThread]: 
[0m21:19:26.088525 [error] [MainThread]: [31mFailure in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0 (models/schema.yml)[0m
[0m21:19:26.089213 [error] [MainThread]:   Database Error in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0 (models/schema.yml)
  syntax error at or near "total_comment_count"
  LINE 18: where not(total_comment_count total_comment_count > 0)
                                         ^
  compiled code at target/run/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_fda3dc8cb8c3a1f3e87127391fb46e83.sql
[0m21:19:26.089779 [info ] [MainThread]: 
[0m21:19:26.090410 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_fda3dc8cb8c3a1f3e87127391fb46e83.sql
[0m21:19:26.090923 [info ] [MainThread]: 
[0m21:19:26.091352 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=10
[0m21:19:26.092620 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": false, "command_wall_clock_time": 2.061752, "process_in_blocks": "0", "process_kernel_time": 0.677596, "process_mem_max_rss": "134224", "process_out_blocks": "3896", "process_user_time": 3.443785}
[0m21:19:26.093143 [debug] [MainThread]: Command `dbt test` failed at 21:19:26.093034 after 2.06 seconds
[0m21:19:26.093642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaed81a88f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaed87ad0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaed59733b0>]}
[0m21:19:26.094041 [debug] [MainThread]: Flushing usage events
[0m21:19:27.475827 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:23:58.911126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7012c4c54950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7012c4c57b30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7012c459ee40>]}


============================== 21:23:58.914872 | 81844ed6-b454-48bd-85c0-9379d3d54124 ==============================
[0m21:23:58.914872 [info ] [MainThread]: Running with dbt=1.10.6
[0m21:23:58.915743 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt test', 'send_anonymous_usage_stats': 'True'}
[0m21:23:59.155949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '81844ed6-b454-48bd-85c0-9379d3d54124', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7012c435b4d0>]}
[0m21:23:59.250482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '81844ed6-b454-48bd-85c0-9379d3d54124', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7012c5394fe0>]}
[0m21:23:59.251352 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m21:23:59.362832 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m21:23:59.512307 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:23:59.512758 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:23:59.562329 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '81844ed6-b454-48bd-85c0-9379d3d54124', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7012c391a060>]}
[0m21:23:59.666594 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m21:23:59.668846 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m21:24:15.190902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '81844ed6-b454-48bd-85c0-9379d3d54124', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7012c29cb050>]}
[0m21:24:15.191523 [info ] [MainThread]: Found 8 models, 10 data tests, 6 sources, 550 macros
[0m21:24:15.191978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '81844ed6-b454-48bd-85c0-9379d3d54124', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7012c3525010>]}
[0m21:24:15.194437 [info ] [MainThread]: 
[0m21:24:15.195068 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:24:15.195628 [info ] [MainThread]: 
[0m21:24:15.196234 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m21:24:15.201453 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_staging'
[0m21:24:15.202484 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_marts'
[0m21:24:15.251351 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m21:24:15.251784 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m21:24:15.252414 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m21:24:15.253144 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m21:24:15.253621 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:24:15.254025 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:24:15.268968 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m21:24:15.269616 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m21:24:15.270092 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m21:24:15.270508 [debug] [ThreadPool]: SQL status: BEGIN in 0.017 seconds
[0m21:24:15.271080 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m21:24:15.271467 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m21:24:15.274578 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.004 seconds
[0m21:24:15.276961 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m21:24:15.277452 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.006 seconds
[0m21:24:15.278890 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m21:24:15.279214 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m21:24:15.279794 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m21:24:15.286602 [debug] [MainThread]: Using postgres connection "master"
[0m21:24:15.286982 [debug] [MainThread]: On master: BEGIN
[0m21:24:15.287296 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:24:15.296334 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m21:24:15.296758 [debug] [MainThread]: Using postgres connection "master"
[0m21:24:15.297232 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m21:24:15.330693 [debug] [MainThread]: SQL status: SELECT 5 in 0.033 seconds
[0m21:24:15.332289 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '81844ed6-b454-48bd-85c0-9379d3d54124', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7012c255d2b0>]}
[0m21:24:15.332807 [debug] [MainThread]: On master: ROLLBACK
[0m21:24:15.333519 [debug] [MainThread]: Using postgres connection "master"
[0m21:24:15.333858 [debug] [MainThread]: On master: BEGIN
[0m21:24:15.334569 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m21:24:15.334898 [debug] [MainThread]: On master: COMMIT
[0m21:24:15.335221 [debug] [MainThread]: Using postgres connection "master"
[0m21:24:15.335527 [debug] [MainThread]: On master: COMMIT
[0m21:24:15.336023 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m21:24:15.336368 [debug] [MainThread]: On master: Close
[0m21:24:15.340803 [debug] [Thread-1 (]: Began running node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd
[0m21:24:15.341445 [debug] [Thread-2 (]: Began running node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:24:15.342005 [debug] [Thread-3 (]: Began running node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:24:15.343055 [debug] [Thread-4 (]: Began running node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:24:15.342485 [info ] [Thread-1 (]: 1 of 10 START test dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0  [RUN]
[0m21:24:15.343705 [info ] [Thread-2 (]: 2 of 10 START test not_null_comments_by_user_email ............................. [RUN]
[0m21:24:15.344420 [info ] [Thread-3 (]: 3 of 10 START test not_null_comments_by_user_name .............................. [RUN]
[0m21:24:15.345335 [info ] [Thread-4 (]: 4 of 10 START test not_null_genres_and_directors_with_good_comment_each_user_email  [RUN]
[0m21:24:15.346001 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd)
[0m21:24:15.346854 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now test.mongo_movies.not_null_comments_by_user_email.761242fc5c)
[0m21:24:15.347462 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.mongo_movies.not_null_comments_by_user_name.5e48cf6675'
[0m21:24:15.348019 [debug] [Thread-4 (]: Acquiring new postgres connection 'test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750'
[0m21:24:15.348482 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd
[0m21:24:15.348976 [debug] [Thread-2 (]: Began compiling node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:24:15.349752 [debug] [Thread-3 (]: Began compiling node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:24:15.350600 [debug] [Thread-4 (]: Began compiling node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:24:15.382922 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd"
[0m21:24:15.383528 [debug] [Thread-2 (]: Writing injected SQL for node "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:23:59.895373 [debug] [Thread-3 (]: Writing injected SQL for node "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:23:59.900270 [debug] [Thread-4 (]: Writing injected SQL for node "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:23:59.902524 [debug] [Thread-1 (]: Began executing node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd
[0m21:23:59.903577 [debug] [Thread-3 (]: Began executing node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:23:59.904208 [debug] [Thread-2 (]: Began executing node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:23:59.910022 [debug] [Thread-4 (]: Began executing node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:23:59.930499 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd"
[0m21:23:59.933149 [debug] [Thread-3 (]: Writing runtime sql for node "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:23:59.936478 [debug] [Thread-2 (]: Writing runtime sql for node "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:23:59.939158 [debug] [Thread-4 (]: Writing runtime sql for node "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:23:59.940774 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd"
[0m21:23:59.941900 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:23:59.942576 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:23:59.943168 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd: BEGIN
[0m21:23:59.943652 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:23:59.944206 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: BEGIN
[0m21:23:59.944727 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: BEGIN
[0m21:23:59.945247 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:23:59.945779 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: BEGIN
[0m21:23:59.946284 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:23:59.946800 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:23:59.947567 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:23:59.960275 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m21:23:59.960955 [debug] [Thread-3 (]: SQL status: BEGIN in 0.015 seconds
[0m21:23:59.961595 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd"
[0m21:23:59.962311 [debug] [Thread-2 (]: SQL status: BEGIN in 0.015 seconds
[0m21:23:59.962950 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:23:59.963458 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  



select
    1
from "test_db"."public_marts"."comments_by_user"

where not(total_comment_count total_comment_count > 0)


  
  
      
    ) dbt_internal_test
[0m21:23:59.964177 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:23:59.964864 [debug] [Thread-4 (]: SQL status: BEGIN in 0.017 seconds
[0m21:23:59.965476 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select name
from "test_db"."public_marts"."comments_by_user"
where name is null



  
  
      
    ) dbt_internal_test
[0m21:23:59.966236 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select email
from "test_db"."public_marts"."comments_by_user"
where email is null



  
  
      
    ) dbt_internal_test
[0m21:23:59.966785 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "total_comment_count"
LINE 18: where not(total_comment_count total_comment_count > 0)
                                       ^

[0m21:23:59.967287 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:23:59.968169 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd: ROLLBACK
[0m21:23:59.968970 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select email
from "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user"
where email is null



  
  
      
    ) dbt_internal_test
[0m21:23:59.969961 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.002 seconds
[0m21:23:59.970455 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.003 seconds
[0m21:23:59.971358 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd: Close
[0m21:23:59.976164 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: ROLLBACK
[0m21:23:59.976833 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.006 seconds
[0m21:23:59.978238 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: ROLLBACK
[0m21:23:59.980979 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: Close
[0m21:23:59.983152 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: ROLLBACK
[0m21:23:59.987003 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: Close
[0m21:23:59.986406 [info ] [Thread-2 (]: 2 of 10 PASS not_null_comments_by_user_email ................................... [[32mPASS[0m in -15.36s]
[0m21:23:59.988475 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: Close
[0m21:23:59.990126 [info ] [Thread-3 (]: 3 of 10 PASS not_null_comments_by_user_name .................................... [[32mPASS[0m in -15.36s]
[0m21:23:59.991391 [debug] [Thread-2 (]: Finished running node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:23:59.995003 [debug] [Thread-1 (]: Database Error in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0 (models/schema.yml)
  syntax error at or near "total_comment_count"
  LINE 18: where not(total_comment_count total_comment_count > 0)
                                         ^
  compiled code at target/run/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_fda3dc8cb8c3a1f3e87127391fb46e83.sql
[0m21:23:59.997013 [debug] [Thread-3 (]: Finished running node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:23:59.996127 [info ] [Thread-4 (]: 4 of 10 PASS not_null_genres_and_directors_with_good_comment_each_user_email ... [[32mPASS[0m in -15.35s]
[0m21:23:59.997994 [debug] [Thread-2 (]: Began running node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:23:59.998843 [error] [Thread-1 (]: 1 of 10 ERROR dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0  [[31mERROR[0m in -15.35s]
[0m21:23:59.999548 [debug] [Thread-3 (]: Began running node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:24:00.000439 [debug] [Thread-4 (]: Finished running node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:24:00.000960 [info ] [Thread-2 (]: 5 of 10 START test not_null_stg_comments__id ................................... [RUN]
[0m21:24:00.001806 [debug] [Thread-1 (]: Finished running node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd
[0m21:24:00.002388 [info ] [Thread-3 (]: 6 of 10 START test not_null_stg_movies__id ..................................... [RUN]
[0m21:24:00.003327 [debug] [Thread-4 (]: Began running node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:24:00.004297 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_comments_by_user_email.761242fc5c, now test.mongo_movies.not_null_stg_comments__id.3928158263)
[0m21:24:00.005067 [debug] [Thread-1 (]: Began running node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:24:00.005904 [debug] [Thread-7 (]: Marking all children of 'test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd' to be skipped because of status 'error'.  Reason: Database Error in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0 (models/schema.yml)
  syntax error at or near "total_comment_count"
  LINE 18: where not(total_comment_count total_comment_count > 0)
                                         ^
  compiled code at target/run/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_fda3dc8cb8c3a1f3e87127391fb46e83.sql.
[0m21:24:00.006526 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_comments_by_user_name.5e48cf6675, now test.mongo_movies.not_null_stg_movies__id.66af63a991)
[0m21:24:00.007299 [info ] [Thread-4 (]: 7 of 10 START test unique_comments_by_user__name___email_ ...................... [RUN]
[0m21:24:00.008120 [debug] [Thread-2 (]: Began compiling node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:24:00.008732 [info ] [Thread-1 (]: 8 of 10 START test unique_genres_and_directors_with_good_comment_each_user_email  [RUN]
[0m21:24:00.010651 [debug] [Thread-3 (]: Began compiling node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:24:00.011566 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750, now test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71)
[0m21:24:00.018920 [debug] [Thread-2 (]: Writing injected SQL for node "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:24:00.019952 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd, now test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24)
[0m21:24:00.026770 [debug] [Thread-3 (]: Writing injected SQL for node "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:24:00.027661 [debug] [Thread-4 (]: Began compiling node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:24:00.028901 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:24:00.030451 [debug] [Thread-2 (]: Began executing node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:24:00.044093 [debug] [Thread-4 (]: Writing injected SQL for node "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:24:00.044676 [debug] [Thread-3 (]: Began executing node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:24:00.122383 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:24:00.124881 [debug] [Thread-2 (]: Writing runtime sql for node "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:24:00.127690 [debug] [Thread-3 (]: Writing runtime sql for node "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:24:00.128333 [debug] [Thread-4 (]: Began executing node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:24:00.130012 [debug] [Thread-1 (]: Began executing node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:24:00.130752 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:24:00.133192 [debug] [Thread-4 (]: Writing runtime sql for node "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:24:00.133857 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:24:00.136290 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:24:00.137157 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: BEGIN
[0m21:24:00.138043 [debug] [Thread-3 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: BEGIN
[0m21:24:00.138946 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:24:00.139506 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:24:00.140212 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:24:00.140687 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:24:00.141186 [debug] [Thread-4 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: BEGIN
[0m21:24:00.141861 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: BEGIN
[0m21:24:00.142589 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:24:00.143108 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:24:00.150910 [debug] [Thread-2 (]: SQL status: BEGIN in 0.011 seconds
[0m21:24:00.151628 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:24:00.152343 [debug] [Thread-3 (]: SQL status: BEGIN in 0.012 seconds
[0m21:24:00.152897 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_stg_comments__id.3928158263"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select _id
from "test_db"."public_staging"."stg_comments"
where _id is null



  
  
      
    ) dbt_internal_test
[0m21:24:00.153854 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:24:00.154474 [debug] [Thread-4 (]: SQL status: BEGIN in 0.012 seconds
[0m21:24:00.155203 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m21:24:00.155825 [debug] [Thread-3 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_stg_movies__id.66af63a991"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select _id
from "test_db"."public_staging"."stg_movies"
where _id is null



  
  
      
    ) dbt_internal_test
[0m21:24:00.156447 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:24:00.157015 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:24:00.157649 [debug] [Thread-4 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    (name || '_' || email) as unique_field,
    count(*) as n_records

from "test_db"."public_marts"."comments_by_user"
where (name || '_' || email) is not null
group by (name || '_' || email)
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:24:00.158176 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    email as unique_field,
    count(*) as n_records

from "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user"
where email is not null
group by email
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:24:00.160128 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.001 seconds
[0m21:24:00.160594 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.002 seconds
[0m21:24:00.162223 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: ROLLBACK
[0m21:24:00.163752 [debug] [Thread-4 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: ROLLBACK
[0m21:24:00.164515 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: Close
[0m21:24:00.164959 [debug] [Thread-4 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: Close
[0m21:24:00.166062 [info ] [Thread-1 (]: 8 of 10 PASS unique_genres_and_directors_with_good_comment_each_user_email ..... [[32mPASS[0m in 0.15s]
[0m21:24:00.166611 [info ] [Thread-4 (]: 7 of 10 PASS unique_comments_by_user__name___email_ ............................ [[32mPASS[0m in 0.16s]
[0m21:24:00.167608 [debug] [Thread-1 (]: Finished running node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:24:00.168368 [debug] [Thread-4 (]: Finished running node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:24:00.168991 [debug] [Thread-1 (]: Began running node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:24:00.169819 [debug] [Thread-4 (]: Began running node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:24:00.170507 [info ] [Thread-1 (]: 9 of 10 START test unique_stg_comments__id ..................................... [RUN]
[0m21:24:00.171215 [info ] [Thread-4 (]: 10 of 10 START test unique_stg_movies__id ...................................... [RUN]
[0m21:24:00.172137 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24, now test.mongo_movies.unique_stg_comments__id.517cb0eade)
[0m21:24:00.172692 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71, now test.mongo_movies.unique_stg_movies__id.8c3f08cf1c)
[0m21:24:00.173322 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:24:00.173960 [debug] [Thread-4 (]: Began compiling node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:24:00.178553 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:24:00.179411 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.024 seconds
[0m21:24:00.184761 [debug] [Thread-4 (]: Writing injected SQL for node "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:24:00.187423 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: ROLLBACK
[0m21:24:00.188237 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.031 seconds
[0m21:24:00.189007 [debug] [Thread-1 (]: Began executing node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:24:00.189758 [debug] [Thread-4 (]: Began executing node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:24:00.191401 [debug] [Thread-3 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: ROLLBACK
[0m21:24:00.191956 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: Close
[0m21:24:00.194805 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:24:00.197211 [debug] [Thread-4 (]: Writing runtime sql for node "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:24:00.198094 [debug] [Thread-3 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: Close
[0m21:24:00.198841 [info ] [Thread-2 (]: 5 of 10 PASS not_null_stg_comments__id ......................................... [[32mPASS[0m in 0.19s]
[0m21:24:00.201449 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:24:00.200775 [info ] [Thread-3 (]: 6 of 10 PASS not_null_stg_movies__id ........................................... [[32mPASS[0m in 0.19s]
[0m21:24:00.202523 [debug] [Thread-2 (]: Finished running node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:24:00.202943 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:24:00.203407 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: BEGIN
[0m21:24:00.204102 [debug] [Thread-3 (]: Finished running node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:24:00.204969 [debug] [Thread-4 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: BEGIN
[0m21:24:00.205519 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:24:00.206274 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:24:00.215775 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m21:24:00.216487 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:24:00.217285 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_stg_comments__id.517cb0eade"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    _id as unique_field,
    count(*) as n_records

from "test_db"."public_staging"."stg_comments"
where _id is not null
group by _id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:24:00.217718 [debug] [Thread-4 (]: SQL status: BEGIN in 0.011 seconds
[0m21:24:00.218358 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:24:00.218788 [debug] [Thread-4 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    _id as unique_field,
    count(*) as n_records

from "test_db"."public_staging"."stg_movies"
where _id is not null
group by _id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:24:00.245929 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.027 seconds
[0m21:24:00.247735 [debug] [Thread-4 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: ROLLBACK
[0m21:24:00.248473 [debug] [Thread-4 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: Close
[0m21:24:00.249299 [info ] [Thread-4 (]: 10 of 10 PASS unique_stg_movies__id ............................................ [[32mPASS[0m in 0.08s]
[0m21:24:00.250004 [debug] [Thread-4 (]: Finished running node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:24:00.255898 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.038 seconds
[0m21:24:00.258168 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: ROLLBACK
[0m21:24:00.258978 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: Close
[0m21:24:00.259758 [info ] [Thread-1 (]: 9 of 10 PASS unique_stg_comments__id ........................................... [[32mPASS[0m in 0.09s]
[0m21:24:00.260513 [debug] [Thread-1 (]: Finished running node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:24:00.263036 [debug] [MainThread]: Using postgres connection "master"
[0m21:24:00.263375 [debug] [MainThread]: On master: BEGIN
[0m21:24:00.263696 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:24:00.273452 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m21:24:00.273970 [debug] [MainThread]: On master: COMMIT
[0m21:24:00.274366 [debug] [MainThread]: Using postgres connection "master"
[0m21:24:00.274721 [debug] [MainThread]: On master: COMMIT
[0m21:24:00.275534 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m21:24:00.276184 [debug] [MainThread]: On master: Close
[0m21:24:00.277063 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:24:00.277430 [debug] [MainThread]: Connection 'test.mongo_movies.unique_stg_comments__id.517cb0eade' was properly closed.
[0m21:24:00.277845 [debug] [MainThread]: Connection 'test.mongo_movies.not_null_stg_comments__id.3928158263' was properly closed.
[0m21:24:00.278162 [debug] [MainThread]: Connection 'test.mongo_movies.not_null_stg_movies__id.66af63a991' was properly closed.
[0m21:24:00.278450 [debug] [MainThread]: Connection 'test.mongo_movies.unique_stg_movies__id.8c3f08cf1c' was properly closed.
[0m21:24:00.278844 [info ] [MainThread]: 
[0m21:24:00.279316 [info ] [MainThread]: Finished running 10 data tests in -1 hours 59 minutes and 45.08 seconds (-14.92s).
[0m21:24:00.281178 [debug] [MainThread]: Command end result
[0m21:24:00.310879 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m21:24:00.313016 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m21:24:00.319952 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m21:24:00.320554 [info ] [MainThread]: 
[0m21:24:00.321109 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:24:00.321594 [info ] [MainThread]: 
[0m21:24:00.322088 [error] [MainThread]: [31mFailure in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0 (models/schema.yml)[0m
[0m21:24:00.322548 [error] [MainThread]:   Database Error in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0 (models/schema.yml)
  syntax error at or near "total_comment_count"
  LINE 18: where not(total_comment_count total_comment_count > 0)
                                         ^
  compiled code at target/run/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_fda3dc8cb8c3a1f3e87127391fb46e83.sql
[0m21:24:00.322921 [info ] [MainThread]: 
[0m21:24:00.323345 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_fda3dc8cb8c3a1f3e87127391fb46e83.sql
[0m21:24:00.323739 [info ] [MainThread]: 
[0m21:24:00.324198 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=10
[0m21:24:00.325252 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": false, "command_wall_clock_time": 1.4900899, "process_in_blocks": "0", "process_kernel_time": 0.583602, "process_mem_max_rss": "128076", "process_out_blocks": "2712", "process_user_time": 2.785191}
[0m21:24:00.325740 [debug] [MainThread]: Command `dbt test` failed at 21:24:00.325636 after 1.49 seconds
[0m21:24:00.326134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7012c51b0a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7012c2ded4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7012c2ded490>]}
[0m21:24:00.326522 [debug] [MainThread]: Flushing usage events
[0m21:24:01.654739 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:27:51.191930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7700f32422d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7700f0a382f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7700f0ffb710>]}


============================== 21:27:51.199426 | bd39ec60-9e8b-4b75-a99f-1ebde18a1b31 ==============================
[0m21:27:51.199426 [info ] [MainThread]: Running with dbt=1.10.6
[0m21:27:51.200061 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt test', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:27:51.517542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bd39ec60-9e8b-4b75-a99f-1ebde18a1b31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7700f012c710>]}
[0m21:27:51.611946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bd39ec60-9e8b-4b75-a99f-1ebde18a1b31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7700f0117230>]}
[0m21:27:51.613214 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m21:27:51.723455 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m21:27:51.926549 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:27:51.927506 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/schema.yml
[0m21:27:52.031343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bd39ec60-9e8b-4b75-a99f-1ebde18a1b31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7700ee90f830>]}
[0m21:27:52.125407 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m21:27:52.127781 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m21:27:52.165326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bd39ec60-9e8b-4b75-a99f-1ebde18a1b31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7700ef961730>]}
[0m21:27:52.165926 [info ] [MainThread]: Found 8 models, 10 data tests, 6 sources, 550 macros
[0m21:27:52.166566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bd39ec60-9e8b-4b75-a99f-1ebde18a1b31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7700ee9a31a0>]}
[0m21:27:52.169417 [info ] [MainThread]: 
[0m21:27:52.170007 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:27:52.170569 [info ] [MainThread]: 
[0m21:27:52.171440 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m21:27:52.176427 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_staging'
[0m21:27:52.177795 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_marts'
[0m21:27:52.232219 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m21:27:52.232813 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m21:27:52.233397 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m21:27:52.233869 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m21:27:52.234351 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:27:52.234877 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:27:52.259082 [debug] [ThreadPool]: SQL status: BEGIN in 0.025 seconds
[0m21:27:52.259702 [debug] [ThreadPool]: SQL status: BEGIN in 0.025 seconds
[0m21:27:52.260171 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m21:27:52.260643 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m21:27:52.261097 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m21:27:52.261570 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m21:27:52.267079 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.005 seconds
[0m21:27:52.267642 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.005 seconds
[0m21:27:52.269127 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m21:27:52.270923 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m21:27:52.272000 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m21:27:52.272395 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m21:27:52.280226 [debug] [MainThread]: Using postgres connection "master"
[0m21:27:52.280721 [debug] [MainThread]: On master: BEGIN
[0m21:27:52.281136 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:27:52.291601 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m21:27:52.292531 [debug] [MainThread]: Using postgres connection "master"
[0m21:27:52.293020 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m21:27:52.325407 [debug] [MainThread]: SQL status: SELECT 5 in 0.032 seconds
[0m21:27:52.326939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bd39ec60-9e8b-4b75-a99f-1ebde18a1b31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7700f0159130>]}
[0m21:27:52.327527 [debug] [MainThread]: On master: ROLLBACK
[0m21:27:52.328144 [debug] [MainThread]: Using postgres connection "master"
[0m21:27:52.328491 [debug] [MainThread]: On master: BEGIN
[0m21:27:52.329354 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m21:27:52.329894 [debug] [MainThread]: On master: COMMIT
[0m21:27:52.330230 [debug] [MainThread]: Using postgres connection "master"
[0m21:27:52.330545 [debug] [MainThread]: On master: COMMIT
[0m21:27:52.331091 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m21:27:52.331425 [debug] [MainThread]: On master: Close
[0m21:27:52.335979 [debug] [Thread-1 (]: Began running node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd
[0m21:27:52.336520 [debug] [Thread-2 (]: Began running node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:27:52.336993 [debug] [Thread-3 (]: Began running node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:27:52.338158 [debug] [Thread-4 (]: Began running node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:27:52.337472 [info ] [Thread-1 (]: 1 of 10 START test dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0  [RUN]
[0m21:27:52.338958 [info ] [Thread-2 (]: 2 of 10 START test not_null_comments_by_user_email ............................. [RUN]
[0m21:27:52.339507 [info ] [Thread-3 (]: 3 of 10 START test not_null_comments_by_user_name .............................. [RUN]
[0m21:27:52.340149 [info ] [Thread-4 (]: 4 of 10 START test not_null_genres_and_directors_with_good_comment_each_user_email  [RUN]
[0m21:27:52.340768 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd)
[0m21:27:52.341263 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now test.mongo_movies.not_null_comments_by_user_email.761242fc5c)
[0m21:27:52.341832 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.mongo_movies.not_null_comments_by_user_name.5e48cf6675'
[0m21:27:52.342350 [debug] [Thread-4 (]: Acquiring new postgres connection 'test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750'
[0m21:27:52.342868 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd
[0m21:27:52.343348 [debug] [Thread-2 (]: Began compiling node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:27:52.343848 [debug] [Thread-3 (]: Began compiling node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:27:52.344338 [debug] [Thread-4 (]: Began compiling node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:27:52.373702 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd"
[0m21:27:52.377960 [debug] [Thread-2 (]: Writing injected SQL for node "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:27:52.451991 [debug] [Thread-3 (]: Writing injected SQL for node "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:27:52.456325 [debug] [Thread-4 (]: Writing injected SQL for node "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:27:52.458229 [debug] [Thread-1 (]: Began executing node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd
[0m21:27:52.464534 [debug] [Thread-2 (]: Began executing node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:27:52.477677 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd"
[0m21:27:52.478321 [debug] [Thread-3 (]: Began executing node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:27:52.480735 [debug] [Thread-2 (]: Writing runtime sql for node "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:27:52.481319 [debug] [Thread-4 (]: Began executing node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:27:52.483815 [debug] [Thread-3 (]: Writing runtime sql for node "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:27:52.484646 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd"
[0m21:27:52.487249 [debug] [Thread-4 (]: Writing runtime sql for node "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:27:52.487853 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:27:52.488869 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd: BEGIN
[0m21:27:52.489741 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: BEGIN
[0m21:27:52.490284 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:27:52.490837 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:27:52.491246 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:27:52.491700 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:27:52.492142 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: BEGIN
[0m21:27:52.492843 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: BEGIN
[0m21:27:52.493621 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:27:52.494059 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:27:52.502764 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m21:27:52.503431 [debug] [Thread-2 (]: SQL status: BEGIN in 0.012 seconds
[0m21:27:52.504164 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd"
[0m21:27:52.504817 [debug] [Thread-3 (]: SQL status: BEGIN in 0.011 seconds
[0m21:27:52.505209 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:27:52.505757 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  



select
    1
from "test_db"."public_marts"."comments_by_user"

where not(total_comment_count total_comment_count > 0)


  
  
      
    ) dbt_internal_test
[0m21:27:52.506376 [debug] [Thread-4 (]: SQL status: BEGIN in 0.012 seconds
[0m21:27:52.506877 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:27:52.507408 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select email
from "test_db"."public_marts"."comments_by_user"
where email is null



  
  
      
    ) dbt_internal_test
[0m21:27:52.508131 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:27:52.508738 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select name
from "test_db"."public_marts"."comments_by_user"
where name is null



  
  
      
    ) dbt_internal_test
[0m21:27:52.509427 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "total_comment_count"
LINE 18: where not(total_comment_count total_comment_count > 0)
                                       ^

[0m21:27:52.510045 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select email
from "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user"
where email is null



  
  
      
    ) dbt_internal_test
[0m21:27:52.510894 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd: ROLLBACK
[0m21:27:52.512089 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.002 seconds
[0m21:27:52.512504 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.002 seconds
[0m21:27:52.518605 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.006 seconds
[0m21:27:52.519200 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd: Close
[0m21:27:52.517900 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: ROLLBACK
[0m21:27:52.520775 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: ROLLBACK
[0m21:27:52.522591 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: ROLLBACK
[0m21:27:52.524447 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: Close
[0m21:27:52.525757 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: Close
[0m21:27:52.526152 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: Close
[0m21:27:52.527432 [info ] [Thread-2 (]: 2 of 10 PASS not_null_comments_by_user_email ................................... [[32mPASS[0m in 0.19s]
[0m21:27:52.528196 [info ] [Thread-4 (]: 4 of 10 PASS not_null_genres_and_directors_with_good_comment_each_user_email ... [[32mPASS[0m in 0.19s]
[0m21:27:52.529860 [info ] [Thread-3 (]: 3 of 10 PASS not_null_comments_by_user_name .................................... [[32mPASS[0m in 0.19s]
[0m21:27:52.531016 [debug] [Thread-2 (]: Finished running node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:27:52.531717 [debug] [Thread-4 (]: Finished running node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:27:52.532383 [debug] [Thread-3 (]: Finished running node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:27:52.533370 [debug] [Thread-2 (]: Began running node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:27:52.534553 [debug] [Thread-4 (]: Began running node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:27:52.535403 [debug] [Thread-3 (]: Began running node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:27:52.536453 [info ] [Thread-2 (]: 5 of 10 START test not_null_stg_comments__id ................................... [RUN]
[0m21:27:52.537199 [info ] [Thread-4 (]: 6 of 10 START test not_null_stg_movies__id ..................................... [RUN]
[0m21:27:52.538098 [info ] [Thread-3 (]: 7 of 10 START test unique_comments_by_user__name___email_ ...................... [RUN]
[0m21:27:52.538757 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_comments_by_user_email.761242fc5c, now test.mongo_movies.not_null_stg_comments__id.3928158263)
[0m21:27:52.539391 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750, now test.mongo_movies.not_null_stg_movies__id.66af63a991)
[0m21:27:52.540030 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_comments_by_user_name.5e48cf6675, now test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71)
[0m21:27:52.540587 [debug] [Thread-2 (]: Began compiling node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:27:52.541275 [debug] [Thread-4 (]: Began compiling node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:27:52.541815 [debug] [Thread-3 (]: Began compiling node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:27:52.544019 [debug] [Thread-1 (]: Database Error in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0 (models/schema.yml)
  syntax error at or near "total_comment_count"
  LINE 18: where not(total_comment_count total_comment_count > 0)
                                         ^
  compiled code at target/run/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_fda3dc8cb8c3a1f3e87127391fb46e83.sql
[0m21:27:52.550593 [debug] [Thread-2 (]: Writing injected SQL for node "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:27:52.555102 [debug] [Thread-4 (]: Writing injected SQL for node "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:27:52.563875 [debug] [Thread-3 (]: Writing injected SQL for node "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:27:52.564779 [error] [Thread-1 (]: 1 of 10 ERROR dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0  [[31mERROR[0m in 0.22s]
[0m21:27:52.566675 [debug] [Thread-2 (]: Began executing node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:27:52.567992 [debug] [Thread-1 (]: Finished running node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd
[0m21:27:52.571157 [debug] [Thread-2 (]: Writing runtime sql for node "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:27:52.571743 [debug] [Thread-4 (]: Began executing node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:27:52.572316 [debug] [Thread-3 (]: Began executing node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:27:52.572852 [debug] [Thread-1 (]: Began running node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:27:52.573663 [debug] [Thread-7 (]: Marking all children of 'test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd' to be skipped because of status 'error'.  Reason: Database Error in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0 (models/schema.yml)
  syntax error at or near "total_comment_count"
  LINE 18: where not(total_comment_count total_comment_count > 0)
                                         ^
  compiled code at target/run/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_fda3dc8cb8c3a1f3e87127391fb46e83.sql.
[0m21:27:52.576292 [debug] [Thread-4 (]: Writing runtime sql for node "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:27:52.579479 [debug] [Thread-3 (]: Writing runtime sql for node "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:27:52.580244 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:27:52.580867 [info ] [Thread-1 (]: 8 of 10 START test unique_genres_and_directors_with_good_comment_each_user_email  [RUN]
[0m21:27:52.582916 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:27:52.583648 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: BEGIN
[0m21:27:52.584291 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd, now test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24)
[0m21:27:52.584903 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:27:52.585604 [debug] [Thread-4 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: BEGIN
[0m21:27:52.586415 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:27:52.587193 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:27:52.587851 [debug] [Thread-3 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: BEGIN
[0m21:27:52.588344 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:27:52.593458 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:27:52.594177 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:27:52.595798 [debug] [Thread-1 (]: Began executing node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:27:52.599342 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:27:52.600608 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:27:52.601116 [debug] [Thread-2 (]: SQL status: BEGIN in 0.015 seconds
[0m21:27:52.601642 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: BEGIN
[0m21:27:52.602195 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:27:52.602755 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:27:52.603344 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_stg_comments__id.3928158263"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select _id
from "test_db"."public_staging"."stg_comments"
where _id is null



  
  
      
    ) dbt_internal_test
[0m21:27:52.605168 [debug] [Thread-4 (]: SQL status: BEGIN in 0.017 seconds
[0m21:27:52.605686 [debug] [Thread-3 (]: SQL status: BEGIN in 0.012 seconds
[0m21:27:52.606270 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:27:52.606922 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:27:52.607551 [debug] [Thread-4 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_stg_movies__id.66af63a991"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select _id
from "test_db"."public_staging"."stg_movies"
where _id is null



  
  
      
    ) dbt_internal_test
[0m21:27:52.608058 [debug] [Thread-3 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    (name || '_' || email) as unique_field,
    count(*) as n_records

from "test_db"."public_marts"."comments_by_user"
where (name || '_' || email) is not null
group by (name || '_' || email)
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:27:52.610227 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m21:27:52.612085 [debug] [Thread-3 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: ROLLBACK
[0m21:27:52.612840 [debug] [Thread-3 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: Close
[0m21:27:52.613636 [info ] [Thread-3 (]: 7 of 10 PASS unique_comments_by_user__name___email_ ............................ [[32mPASS[0m in 0.07s]
[0m21:27:52.614343 [debug] [Thread-3 (]: Finished running node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:27:52.615037 [debug] [Thread-3 (]: Began running node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:27:52.615555 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m21:27:52.616131 [info ] [Thread-3 (]: 9 of 10 START test unique_stg_comments__id ..................................... [RUN]
[0m21:27:52.616821 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:27:52.617546 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71, now test.mongo_movies.unique_stg_comments__id.517cb0eade)
[0m21:27:52.618180 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    email as unique_field,
    count(*) as n_records

from "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user"
where email is not null
group by email
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:27:52.618684 [debug] [Thread-3 (]: Began compiling node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:27:52.624442 [debug] [Thread-3 (]: Writing injected SQL for node "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:27:52.624974 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.006 seconds
[0m21:27:52.626728 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: ROLLBACK
[0m21:27:52.627521 [debug] [Thread-3 (]: Began executing node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:27:52.628042 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: Close
[0m21:27:52.631845 [debug] [Thread-3 (]: Writing runtime sql for node "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:27:52.632898 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.029 seconds
[0m21:27:52.633911 [info ] [Thread-1 (]: 8 of 10 PASS unique_genres_and_directors_with_good_comment_each_user_email ..... [[32mPASS[0m in 0.05s]
[0m21:27:52.636220 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: ROLLBACK
[0m21:27:52.637106 [debug] [Thread-1 (]: Finished running node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:27:52.637744 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:27:52.638449 [debug] [Thread-1 (]: Began running node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:27:52.639119 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: Close
[0m21:27:52.639560 [debug] [Thread-3 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: BEGIN
[0m21:27:52.640107 [info ] [Thread-1 (]: 10 of 10 START test unique_stg_movies__id ...................................... [RUN]
[0m21:27:52.640746 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:27:52.641380 [info ] [Thread-2 (]: 5 of 10 PASS not_null_stg_comments__id ......................................... [[32mPASS[0m in 0.10s]
[0m21:27:52.642106 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24, now test.mongo_movies.unique_stg_movies__id.8c3f08cf1c)
[0m21:27:52.643257 [debug] [Thread-2 (]: Finished running node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:27:52.643831 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:27:52.649556 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:27:52.650361 [debug] [Thread-1 (]: Began executing node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:27:52.652755 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:27:52.653517 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:27:52.653941 [debug] [Thread-3 (]: SQL status: BEGIN in 0.013 seconds
[0m21:27:52.654404 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: BEGIN
[0m21:27:52.654960 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:27:52.655645 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:27:52.656230 [debug] [Thread-3 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_stg_comments__id.517cb0eade"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    _id as unique_field,
    count(*) as n_records

from "test_db"."public_staging"."stg_comments"
where _id is not null
group by _id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:27:52.667906 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m21:27:52.668451 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:27:52.668841 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    _id as unique_field,
    count(*) as n_records

from "test_db"."public_staging"."stg_movies"
where _id is not null
group by _id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:27:52.712442 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.055 seconds
[0m21:27:52.714129 [debug] [Thread-3 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: ROLLBACK
[0m21:27:52.714914 [debug] [Thread-3 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: Close
[0m21:27:52.715793 [info ] [Thread-3 (]: 9 of 10 PASS unique_stg_comments__id ........................................... [[32mPASS[0m in 0.10s]
[0m21:27:52.716579 [debug] [Thread-3 (]: Finished running node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:27:52.724629 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.116 seconds
[0m21:27:52.726411 [debug] [Thread-4 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: ROLLBACK
[0m21:27:52.727280 [debug] [Thread-4 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: Close
[0m21:27:52.728333 [info ] [Thread-4 (]: 6 of 10 PASS not_null_stg_movies__id ........................................... [[32mPASS[0m in 0.19s]
[0m21:27:52.729114 [debug] [Thread-4 (]: Finished running node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:27:52.748496 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.079 seconds
[0m21:27:52.750181 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: ROLLBACK
[0m21:27:52.750971 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: Close
[0m21:27:52.751899 [info ] [Thread-1 (]: 10 of 10 PASS unique_stg_movies__id ............................................ [[32mPASS[0m in 0.11s]
[0m21:27:52.752836 [debug] [Thread-1 (]: Finished running node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:27:52.755412 [debug] [MainThread]: Using postgres connection "master"
[0m21:27:52.755786 [debug] [MainThread]: On master: BEGIN
[0m21:27:52.756122 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:27:52.766281 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m21:27:52.766917 [debug] [MainThread]: On master: COMMIT
[0m21:27:52.767362 [debug] [MainThread]: Using postgres connection "master"
[0m21:27:52.767787 [debug] [MainThread]: On master: COMMIT
[0m21:27:52.768398 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m21:27:52.768772 [debug] [MainThread]: On master: Close
[0m21:27:52.769435 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:27:52.769755 [debug] [MainThread]: Connection 'test.mongo_movies.not_null_stg_comments__id.3928158263' was properly closed.
[0m21:27:52.770202 [debug] [MainThread]: Connection 'test.mongo_movies.unique_stg_movies__id.8c3f08cf1c' was properly closed.
[0m21:27:52.770587 [debug] [MainThread]: Connection 'test.mongo_movies.unique_stg_comments__id.517cb0eade' was properly closed.
[0m21:27:52.771098 [debug] [MainThread]: Connection 'test.mongo_movies.not_null_stg_movies__id.66af63a991' was properly closed.
[0m21:27:52.771495 [info ] [MainThread]: 
[0m21:27:52.772012 [info ] [MainThread]: Finished running 10 data tests in 0 hours 0 minutes and 0.60 seconds (0.60s).
[0m21:27:52.773758 [debug] [MainThread]: Command end result
[0m21:27:52.808362 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m21:27:52.810588 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m21:27:52.818845 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m21:27:52.819291 [info ] [MainThread]: 
[0m21:27:52.819736 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:27:52.820129 [info ] [MainThread]: 
[0m21:27:52.820578 [error] [MainThread]: [31mFailure in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0 (models/schema.yml)[0m
[0m21:27:52.821017 [error] [MainThread]:   Database Error in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0 (models/schema.yml)
  syntax error at or near "total_comment_count"
  LINE 18: where not(total_comment_count total_comment_count > 0)
                                         ^
  compiled code at target/run/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_fda3dc8cb8c3a1f3e87127391fb46e83.sql
[0m21:27:52.821393 [info ] [MainThread]: 
[0m21:27:52.821822 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_fda3dc8cb8c3a1f3e87127391fb46e83.sql
[0m21:27:52.822191 [info ] [MainThread]: 
[0m21:27:52.822594 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=10
[0m21:27:52.824119 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": false, "command_wall_clock_time": 1.7255812, "process_in_blocks": "92992", "process_kernel_time": 0.838951, "process_mem_max_rss": "127908", "process_out_blocks": "3896", "process_user_time": 2.792567}
[0m21:27:52.824659 [debug] [MainThread]: Command `dbt test` failed at 21:27:52.824551 after 1.73 seconds
[0m21:27:52.825074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7700ece9b080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7700ece9b200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7700ece997f0>]}
[0m21:27:52.825483 [debug] [MainThread]: Flushing usage events
[0m21:27:54.081178 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:28:10.407265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c84d6eb6990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c84d531dc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c84d7d711c0>]}


============================== 21:28:10.411042 | a9d37569-5501-4004-b398-da3c15ab5cf7 ==============================
[0m21:28:10.411042 [info ] [MainThread]: Running with dbt=1.10.6
[0m21:28:10.411694 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt test', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m21:28:10.643106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a9d37569-5501-4004-b398-da3c15ab5cf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c84d58486b0>]}
[0m21:28:10.727384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a9d37569-5501-4004-b398-da3c15ab5cf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c84d50e6ae0>]}
[0m21:28:10.728240 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m21:28:10.832797 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m21:28:10.957871 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:28:10.958303 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:28:11.007925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a9d37569-5501-4004-b398-da3c15ab5cf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c84d47dcbc0>]}
[0m21:28:11.098406 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m21:28:11.100528 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m21:28:11.123908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a9d37569-5501-4004-b398-da3c15ab5cf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c84d33e7aa0>]}
[0m21:28:11.124613 [info ] [MainThread]: Found 8 models, 10 data tests, 6 sources, 550 macros
[0m21:28:11.125117 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a9d37569-5501-4004-b398-da3c15ab5cf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c84d47de5d0>]}
[0m21:28:11.127366 [info ] [MainThread]: 
[0m21:28:11.127856 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:28:11.128283 [info ] [MainThread]: 
[0m21:28:11.128920 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m21:28:11.133906 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_marts'
[0m21:28:11.134821 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_staging'
[0m21:28:11.185302 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m21:28:11.185731 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m21:28:11.186167 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m21:28:11.186654 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m21:28:11.187204 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:28:11.187701 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:28:11.199199 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m21:28:11.199845 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m21:28:11.200348 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m21:28:11.200776 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m21:28:11.201182 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m21:28:11.201633 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m21:28:11.205638 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.003 seconds
[0m21:28:11.206040 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.004 seconds
[0m21:28:11.207404 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m21:28:11.208631 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m21:28:11.209258 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m21:28:11.209686 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m21:28:11.216477 [debug] [MainThread]: Using postgres connection "master"
[0m21:28:11.216905 [debug] [MainThread]: On master: BEGIN
[0m21:28:11.217209 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:28:11.226145 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m21:28:11.226635 [debug] [MainThread]: Using postgres connection "master"
[0m21:28:11.227523 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m21:28:11.260856 [debug] [MainThread]: SQL status: SELECT 5 in 0.033 seconds
[0m21:28:11.262271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a9d37569-5501-4004-b398-da3c15ab5cf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c84d5f58b60>]}
[0m21:28:11.262783 [debug] [MainThread]: On master: ROLLBACK
[0m21:28:11.263399 [debug] [MainThread]: Using postgres connection "master"
[0m21:28:11.263880 [debug] [MainThread]: On master: BEGIN
[0m21:28:11.264585 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m21:28:11.265017 [debug] [MainThread]: On master: COMMIT
[0m21:28:11.265368 [debug] [MainThread]: Using postgres connection "master"
[0m21:28:11.265683 [debug] [MainThread]: On master: COMMIT
[0m21:28:11.266163 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m21:28:11.266485 [debug] [MainThread]: On master: Close
[0m21:28:11.270670 [debug] [Thread-1 (]: Began running node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd
[0m21:28:11.271267 [debug] [Thread-2 (]: Began running node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:28:11.272152 [debug] [Thread-3 (]: Began running node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:28:11.272828 [debug] [Thread-4 (]: Began running node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:28:11.271759 [info ] [Thread-1 (]: 1 of 10 START test dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0  [RUN]
[0m21:28:11.273475 [info ] [Thread-2 (]: 2 of 10 START test not_null_comments_by_user_email ............................. [RUN]
[0m21:28:11.274124 [info ] [Thread-3 (]: 3 of 10 START test not_null_comments_by_user_name .............................. [RUN]
[0m21:28:11.274791 [info ] [Thread-4 (]: 4 of 10 START test not_null_genres_and_directors_with_good_comment_each_user_email  [RUN]
[0m21:28:11.275446 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd)
[0m21:28:11.276029 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now test.mongo_movies.not_null_comments_by_user_email.761242fc5c)
[0m21:28:11.276589 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.mongo_movies.not_null_comments_by_user_name.5e48cf6675'
[0m21:28:11.277144 [debug] [Thread-4 (]: Acquiring new postgres connection 'test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750'
[0m21:28:11.277644 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd
[0m21:28:11.278238 [debug] [Thread-2 (]: Began compiling node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:28:11.278711 [debug] [Thread-3 (]: Began compiling node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:28:11.279243 [debug] [Thread-4 (]: Began compiling node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:28:11.306033 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd"
[0m21:28:11.309298 [debug] [Thread-2 (]: Writing injected SQL for node "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:28:11.312949 [debug] [Thread-3 (]: Writing injected SQL for node "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:28:11.316727 [debug] [Thread-4 (]: Writing injected SQL for node "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:28:11.318383 [debug] [Thread-1 (]: Began executing node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd
[0m21:28:11.319543 [debug] [Thread-2 (]: Began executing node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:28:11.320180 [debug] [Thread-3 (]: Began executing node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:28:11.325914 [debug] [Thread-4 (]: Began executing node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:28:11.352472 [debug] [Thread-2 (]: Writing runtime sql for node "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:28:11.353974 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd"
[0m21:28:11.356098 [debug] [Thread-3 (]: Writing runtime sql for node "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:28:11.358517 [debug] [Thread-4 (]: Writing runtime sql for node "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:28:11.360858 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd"
[0m21:28:11.361592 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:28:11.362045 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:28:11.362462 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:28:11.362828 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd: BEGIN
[0m21:28:11.363264 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: BEGIN
[0m21:28:11.363817 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: BEGIN
[0m21:28:11.364231 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: BEGIN
[0m21:28:11.364705 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:28:11.365125 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:28:11.365524 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:28:11.365923 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:28:11.376482 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m21:28:11.377130 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd"
[0m21:28:11.378123 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  



select
    1
from "test_db"."public_marts"."comments_by_user"

where not(total_comment_count total_comment_count > 0)


  
  
      
    ) dbt_internal_test
[0m21:28:11.378822 [debug] [Thread-4 (]: SQL status: BEGIN in 0.014 seconds
[0m21:28:11.379189 [debug] [Thread-2 (]: SQL status: BEGIN in 0.014 seconds
[0m21:28:11.379877 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:28:11.380395 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "total_comment_count"
LINE 18: where not(total_comment_count total_comment_count > 0)
                                       ^

[0m21:28:11.380963 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:28:11.381463 [debug] [Thread-3 (]: SQL status: BEGIN in 0.016 seconds
[0m21:28:11.381847 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select email
from "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user"
where email is null



  
  
      
    ) dbt_internal_test
[0m21:28:11.382332 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd: ROLLBACK
[0m21:28:11.382762 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select email
from "test_db"."public_marts"."comments_by_user"
where email is null



  
  
      
    ) dbt_internal_test
[0m21:28:11.383208 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:28:11.384575 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd: Close
[0m21:28:11.385283 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.002 seconds
[0m21:28:11.385684 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.002 seconds
[0m21:28:11.386136 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select name
from "test_db"."public_marts"."comments_by_user"
where name is null



  
  
      
    ) dbt_internal_test
[0m21:28:11.392256 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: ROLLBACK
[0m21:28:11.394629 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: ROLLBACK
[0m21:28:11.396261 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: Close
[0m21:28:11.396734 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.002 seconds
[0m21:28:11.397518 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: Close
[0m21:28:11.398632 [info ] [Thread-4 (]: 4 of 10 PASS not_null_genres_and_directors_with_good_comment_each_user_email ... [[32mPASS[0m in 0.12s]
[0m21:28:11.400671 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: ROLLBACK
[0m21:28:11.402339 [info ] [Thread-2 (]: 2 of 10 PASS not_null_comments_by_user_email ................................... [[32mPASS[0m in 0.13s]
[0m21:28:11.403510 [debug] [Thread-4 (]: Finished running node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:28:11.405312 [debug] [Thread-1 (]: Database Error in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0 (models/schema.yml)
  syntax error at or near "total_comment_count"
  LINE 18: where not(total_comment_count total_comment_count > 0)
                                         ^
  compiled code at target/run/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_fda3dc8cb8c3a1f3e87127391fb46e83.sql
[0m21:28:11.406548 [debug] [Thread-2 (]: Finished running node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:28:11.407061 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: Close
[0m21:28:11.407670 [debug] [Thread-4 (]: Began running node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:28:11.408520 [error] [Thread-1 (]: 1 of 10 ERROR dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0  [[31mERROR[0m in 0.13s]
[0m21:28:11.409324 [debug] [Thread-2 (]: Began running node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:28:11.410244 [info ] [Thread-4 (]: 5 of 10 START test not_null_stg_comments__id ................................... [RUN]
[0m21:28:11.411762 [debug] [Thread-1 (]: Finished running node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd
[0m21:28:11.410845 [info ] [Thread-3 (]: 3 of 10 PASS not_null_comments_by_user_name .................................... [[32mPASS[0m in 0.13s]
[0m21:28:11.412377 [info ] [Thread-2 (]: 6 of 10 START test not_null_stg_movies__id ..................................... [RUN]
[0m21:28:11.413043 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750, now test.mongo_movies.not_null_stg_comments__id.3928158263)
[0m21:28:11.413714 [debug] [Thread-1 (]: Began running node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:28:11.414625 [debug] [Thread-7 (]: Marking all children of 'test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd' to be skipped because of status 'error'.  Reason: Database Error in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0 (models/schema.yml)
  syntax error at or near "total_comment_count"
  LINE 18: where not(total_comment_count total_comment_count > 0)
                                         ^
  compiled code at target/run/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_fda3dc8cb8c3a1f3e87127391fb46e83.sql.
[0m21:28:11.415600 [debug] [Thread-3 (]: Finished running node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:28:11.416476 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_comments_by_user_email.761242fc5c, now test.mongo_movies.not_null_stg_movies__id.66af63a991)
[0m21:28:11.417127 [debug] [Thread-4 (]: Began compiling node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:28:11.417782 [info ] [Thread-1 (]: 7 of 10 START test unique_comments_by_user__name___email_ ...................... [RUN]
[0m21:28:11.419378 [debug] [Thread-3 (]: Began running node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:28:11.420242 [debug] [Thread-2 (]: Began compiling node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:28:11.426425 [debug] [Thread-4 (]: Writing injected SQL for node "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:28:11.427077 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0.8645f449fd, now test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71)
[0m21:28:11.427711 [info ] [Thread-3 (]: 8 of 10 START test unique_genres_and_directors_with_good_comment_each_user_email  [RUN]
[0m21:28:11.431736 [debug] [Thread-2 (]: Writing injected SQL for node "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:28:11.432730 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:28:11.433484 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_comments_by_user_name.5e48cf6675, now test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24)
[0m21:28:11.434162 [debug] [Thread-4 (]: Began executing node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:28:11.513442 [debug] [Thread-3 (]: Began compiling node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:28:11.515338 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:28:11.515935 [debug] [Thread-2 (]: Began executing node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:28:11.518641 [debug] [Thread-4 (]: Writing runtime sql for node "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:28:11.523137 [debug] [Thread-3 (]: Writing injected SQL for node "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:28:11.526105 [debug] [Thread-2 (]: Writing runtime sql for node "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:28:11.527124 [debug] [Thread-1 (]: Began executing node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:28:11.527928 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:28:11.528594 [debug] [Thread-3 (]: Began executing node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:28:11.530870 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:28:11.531437 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:28:11.532351 [debug] [Thread-4 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: BEGIN
[0m21:28:11.535076 [debug] [Thread-3 (]: Writing runtime sql for node "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:28:11.536038 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: BEGIN
[0m21:28:11.536751 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:28:11.537435 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:28:11.538179 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:28:11.539030 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:28:11.539534 [debug] [Thread-1 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: BEGIN
[0m21:28:11.540799 [debug] [Thread-3 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: BEGIN
[0m21:28:11.541394 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:28:11.541885 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:28:11.549380 [debug] [Thread-4 (]: SQL status: BEGIN in 0.013 seconds
[0m21:28:11.550106 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:28:11.550588 [debug] [Thread-2 (]: SQL status: BEGIN in 0.012 seconds
[0m21:28:11.551191 [debug] [Thread-4 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_stg_comments__id.3928158263"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select _id
from "test_db"."public_staging"."stg_comments"
where _id is null



  
  
      
    ) dbt_internal_test
[0m21:28:11.551748 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:28:11.552668 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_stg_movies__id.66af63a991"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select _id
from "test_db"."public_staging"."stg_movies"
where _id is null



  
  
      
    ) dbt_internal_test
[0m21:28:11.553456 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m21:28:11.554012 [debug] [Thread-3 (]: SQL status: BEGIN in 0.012 seconds
[0m21:28:11.554591 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:28:11.555222 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:28:11.555772 [debug] [Thread-1 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    (name || '_' || email) as unique_field,
    count(*) as n_records

from "test_db"."public_marts"."comments_by_user"
where (name || '_' || email) is not null
group by (name || '_' || email)
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:28:11.556414 [debug] [Thread-3 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    email as unique_field,
    count(*) as n_records

from "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user"
where email is not null
group by email
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:28:11.559017 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m21:28:11.559479 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.002 seconds
[0m21:28:11.561453 [debug] [Thread-1 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: ROLLBACK
[0m21:28:11.562828 [debug] [Thread-3 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: ROLLBACK
[0m21:28:11.563580 [debug] [Thread-1 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: Close
[0m21:28:11.564352 [debug] [Thread-3 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: Close
[0m21:28:11.565502 [info ] [Thread-1 (]: 7 of 10 PASS unique_comments_by_user__name___email_ ............................ [[32mPASS[0m in 0.14s]
[0m21:28:11.566193 [info ] [Thread-3 (]: 8 of 10 PASS unique_genres_and_directors_with_good_comment_each_user_email ..... [[32mPASS[0m in 0.13s]
[0m21:28:11.568977 [debug] [Thread-3 (]: Finished running node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:28:11.567882 [debug] [Thread-1 (]: Finished running node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:28:11.569586 [debug] [Thread-3 (]: Began running node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:28:11.570396 [debug] [Thread-1 (]: Began running node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:28:11.571097 [info ] [Thread-3 (]: 9 of 10 START test unique_stg_comments__id ..................................... [RUN]
[0m21:28:11.571950 [info ] [Thread-1 (]: 10 of 10 START test unique_stg_movies__id ...................................... [RUN]
[0m21:28:11.572806 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24, now test.mongo_movies.unique_stg_comments__id.517cb0eade)
[0m21:28:11.573561 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71, now test.mongo_movies.unique_stg_movies__id.8c3f08cf1c)
[0m21:28:11.574478 [debug] [Thread-3 (]: Began compiling node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:28:11.575061 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:28:11.580106 [debug] [Thread-3 (]: Writing injected SQL for node "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:28:11.580762 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.027 seconds
[0m21:28:11.585316 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:28:11.585961 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.034 seconds
[0m21:28:11.587894 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: ROLLBACK
[0m21:28:11.589086 [debug] [Thread-3 (]: Began executing node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:28:11.590923 [debug] [Thread-4 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: ROLLBACK
[0m21:28:11.591474 [debug] [Thread-1 (]: Began executing node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:28:11.594672 [debug] [Thread-3 (]: Writing runtime sql for node "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:28:11.595300 [debug] [Thread-2 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: Close
[0m21:28:11.597909 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:28:11.598343 [debug] [Thread-4 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: Close
[0m21:28:11.599449 [info ] [Thread-2 (]: 6 of 10 PASS not_null_stg_movies__id ........................................... [[32mPASS[0m in 0.18s]
[0m21:28:11.600412 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:28:11.601409 [debug] [Thread-2 (]: Finished running node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:28:11.601958 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:28:11.602695 [info ] [Thread-4 (]: 5 of 10 PASS not_null_stg_comments__id ......................................... [[32mPASS[0m in 0.19s]
[0m21:28:11.603511 [debug] [Thread-3 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: BEGIN
[0m21:28:11.604401 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: BEGIN
[0m21:28:11.605025 [debug] [Thread-4 (]: Finished running node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:28:11.605515 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:28:11.605957 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:28:11.615916 [debug] [Thread-3 (]: SQL status: BEGIN in 0.010 seconds
[0m21:28:11.616422 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m21:28:11.616949 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:28:11.617401 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:28:11.618059 [debug] [Thread-3 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_stg_comments__id.517cb0eade"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    _id as unique_field,
    count(*) as n_records

from "test_db"."public_staging"."stg_comments"
where _id is not null
group by _id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:28:11.618860 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    _id as unique_field,
    count(*) as n_records

from "test_db"."public_staging"."stg_movies"
where _id is not null
group by _id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:28:11.649351 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.030 seconds
[0m21:28:11.651825 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: ROLLBACK
[0m21:28:11.652753 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: Close
[0m21:28:11.653966 [info ] [Thread-1 (]: 10 of 10 PASS unique_stg_movies__id ............................................ [[32mPASS[0m in 0.08s]
[0m21:28:11.654977 [debug] [Thread-1 (]: Finished running node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:28:11.678496 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.059 seconds
[0m21:28:11.680401 [debug] [Thread-3 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: ROLLBACK
[0m21:28:11.681088 [debug] [Thread-3 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: Close
[0m21:28:11.682071 [info ] [Thread-3 (]: 9 of 10 PASS unique_stg_comments__id ........................................... [[32mPASS[0m in 0.11s]
[0m21:28:11.682907 [debug] [Thread-3 (]: Finished running node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:28:11.685490 [debug] [MainThread]: Using postgres connection "master"
[0m21:28:11.686034 [debug] [MainThread]: On master: BEGIN
[0m21:28:11.686465 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:28:11.695844 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m21:28:11.696328 [debug] [MainThread]: On master: COMMIT
[0m21:28:11.696717 [debug] [MainThread]: Using postgres connection "master"
[0m21:28:11.697180 [debug] [MainThread]: On master: COMMIT
[0m21:28:11.697773 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m21:28:11.698134 [debug] [MainThread]: On master: Close
[0m21:28:11.698728 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:28:11.699089 [debug] [MainThread]: Connection 'test.mongo_movies.unique_stg_movies__id.8c3f08cf1c' was properly closed.
[0m21:28:11.699474 [debug] [MainThread]: Connection 'test.mongo_movies.not_null_stg_movies__id.66af63a991' was properly closed.
[0m21:28:11.699976 [debug] [MainThread]: Connection 'test.mongo_movies.unique_stg_comments__id.517cb0eade' was properly closed.
[0m21:28:11.700355 [debug] [MainThread]: Connection 'test.mongo_movies.not_null_stg_comments__id.3928158263' was properly closed.
[0m21:28:11.700817 [info ] [MainThread]: 
[0m21:28:11.701321 [info ] [MainThread]: Finished running 10 data tests in 0 hours 0 minutes and 0.57 seconds (0.57s).
[0m21:28:11.703327 [debug] [MainThread]: Command end result
[0m21:28:11.735349 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m21:28:11.738049 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m21:28:11.744474 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m21:28:11.744844 [info ] [MainThread]: 
[0m21:28:11.745262 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:28:11.745641 [info ] [MainThread]: 
[0m21:28:11.746084 [error] [MainThread]: [31mFailure in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0 (models/schema.yml)[0m
[0m21:28:11.746519 [error] [MainThread]:   Database Error in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__total_comment_count_0 (models/schema.yml)
  syntax error at or near "total_comment_count"
  LINE 18: where not(total_comment_count total_comment_count > 0)
                                         ^
  compiled code at target/run/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_fda3dc8cb8c3a1f3e87127391fb46e83.sql
[0m21:28:11.746903 [info ] [MainThread]: 
[0m21:28:11.747316 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_fda3dc8cb8c3a1f3e87127391fb46e83.sql
[0m21:28:11.747699 [info ] [MainThread]: 
[0m21:28:11.748085 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=10
[0m21:28:11.749087 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": false, "command_wall_clock_time": 1.4125592, "process_in_blocks": "0", "process_kernel_time": 0.507464, "process_mem_max_rss": "128924", "process_out_blocks": "2704", "process_user_time": 2.658146}
[0m21:28:11.749534 [debug] [MainThread]: Command `dbt test` failed at 21:28:11.749435 after 1.41 seconds
[0m21:28:11.749906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c84d181cad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c84d181cf20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c84d181d850>]}
[0m21:28:11.750282 [debug] [MainThread]: Flushing usage events
[0m21:28:12.878058 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:28:37.197515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a68105524b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a680de75640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a680ea11640>]}


============================== 21:28:37.201183 | 70012692-41a4-43f9-a496-29240b6828a2 ==============================
[0m21:28:37.201183 [info ] [MainThread]: Running with dbt=1.10.6
[0m21:28:37.201795 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt test', 'send_anonymous_usage_stats': 'True'}
[0m21:28:37.417162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '70012692-41a4-43f9-a496-29240b6828a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a680d4f2f60>]}
[0m21:28:37.505632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '70012692-41a4-43f9-a496-29240b6828a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a680df40f80>]}
[0m21:28:37.506724 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m21:28:37.616814 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m21:28:37.755027 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:28:37.756058 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/schema.yml
[0m21:28:38.382574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '70012692-41a4-43f9-a496-29240b6828a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6809401910>]}
[0m21:28:38.468905 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m21:28:38.470811 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m21:28:38.492731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '70012692-41a4-43f9-a496-29240b6828a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a680b9d95e0>]}
[0m21:28:38.493293 [info ] [MainThread]: Found 8 models, 10 data tests, 6 sources, 550 macros
[0m21:28:38.493695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '70012692-41a4-43f9-a496-29240b6828a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a680b9a18b0>]}
[0m21:28:38.495805 [info ] [MainThread]: 
[0m21:28:38.496221 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:28:38.496599 [info ] [MainThread]: 
[0m21:28:38.497165 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m21:28:38.501304 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_staging'
[0m21:28:38.507663 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_marts'
[0m21:28:38.553662 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m21:28:38.554409 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m21:28:38.555133 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m21:28:38.555725 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m21:28:38.556260 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:28:38.556674 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:28:38.569850 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m21:28:38.570405 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m21:28:38.570935 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m21:28:38.571408 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m21:28:38.571898 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m21:28:38.572444 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m21:28:38.576891 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.005 seconds
[0m21:28:38.578433 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m21:28:38.578821 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.006 seconds
[0m21:28:38.580156 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m21:28:38.580529 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m21:28:38.581123 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m21:28:38.588401 [debug] [MainThread]: Using postgres connection "master"
[0m21:28:38.588756 [debug] [MainThread]: On master: BEGIN
[0m21:28:38.589070 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:28:38.599248 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m21:28:38.599989 [debug] [MainThread]: Using postgres connection "master"
[0m21:28:38.600381 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m21:28:38.633833 [debug] [MainThread]: SQL status: SELECT 5 in 0.033 seconds
[0m21:28:38.635680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '70012692-41a4-43f9-a496-29240b6828a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a681031d1f0>]}
[0m21:28:38.636220 [debug] [MainThread]: On master: ROLLBACK
[0m21:28:38.636780 [debug] [MainThread]: Using postgres connection "master"
[0m21:28:38.637224 [debug] [MainThread]: On master: BEGIN
[0m21:28:38.638201 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m21:28:38.638524 [debug] [MainThread]: On master: COMMIT
[0m21:28:38.638913 [debug] [MainThread]: Using postgres connection "master"
[0m21:28:38.639361 [debug] [MainThread]: On master: COMMIT
[0m21:28:38.639859 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m21:28:38.640218 [debug] [MainThread]: On master: Close
[0m21:28:38.645500 [debug] [Thread-1 (]: Began running node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__comments_by_user_total_comment_count_0.71355d3ca6
[0m21:28:38.646367 [debug] [Thread-2 (]: Began running node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:28:38.647011 [debug] [Thread-3 (]: Began running node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:28:38.648276 [debug] [Thread-4 (]: Began running node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:28:38.647812 [info ] [Thread-1 (]: 1 of 10 START test dbt_utils_expression_is_true_comments_by_user_total_comment_count__comments_by_user_total_comment_count_0  [RUN]
[0m21:28:38.649035 [info ] [Thread-2 (]: 2 of 10 START test not_null_comments_by_user_email ............................. [RUN]
[0m21:28:38.649719 [info ] [Thread-3 (]: 3 of 10 START test not_null_comments_by_user_name .............................. [RUN]
[0m21:28:38.650428 [info ] [Thread-4 (]: 4 of 10 START test not_null_genres_and_directors_with_good_comment_each_user_email  [RUN]
[0m21:28:38.651189 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__comments_by_user_total_comment_count_0.71355d3ca6)
[0m21:28:38.652151 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now test.mongo_movies.not_null_comments_by_user_email.761242fc5c)
[0m21:28:38.652991 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.mongo_movies.not_null_comments_by_user_name.5e48cf6675'
[0m21:28:38.653543 [debug] [Thread-4 (]: Acquiring new postgres connection 'test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750'
[0m21:28:38.654142 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__comments_by_user_total_comment_count_0.71355d3ca6
[0m21:28:38.654670 [debug] [Thread-2 (]: Began compiling node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:28:38.655147 [debug] [Thread-3 (]: Began compiling node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:28:38.655667 [debug] [Thread-4 (]: Began compiling node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:28:38.668268 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__comments_by_user_total_comment_count_0.71355d3ca6"
[0m21:28:38.674559 [debug] [Thread-2 (]: Writing injected SQL for node "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:28:38.679100 [debug] [Thread-3 (]: Writing injected SQL for node "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:28:38.684886 [debug] [Thread-4 (]: Writing injected SQL for node "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:28:38.686982 [debug] [Thread-1 (]: Began executing node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__comments_by_user_total_comment_count_0.71355d3ca6
[0m21:28:38.687583 [debug] [Thread-3 (]: Began executing node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:28:38.700143 [debug] [Thread-4 (]: Began executing node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:28:38.700743 [debug] [Thread-2 (]: Began executing node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:28:38.706338 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__comments_by_user_total_comment_count_0.71355d3ca6"
[0m21:28:38.709900 [debug] [Thread-3 (]: Writing runtime sql for node "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:28:38.712696 [debug] [Thread-4 (]: Writing runtime sql for node "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:28:38.715055 [debug] [Thread-2 (]: Writing runtime sql for node "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:28:38.717389 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__comments_by_user_total_comment_count_0.71355d3ca6"
[0m21:28:38.718203 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:28:38.718708 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:28:38.719317 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__comments_by_user_total_comment_count_0.71355d3ca6: BEGIN
[0m21:28:38.719734 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:28:38.720183 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: BEGIN
[0m21:28:38.720639 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: BEGIN
[0m21:28:38.721117 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:28:38.721545 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: BEGIN
[0m21:28:38.721979 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:28:38.722439 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:28:38.723153 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:28:38.734208 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m21:28:38.734889 [debug] [Thread-4 (]: SQL status: BEGIN in 0.013 seconds
[0m21:28:38.735452 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__comments_by_user_total_comment_count_0.71355d3ca6"
[0m21:28:38.736091 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:28:38.736747 [debug] [Thread-2 (]: SQL status: BEGIN in 0.014 seconds
[0m21:28:38.737155 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__comments_by_user_total_comment_count_0.71355d3ca6: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__comments_by_user_total_comment_count_0.71355d3ca6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  



select
    1
from "test_db"."public_marts"."comments_by_user"

where not(total_comment_count comments_by_user.total_comment_count > 0)


  
  
      
    ) dbt_internal_test
[0m21:28:38.737560 [debug] [Thread-3 (]: SQL status: BEGIN in 0.014 seconds
[0m21:28:38.738017 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select email
from "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user"
where email is null



  
  
      
    ) dbt_internal_test
[0m21:28:38.738500 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:28:38.739180 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:28:38.740002 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "comments_by_user"
LINE 18: where not(total_comment_count comments_by_user.total_comment...
                                       ^

[0m21:28:38.740607 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select email
from "test_db"."public_marts"."comments_by_user"
where email is null



  
  
      
    ) dbt_internal_test
[0m21:28:38.741147 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select name
from "test_db"."public_marts"."comments_by_user"
where name is null



  
  
      
    ) dbt_internal_test
[0m21:28:38.741772 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m21:28:38.742223 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__comments_by_user_total_comment_count_0.71355d3ca6: ROLLBACK
[0m21:28:38.747071 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: ROLLBACK
[0m21:28:38.747731 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.005 seconds
[0m21:28:38.748459 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.006 seconds
[0m21:28:38.749318 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__comments_by_user_total_comment_count_0.71355d3ca6: Close
[0m21:28:38.749680 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: Close
[0m21:28:38.751428 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: ROLLBACK
[0m21:28:38.753264 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: ROLLBACK
[0m21:28:38.755805 [info ] [Thread-4 (]: 4 of 10 PASS not_null_genres_and_directors_with_good_comment_each_user_email ... [[32mPASS[0m in 0.10s]
[0m21:28:38.756871 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: Close
[0m21:28:38.757711 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: Close
[0m21:28:38.758423 [debug] [Thread-4 (]: Finished running node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:28:38.759935 [info ] [Thread-3 (]: 3 of 10 PASS not_null_comments_by_user_name .................................... [[32mPASS[0m in 0.11s]
[0m21:28:38.762619 [debug] [Thread-4 (]: Began running node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:28:38.761635 [info ] [Thread-2 (]: 2 of 10 PASS not_null_comments_by_user_email ................................... [[32mPASS[0m in 0.11s]
[0m21:28:38.764412 [debug] [Thread-3 (]: Finished running node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:28:38.766263 [debug] [Thread-1 (]: Database Error in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__comments_by_user_total_comment_count_0 (models/schema.yml)
  syntax error at or near "comments_by_user"
  LINE 18: where not(total_comment_count comments_by_user.total_comment...
                                         ^
  compiled code at target/run/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_e2f778b5b78307284c98141d6283dd94.sql
[0m21:28:38.766763 [info ] [Thread-4 (]: 5 of 10 START test not_null_stg_comments__id ................................... [RUN]
[0m21:28:38.767587 [debug] [Thread-2 (]: Finished running node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:28:38.768116 [debug] [Thread-3 (]: Began running node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:28:38.768856 [error] [Thread-1 (]: 1 of 10 ERROR dbt_utils_expression_is_true_comments_by_user_total_comment_count__comments_by_user_total_comment_count_0  [[31mERROR[0m in 0.12s]
[0m21:28:38.769576 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750, now test.mongo_movies.not_null_stg_comments__id.3928158263)
[0m21:28:38.770185 [debug] [Thread-2 (]: Began running node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:28:38.770715 [info ] [Thread-3 (]: 6 of 10 START test not_null_stg_movies__id ..................................... [RUN]
[0m21:28:38.771566 [debug] [Thread-1 (]: Finished running node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__comments_by_user_total_comment_count_0.71355d3ca6
[0m21:28:38.772175 [debug] [Thread-4 (]: Began compiling node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:28:38.772743 [info ] [Thread-2 (]: 7 of 10 START test unique_comments_by_user__name___email_ ...................... [RUN]
[0m21:28:38.773346 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_comments_by_user_name.5e48cf6675, now test.mongo_movies.not_null_stg_movies__id.66af63a991)
[0m21:28:38.773897 [debug] [Thread-1 (]: Began running node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:28:38.774747 [debug] [Thread-7 (]: Marking all children of 'test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__comments_by_user_total_comment_count_0.71355d3ca6' to be skipped because of status 'error'.  Reason: Database Error in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__comments_by_user_total_comment_count_0 (models/schema.yml)
  syntax error at or near "comments_by_user"
  LINE 18: where not(total_comment_count comments_by_user.total_comment...
                                         ^
  compiled code at target/run/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_e2f778b5b78307284c98141d6283dd94.sql.
[0m21:28:38.779477 [debug] [Thread-4 (]: Writing injected SQL for node "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:28:38.780208 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_comments_by_user_email.761242fc5c, now test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71)
[0m21:28:38.780885 [debug] [Thread-3 (]: Began compiling node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:28:38.781540 [info ] [Thread-1 (]: 8 of 10 START test unique_genres_and_directors_with_good_comment_each_user_email  [RUN]
[0m21:28:38.783640 [debug] [Thread-2 (]: Began compiling node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:28:38.788285 [debug] [Thread-3 (]: Writing injected SQL for node "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:28:38.788949 [debug] [Thread-4 (]: Began executing node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:28:38.789587 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count__comments_by_user_total_comment_count_0.71355d3ca6, now test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24)
[0m21:28:38.796808 [debug] [Thread-2 (]: Writing injected SQL for node "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:28:38.799680 [debug] [Thread-4 (]: Writing runtime sql for node "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:28:38.800403 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:28:38.800927 [debug] [Thread-3 (]: Began executing node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:28:38.807543 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:28:38.808378 [debug] [Thread-2 (]: Began executing node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:28:38.809329 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:28:38.812298 [debug] [Thread-3 (]: Writing runtime sql for node "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:28:38.814796 [debug] [Thread-2 (]: Writing runtime sql for node "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:28:38.815562 [debug] [Thread-4 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: BEGIN
[0m21:28:38.815996 [debug] [Thread-1 (]: Began executing node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:28:38.817019 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:28:38.817763 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:28:38.818190 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:28:38.820637 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:28:38.821424 [debug] [Thread-2 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: BEGIN
[0m21:28:38.821974 [debug] [Thread-3 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: BEGIN
[0m21:28:38.822766 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:28:38.823305 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:28:38.823714 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:28:38.824849 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: BEGIN
[0m21:28:38.825422 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:28:38.832081 [debug] [Thread-4 (]: SQL status: BEGIN in 0.015 seconds
[0m21:28:38.832636 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:28:38.833208 [debug] [Thread-4 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_stg_comments__id.3928158263"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select _id
from "test_db"."public_staging"."stg_comments"
where _id is null



  
  
      
    ) dbt_internal_test
[0m21:28:38.834773 [debug] [Thread-2 (]: SQL status: BEGIN in 0.012 seconds
[0m21:28:38.835338 [debug] [Thread-3 (]: SQL status: BEGIN in 0.012 seconds
[0m21:28:38.835929 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:28:38.836405 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m21:28:38.836788 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:28:38.837296 [debug] [Thread-2 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    (name || '_' || email) as unique_field,
    count(*) as n_records

from "test_db"."public_marts"."comments_by_user"
where (name || '_' || email) is not null
group by (name || '_' || email)
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:28:38.837745 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:28:38.838294 [debug] [Thread-3 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_stg_movies__id.66af63a991"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select _id
from "test_db"."public_staging"."stg_movies"
where _id is null



  
  
      
    ) dbt_internal_test
[0m21:28:38.839007 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    email as unique_field,
    count(*) as n_records

from "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user"
where email is not null
group by email
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:28:38.840383 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.002 seconds
[0m21:28:38.842835 [debug] [Thread-2 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: ROLLBACK
[0m21:28:38.843484 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m21:28:38.845316 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: ROLLBACK
[0m21:28:38.845834 [debug] [Thread-2 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: Close
[0m21:28:38.846657 [debug] [Thread-1 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: Close
[0m21:28:38.847425 [info ] [Thread-2 (]: 7 of 10 PASS unique_comments_by_user__name___email_ ............................ [[32mPASS[0m in 0.07s]
[0m21:28:38.848393 [debug] [Thread-2 (]: Finished running node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:28:38.849072 [info ] [Thread-1 (]: 8 of 10 PASS unique_genres_and_directors_with_good_comment_each_user_email ..... [[32mPASS[0m in 0.06s]
[0m21:28:38.849780 [debug] [Thread-2 (]: Began running node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:28:38.850655 [debug] [Thread-1 (]: Finished running node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:28:38.851115 [info ] [Thread-2 (]: 9 of 10 START test unique_stg_comments__id ..................................... [RUN]
[0m21:28:38.851803 [debug] [Thread-1 (]: Began running node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:28:38.852411 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71, now test.mongo_movies.unique_stg_comments__id.517cb0eade)
[0m21:28:38.852914 [info ] [Thread-1 (]: 10 of 10 START test unique_stg_movies__id ...................................... [RUN]
[0m21:28:38.853538 [debug] [Thread-2 (]: Began compiling node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:28:38.854179 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24, now test.mongo_movies.unique_stg_movies__id.8c3f08cf1c)
[0m21:28:38.859115 [debug] [Thread-2 (]: Writing injected SQL for node "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:28:38.859979 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.020 seconds
[0m21:28:38.860460 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:28:38.860886 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.027 seconds
[0m21:28:38.863105 [debug] [Thread-3 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: ROLLBACK
[0m21:28:38.867632 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:28:38.868179 [debug] [Thread-2 (]: Began executing node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:28:38.870026 [debug] [Thread-4 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: ROLLBACK
[0m21:28:38.872826 [debug] [Thread-2 (]: Writing runtime sql for node "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:28:38.873521 [debug] [Thread-3 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: Close
[0m21:28:38.874153 [debug] [Thread-1 (]: Began executing node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:28:38.874927 [debug] [Thread-4 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: Close
[0m21:28:38.878355 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:28:38.878949 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:28:38.876068 [info ] [Thread-3 (]: 6 of 10 PASS not_null_stg_movies__id ........................................... [[32mPASS[0m in 0.10s]
[0m21:28:38.880323 [info ] [Thread-4 (]: 5 of 10 PASS not_null_stg_comments__id ......................................... [[32mPASS[0m in 0.11s]
[0m21:28:38.881083 [debug] [Thread-2 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: BEGIN
[0m21:28:38.881809 [debug] [Thread-3 (]: Finished running node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:28:38.882415 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:28:38.883083 [debug] [Thread-4 (]: Finished running node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:28:38.883606 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:28:38.884504 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: BEGIN
[0m21:28:38.885508 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:28:38.895244 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m21:28:38.895964 [debug] [Thread-2 (]: SQL status: BEGIN in 0.012 seconds
[0m21:28:38.896515 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:28:38.897133 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:28:38.897703 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    _id as unique_field,
    count(*) as n_records

from "test_db"."public_staging"."stg_movies"
where _id is not null
group by _id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:28:38.898258 [debug] [Thread-2 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_stg_comments__id.517cb0eade"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    _id as unique_field,
    count(*) as n_records

from "test_db"."public_staging"."stg_comments"
where _id is not null
group by _id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:28:38.926790 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.028 seconds
[0m21:28:38.928491 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: ROLLBACK
[0m21:28:38.929178 [debug] [Thread-1 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: Close
[0m21:28:38.929923 [info ] [Thread-1 (]: 10 of 10 PASS unique_stg_movies__id ............................................ [[32mPASS[0m in 0.08s]
[0m21:28:38.930643 [debug] [Thread-1 (]: Finished running node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:28:38.949038 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.050 seconds
[0m21:28:38.950658 [debug] [Thread-2 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: ROLLBACK
[0m21:28:38.951503 [debug] [Thread-2 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: Close
[0m21:28:38.952567 [info ] [Thread-2 (]: 9 of 10 PASS unique_stg_comments__id ........................................... [[32mPASS[0m in 0.10s]
[0m21:28:38.953216 [debug] [Thread-2 (]: Finished running node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:28:38.955717 [debug] [MainThread]: Using postgres connection "master"
[0m21:28:38.956106 [debug] [MainThread]: On master: BEGIN
[0m21:28:38.956461 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:28:38.966089 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m21:28:38.966765 [debug] [MainThread]: On master: COMMIT
[0m21:28:38.967214 [debug] [MainThread]: Using postgres connection "master"
[0m21:28:38.967647 [debug] [MainThread]: On master: COMMIT
[0m21:28:38.968301 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m21:28:38.968672 [debug] [MainThread]: On master: Close
[0m21:28:38.969250 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:28:38.969554 [debug] [MainThread]: Connection 'test.mongo_movies.unique_stg_movies__id.8c3f08cf1c' was properly closed.
[0m21:28:38.969842 [debug] [MainThread]: Connection 'test.mongo_movies.unique_stg_comments__id.517cb0eade' was properly closed.
[0m21:28:38.970157 [debug] [MainThread]: Connection 'test.mongo_movies.not_null_stg_movies__id.66af63a991' was properly closed.
[0m21:28:38.970435 [debug] [MainThread]: Connection 'test.mongo_movies.not_null_stg_comments__id.3928158263' was properly closed.
[0m21:28:38.970784 [info ] [MainThread]: 
[0m21:28:38.971188 [info ] [MainThread]: Finished running 10 data tests in 0 hours 0 minutes and 0.47 seconds (0.47s).
[0m21:28:38.972929 [debug] [MainThread]: Command end result
[0m21:28:39.002683 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m21:28:39.004634 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m21:28:39.011891 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m21:28:39.012316 [info ] [MainThread]: 
[0m21:28:39.012820 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:28:39.013213 [info ] [MainThread]: 
[0m21:28:39.013664 [error] [MainThread]: [31mFailure in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__comments_by_user_total_comment_count_0 (models/schema.yml)[0m
[0m21:28:39.014125 [error] [MainThread]:   Database Error in test dbt_utils_expression_is_true_comments_by_user_total_comment_count__comments_by_user_total_comment_count_0 (models/schema.yml)
  syntax error at or near "comments_by_user"
  LINE 18: where not(total_comment_count comments_by_user.total_comment...
                                         ^
  compiled code at target/run/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_e2f778b5b78307284c98141d6283dd94.sql
[0m21:28:39.015064 [info ] [MainThread]: 
[0m21:28:39.015580 [info ] [MainThread]:   compiled code at target/compiled/mongo_movies/models/schema.yml/dbt_utils_expression_is_true_c_e2f778b5b78307284c98141d6283dd94.sql
[0m21:28:39.015954 [info ] [MainThread]: 
[0m21:28:39.016356 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=10
[0m21:28:39.017415 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": false, "command_wall_clock_time": 1.9041556, "process_in_blocks": "400", "process_kernel_time": 0.631504, "process_mem_max_rss": "134236", "process_out_blocks": "3896", "process_user_time": 3.169514}
[0m21:28:39.017886 [debug] [MainThread]: Command `dbt test` failed at 21:28:39.017785 after 1.90 seconds
[0m21:28:39.018263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a680de005c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a68105524b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a680e84ce00>]}
[0m21:28:39.018676 [debug] [MainThread]: Flushing usage events
[0m21:28:55.669391 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:29:44.547121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a524077a7e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a524056ca70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a52413cffb0>]}


============================== 21:29:44.553241 | a7dc2f5f-52c8-4099-97c9-984a7bdbc272 ==============================
[0m21:29:44.553241 [info ] [MainThread]: Running with dbt=1.10.6
[0m21:29:44.553995 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/adminxx/astro-dlt-dbt/include/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/adminxx/astro-dlt-dbt/include/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt test', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:29:44.881576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a7dc2f5f-52c8-4099-97c9-984a7bdbc272', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a523fe3eba0>]}
[0m21:29:44.972199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a7dc2f5f-52c8-4099-97c9-984a7bdbc272', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a523f9dae40>]}
[0m21:29:44.974057 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m21:29:45.087843 [debug] [MainThread]: checksum: f6e4baf4de20596ffb9d14e6ef805989eb0e1950dedc3cc83d03f20aa023904c, vars: {}, profile: , target: , version: 1.10.6
[0m21:30:00.791164 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:30:00.792368 [debug] [MainThread]: Partial parsing: updated file: mongo_movies://models/schema.yml
[0m21:29:46.010023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a7dc2f5f-52c8-4099-97c9-984a7bdbc272', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a523dd9bad0>]}
[0m21:29:46.107358 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m21:29:46.111391 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m21:29:46.151618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a7dc2f5f-52c8-4099-97c9-984a7bdbc272', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a523e5b0f80>]}
[0m21:29:46.152245 [info ] [MainThread]: Found 8 models, 10 data tests, 6 sources, 550 macros
[0m21:29:46.152777 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a7dc2f5f-52c8-4099-97c9-984a7bdbc272', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a523e1554f0>]}
[0m21:29:46.155795 [info ] [MainThread]: 
[0m21:29:46.156307 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:29:46.156779 [info ] [MainThread]: 
[0m21:29:46.157474 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m21:29:46.163562 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_staging'
[0m21:29:46.164442 [debug] [ThreadPool]: Acquiring new postgres connection 'list_test_db_public_marts'
[0m21:29:46.224692 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m21:29:46.225731 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m21:29:46.226328 [debug] [ThreadPool]: On list_test_db_public_staging: BEGIN
[0m21:29:46.226952 [debug] [ThreadPool]: On list_test_db_public_marts: BEGIN
[0m21:29:46.227463 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:29:46.227885 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:29:46.253536 [debug] [ThreadPool]: SQL status: BEGIN in 0.026 seconds
[0m21:29:46.254145 [debug] [ThreadPool]: SQL status: BEGIN in 0.026 seconds
[0m21:29:46.254710 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_staging"
[0m21:29:46.255152 [debug] [ThreadPool]: Using postgres connection "list_test_db_public_marts"
[0m21:29:46.255720 [debug] [ThreadPool]: On list_test_db_public_staging: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_staging"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_staging'
  
[0m21:29:46.256564 [debug] [ThreadPool]: On list_test_db_public_marts: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "list_test_db_public_marts"} */
select
      'test_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_marts'
    union all
    select
      'test_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_marts'
  
[0m21:29:46.261879 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.004 seconds
[0m21:29:46.262585 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.005 seconds
[0m21:29:46.264472 [debug] [ThreadPool]: On list_test_db_public_marts: ROLLBACK
[0m21:29:46.266027 [debug] [ThreadPool]: On list_test_db_public_staging: ROLLBACK
[0m21:29:46.266754 [debug] [ThreadPool]: On list_test_db_public_marts: Close
[0m21:29:46.267130 [debug] [ThreadPool]: On list_test_db_public_staging: Close
[0m21:29:46.275453 [debug] [MainThread]: Using postgres connection "master"
[0m21:29:46.276230 [debug] [MainThread]: On master: BEGIN
[0m21:29:46.276787 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:29:46.287339 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m21:29:46.287865 [debug] [MainThread]: Using postgres connection "master"
[0m21:29:46.288403 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m21:29:46.325624 [debug] [MainThread]: SQL status: SELECT 5 in 0.037 seconds
[0m21:29:46.327645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a7dc2f5f-52c8-4099-97c9-984a7bdbc272', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a523e1dbaa0>]}
[0m21:29:46.328287 [debug] [MainThread]: On master: ROLLBACK
[0m21:29:46.328999 [debug] [MainThread]: Using postgres connection "master"
[0m21:29:46.329420 [debug] [MainThread]: On master: BEGIN
[0m21:29:46.330229 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m21:29:46.330648 [debug] [MainThread]: On master: COMMIT
[0m21:29:46.330986 [debug] [MainThread]: Using postgres connection "master"
[0m21:29:46.331297 [debug] [MainThread]: On master: COMMIT
[0m21:29:46.331791 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m21:29:46.332184 [debug] [MainThread]: On master: Close
[0m21:29:46.337213 [debug] [Thread-1 (]: Began running node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count_0.2d21c93045
[0m21:29:46.338088 [debug] [Thread-2 (]: Began running node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:29:46.339096 [debug] [Thread-3 (]: Began running node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:29:46.339572 [debug] [Thread-4 (]: Began running node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:29:46.338710 [info ] [Thread-1 (]: 1 of 10 START test dbt_utils_expression_is_true_comments_by_user_total_comment_count_0  [RUN]
[0m21:29:46.340310 [info ] [Thread-2 (]: 2 of 10 START test not_null_comments_by_user_email ............................. [RUN]
[0m21:29:46.341219 [info ] [Thread-3 (]: 3 of 10 START test not_null_comments_by_user_name .............................. [RUN]
[0m21:29:46.341924 [info ] [Thread-4 (]: 4 of 10 START test not_null_genres_and_directors_with_good_comment_each_user_email  [RUN]
[0m21:29:46.342812 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_test_db_public_staging, now test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count_0.2d21c93045)
[0m21:29:46.343461 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_test_db_public_marts, now test.mongo_movies.not_null_comments_by_user_email.761242fc5c)
[0m21:29:46.344160 [debug] [Thread-3 (]: Acquiring new postgres connection 'test.mongo_movies.not_null_comments_by_user_name.5e48cf6675'
[0m21:29:46.344871 [debug] [Thread-4 (]: Acquiring new postgres connection 'test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750'
[0m21:29:46.345383 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count_0.2d21c93045
[0m21:29:46.345906 [debug] [Thread-2 (]: Began compiling node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:29:46.346468 [debug] [Thread-3 (]: Began compiling node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:29:46.347037 [debug] [Thread-4 (]: Began compiling node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:29:46.356961 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count_0.2d21c93045"
[0m21:29:46.365078 [debug] [Thread-2 (]: Writing injected SQL for node "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:29:46.369750 [debug] [Thread-3 (]: Writing injected SQL for node "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:29:46.376237 [debug] [Thread-4 (]: Writing injected SQL for node "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:29:46.378152 [debug] [Thread-1 (]: Began executing node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count_0.2d21c93045
[0m21:29:46.379276 [debug] [Thread-3 (]: Began executing node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:29:46.385122 [debug] [Thread-2 (]: Began executing node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:29:46.401040 [debug] [Thread-3 (]: Writing runtime sql for node "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:29:46.401669 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count_0.2d21c93045"
[0m21:29:46.402164 [debug] [Thread-4 (]: Began executing node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:29:46.404720 [debug] [Thread-2 (]: Writing runtime sql for node "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:29:46.408287 [debug] [Thread-4 (]: Writing runtime sql for node "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:29:46.409138 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:29:46.409895 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count_0.2d21c93045"
[0m21:29:46.411229 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: BEGIN
[0m21:29:46.411814 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:29:46.412406 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:29:46.412847 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count_0.2d21c93045: BEGIN
[0m21:29:46.413323 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:29:46.413771 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: BEGIN
[0m21:29:46.414257 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: BEGIN
[0m21:29:46.414697 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:29:46.415355 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:29:46.415884 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:29:46.426207 [debug] [Thread-3 (]: SQL status: BEGIN in 0.013 seconds
[0m21:29:46.427007 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m21:29:46.427877 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"
[0m21:29:46.428682 [debug] [Thread-4 (]: SQL status: BEGIN in 0.013 seconds
[0m21:29:46.429173 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count_0.2d21c93045"
[0m21:29:46.429600 [debug] [Thread-2 (]: SQL status: BEGIN in 0.014 seconds
[0m21:29:46.430122 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_comments_by_user_name.5e48cf6675"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select name
from "test_db"."public_marts"."comments_by_user"
where name is null



  
  
      
    ) dbt_internal_test
[0m21:29:46.430721 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"
[0m21:29:46.431194 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count_0.2d21c93045: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count_0.2d21c93045"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  



select
    1
from "test_db"."public_marts"."comments_by_user"

where not(total_comment_count > 0)


  
  
      
    ) dbt_internal_test
[0m21:29:46.431868 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"
[0m21:29:46.432814 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select email
from "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user"
where email is null



  
  
      
    ) dbt_internal_test
[0m21:29:46.433695 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_comments_by_user_email.761242fc5c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select email
from "test_db"."public_marts"."comments_by_user"
where email is null



  
  
      
    ) dbt_internal_test
[0m21:29:46.434264 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.002 seconds
[0m21:29:46.434813 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.001 seconds
[0m21:29:46.439502 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: ROLLBACK
[0m21:29:46.440175 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.005 seconds
[0m21:29:46.440658 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.006 seconds
[0m21:29:46.442333 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count_0.2d21c93045: ROLLBACK
[0m21:29:46.444587 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: ROLLBACK
[0m21:29:46.445124 [debug] [Thread-3 (]: On test.mongo_movies.not_null_comments_by_user_name.5e48cf6675: Close
[0m21:29:46.446893 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: ROLLBACK
[0m21:29:46.448026 [debug] [Thread-1 (]: On test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count_0.2d21c93045: Close
[0m21:29:46.449598 [debug] [Thread-2 (]: On test.mongo_movies.not_null_comments_by_user_email.761242fc5c: Close
[0m21:29:46.449087 [info ] [Thread-3 (]: 3 of 10 PASS not_null_comments_by_user_name .................................... [[32mPASS[0m in 0.10s]
[0m21:29:46.450689 [info ] [Thread-1 (]: 1 of 10 PASS dbt_utils_expression_is_true_comments_by_user_total_comment_count_0  [[32mPASS[0m in 0.11s]
[0m21:29:46.452207 [debug] [Thread-3 (]: Finished running node test.mongo_movies.not_null_comments_by_user_name.5e48cf6675
[0m21:29:46.452613 [debug] [Thread-4 (]: On test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750: Close
[0m21:29:46.451502 [info ] [Thread-2 (]: 2 of 10 PASS not_null_comments_by_user_email ................................... [[32mPASS[0m in 0.11s]
[0m21:29:46.453498 [debug] [Thread-1 (]: Finished running node test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count_0.2d21c93045
[0m21:29:46.454057 [debug] [Thread-3 (]: Began running node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:29:46.454961 [debug] [Thread-2 (]: Finished running node test.mongo_movies.not_null_comments_by_user_email.761242fc5c
[0m21:29:46.455625 [info ] [Thread-4 (]: 4 of 10 PASS not_null_genres_and_directors_with_good_comment_each_user_email ... [[32mPASS[0m in 0.11s]
[0m21:29:46.456317 [debug] [Thread-1 (]: Began running node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:29:46.457026 [info ] [Thread-3 (]: 5 of 10 START test not_null_stg_comments__id ................................... [RUN]
[0m21:29:46.457814 [debug] [Thread-2 (]: Began running node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:29:46.458680 [debug] [Thread-4 (]: Finished running node test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750
[0m21:29:46.459238 [info ] [Thread-1 (]: 6 of 10 START test not_null_stg_movies__id ..................................... [RUN]
[0m21:29:46.459930 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_comments_by_user_name.5e48cf6675, now test.mongo_movies.not_null_stg_comments__id.3928158263)
[0m21:29:46.460559 [info ] [Thread-2 (]: 7 of 10 START test unique_comments_by_user__name___email_ ...................... [RUN]
[0m21:29:46.461500 [debug] [Thread-4 (]: Began running node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:29:46.462359 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.mongo_movies.dbt_utils_expression_is_true_comments_by_user_total_comment_count_0.2d21c93045, now test.mongo_movies.not_null_stg_movies__id.66af63a991)
[0m21:29:46.462999 [debug] [Thread-3 (]: Began compiling node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:29:46.463585 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_comments_by_user_email.761242fc5c, now test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71)
[0m21:29:46.464218 [info ] [Thread-4 (]: 8 of 10 START test unique_genres_and_directors_with_good_comment_each_user_email  [RUN]
[0m21:29:46.464983 [debug] [Thread-1 (]: Began compiling node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:29:46.471035 [debug] [Thread-3 (]: Writing injected SQL for node "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:29:46.471806 [debug] [Thread-2 (]: Began compiling node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:29:46.472666 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.mongo_movies.not_null_genres_and_directors_with_good_comment_each_user_email.3651f80750, now test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24)
[0m21:29:46.476942 [debug] [Thread-1 (]: Writing injected SQL for node "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:29:46.483774 [debug] [Thread-2 (]: Writing injected SQL for node "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:29:46.484791 [debug] [Thread-4 (]: Began compiling node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:29:46.485343 [debug] [Thread-3 (]: Began executing node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:29:46.489683 [debug] [Thread-4 (]: Writing injected SQL for node "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:29:46.496182 [debug] [Thread-1 (]: Began executing node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:29:46.496782 [debug] [Thread-2 (]: Began executing node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:29:46.495265 [debug] [Thread-3 (]: Writing runtime sql for node "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:29:46.499807 [debug] [Thread-1 (]: Writing runtime sql for node "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:29:46.502538 [debug] [Thread-2 (]: Writing runtime sql for node "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:29:46.503476 [debug] [Thread-4 (]: Began executing node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:29:46.504986 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:29:46.505654 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:29:46.508070 [debug] [Thread-4 (]: Writing runtime sql for node "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:29:46.508737 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:29:46.509830 [debug] [Thread-3 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: BEGIN
[0m21:29:46.510536 [debug] [Thread-1 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: BEGIN
[0m21:29:46.511417 [debug] [Thread-2 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: BEGIN
[0m21:29:46.512193 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:29:46.512938 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:29:46.513391 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:29:46.513879 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:29:46.514736 [debug] [Thread-4 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: BEGIN
[0m21:29:46.515913 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:29:46.525922 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m21:29:46.526769 [debug] [Thread-3 (]: SQL status: BEGIN in 0.015 seconds
[0m21:29:46.527672 [debug] [Thread-1 (]: Using postgres connection "test.mongo_movies.not_null_stg_movies__id.66af63a991"
[0m21:29:46.528558 [debug] [Thread-3 (]: Using postgres connection "test.mongo_movies.not_null_stg_comments__id.3928158263"
[0m21:29:46.529169 [debug] [Thread-2 (]: SQL status: BEGIN in 0.015 seconds
[0m21:29:46.529907 [debug] [Thread-1 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_stg_movies__id.66af63a991"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select _id
from "test_db"."public_staging"."stg_movies"
where _id is null



  
  
      
    ) dbt_internal_test
[0m21:29:46.530583 [debug] [Thread-4 (]: SQL status: BEGIN in 0.015 seconds
[0m21:29:46.531147 [debug] [Thread-3 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.not_null_stg_comments__id.3928158263"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select _id
from "test_db"."public_staging"."stg_comments"
where _id is null



  
  
      
    ) dbt_internal_test
[0m21:29:46.531640 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"
[0m21:29:46.532513 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"
[0m21:29:46.533218 [debug] [Thread-2 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    (name || '_' || email) as unique_field,
    count(*) as n_records

from "test_db"."public_marts"."comments_by_user"
where (name || '_' || email) is not null
group by (name || '_' || email)
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:29:46.533897 [debug] [Thread-4 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    email as unique_field,
    count(*) as n_records

from "test_db"."public_marts"."genres_and_directors_with_good_comment_each_user"
where email is not null
group by email
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:29:46.536570 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.002 seconds
[0m21:29:46.537130 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.003 seconds
[0m21:29:46.539274 [debug] [Thread-4 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: ROLLBACK
[0m21:29:46.541258 [debug] [Thread-2 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: ROLLBACK
[0m21:29:46.542392 [debug] [Thread-2 (]: On test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71: Close
[0m21:29:46.542907 [debug] [Thread-4 (]: On test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24: Close
[0m21:29:46.544034 [info ] [Thread-2 (]: 7 of 10 PASS unique_comments_by_user__name___email_ ............................ [[32mPASS[0m in 0.08s]
[0m21:29:46.546011 [debug] [Thread-2 (]: Finished running node test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71
[0m21:29:46.544959 [info ] [Thread-4 (]: 8 of 10 PASS unique_genres_and_directors_with_good_comment_each_user_email ..... [[32mPASS[0m in 0.07s]
[0m21:29:46.546910 [debug] [Thread-2 (]: Began running node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:29:46.548036 [debug] [Thread-4 (]: Finished running node test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24
[0m21:29:46.548753 [info ] [Thread-2 (]: 9 of 10 START test unique_stg_comments__id ..................................... [RUN]
[0m21:29:46.549634 [debug] [Thread-4 (]: Began running node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:29:46.550489 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.mongo_movies.unique_comments_by_user__name___email_.8b4983be71, now test.mongo_movies.unique_stg_comments__id.517cb0eade)
[0m21:29:46.551057 [info ] [Thread-4 (]: 10 of 10 START test unique_stg_movies__id ...................................... [RUN]
[0m21:29:46.551777 [debug] [Thread-2 (]: Began compiling node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:29:46.552442 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.mongo_movies.unique_genres_and_directors_with_good_comment_each_user_email.a62c3b9b24, now test.mongo_movies.unique_stg_movies__id.8c3f08cf1c)
[0m21:29:46.556827 [debug] [Thread-2 (]: Writing injected SQL for node "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:29:46.557652 [debug] [Thread-4 (]: Began compiling node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:29:46.558973 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.026 seconds
[0m21:29:46.565663 [debug] [Thread-4 (]: Writing injected SQL for node "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:29:46.566594 [debug] [Thread-2 (]: Began executing node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:29:46.568436 [debug] [Thread-3 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: ROLLBACK
[0m21:29:46.571485 [debug] [Thread-2 (]: Writing runtime sql for node "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:29:46.572317 [debug] [Thread-4 (]: Began executing node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:29:46.572926 [debug] [Thread-3 (]: On test.mongo_movies.not_null_stg_comments__id.3928158263: Close
[0m21:29:46.576297 [debug] [Thread-4 (]: Writing runtime sql for node "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:29:46.578315 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:29:46.577732 [info ] [Thread-3 (]: 5 of 10 PASS not_null_stg_comments__id ......................................... [[32mPASS[0m in 0.12s]
[0m21:29:46.579300 [debug] [Thread-2 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: BEGIN
[0m21:29:46.580195 [debug] [Thread-3 (]: Finished running node test.mongo_movies.not_null_stg_comments__id.3928158263
[0m21:29:46.580895 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:29:46.581437 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:29:46.582460 [debug] [Thread-4 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: BEGIN
[0m21:29:46.583364 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:29:46.593364 [debug] [Thread-2 (]: SQL status: BEGIN in 0.012 seconds
[0m21:29:46.594513 [debug] [Thread-2 (]: Using postgres connection "test.mongo_movies.unique_stg_comments__id.517cb0eade"
[0m21:29:46.595388 [debug] [Thread-2 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_stg_comments__id.517cb0eade"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    _id as unique_field,
    count(*) as n_records

from "test_db"."public_staging"."stg_comments"
where _id is not null
group by _id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:29:46.596013 [debug] [Thread-4 (]: SQL status: BEGIN in 0.013 seconds
[0m21:29:46.596739 [debug] [Thread-4 (]: Using postgres connection "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"
[0m21:29:46.597229 [debug] [Thread-4 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: /* {"app": "dbt", "dbt_version": "1.10.6", "profile_name": "default", "target_name": "dev", "node_id": "test.mongo_movies.unique_stg_movies__id.8c3f08cf1c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    _id as unique_field,
    count(*) as n_records

from "test_db"."public_staging"."stg_movies"
where _id is not null
group by _id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:29:46.647610 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.115 seconds
[0m21:29:46.649374 [debug] [Thread-1 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: ROLLBACK
[0m21:29:46.650174 [debug] [Thread-1 (]: On test.mongo_movies.not_null_stg_movies__id.66af63a991: Close
[0m21:29:46.651258 [info ] [Thread-1 (]: 6 of 10 PASS not_null_stg_movies__id ........................................... [[32mPASS[0m in 0.19s]
[0m21:29:46.652054 [debug] [Thread-1 (]: Finished running node test.mongo_movies.not_null_stg_movies__id.66af63a991
[0m21:29:46.653566 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.057 seconds
[0m21:29:46.655106 [debug] [Thread-2 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: ROLLBACK
[0m21:29:46.655765 [debug] [Thread-2 (]: On test.mongo_movies.unique_stg_comments__id.517cb0eade: Close
[0m21:29:46.656618 [info ] [Thread-2 (]: 9 of 10 PASS unique_stg_comments__id ........................................... [[32mPASS[0m in 0.11s]
[0m21:29:46.657486 [debug] [Thread-2 (]: Finished running node test.mongo_movies.unique_stg_comments__id.517cb0eade
[0m21:29:46.666534 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.069 seconds
[0m21:29:46.668274 [debug] [Thread-4 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: ROLLBACK
[0m21:29:46.669144 [debug] [Thread-4 (]: On test.mongo_movies.unique_stg_movies__id.8c3f08cf1c: Close
[0m21:29:46.670225 [info ] [Thread-4 (]: 10 of 10 PASS unique_stg_movies__id ............................................ [[32mPASS[0m in 0.12s]
[0m21:29:46.670877 [debug] [Thread-4 (]: Finished running node test.mongo_movies.unique_stg_movies__id.8c3f08cf1c
[0m21:29:46.673394 [debug] [MainThread]: Using postgres connection "master"
[0m21:29:46.673820 [debug] [MainThread]: On master: BEGIN
[0m21:29:46.674180 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:29:46.685272 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m21:29:46.685787 [debug] [MainThread]: On master: COMMIT
[0m21:29:46.686185 [debug] [MainThread]: Using postgres connection "master"
[0m21:29:46.686522 [debug] [MainThread]: On master: COMMIT
[0m21:29:46.687019 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m21:29:46.687357 [debug] [MainThread]: On master: Close
[0m21:29:46.687965 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:29:46.688368 [debug] [MainThread]: Connection 'test.mongo_movies.not_null_stg_movies__id.66af63a991' was properly closed.
[0m21:29:46.688675 [debug] [MainThread]: Connection 'test.mongo_movies.unique_stg_comments__id.517cb0eade' was properly closed.
[0m21:29:46.688975 [debug] [MainThread]: Connection 'test.mongo_movies.not_null_stg_comments__id.3928158263' was properly closed.
[0m21:29:46.689256 [debug] [MainThread]: Connection 'test.mongo_movies.unique_stg_movies__id.8c3f08cf1c' was properly closed.
[0m21:29:46.689641 [info ] [MainThread]: 
[0m21:29:46.690200 [info ] [MainThread]: Finished running 10 data tests in 0 hours 0 minutes and 0.53 seconds (0.53s).
[0m21:29:46.691994 [debug] [MainThread]: Command end result
[0m21:29:46.721955 [debug] [MainThread]: Wrote artifact WritableManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/manifest.json
[0m21:29:46.724061 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/adminxx/astro-dlt-dbt/include/dbt/target/semantic_manifest.json
[0m21:29:46.733528 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/adminxx/astro-dlt-dbt/include/dbt/target/run_results.json
[0m21:29:46.734059 [info ] [MainThread]: 
[0m21:29:46.734568 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:29:46.734974 [info ] [MainThread]: 
[0m21:29:46.735389 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=10
[0m21:29:46.737040 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 2.2550151, "process_in_blocks": "93160", "process_kernel_time": 0.698639, "process_mem_max_rss": "133292", "process_out_blocks": "3872", "process_user_time": 3.452578}
[0m21:29:46.737620 [debug] [MainThread]: Command `dbt test` succeeded at 21:29:46.737463 after 2.26 seconds
[0m21:29:46.738127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5240a4cda0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5240442de0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a52408cb650>]}
[0m21:29:46.738637 [debug] [MainThread]: Flushing usage events
[0m21:29:48.065628 [debug] [MainThread]: An error was encountered while trying to flush usage events
